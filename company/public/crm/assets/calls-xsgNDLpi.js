import{r as l,j as e,T as p,v as le,I as f,B as r,D as Z,p as M,q as b,S as ve,h as Se,d as O}from"./index-Co7v2xsC.js";import{C as we}from"./config-global-BX9xwJzv.js";import{d as ke}from"./dayjs.min-C2542nnJ.js";import{r as _e,u as F,w as De}from"./reports-0l1D3gVE.js";import{getDoctypeList as Ie}from"./leads-d5FzXGcx.js";import{D as Re,C as H}from"./Card-CDV3jV6O.js";import{g as We}from"./calls-Cmwi30yB.js";import{L as Te}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{D as Oe,a as Fe}from"./DialogContent-DtP-sWqR.js";import{D as Pe}from"./DialogTitle-C3eBZids.js";import{E as Ee}from"./export-fields-dialog-DKDJ10Kv.js";import{S as _}from"./Stack-GQIY7Xk9.js";import{L as Le,A as Ae}from"./AdapterDayjs-BPhbSeWE.js";import{D as ee}from"./DatePicker-BMZY9CMK.js";import{F as P,S as E}from"./Select-B1EkSlUY.js";import{T as Ye,a as ze,b as Me,c as B,d as o,e as Be}from"./TableRow-DqeBPnxy.js";import{C as te}from"./Checkbox-CoJXcvzD.js";import{T as Ne}from"./TablePagination-CEaYVDlQ.js";import"./api-error-handler-CV6pRVHb.js";import"./utils-CQVN1UoU.js";import"./RadioGroup-B7r1ll7C.js";import"./useFormControl-Cqn8lfES.js";import"./FormControlLabel-CEvUm0a3.js";import"./DialogActions-h_2rRG3x.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./TextField-BmVWmDzd.js";import"./Chip-Rg4Dn3a5.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function He({open:a,onClose:i,callId:g}){const[s,d]=l.useState(null),[j,x]=l.useState(!1);l.useEffect(()=>{a&&g?(x(!0),We(g).then(h=>{d(h),x(!1)}).catch(h=>{console.error(h),x(!1)})):d(null)},[a,g]);const C=h=>{switch(h){case"Completed":return"success";case"Scheduled":return"info";case"Overdue":return"error";case"Cancelled":return"warning";default:return"default"}};return e.jsxs(Oe,{open:a,onClose:i,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Pe,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(p,{variant:"h6",sx:{fontWeight:800},children:"Call Details"}),e.jsx(le,{onClick:i,sx:{color:h=>h.palette.grey[500],bgcolor:"background.paper",boxShadow:h=>{var w;return(w=h.customShadows)==null?void 0:w.z1}},children:e.jsx(f,{icon:"mingcute:close-line"})})]}),e.jsx(Fe,{sx:{p:4,m:2,mt:4},children:j?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(f,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):s?e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(r,{sx:{width:64,height:64,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.lighter",color:"primary.main"},children:e.jsx(f,{icon:"solar:phone-calling-bold",width:32})}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsx(p,{variant:"h5",sx:{fontWeight:800},children:s.title}),e.jsxs(p,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:[s.call_for," with ",s.lead_name]})]}),e.jsxs(r,{sx:{textAlign:"right"},children:[e.jsx(Te,{variant:"soft",color:C(s.outgoing_call_status),children:s.outgoing_call_status}),e.jsxs(p,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled",fontWeight:700},children:["ID: ",s.name]})]})]}),e.jsx(Z,{sx:{borderStyle:"dashed"}}),e.jsxs(r,{children:[e.jsx(N,{title:"Call Information",icon:"solar:info-circle-bold"}),e.jsxs(r,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(y,{label:"Subject",value:s.title,icon:"solar:pen-bold",fullWidth:!0}),e.jsx(y,{label:"Call For",value:s.call_for,icon:"solar:user-bold"}),e.jsx(y,{label:"Reference",value:s.lead_name,icon:"solar:link-bold"}),e.jsx(y,{label:"Start Time",value:s.call_start_time?new Date(s.call_start_time).toLocaleString():"-",icon:"solar:clock-circle-bold"}),e.jsx(y,{label:"End Time",value:s.call_end_time?new Date(s.call_end_time).toLocaleString():"-",icon:"solar:clock-circle-bold"}),e.jsx(y,{label:"Owner",value:s.owner,icon:"solar:user-rounded-bold"})]})]}),e.jsx(Z,{sx:{borderStyle:"dashed"}}),e.jsxs(r,{children:[e.jsx(N,{title:"Call Discussion",icon:"solar:notebook-bold"}),e.jsxs(r,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(y,{label:"Purpose",value:s.call_purpose,icon:"solar:flag-bold",fullWidth:!0}),e.jsx(y,{label:"Agenda",value:s.call_agenda,icon:"solar:checklist-bold",fullWidth:!0})]})]}),e.jsxs(r,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(N,{title:"System Information",icon:"solar:clock-circle-bold",noMargin:!0}),e.jsxs(r,{sx:{mt:3,display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(y,{label:"Created On",value:new Date(s.creation).toLocaleString(),icon:"solar:calendar-date-bold"}),e.jsx(y,{label:"Modified On",value:new Date(s.modified).toLocaleString(),icon:"solar:calendar-minimalistic-bold"})]})]})]}):e.jsxs(r,{sx:{py:10,textAlign:"center"},children:[e.jsx(f,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(p,{variant:"h6",sx:{color:"text.secondary"},children:"No Details Found"})]})})]})}function N({title:a,icon:i,noMargin:g=!1}){return e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:g?0:2.5},children:[e.jsx(f,{icon:i,width:20,sx:{color:"primary.main"}}),e.jsx(p,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:a})]})}function y({label:a,value:i,icon:g,color:s="text.primary",fullWidth:d}){return e.jsxs(r,{sx:d?{gridColumn:"1 / -1"}:{},children:[e.jsx(p,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:a}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{icon:g,width:16,sx:{color:"text.disabled"}}),e.jsx(p,{variant:"body2",sx:{fontWeight:700,color:s},children:i||"-"})]})]})}function $e(){const[a,i]=l.useState([]),[g,s]=l.useState([]),[d,j]=l.useState(!1),[x,C]=l.useState(null),[h,w]=l.useState(null),[D,$]=l.useState("all"),[I,G]=l.useState("all"),[R,U]=l.useState("all"),[W,V]=l.useState("all"),[se,ae]=l.useState([]),[re]=l.useState(["Scheduled","Completed","Overdue","Cancelled"]),[oe]=l.useState(["Lead","Contact","Prospect","Customer"]),[L,A]=l.useState(0),[T,ne]=l.useState(10),[ie,q]=l.useState(!1),[ce,J]=l.useState(null),[u,Y]=l.useState([]),de=t=>{if(t.target.checked){const c=a.map(n=>n.name);Y(c);return}Y([])},xe=(t,c)=>{const n=u.indexOf(c);let m=[];n===-1?m=m.concat(u,c):n===0?m=m.concat(u.slice(1)):n===u.length-1?m=m.concat(u.slice(0,-1)):n>0&&(m=m.concat(u.slice(0,n),u.slice(n+1))),Y(m)},[he,K]=l.useState(!1),ue=async(t,c)=>{j(!0);try{const n=u.length>0?u:a.map(v=>v.name);if(n.length===0){j(!1);return}const m=[["Calls","name","in",n]],je=new URLSearchParams({doctype:"Calls",fields:JSON.stringify(t),filters:JSON.stringify(m),limit_page_length:"99999"}),Q=await fetch(`/api/method/frappe.client.get_list?${je.toString()}`,{credentials:"include"});if(!Q.ok)throw new Error("Failed to fetch data for export");const be=(await Q.json()).message||[],X=F.json_to_sheet(be);if(c==="excel"){const v=F.book_new();F.book_append_sheet(v,X,"Calls"),De(v,"Calls_Report.xlsx")}else{const v=F.sheet_to_csv(X),ye=new Blob([v],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a"),Ce=URL.createObjectURL(ye);S.setAttribute("href",Ce),S.setAttribute("download","Calls_Report.csv"),S.style.visibility="hidden",document.body.appendChild(S),S.click(),document.body.removeChild(S)}}catch(n){console.error(n)}finally{j(!1)}},me=l.useCallback(t=>{J(t),q(!0)},[]),pe=l.useCallback((t,c)=>{A(c)},[]),ge=l.useCallback(t=>{ne(parseInt(t.target.value,10)),A(0)},[]),z=l.useCallback(async()=>{j(!0);try{const t={};x&&(t.from_date=x.format("YYYY-MM-DD")),h&&(t.to_date=h.format("YYYY-MM-DD")),D!=="all"&&(t.call_for=D),I!=="all"&&(t.status=I),R!=="all"&&(t.owner_name=R),W!=="all"&&(t.enable_reminder=W);const c=await _e("Calls Report",t);i(c.result||[]),s(c.report_summary||[]),A(0)}catch(t){console.error("Failed to fetch calls report:",t)}finally{j(!1)}},[x,h,D,I,R,W]);l.useEffect(()=>{z()},[z]);const fe=()=>{C(null),w(null),$("all"),G("all"),U("all"),V("all")};return l.useEffect(()=>{Ie("User").then(ae)},[]),e.jsxs(Re,{children:[e.jsxs(_,{spacing:3,children:[e.jsxs(_,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(p,{variant:"h4",children:"Calls Report"}),e.jsxs(_,{direction:"row",spacing:1,children:[e.jsx(M,{variant:"outlined",startIcon:e.jsx(f,{icon:"solar:refresh-bold"}),onClick:z,disabled:d,children:"Refresh"}),e.jsx(M,{variant:"outlined",color:"error",startIcon:e.jsx(f,{icon:"solar:restart-bold"}),onClick:fe,children:"Reset"})]})]}),e.jsxs(H,{sx:{p:2.5,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"background.neutral",border:t=>`1px solid ${t.palette.divider}`},children:[e.jsxs(Le,{dateAdapter:Ae,children:[e.jsx(ee,{label:"From Date",value:x,onChange:t=>C(t),slotProps:{textField:{size:"small"}}}),e.jsx(ee,{label:"To Date",value:h,onChange:t=>w(t),slotProps:{textField:{size:"small"}}})]}),e.jsx(P,{size:"small",sx:{minWidth:160},children:e.jsxs(E,{value:D,onChange:t=>$(t.target.value),displayEmpty:!0,children:[e.jsx(b,{value:"all",children:"Call For"}),oe.map(t=>e.jsx(b,{value:t,children:t},t))]})}),e.jsx(P,{size:"small",sx:{minWidth:160},children:e.jsxs(E,{value:I,onChange:t=>G(t.target.value),displayEmpty:!0,children:[e.jsx(b,{value:"all",children:"Status"}),re.map(t=>e.jsx(b,{value:t,children:t},t))]})}),e.jsx(P,{size:"small",sx:{minWidth:160},children:e.jsxs(E,{value:R,onChange:t=>U(t.target.value),displayEmpty:!0,children:[e.jsx(b,{value:"all",children:"Owner"}),e.jsx(b,{value:"Administrator",children:"Administrator"}),se.filter(t=>t!=="Administrator").map(t=>e.jsx(b,{value:t,children:t},t))]})}),e.jsx(P,{size:"small",sx:{minWidth:160},children:e.jsxs(E,{value:W,onChange:t=>V(t.target.value),displayEmpty:!0,children:[e.jsx(b,{value:"all",children:"Reminder"}),e.jsx(b,{value:"1",children:"Enabled"}),e.jsx(b,{value:"0",children:"Disabled"})]})}),e.jsx(r,{sx:{flexGrow:1}}),e.jsx(M,{variant:"contained",startIcon:e.jsx(f,{icon:"solar:export-bold"}),onClick:()=>K(!0),children:"Export"})]}),e.jsxs(r,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"}},children:[g.map((t,c)=>e.jsx(k,{item:t},c)),g.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(k,{item:{label:"Total Calls",value:0,indicator:"blue"}}),e.jsx(k,{item:{label:"Scheduled",value:0,indicator:"orange"}}),e.jsx(k,{item:{label:"Completed",value:0,indicator:"green"}}),e.jsx(k,{item:{label:"With Reminder",value:0,indicator:"red"}})]})]}),e.jsxs(H,{children:[e.jsx(Ye,{sx:{position:"relative",overflow:"unset"},children:e.jsx(ve,{children:e.jsxs(ze,{size:"medium",stickyHeader:!0,children:[e.jsx(Me,{children:e.jsxs(B,{sx:{bgcolor:"#f4f6f8"},children:[e.jsx(o,{padding:"checkbox",children:e.jsx(te,{indeterminate:u.length>0&&u.length<a.length,checked:a.length>0&&u.length===a.length,onChange:de})}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Title"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Call For"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Lead/Contact"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Account"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Status"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Time"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Owner"}),e.jsx(o,{align:"right",sx:{fontWeight:700,color:"text.secondary",position:"sticky",right:0,bgcolor:"#f4f6f8",zIndex:11},children:"Actions"})]})}),e.jsxs(Be,{children:[a.slice(L*T,L*T+T).map((t,c)=>{const n=u.indexOf(t.name)!==-1;return e.jsxs(B,{hover:!0,role:"checkbox","aria-checked":n,selected:n,children:[e.jsx(o,{padding:"checkbox",children:e.jsx(te,{checked:n,onClick:m=>xe(m,t.name)})}),e.jsx(o,{sx:{fontWeight:600},children:t.title}),e.jsx(o,{children:t.call_for}),e.jsx(o,{children:t.lead_name||t.contact_name||"-"}),e.jsx(o,{children:t.account_name||"-"}),e.jsx(o,{children:t.outgoing_call_status}),e.jsx(o,{children:e.jsx(p,{variant:"body2",children:t.call_start_time?ke(t.call_start_time).format("DD MMM YYYY HH:mm"):"-"})}),e.jsx(o,{children:t.owner_name}),e.jsx(o,{align:"right",sx:{position:"sticky",right:0,bgcolor:"background.paper",boxShadow:"-2px 0 4px rgba(145, 158, 171, 0.08)"},children:e.jsx(le,{onClick:()=>me(t.name),sx:{color:"info.main"},children:e.jsx(f,{icon:"solar:eye-bold"})})})]},c)}),a.length===0&&!d&&e.jsx(B,{children:e.jsx(o,{colSpan:9,align:"center",sx:{py:10},children:e.jsxs(_,{spacing:1,alignItems:"center",children:[e.jsx(f,{icon:"eva:slash-outline",width:48,sx:{color:"text.disabled"}}),e.jsx(p,{variant:"body2",sx:{color:"text.disabled"},children:"No data found"})]})})})]})]})})}),e.jsx(Ne,{component:"div",count:a.length,page:L,onPageChange:pe,rowsPerPage:T,onRowsPerPageChange:ge,rowsPerPageOptions:[5,10,25]})]})]}),e.jsx(He,{open:ie,callId:ce,onClose:()=>{q(!1),J(null)}}),e.jsx(Ee,{open:he,onClose:()=>K(!1),doctype:"Calls",onExport:ue})]})}function k({item:a}){var j;const i=Se(),g=x=>{switch(x==null?void 0:x.toLowerCase()){case"blue":return i.palette.info.main;case"green":return i.palette.success.main;case"orange":return i.palette.warning.main;case"red":return i.palette.error.main;default:return i.palette.primary.main}},s=x=>{const C=x.toLowerCase();return C.includes("call")?"solar:phone-calling-rounded-bold-duotone":C.includes("scheduled")?"solar:calendar-mark-bold-duotone":C.includes("completed")?"solar:check-circle-bold-duotone":C.includes("reminder")?"solar:bell-bing-bold-duotone":"solar:chart-2-bold-duotone"},d=g(a.indicator);return e.jsxs(H,{sx:{p:3,boxShadow:"none",position:"relative",overflow:"hidden",bgcolor:O(d,.04),border:`1px solid ${O(d,.1)}`,transition:i.transitions.create(["transform","box-shadow"]),"&:hover":{transform:"translateY(-4px)",boxShadow:`0 12px 24px -4px ${O(d,.12)}`}},children:[e.jsxs(_,{direction:"row",alignItems:"center",spacing:2.5,children:[e.jsx(r,{sx:{width:48,height:48,flexShrink:0,display:"flex",borderRadius:1.5,alignItems:"center",justifyContent:"center",color:d,bgcolor:O(d,.1)},children:e.jsx(f,{icon:s(a.label),width:28})}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:700,mb:.5},children:a.label}),e.jsx(p,{variant:"h4",sx:{color:"text.primary",fontWeight:800},children:(j=a.value)==null?void 0:j.toLocaleString()})]})]}),e.jsx(r,{sx:{top:-16,right:-16,width:80,height:80,opacity:.08,position:"absolute",borderRadius:"50%",bgcolor:d}})]})}function wt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Calls Report - ${we.appName}`}),e.jsx($e,{})]})}export{wt as default};
