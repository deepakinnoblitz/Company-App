import{f as h,H as j,r as f,j as e,B as c,T as p,v as k,I as C,q as d,p as v,w as O}from"./index-Co7v2xsC.js";import{d as S}from"./dayjs.min-C2542nnJ.js";import{h as g}from"./api-error-handler-CV6pRVHb.js";import{h as _}from"./utils-CQVN1UoU.js";import{D as F,a as W}from"./DialogContent-DtP-sWqR.js";import{D as E}from"./DialogTitle-C3eBZids.js";import{L as I,A as P}from"./AdapterDayjs-BPhbSeWE.js";import{T as A}from"./TextField-BmVWmDzd.js";import{G as m}from"./Grid-BdmJn5bP.js";import{F as D,a as w,S as b}from"./Select-B1EkSlUY.js";import{D as M}from"./DatePicker-BMZY9CMK.js";import{D as Y}from"./DialogActions-h_2rRG3x.js";import{S as L}from"./Snackbar-BVA3LOhi.js";async function ee(i,s){const t=[];i&&s&&t.push(["ToDo","date","between",[i,s]]);const r=new URLSearchParams({doctype:"ToDo",fields:JSON.stringify(["name","description","status","priority","date","allocated_to","reference_type","reference_name","color"]),filters:JSON.stringify(t),limit_page_length:"1000",order_by:"date asc"}),l=await h(`/api/method/frappe.client.get_list?${r.toString()}`);return(await _(l)).message}async function N(i){const s=await j(),t=await h("/api/method/frappe.client.insert",{method:"POST",headers:s,body:JSON.stringify({doc:{doctype:"ToDo",...i}})});if(!t.ok){const r=await t.json();throw new Error(g(r,"Failed to create todo"))}}async function R(i,s){const t=await j(),r=await h("/api/method/frappe.client.set_value",{method:"POST",headers:t,body:JSON.stringify({doctype:"ToDo",name:i,fieldname:s})});if(!r.ok){const l=await r.json();throw new Error(g(l,"Failed to update todo"))}}async function te(i){const s=await j(),t=await h("/api/method/frappe.client.delete",{method:"POST",headers:s,body:JSON.stringify({doctype:"ToDo",name:i})});if(!t.ok){const r=await t.json();throw new Error(g(r,"Failed to delete todo"))}}const y={description:"",status:"Open",priority:"Medium",date:S().format("YYYY-MM-DD")};function ae({open:i,onClose:s,selectedTodo:t,initialData:r,onSuccess:l}){const[o,n]=f.useState(y),[u,x]=f.useState({open:!1,message:"",severity:"success"});f.useEffect(()=>{n(t?{description:t.description,status:t.status,priority:t.priority,date:t.date,allocated_to:t.allocated_to}:r?{...y,...r}:y)},[t,r,i]);const T=async()=>{try{t?await R(t.name,o):await N(o),s(),l&&l()}catch(a){console.error("Failed to save todo:",a),x({open:!0,message:a.message||"Failed to save todo",severity:"error"})}};return e.jsxs(e.Fragment,{children:[e.jsxs(F,{open:i,onClose:s,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(E,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:e.jsx(p,{variant:"h6",sx:{fontWeight:700},children:t?"Edit Task":"New Task"})}),e.jsx(k,{onClick:s,sx:{color:"text.secondary"},children:e.jsx(C,{icon:"mingcute:close-line"})})]}),e.jsx(W,{dividers:!0,sx:{borderBottom:"none",px:3,pb:0},children:e.jsx(I,{dateAdapter:P,children:e.jsxs(c,{sx:{py:2,display:"flex",flexDirection:"column",gap:4},children:[e.jsxs(c,{children:[e.jsx(p,{variant:"overline",sx:{color:"text.secondary",fontWeight:700,mb:2,display:"block"},children:"Task Description"}),e.jsx(A,{fullWidth:!0,multiline:!0,rows:4,label:"What needs to be done?",placeholder:"Enter task details...",value:o.description,onChange:a=>n({...o,description:a.target.value})})]}),e.jsxs(c,{children:[e.jsx(p,{variant:"overline",sx:{color:"text.secondary",fontWeight:700,mb:2,display:"block"},children:"Priority & Status"}),e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{size:{xs:12,md:6},children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(w,{children:"Status"}),e.jsxs(b,{label:"Status",value:o.status,onChange:a=>n({...o,status:a.target.value}),children:[e.jsx(d,{value:"Open",children:"Open"}),e.jsx(d,{value:"Closed",children:"Closed"}),e.jsx(d,{value:"Cancelled",children:"Cancelled"})]})]})}),e.jsx(m,{size:{xs:12,md:6},children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(w,{children:"Priority"}),e.jsxs(b,{label:"Priority",value:o.priority,onChange:a=>n({...o,priority:a.target.value}),children:[e.jsx(d,{value:"High",children:"High"}),e.jsx(d,{value:"Medium",children:"Medium"}),e.jsx(d,{value:"Low",children:"Low"})]})]})})]})]}),e.jsxs(c,{children:[e.jsx(p,{variant:"overline",sx:{color:"text.secondary",fontWeight:700,mb:2,display:"block"},children:"Due Date"}),e.jsx(M,{label:"Due Date",value:o.date?S(o.date):null,onChange:a=>n({...o,date:a?a.format("YYYY-MM-DD"):""}),slotProps:{textField:{fullWidth:!0}}})]})]})})}),e.jsxs(Y,{sx:{p:3,pt:2,gap:1.5},children:[e.jsx(v,{color:"inherit",variant:"outlined",onClick:s,sx:{borderRadius:1},children:"Cancel"}),e.jsx(v,{variant:"contained",color:"info",onClick:T,sx:{borderRadius:1,px:3},children:t?"Save Changes":"Create Task"})]})]}),e.jsx(L,{open:u.open,autoHideDuration:6e3,onClose:()=>x(a=>({...a,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(O,{onClose:()=>x(a=>({...a,open:!1})),severity:u.severity,sx:{width:"100%"},children:u.message})})]})}export{ae as T,te as d,ee as f,R as u};
