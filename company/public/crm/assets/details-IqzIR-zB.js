import{Z as Q,W as V,a0 as Y,r as h,j as e,$ as Z,T as r,p as m,I as o,B as g,d as n,D as k,w as K}from"./index-Co7v2xsC.js";import{C as X}from"./config-global-BX9xwJzv.js";import{c as a}from"./format-number-DSNgsWBE.js";import{h as ee}from"./print-q83xVReF.js";import{D as C,C as te}from"./Card-CDV3jV6O.js";import{g as re,d as ie,b as ne}from"./invoice-CmnDHtbD.js";import{C as se}from"./confirm-dialog--19ddTk_.js";import{S as i}from"./Stack-GQIY7Xk9.js";import{T as oe,a as ae,b as ce,c as A,d as s,e as le}from"./TableRow-DqeBPnxy.js";import{S as de}from"./Snackbar-BVA3LOhi.js";import{A as xe}from"./AlertTitle-BbqQne_Q.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";function he(){const{id:c}=Q(),j=V(),I=Y(),[S,$]=h.useState(null),[F,G]=h.useState(!0),[y,T]=h.useState(!1),[P,b]=h.useState(!1),[N,W]=h.useState(!1);if(h.useEffect(()=>{c&&re(c).then($).finally(()=>G(!1))},[c]),h.useEffect(()=>{var t;(t=I.state)!=null&&t.converted&&(W(!0),window.history.replaceState({},document.title))},[I.state]),F)return e.jsx(C,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(Z,{})});if(!S)return e.jsxs(C,{children:[e.jsx(r,{variant:"h4",children:"Invoice not found"}),e.jsx(m,{onClick:()=>j.push("/invoices"),sx:{mt:3},children:"Go back to list"})]});const{customer_id:E,invoice_date:H,billing_address:O,description:D,terms_and_conditions:z,attachments:p,overall_discount_type:_,overall_discount:f,total_amount:L,grand_total:B,received_amount:v,balance_amount:d,table_qecz:w=[]}=S;let u=[];if(p)try{const t=JSON.parse(p);Array.isArray(t)?u=t:u=[{name:p.split("/").pop()||"Attachment",url:p}]}catch{u=[{name:p.split("/").pop()||"Attachment",url:p}]}const R=w.reduce((t,x)=>t+(x.tax_amount||0),0),M=L+R,q=_==="Flat"?f:M*f/100,U=()=>{c&&ee(ne(c))},J=async()=>{if(c)try{T(!0),await ie(c),j.push("/invoices")}catch(t){console.error("Failed to delete invoice:",t)}finally{T(!1),b(!1)}};return e.jsxs(C,{children:[e.jsxs(i,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,className:"no-print",children:[e.jsxs(r,{variant:"h4",children:["Invoice: ",c]}),e.jsxs(i,{direction:"row",spacing:2,children:[e.jsx(m,{variant:"outlined",color:"inherit",onClick:()=>j.push("/invoices"),startIcon:e.jsx(o,{icon:"solar:arrow-left-bold"}),children:"Back to List"}),e.jsx(m,{variant:"outlined",color:"primary",onClick:U,startIcon:e.jsx(o,{icon:"solar:printer-bold"}),children:"Print"}),v===0&&e.jsx(m,{variant:"contained",color:"error",onClick:()=>b(!0),startIcon:e.jsx(o,{icon:"solar:trash-bin-trash-bold"}),children:"Delete"}),v===0&&e.jsx(m,{variant:"contained",color:"primary",onClick:()=>j.push(`/invoices/${encodeURIComponent(c||"")}/edit`),startIcon:e.jsx(o,{icon:"solar:pen-bold"}),children:"Edit Invoice"})]})]}),e.jsx(te,{sx:{p:4,borderRadius:2},children:e.jsxs(i,{spacing:4,children:[e.jsxs(g,{sx:{display:"grid",columnGap:4,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsxs(i,{spacing:1.5,children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(o,{icon:"solar:user-rounded-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Customer Details"})]}),e.jsxs(g,{sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsx(r,{variant:"subtitle1",color:"primary.main",children:E}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1,whiteSpace:"pre-wrap"},children:O||"No address provided"})]})]}),e.jsxs(i,{spacing:1.5,children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(o,{icon:"solar:calendar-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Doc Logistics"})]}),e.jsxs(i,{spacing:2,sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.disabled",children:"Invoice Date"}),e.jsx(r,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:H})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.disabled",children:"Reference"}),e.jsxs(r,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:["#",c]})]})]})]}),e.jsxs(i,{spacing:1.5,children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(o,{icon:"solar:wad-of-money-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Financial Status"})]}),e.jsxs(i,{spacing:2,sx:{p:2,borderRadius:1.5,bgcolor:t=>n((d||0)>0?t.palette.error.main:t.palette.success.main,.04),border:t=>`1px solid ${n((d||0)>0?t.palette.error.main:t.palette.success.main,.12)}`},children:[e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Grand Total"}),e.jsx(r,{variant:"subtitle1",color:"primary.main",children:a(B)})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Balance Due"}),e.jsx(r,{variant:"h6",color:(d||0)>0?"error.main":"success.main",children:a(d)})]})]})]})]}),e.jsxs(g,{children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2,color:"text.secondary"},children:[e.jsx(o,{icon:"solar:list-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Invoice Items"})]}),e.jsx(oe,{sx:{overflow:"unset",border:t=>`1px solid ${n(t.palette.grey[500],.12)}`,borderRadius:1.5},children:e.jsxs(ae,{sx:{minWidth:800},children:[e.jsx(ce,{children:e.jsxs(A,{sx:{bgcolor:t=>n(t.palette.grey[500],.04)},children:[e.jsx(s,{sx:{fontWeight:"fontWeightBold",py:2},children:"Service"}),e.jsx(s,{sx:{fontWeight:"fontWeightBold",py:2},children:"HSN"}),e.jsx(s,{sx:{fontWeight:"fontWeightBold",py:2},children:"Description"}),e.jsx(s,{width:60,align:"center",sx:{fontWeight:"fontWeightBold",py:2},children:"Qty"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Price"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Discount"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Tax Type"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Tax Amt"}),e.jsx(s,{width:120,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Total"})]})}),e.jsx(le,{children:w.map((t,x)=>e.jsxs(A,{sx:{"&:hover":{bgcolor:l=>n(l.palette.primary.main,.02)}},children:[e.jsx(s,{sx:{py:2},children:e.jsx(r,{variant:"subtitle2",children:t.service})}),e.jsx(s,{sx:{py:2},children:e.jsx(r,{variant:"body2",children:t.hsn_code||"-"})}),e.jsx(s,{sx:{py:2},children:e.jsx(r,{variant:"caption",sx:{color:"text.secondary",display:"block",maxWidth:200},children:t.description})}),e.jsx(s,{align:"center",sx:{py:2},children:t.quantity}),e.jsx(s,{align:"right",sx:{py:2},children:a(t.price)}),e.jsx(s,{align:"right",sx:{py:2},children:t.discount>0?e.jsxs(r,{variant:"caption",color:"success.main",children:["-",t.discount_type==="Flat"?a(t.discount):`${t.discount}%`]}):"-"}),e.jsx(s,{align:"right",sx:{py:2},children:e.jsx(r,{variant:"caption",color:"text.secondary",children:t.tax_type||"-"})}),e.jsx(s,{align:"right",sx:{py:2},children:a(t.tax_amount)}),e.jsx(s,{align:"right",sx:{py:2},children:e.jsx(r,{variant:"subtitle2",color:"primary",children:a(t.sub_total)})})]},x))})]})})]}),e.jsxs(g,{sx:{display:"grid",columnGap:4,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},alignItems:"start"},children:[e.jsxs(i,{spacing:3,children:[D&&e.jsxs(i,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Scope & Description"}),e.jsx(r,{variant:"body2",sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.primary.main,.04),border:t=>`1px solid ${n(t.palette.primary.main,.12)}`,whiteSpace:"pre-wrap",minHeight:80,color:"text.secondary"},children:D})]}),e.jsxs(i,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Terms & Conditions"}),e.jsx(r,{variant:"body2",sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.primary.main,.04),border:t=>`1px solid ${n(t.palette.primary.main,.12)}`,whiteSpace:"pre-wrap",minHeight:80},children:z||"No specific terms provided."})]}),u.length>0&&e.jsxs(i,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Attachments"}),e.jsx(i,{spacing:1,children:u.map((t,x)=>e.jsxs(i,{direction:"row",alignItems:"center",component:"a",href:t.url,target:"_blank",sx:{px:2,py:1,borderRadius:1.5,textDecoration:"none",color:"inherit",bgcolor:l=>n(l.palette.primary.main,.04),border:l=>`1px solid ${n(l.palette.primary.main,.12)}`,transition:l=>l.transitions.create(["background-color","transform"]),"&:hover":{bgcolor:l=>n(l.palette.primary.main,.08),transform:"translateY(-1px)"}},children:[e.jsx(o,{icon:"solar:link-bold",width:18,sx:{mr:1,color:"primary.main",flexShrink:0}}),e.jsx(r,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:t.name||t.url.split("/").pop()}),e.jsx(o,{icon:"solar:download-bold",width:16,sx:{ml:1,color:"text.disabled"}})]},x))})]})]}),e.jsxs(i,{spacing:2,sx:{p:3,borderRadius:2,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Taxable Amount"}),e.jsx(r,{variant:"subtitle2",children:a(w.reduce((t,x)=>t+(x.sub_total-x.tax_amount),0))})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Total Tax"}),e.jsxs(r,{variant:"subtitle2",color:"error.main",children:["+",a(R)]})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Discount (",_==="Flat"?"Flat":`${f}%`,")"]}),e.jsxs(r,{variant:"subtitle2",color:"success.main",children:["-",a(q)]})]}),e.jsx(k,{sx:{borderStyle:"dashed"}}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"subtitle1",children:"Grand Total"}),e.jsx(r,{variant:"h6",children:a(B)})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(o,{icon:"solar:hand-money-bold-duotone",width:16,sx:{color:"success.main"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Received Amount"})]}),e.jsx(r,{variant:"subtitle2",color:"success.main",children:a(v)})]}),e.jsx(k,{sx:{borderStyle:"dashed"}}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(o,{icon:"solar:wallet-2-bold-duotone",width:20,sx:{color:(d||0)>0?"error.main":"success.main"}}),e.jsx(r,{variant:"subtitle1",sx:{color:(d||0)>0?"error.main":"success.main"},children:"Balance Due"})]}),e.jsx(r,{variant:"h5",color:(d||0)>0?"error.main":"success.main",children:a(d)})]})]})]})]})}),e.jsx(de,{open:N,autoHideDuration:5e3,onClose:()=>W(!1),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(K,{severity:"success",sx:{width:"100%",boxShadow:t=>t.customShadows.z20},children:[e.jsx(xe,{children:"Success"}),"Converted from estimation successfully!"]})}),e.jsx(se,{open:P,onClose:()=>!y&&b(!1),title:"Confirm Delete",content:"Are you sure you want to delete this invoice?",action:e.jsx(m,{variant:"contained",color:"error",onClick:J,disabled:y,sx:{borderRadius:1.5,minWidth:100},children:y?"Deleting...":"Delete"})})]})}function De(){return e.jsxs(e.Fragment,{children:[e.jsxs("title",{children:[" ",`Invoice Details - ${X.appName}`]}),e.jsx(he,{})]})}export{De as default};
