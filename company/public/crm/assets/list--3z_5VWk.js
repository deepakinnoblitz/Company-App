import{j as e,B as P,d as z,v as T,I as C,r as l,T as D,p as R,q as be,y as je,S as Y,W as ye,w as ve}from"./index-Co7v2xsC.js";import{C as Ce}from"./config-global-BX9xwJzv.js";import{D as _e,C as we}from"./Card-CDV3jV6O.js";import{f as Se,d as ke}from"./purchase-collection-D_NfVWmK.js";import{E as Pe}from"./empty-content-BBDmaj4d.js";import{C as Te}from"./confirm-dialog--19ddTk_.js";import{T as Ie,e as De,a as Re}from"./table-empty-rows-BA_Yxb7w.js";import{f as Oe}from"./format-time-9uMX-KY9.js";import{c as J}from"./format-number-DSNgsWBE.js";import{c as M,d as u,b as Fe,T as We,a as Ae,e as Be}from"./TableRow-DqeBPnxy.js";import{C as ee}from"./Checkbox-CoJXcvzD.js";import{a as Ee,T as Le}from"./TablePagination-CEaYVDlQ.js";import{O as Ne,I as $e,M as ze}from"./Select-B1EkSlUY.js";import{S as F}from"./Stack-GQIY7Xk9.js";import{A as K}from"./Autocomplete-BIV6h0T7.js";import{T as U}from"./TextField-BmVWmDzd.js";import{B as Me}from"./Badge-DIppMJwA.js";import{S as Ve}from"./Snackbar-BVA3LOhi.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./dayjs.min-C2542nnJ.js";import"./useFormControl-Cqn8lfES.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./usePreviousProps-CVIlMhUg.js";import"./Popper-DDlcgFVJ.js";import"./Chip-Rg4Dn3a5.js";function He({row:x,selected:b,onSelectRow:c,onViewRow:h,onEditRow:g,onDeleteRow:i,isLatest:j=!0,hideCheckbox:m=!1,index:f}){const{name:n,purchase:_,vendor_name:y,collection_date:o,amount_collected:p,amount_pending:S,mode_of_payment:s}=x;return e.jsxs(M,{hover:!0,tabIndex:-1,role:"checkbox",selected:b,children:[!m&&e.jsx(u,{padding:"checkbox",children:e.jsx(ee,{disableRipple:!0,checked:b,onChange:c})}),typeof f=="number"&&e.jsx(u,{align:"center",children:e.jsx(P,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:w=>z(w.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:w=>`1px solid ${z(w.palette.primary.main,.16)}`,mx:"auto",transition:w=>w.transitions.create(["all"],{duration:w.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:f+1})}),e.jsx(u,{component:"th",scope:"row",children:e.jsx(P,{sx:{gap:2,display:"flex",alignItems:"center"},children:n})}),e.jsx(u,{children:_}),e.jsx(u,{children:y}),e.jsx(u,{children:Oe(o)}),e.jsx(u,{children:s}),e.jsx(u,{align:"right",children:J(p)}),e.jsx(u,{align:"right",children:J(S||0)}),e.jsx(u,{align:"right",children:e.jsxs(P,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(T,{onClick:h,sx:{color:"info.main"},children:e.jsx(C,{icon:"solar:eye-bold"})}),j&&e.jsx(T,{onClick:g,sx:{color:"primary.main"},children:e.jsx(C,{icon:"solar:pen-bold"})}),j&&e.jsx(T,{onClick:i,sx:{color:"error.main"},children:e.jsx(C,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function Ge({order:x,orderBy:b,rowCount:c,headLabel:h,numSelected:g,onSort:i,onSelectAllRows:j,hideCheckbox:m=!1,showIndex:f=!1}){return e.jsx(Fe,{children:e.jsxs(M,{children:[!m&&e.jsx(u,{padding:"checkbox",children:e.jsx(ee,{indeterminate:g>0&&g<c,checked:c>0&&g===c,onChange:n=>j(n.target.checked)})}),f&&e.jsx(u,{align:"center",children:"Sno"}),h.map(n=>e.jsx(u,{align:n.align||"left",sx:{width:n.width,minWidth:n.minWidth},children:n.label},n.id))]})})}const X=[{value:"modified_desc",label:"Newest First"},{value:"modified_asc",label:"Oldest First"},{value:"collection_date_desc",label:"Date: Newest First"},{value:"collection_date_asc",label:"Date: Oldest First"},{value:"amount_collected_desc",label:"Amount: High to Low"},{value:"amount_collected_asc",label:"Amount: Low to High"},{value:"vendor_name_asc",label:"Vendor: A to Z"},{value:"vendor_name_desc",label:"Vendor: Z to A"}];function Ze({numSelected:x,filterName:b,onFilterName:c,onDelete:h,sortBy:g="modified_desc",onSortChange:i,onOpenFilter:j,canReset:m}){var S;const[f,n]=l.useState(null),_=s=>{n(s.currentTarget)},y=()=>{n(null)},o=s=>{i&&i(s),y()},p=((S=X.find(s=>s.value===g))==null?void 0:S.label)||"Sort";return e.jsxs(Ee,{sx:{height:96,display:"flex",justifyContent:"space-between",p:s=>s.spacing(0,1,0,3),...x>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[x>0?e.jsxs(D,{component:"div",variant:"subtitle1",children:[x," selected"]}):e.jsx(Ne,{value:b,onChange:c,placeholder:"Search by ID, Purchase, or Vendor...",startAdornment:e.jsx($e,{position:"start",children:e.jsx(C,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:480,width:1}}),e.jsx(P,{sx:{display:"flex",gap:1,alignItems:"center"},children:x>0?e.jsx(T,{onClick:h,children:e.jsx(C,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(R,{disableRipple:!0,color:"inherit",onClick:j,endIcon:e.jsx(C,{icon:"ic:round-filter-list",width:20,sx:m?{color:"error.main"}:void 0}),sx:{color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",height:40,px:2,fontWeight:500,borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:"Filters"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"text",color:"inherit",startIcon:e.jsx(C,{icon:"solar:sort-bold"}),onClick:_,sx:{minWidth:160,height:40,px:2,color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500,"&:hover":{bgcolor:"action.hover"}},children:p}),e.jsx(ze,{anchorEl:f,open:!!f,onClose:y,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1,minWidth:200,boxShadow:s=>s.customShadows.z20}}},children:X.map(s=>e.jsx(be,{selected:s.value===g,onClick:()=>o(s.value),sx:{typography:"body2",...s.value===g&&{bgcolor:w=>z(w.palette.primary.main,.08),fontWeight:"fontWeightSemiBold"}},children:s.label},s.value))})]})]})})]})}function qe({open:x,onOpen:b,onClose:c,filters:h,onFilters:g,canReset:i,onResetFilters:j,options:m}){const f=(o,p)=>{g({[o]:p})},n=e.jsxs(P,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(D,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(T,{onClick:j,disabled:!i,sx:{mr:.5,color:i?"primary.main":"text.disabled","&:hover":{bgcolor:i?"primary.lighter":"transparent"}},children:e.jsx(Me,{color:"error",variant:"dot",invisible:!i,children:e.jsx(C,{icon:"solar:restart-bold",width:20})})}),e.jsx(T,{onClick:c,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(C,{icon:"mingcute:close-line",width:20})})]}),_=e.jsxs(F,{spacing:1.5,children:[e.jsx(D,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Vendor"}),e.jsx(K,{fullWidth:!0,size:"small",value:h.vendor_name==="all"?null:m.vendors.find(o=>o.name===h.vendor_name)||null,onChange:(o,p)=>{f("vendor_name",p?p.name:"all")},options:m.vendors,getOptionLabel:o=>`${o.first_name} (${o.name})`,renderInput:o=>e.jsx(U,{...o,placeholder:"Search vendors...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}})})]}),y=e.jsxs(F,{spacing:1.5,children:[e.jsx(D,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Mode of Payment"}),e.jsx(K,{fullWidth:!0,size:"small",value:h.mode_of_payment==="all"?null:m.payment_types.find(o=>o.name===h.mode_of_payment)||null,onChange:(o,p)=>{f("mode_of_payment",p?p.name:"all")},options:m.payment_types,getOptionLabel:o=>o.name,renderInput:o=>e.jsx(U,{...o,placeholder:"Search payment types...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}})})]});return e.jsxs(je,{anchor:"right",open:x,onClose:c,slotProps:{paper:{sx:{width:340,boxShadow:o=>o.customShadows.z24}}},sx:{zIndex:o=>o.zIndex.drawer+100},children:[n,e.jsx(Y,{children:e.jsxs(F,{spacing:3,sx:{p:3},children:[_,y]})}),e.jsx(P,{sx:{p:2.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.neutral"},children:e.jsx(R,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),onClick:j,disabled:!i,sx:{borderRadius:1.5,borderColor:"divider",fontWeight:600,"&:hover":{borderColor:"error.main",color:"error.main",bgcolor:"error.lighter"},"&.Mui-disabled":{borderColor:"divider"}},children:"Clear All Filters"})})]})}const Qe=[{id:"name",label:"ID"},{id:"purchase",label:"Purchase ID"},{id:"vendor_name",label:"Vendor"},{id:"collection_date",label:"Date"},{id:"mode_of_payment",label:"Mode"},{id:"amount_collected",label:"Amount",align:"right"},{id:"amount_pending",label:"Pending",align:"right"},{id:""}];function Je(){const x=ye(),[b,c]=l.useState(0),[h,g]=l.useState(5),[i,j]=l.useState("modified"),[m,f]=l.useState("desc"),[n,_]=l.useState([]),[y,o]=l.useState([]),[p,S]=l.useState(0),[s,w]=l.useState(""),[V,H]=l.useState(!0),[W,A]=l.useState({open:!1,id:null}),[B,E]=l.useState({open:!1,message:"",severity:"success"}),[te,L]=l.useState(!1),[I,N]=l.useState({vendor_name:"all",mode_of_payment:"all"}),[oe,re]=l.useState([]),[ne,se]=l.useState([]),$=l.useCallback(async()=>{try{H(!0);const{data:t,total:r}=await Se({page:b+1,page_size:h,search:s,sort_by:`${i}_${m}`,filterValues:I}),a=new Map;t.forEach(d=>{const Z=a.get(d.purchase);if(!Z)a.set(d.purchase,d.name);else{const k=t.find(fe=>fe.name===Z),q=new Date(d.collection_date),Q=new Date((k==null?void 0:k.collection_date)||0);(q>Q||q.getTime()===Q.getTime()&&new Date(d.creation)>new Date((k==null?void 0:k.creation)||0))&&a.set(d.purchase,d.name)}});const v=t.map(d=>({...d,isLatest:a.get(d.purchase)===d.name}));o(v),S(r)}catch(t){console.error(t)}finally{H(!1)}},[b,h,s,i,m,I]);l.useCallback((t,r)=>{N(a=>({...a,[t]:r})),c(0)},[]);const ae=l.useCallback(()=>{N({vendor_name:"all",mode_of_payment:"all"}),c(0)},[]),O=I.vendor_name!=="all"||I.mode_of_payment!=="all";l.useEffect(()=>{$()},[$]),l.useEffect(()=>{(async()=>{try{const[r,a]=await Promise.all([fetch('/api/method/frappe.client.get_list?doctype=Contacts&fields=["name","first_name"]&link_full_match=0&limit_page_length=999&filters=[["Contacts","customer_type","=","Purchase"]]',{credentials:"include"}),fetch('/api/method/frappe.client.get_list?doctype=Payment Type&fields=["name"]',{credentials:"include"})]);if(r.ok){const v=await r.json();re(v.message||[])}if(a.ok){const v=await a.json();se(v.message||[])}}catch(r){console.error("Failed to fetch filter options",r)}})()},[]);const le=l.useCallback(t=>{w(t),c(0)},[]),ie=t=>{t!==""&&(f(i===t&&m==="asc"?"desc":"asc"),j(t))},ce=t=>{if(t){const r=y.map(a=>a.name);_(r);return}_([])},de=t=>{const r=n.indexOf(t);let a=[];r===-1?a=a.concat(n,t):r===0?a=a.concat(n.slice(1)):r===n.length-1?a=a.concat(n.slice(0,-1)):r>0&&(a=a.concat(n.slice(0,r),n.slice(r+1))),_(a)},he=(t,r)=>{c(r)},me=t=>{g(parseInt(t.target.value,10)),c(0)},pe=l.useCallback(t=>{A({open:!0,id:t})},[]),ue=async()=>{if(W.id)try{await ke(W.id),E({open:!0,message:"Collection deleted successfully",severity:"success"}),$(),_([])}catch(t){console.error(t),E({open:!0,message:t.message||"Failed to delete collection",severity:"error"})}finally{A({open:!1,id:null})}},G=()=>{E(t=>({...t,open:!1}))},xe=!V&&y.length===0&&(!!s||O),ge=!V&&y.length===0&&!s&&!O;return e.jsxs(_e,{children:[e.jsxs(F,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(D,{variant:"h4",children:"Purchase Collections"}),e.jsx(R,{variant:"contained",color:"info",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),onClick:()=>x.push("/purchase-collections/new"),children:"New Collection"})]}),e.jsxs(we,{children:[e.jsx(Ze,{numSelected:n.length,filterName:s,onFilterName:t=>le(t.target.value),sortBy:`${i}_${m}`,onSortChange:t=>{const[r,a]=t.split("_").reduce((v,d)=>(d==="asc"||d==="desc"?v[1]=d:v[0]=v[0]?`${v[0]}_${d}`:d,v),["","desc"]);j(r),f(a)},onOpenFilter:()=>L(!0),canReset:O}),e.jsx(qe,{open:te,onOpen:()=>L(!0),onClose:()=>L(!1),filters:I,onFilters:t=>{N(r=>({...r,...t})),c(0)},canReset:O,onResetFilters:ae,options:{vendors:oe,payment_types:ne}}),e.jsx(Y,{children:e.jsx(We,{sx:{overflow:"unset"},children:e.jsxs(Ae,{sx:{minWidth:800},children:[e.jsx(Ge,{order:m,orderBy:i,rowCount:p,numSelected:n.length,onSort:ie,onSelectAllRows:ce,hideCheckbox:!0,showIndex:!0,headLabel:Qe}),e.jsxs(Be,{children:[y.map((t,r)=>e.jsx(He,{index:b*h+r,hideCheckbox:!0,row:t,selected:n.includes(t.name),onSelectRow:()=>de(t.name),onEditRow:()=>x.push(`/purchase-collections/${t.name}/edit`),onDeleteRow:()=>pe(t.name),onViewRow:()=>x.push(`/purchase-collections/${t.name}/view`),isLatest:t.isLatest},t.name)),e.jsx(Ie,{height:77,emptyRows:De(b,h,p)}),xe&&e.jsx(Re,{searchQuery:s}),ge&&e.jsx(M,{children:e.jsx(u,{colSpan:8,children:e.jsx(Pe,{title:"No purchase collections found",description:"Track your purchase payments to vendors here.",icon:"solar:bill-check-bold-duotone"})})})]})]})})}),e.jsx(Le,{page:b,component:"div",count:p,rowsPerPage:h,onPageChange:he,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:me})]}),e.jsx(Ve,{open:B.open,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ve,{onClose:G,severity:B.severity,sx:{width:"100%"},children:B.message})}),e.jsx(Te,{open:W.open,onClose:()=>A({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this collection?",action:e.jsx(R,{variant:"contained",color:"error",onClick:ue,sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function St(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Purchase Collections - ${Ce.appName}`}),e.jsx(Je,{})]})}export{St as default};
