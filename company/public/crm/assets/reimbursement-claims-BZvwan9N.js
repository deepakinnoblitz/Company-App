import{f as S,H as J,r as n,j as e,B as o,d as te,v as D,I as h,T as m,S as ne,p as O,D as ae,q as Ie,w as Ee}from"./index-Co7v2xsC.js";import{C as Fe}from"./config-global-BX9xwJzv.js";import{d as Oe}from"./dayjs.min-C2542nnJ.js";import{h as M}from"./api-error-handler-CV6pRVHb.js";import{f as Le}from"./hr-management-CfgPc5UQ.js";import{D as We,C as Ne}from"./Card-CDV3jV6O.js";import{E as Ae}from"./empty-content-BBDmaj4d.js";import{U as Be,a as $e,b as ze,T as qe}from"./user-table-toolbar-BXgkag6p.js";import{L as ie}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as oe,d as b,T as He,a as Ue,e as Je}from"./TableRow-DqeBPnxy.js";import{C as Me}from"./Checkbox-CoJXcvzD.js";import{S as H}from"./Stack-GQIY7Xk9.js";import{D as le,a as ce}from"./DialogContent-DtP-sWqR.js";import{D as de}from"./DialogTitle-C3eBZids.js";import{T as Ye}from"./TablePagination-CEaYVDlQ.js";import{F as Ge,a as Ve,S as Qe}from"./Select-B1EkSlUY.js";import{T as U}from"./TextField-BmVWmDzd.js";import{L as Ke,A as Xe}from"./AdapterDayjs-BPhbSeWE.js";import{D as Ze}from"./DatePicker-BMZY9CMK.js";import{D as et}from"./DialogActions-h_2rRG3x.js";import{S as tt}from"./Snackbar-BVA3LOhi.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";async function at(s){const r=[];s.search&&r.push([["Reimbursement Claim","employee_name","like",`%${s.search}%`]]);const a=s.orderBy&&s.order?`${s.orderBy} ${s.order}`:"date_of_expense desc",c=new URLSearchParams({doctype:"Reimbursement Claim",fields:JSON.stringify(["*"]),filters:JSON.stringify(r),limit_start:String((s.page-1)*s.page_size),limit_page_length:String(s.page_size),order_by:a}),[d,x]=await Promise.all([S(`/api/method/frappe.client.get_list?${c.toString()}`),S(`/api/method/frappe.client.get_count?doctype=Reimbursement Claim&filters=${encodeURIComponent(JSON.stringify(r))}`)]);if(!d.ok)throw new Error("Failed to fetch reimbursement claims");const f=await d.json(),w=await x.json();return{data:f.message||[],total:w.message||0}}const st=s=>at(s);async function rt(s){const r=await J(),a=await S("/api/method/frappe.client.insert",{method:"POST",headers:r,body:JSON.stringify({doc:{doctype:"Reimbursement Claim",...s}})});if(!a.ok){const c=await a.json();throw new Error(M(c,"Failed to create reimbursement claim"))}return(await a.json()).message}async function nt(s,r){const a=await J(),c=await S("/api/method/frappe.client.set_value",{method:"POST",headers:a,body:JSON.stringify({doctype:"Reimbursement Claim",name:s,fieldname:r})});if(!c.ok){const d=await c.json();throw new Error(M(d,"Failed to update reimbursement claim"))}return(await c.json()).message}async function se(s){const r=await J(),a=await S("/api/method/frappe.client.delete",{method:"POST",headers:r,body:JSON.stringify({doctype:"Reimbursement Claim",name:s})});if(!a.ok){const c=await a.json();throw new Error(M(c,"Failed to delete reimbursement claim"))}return!0}async function re(s){const r=await S(`/api/method/frappe.client.get?doctype=Reimbursement Claim&name=${encodeURIComponent(s)}`);if(!r.ok)throw new Error("Failed to fetch reimbursement claim details");return(await r.json()).message}async function it(){const s=await S("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Reimbursement Claim");return s.ok?(await s.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}function ot(s,r,a="",c="date_of_expense",d="desc"){const[x,f]=n.useState([]),[w,j]=n.useState(0),[v,p]=n.useState(!0),g=async()=>{p(!0);try{const i=await st({page:s,page_size:r,search:a,orderBy:c,order:d});f(i.data),j(i.total)}catch(i){console.error("Failed to fetch reimbursement claims:",i),f([]),j(0)}finally{p(!1)}};return n.useEffect(()=>{g()},[s,r,a,c,d]),{data:x,total:w,loading:v,refetch:g}}function lt({row:s,selected:r,onSelectRow:a,onView:c,onEdit:d,onDelete:x,canEdit:f,canDelete:w,hideCheckbox:j=!1,index:v}){var g;const p=(i,L)=>{i.stopPropagation(),L()};return e.jsxs(oe,{hover:!0,tabIndex:-1,role:"checkbox",selected:r,children:[!j&&e.jsx(b,{padding:"checkbox",children:e.jsx(Me,{disableRipple:!0,checked:r,onChange:a})}),typeof v=="number"&&e.jsx(b,{align:"center",children:e.jsx(o,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:i=>te(i.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:i=>`1px solid ${te(i.palette.primary.main,.16)}`,mx:"auto",transition:i=>i.transitions.create(["all"],{duration:i.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:v+1})}),e.jsx(b,{children:s.employee_name}),e.jsx(b,{children:s.claim_type}),e.jsx(b,{children:new Date(s.date_of_expense).toLocaleDateString()}),e.jsxs(b,{children:["₹",((g=s.amount)==null?void 0:g.toLocaleString())||0]}),e.jsx(b,{children:e.jsx(ie,{variant:"soft",color:s.paid===1?"success":"warning",children:s.paid===1?"Paid":"Pending"})}),e.jsx(b,{align:"right",children:e.jsxs(o,{sx:{display:"flex",gap:.5,justifyContent:"flex-end"},children:[e.jsx(D,{onClick:i=>p(i,c),color:"info",children:e.jsx(h,{icon:"solar:eye-bold"})}),f&&e.jsx(D,{onClick:i=>p(i,d),color:"primary",children:e.jsx(h,{icon:"solar:pen-bold"})}),w&&e.jsx(D,{onClick:i=>p(i,x),color:"error",children:e.jsx(h,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function ct({open:s,onClose:r,claim:a}){var d,x;if(!a)return null;const c=e.jsxs(o,{sx:{p:3,display:"flex",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(o,{sx:{width:64,height:64,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.lighter",color:"primary.main",mr:3},children:e.jsx(h,{icon:"solar:wallet-money-bold-duotone",width:32})}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(m,{variant:"h6",children:a.employee_name}),e.jsxs(m,{variant:"body2",sx:{color:"text.secondary"},children:[a.claim_type," • ",new Date(a.date_of_expense).toLocaleDateString()]})]}),e.jsxs(H,{spacing:1,alignItems:"flex-end",children:[e.jsxs(m,{variant:"h5",sx:{color:"primary.main",fontWeight:700},children:["₹",((d=a.amount)==null?void 0:d.toLocaleString())||0]}),e.jsx(ie,{variant:"soft",color:a.paid===1?"success":"warning",children:a.paid===1?"Paid":"Pending"})]})]});return e.jsxs(le,{open:s,onClose:r,fullWidth:!0,maxWidth:"md",children:[e.jsxs(de,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Claim Details",e.jsx(D,{onClick:r,children:e.jsx(h,{icon:"mingcute:close-line"})})]}),e.jsx(ne,{sx:{maxHeight:"80vh"},children:e.jsxs(ce,{sx:{p:0},children:[c,e.jsx(o,{sx:{p:3},children:e.jsxs(H,{spacing:3,children:[e.jsxs(o,{children:[e.jsx(_,{title:"Claim Information",icon:"solar:document-bold"}),e.jsxs(o,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(C,{label:"Claim Type",value:a.claim_type,icon:"solar:tag-bold"}),e.jsx(C,{label:"Date of Expense",value:new Date(a.date_of_expense).toLocaleDateString(),icon:"solar:calendar-bold"}),e.jsx(C,{label:"Amount",value:`₹${((x=a.amount)==null?void 0:x.toLocaleString())||0}`,icon:"solar:wad-of-money-bold"}),e.jsx(C,{label:"Status",value:a.paid===1?"Paid":"Pending",icon:"solar:info-circle-bold"})]})]}),(a.paid===1||a.approved_by||a.paid_by)&&e.jsxs(o,{children:[e.jsx(_,{title:"Settlement Details",icon:"solar:checklist-bold"}),e.jsxs(o,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(C,{label:"Approved By",value:a.approved_by||"-",icon:"solar:user-bold"}),e.jsx(C,{label:"Paid By",value:a.paid_by||"-",icon:"solar:user-bold"}),e.jsx(C,{label:"Paid Date",value:a.paid_date?new Date(a.paid_date).toLocaleDateString():"-",icon:"solar:calendar-bold"}),e.jsx(C,{label:"Payment Reference",value:a.payment_reference||"-",icon:"solar:bill-bold"})]})]}),a.claim_details&&e.jsxs(o,{children:[e.jsx(_,{title:"Details & Notes",icon:"solar:notes-bold"}),e.jsx(o,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:e.jsx(m,{variant:"body2",sx:{fontWeight:500,whiteSpace:"pre-wrap"},children:a.claim_details})})]}),(a.receipt||a.payment_proof)&&e.jsx(o,{children:e.jsx(_,{title:"Attachments",icon:"solar:link-bold",action:e.jsxs(H,{direction:"row",spacing:1,children:[a.receipt&&e.jsx(O,{variant:"text",size:"small",color:"primary",startIcon:e.jsx(h,{icon:"solar:paperclip-bold"}),href:a.receipt,target:"_blank",sx:{fontSize:"0.75rem",fontWeight:700},children:"Expense Receipt"}),a.payment_proof&&e.jsx(O,{variant:"text",size:"small",color:"success",startIcon:e.jsx(h,{icon:"solar:check-read-bold"}),href:a.payment_proof,target:"_blank",sx:{fontSize:"0.75rem",fontWeight:700},children:"Payment Proof"})]})})}),e.jsxs(o,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(_,{title:"Record Information",icon:"solar:info-circle-bold",noMargin:!0}),e.jsxs(o,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},mt:2},children:[e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:"Created On"}),e.jsx(m,{variant:"body2",children:new Date(a.creation).toLocaleString()})]}),e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:"Last Modified"}),e.jsx(m,{variant:"body2",children:new Date(a.modified).toLocaleString()})]}),e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:"Record ID"}),e.jsx(m,{variant:"body2",sx:{color:"primary.main",fontWeight:600},children:a.name})]})]})]})]})})]})})]})}function _({title:s,icon:r,action:a,noMargin:c=!1}){return e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:c?0:2,gap:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{icon:r,width:20,sx:{mr:1,color:"text.secondary"}}),e.jsx(m,{variant:"subtitle2",sx:{color:"text.secondary",textTransform:"uppercase",letterSpacing:1,fontWeight:700},children:s})]}),a&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ae,{orientation:"vertical",flexItem:!0,sx:{height:16,my:"auto",borderStyle:"dashed"}}),a]})]}),!c&&e.jsx(ae,{sx:{mb:3}})]})}function C({label:s,value:r,icon:a}){return e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start"},children:[e.jsx(o,{sx:{p:1,mr:2,borderRadius:1,bgcolor:"background.neutral",color:"text.secondary",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{icon:a,width:20})}),e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:s}),e.jsx(m,{variant:"body2",sx:{fontWeight:600},children:r||"-"})]})]})}function dt(){const[s,r]=n.useState(0),[a,c]=n.useState(10),[d,x]=n.useState(""),[f,w]=n.useState("desc"),[j,v]=n.useState("date_of_expense"),[p,g]=n.useState([]),{data:i,total:L,refetch:R}=ot(s+1,a,d,j,f),[me,W]=n.useState(!1),[N,A]=n.useState(!1),[Y,B]=n.useState(null),[pe,G]=n.useState(!1),[ue,he]=n.useState(null),[V,k]=n.useState(""),[Q,P]=n.useState(""),[$,T]=n.useState(""),[K,I]=n.useState(""),[X,E]=n.useState(""),[xe,fe]=n.useState([]),[z,ge]=n.useState({read:!1,write:!1,delete:!1}),[F,y]=n.useState({open:!1,message:"",severity:"success"});n.useEffect(()=>{it().then(ge),Le({page:1,page_size:1e3,search:""}).then(t=>{fe(t.data||[])})},[]);const ye=t=>{w(j===t&&f==="asc"?"desc":"asc"),v(t)},be=t=>{g(t?i.map(l=>l.name):[])},je=t=>{g(l=>l.includes(t)?l.filter(u=>u!==t):[...l,t])},Ce=async()=>{try{await Promise.all(p.map(t=>se(t))),y({open:!0,message:`${p.length} claim(s) deleted successfully`,severity:"success"}),g([]),R()}catch(t){y({open:!0,message:t.message||"Failed to delete claims",severity:"error"})}},we=()=>{A(!1),B(null),k(""),P(""),T(""),I(""),E(""),W(!0)},q=()=>{W(!1),A(!1),B(null),k(""),P(""),T(""),I(""),E("")},Se=n.useCallback(async t=>{var l;try{const u=await re(t.name);B(u),k(u.employee||""),P(u.claim_type||""),T(u.date_of_expense||""),I(((l=u.amount)==null?void 0:l.toString())||""),E(u.claim_details||""),A(!0),W(!0)}catch(u){y({open:!0,message:u.message||"Failed to load claim",severity:"error"})}},[]),ve=n.useCallback(async t=>{try{const l=await re(t.name);he(l),G(!0)}catch(l){y({open:!0,message:l.message||"Failed to load claim",severity:"error"})}},[]),_e=n.useCallback(async t=>{try{await se(t),y({open:!0,message:"Claim deleted successfully",severity:"success"}),R()}catch(l){y({open:!0,message:l.message||"Failed to delete claim",severity:"error"})}},[R]),De=async t=>{t.preventDefault();const l={employee:V.trim(),claim_type:Q.trim(),date_of_expense:$,amount:parseFloat(K)||0,claim_details:X.trim()};try{N&&Y?(await nt(Y.name,l),y({open:!0,message:"Claim updated successfully",severity:"success"})):(await rt(l),y({open:!0,message:"Claim created successfully",severity:"success"})),q(),R()}catch(u){y({open:!0,message:u.message||"Operation failed",severity:"error"})}},Re=(t,l)=>{r(l)},ke=t=>{c(parseInt(t.target.value,10)),r(0)},Pe=t=>{x(t.target.value),r(0)},Z=()=>{y({...F,open:!1})},Te=!i.length&&!!d,ee=!i.length&&!d;return e.jsxs(We,{children:[e.jsxs(o,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(m,{variant:"h4",sx:{flexGrow:1},children:"Reimbursement Claims"}),z.write&&e.jsx(O,{variant:"contained",startIcon:e.jsx(h,{icon:"mingcute:add-line"}),onClick:we,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Claim"})]}),e.jsxs(Ne,{children:[e.jsx(Be,{numSelected:p.length,filterName:d,onFilterName:Pe,searchPlaceholder:"Search claims...",onDelete:p.length>0?Ce:void 0}),e.jsx(ne,{children:e.jsx(He,{sx:{overflow:"unset"},children:e.jsxs(Ue,{sx:{minWidth:800},children:[e.jsx($e,{order:f,orderBy:j,rowCount:i.length,numSelected:p.length,onSort:ye,onSelectAllRows:t=>be(t),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"employee_name",label:"Employee"},{id:"claim_type",label:"Claim Type"},{id:"date_of_expense",label:"Date"},{id:"amount",label:"Amount"},{id:"paid",label:"Status"},{id:"",label:""}]}),e.jsxs(Je,{children:[i.map((t,l)=>e.jsx(lt,{index:s*a+l,hideCheckbox:!0,row:{id:t.name,employee_name:t.employee_name,claim_type:t.claim_type,date_of_expense:t.date_of_expense,amount:t.amount,paid:t.paid},selected:p.includes(t.name),onSelectRow:()=>je(t.name),onView:()=>ve(t),onEdit:()=>Se(t),onDelete:()=>_e(t.name),canEdit:z.write,canDelete:z.delete},t.name)),Te&&e.jsx(ze,{searchQuery:d}),ee&&e.jsx(oe,{children:e.jsx(b,{colSpan:6,children:e.jsx(Ae,{title:"No claims found",description:"You haven't submitted any reimbursement claims yet.",icon:"solar:money-bag-bold-duotone"})})}),!ee&&e.jsx(qe,{height:68,emptyRows:Math.max(0,a-i.length)})]})]})})}),e.jsx(Ye,{component:"div",page:s,count:L,rowsPerPage:a,onPageChange:Re,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:ke})]}),e.jsx(le,{open:me,onClose:q,fullWidth:!0,maxWidth:"sm",children:e.jsxs("form",{onSubmit:De,children:[e.jsxs(de,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[N?"Edit Claim":"New Claim",e.jsx(D,{onClick:q,children:e.jsx(h,{icon:"mingcute:close-line"})})]}),e.jsx(ce,{dividers:!0,children:e.jsxs(o,{sx:{display:"grid",gap:3,margin:"1rem"},children:[e.jsxs(Ge,{fullWidth:!0,required:!0,children:[e.jsx(Ve,{children:"Employee"}),e.jsx(Qe,{value:V,onChange:t=>k(t.target.value),label:"Employee",children:xe.map(t=>e.jsxs(Ie,{value:t.name,children:[t.employee_name," (",t.employee_id,")"]},t.name))})]}),e.jsx(U,{fullWidth:!0,label:"Claim Type",value:Q,onChange:t=>P(t.target.value),required:!0,placeholder:"e.g., Travel, Medical, Food"}),e.jsx(Ke,{dateAdapter:Xe,children:e.jsx(Ze,{label:"Date of Expense",value:$?Oe($):null,onChange:t=>T((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}}}})}),e.jsx(U,{fullWidth:!0,label:"Amount",type:"number",value:K,onChange:t=>I(t.target.value),required:!0,placeholder:"Enter amount",inputProps:{step:"0.01",min:"0"}}),e.jsx(U,{fullWidth:!0,label:"Claim Details",value:X,onChange:t=>E(t.target.value),multiline:!0,rows:4,placeholder:"Enter claim details"})]})}),e.jsx(et,{children:e.jsx(O,{type:"submit",variant:"contained",children:N?"Update":"Create"})})]})}),e.jsx(ct,{open:pe,onClose:()=>G(!1),claim:ue}),e.jsx(tt,{open:F.open,autoHideDuration:6e3,onClose:Z,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ee,{onClose:Z,severity:F.severity,sx:{width:"100%"},children:F.message})})]})}function Ht(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Reimbursement Claims - ${Fe.appName}`}),e.jsx(dt,{})]})}export{Ht as default};
