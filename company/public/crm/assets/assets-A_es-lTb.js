import{f as v,H as G,r,j as e,B as l,d as oe,v as _,I as x,T as m,D as Ne,p as H,S as Fe,q as F,w as We}from"./index-Co7v2xsC.js";import{C as Ee}from"./config-global-BX9xwJzv.js";import{d as Oe}from"./dayjs.min-C2542nnJ.js";import{h as V}from"./api-error-handler-CV6pRVHb.js";import{D as Le,C as Be}from"./Card-CDV3jV6O.js";import{E as $e}from"./empty-content-BBDmaj4d.js";import{C as Me}from"./confirm-dialog--19ddTk_.js";import{U as ze,a as Ue,T as qe,b as Je}from"./user-table-toolbar-BXgkag6p.js";import{L as ie}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as ce,d as p,T as He,a as Ye,e as Ge}from"./TableRow-DqeBPnxy.js";import{C as Ve}from"./Checkbox-CoJXcvzD.js";import{D as de,a as ue}from"./DialogContent-DtP-sWqR.js";import{D as he}from"./DialogTitle-C3eBZids.js";import{T as Qe}from"./TablePagination-CEaYVDlQ.js";import{T as A}from"./TextField-BmVWmDzd.js";import{F as Ke,a as Xe,S as Ze}from"./Select-B1EkSlUY.js";import{L as et,A as tt}from"./AdapterDayjs-BPhbSeWE.js";import{D as st}from"./DatePicker-BMZY9CMK.js";import{D as at}from"./DialogActions-h_2rRG3x.js";import{S as rt}from"./Snackbar-BVA3LOhi.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";async function nt(s){const n=[];s.search&&n.push([["Asset","asset_name","like",`%${s.search}%`],["or",["Asset","asset_tag","like",`%${s.search}%`]]]);const a=s.orderBy&&s.order?`${s.orderBy} ${s.order}`:"creation desc",i=new URLSearchParams({doctype:"Asset",fields:JSON.stringify(["*"]),filters:JSON.stringify(n),limit_start:String((s.page-1)*s.page_size),limit_page_length:String(s.page_size),order_by:a}),[o,h]=await Promise.all([v(`/api/method/frappe.client.get_list?${i.toString()}`),v(`/api/method/frappe.client.get_count?doctype=Asset&filters=${encodeURIComponent(JSON.stringify(n))}`)]);if(!o.ok)throw new Error("Failed to fetch assets");const g=await o.json(),b=await h.json();return{data:g.message||[],total:b.message||0}}const ot=s=>nt(s);async function lt(s){const n=await G(),a=await v("/api/method/frappe.client.insert",{method:"POST",headers:n,body:JSON.stringify({doc:{doctype:"Asset",...s}})});if(!a.ok){const i=await a.json();throw new Error(V(i,"Failed to create asset"))}return(await a.json()).message}async function it(s,n){const a=await G(),i=await v("/api/method/frappe.client.set_value",{method:"POST",headers:a,body:JSON.stringify({doctype:"Asset",name:s,fieldname:n})});if(!i.ok){const o=await i.json();throw new Error(V(o,"Failed to update asset"))}return(await i.json()).message}async function le(s){const n=await G(),a=await v("/api/method/frappe.client.delete",{method:"POST",headers:n,body:JSON.stringify({doctype:"Asset",name:s})});if(!a.ok){const i=await a.json();throw new Error(V(i,"Failed to delete asset"))}return!0}async function ct(){const s=await v("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Asset");return s.ok?(await s.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}function dt(s,n,a,i,o){const[h,g]=r.useState([]),[b,y]=r.useState(0),[C,c]=r.useState(!0),f=r.useCallback(async()=>{c(!0);try{const u=await ot({page:s,page_size:n,search:a,orderBy:i,order:o});g(u.data),y(u.total)}catch(u){console.error("Failed to fetch assets:",u)}finally{c(!1)}},[s,n,a,i,o]);return r.useEffect(()=>{f()},[f]),{data:h,total:b,loading:C,refetch:f}}function ut({row:s,selected:n,onSelectRow:a,onView:i,onEdit:o,onDelete:h,canEdit:g,canDelete:b,hideCheckbox:y=!1,index:C}){return e.jsxs(ce,{hover:!0,tabIndex:-1,role:"checkbox",selected:n,children:[!y&&e.jsx(p,{padding:"checkbox",children:e.jsx(Ve,{disableRipple:!0,checked:n,onChange:a})}),typeof C=="number"&&e.jsx(p,{align:"center",children:e.jsx(l,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:c=>oe(c.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:c=>`1px solid ${oe(c.palette.primary.main,.16)}`,mx:"auto",transition:c=>c.transitions.create(["all"],{duration:c.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:C+1})}),e.jsx(p,{children:s.asset_name||"-"}),e.jsx(p,{children:s.asset_tag||"-"}),e.jsx(p,{children:s.category||"-"}),e.jsx(p,{children:e.jsx(ie,{color:s.current_status==="Available"&&"success"||s.current_status==="Assigned"&&"info"||s.current_status==="Maintenance"&&"warning"||s.current_status==="Disposed"&&"error"||"default",children:s.current_status||"Unknown"})}),e.jsx(p,{children:s.purchase_cost?`₹${s.purchase_cost.toLocaleString()}`:"-"}),e.jsx(p,{children:s.purchase_date?new Date(s.purchase_date).toLocaleDateString():"-"}),e.jsx(p,{align:"right",children:e.jsxs(l,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(_,{size:"small",color:"primary",onClick:i,children:e.jsx(x,{icon:"solar:eye-bold"})}),g&&e.jsx(_,{size:"small",color:"info",onClick:o,children:e.jsx(x,{icon:"solar:pen-bold"})}),b&&e.jsx(_,{size:"small",color:"error",onClick:h,children:e.jsx(x,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function ht({open:s,onClose:n,asset:a}){const i=o=>e.jsx(ie,{variant:"soft",color:o==="Available"&&"success"||o==="Assigned"&&"info"||o==="Maintenance"&&"warning"||o==="Disposed"&&"error"||"default",children:o||"Unknown"});return e.jsxs(de,{open:s,onClose:n,fullWidth:!0,maxWidth:"md",children:[e.jsxs(he,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(m,{variant:"h6",sx:{fontWeight:800},children:"Asset Details"}),e.jsx(_,{onClick:n,sx:{color:o=>o.palette.grey[500],bgcolor:"background.paper",boxShadow:o=>{var h;return(h=o.customShadows)==null?void 0:h.z1}},children:e.jsx(x,{icon:"mingcute:close-line"})})]}),e.jsx(ue,{sx:{p:4,m:2,mt:4},children:a?e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(l,{sx:{width:80,height:80,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"info.lighter",color:"info.main"},children:e.jsx(x,{icon:"solar:laptop-bold",width:40})}),e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(m,{variant:"h5",sx:{fontWeight:800},children:a.asset_name}),e.jsx(m,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:a.asset_tag})]}),e.jsxs(l,{sx:{textAlign:"right"},children:[i(a.current_status),e.jsxs(m,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled",fontWeight:700},children:["ID: ",a.name]})]})]}),e.jsx(Ne,{sx:{borderStyle:"dashed"}}),e.jsxs(l,{children:[e.jsx(Y,{title:"Asset Information",icon:"solar:document-bold"}),e.jsxs(l,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(S,{label:"Asset Name",value:a.asset_name,icon:"solar:tag-bold"}),e.jsx(S,{label:"Asset Tag",value:a.asset_tag,icon:"solar:hashtag-bold"}),e.jsx(S,{label:"Category",value:a.category,icon:"solar:folder-bold"}),e.jsx(S,{label:"Status",value:a.current_status,icon:"solar:flag-bold"})]})]}),e.jsxs(l,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(Y,{title:"Purchase Details",icon:"solar:wallet-bold",noMargin:!0}),e.jsxs(l,{sx:{mt:3,display:"grid",gap:3,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"}},children:[e.jsx(S,{label:"Purchase Date",value:a.purchase_date?new Date(a.purchase_date).toLocaleDateString():"-",icon:"solar:calendar-bold"}),e.jsx(S,{label:"Purchase Cost",value:a.purchase_cost?`₹${a.purchase_cost.toLocaleString()}`:"-",icon:"solar:dollar-bold"})]})]}),a.description&&e.jsxs(l,{children:[e.jsx(Y,{title:"Description",icon:"solar:notes-bold"}),e.jsx(l,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:e.jsx(m,{variant:"body2",sx:{fontWeight:500},children:a.description})})]})]}):e.jsxs(l,{sx:{py:10,textAlign:"center"},children:[e.jsx(x,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(m,{variant:"h6",sx:{color:"text.secondary"},children:"No Asset Found"})]})})]})}function Y({title:s,icon:n,noMargin:a=!1}){return e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:a?0:2.5},children:[e.jsx(x,{icon:n,width:20,sx:{color:"primary.main"}}),e.jsx(m,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:s})]})}function S({label:s,value:n,icon:a}){return e.jsxs(l,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:s}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{icon:a,width:16,sx:{color:"text.disabled"}}),e.jsx(m,{variant:"body2",sx:{fontWeight:700},children:n||"-"})]})]})}function pt(){const[s,n]=r.useState(0),[a,i]=r.useState(10),[o,h]=r.useState(""),[g,b]=r.useState("desc"),[y,C]=r.useState("creation"),[c,f]=r.useState([]),{data:u,total:pe,refetch:W}=dt(s+1,a,o,y,g),[me,E]=r.useState(!1),[O,L]=r.useState(!1),[Q,B]=r.useState(null),[$,M]=r.useState({open:!1,id:null}),[xe,K]=r.useState(!1),[ge,fe]=r.useState(null),[X,D]=r.useState(""),[Z,w]=r.useState(""),[ee,k]=r.useState(""),[z,P]=r.useState(""),[te,T]=r.useState(""),[se,I]=r.useState("Available"),[ae,R]=r.useState(""),[U,je]=r.useState({read:!1,write:!1,delete:!1}),[N,j]=r.useState({open:!1,message:"",severity:"success"});r.useState(()=>{ct().then(je)});const be=t=>{b(y===t&&g==="asc"?"desc":"asc"),C(t)},ye=t=>{f(t?u.map(d=>d.name):[])},Ce=t=>{f(d=>d.includes(t)?d.filter(J=>J!==t):[...d,t])},Se=async()=>{try{await Promise.all(c.map(t=>le(t))),j({open:!0,message:`${c.length} asset(s) deleted successfully`,severity:"success"}),f([]),W()}catch(t){j({open:!0,message:t.message||"Failed to delete assets",severity:"error"})}},ve=()=>{L(!1),B(null),D(""),w(""),k(""),P(""),T(""),I("Available"),R(""),E(!0)},q=()=>{E(!1),L(!1),B(null),D(""),w(""),k(""),P(""),T(""),I("Available"),R("")},Ae=r.useCallback(t=>{var d;B(t),D(t.asset_name||""),w(t.asset_tag||""),k(t.category||""),P(t.purchase_date||""),T(((d=t.purchase_cost)==null?void 0:d.toString())||""),I(t.current_status||"Available"),R(t.description||""),L(!0),E(!0)},[]),_e=r.useCallback(t=>{fe(t),K(!0)},[]),De=r.useCallback(t=>{M({open:!0,id:t})},[]),we=async()=>{if($.id)try{await le($.id),j({open:!0,message:"Asset deleted successfully",severity:"success"}),W()}catch(t){j({open:!0,message:t.message||"Failed to delete asset",severity:"error"})}finally{M({open:!1,id:null})}},ke=async t=>{t.preventDefault();const d={asset_name:X.trim(),asset_tag:Z.trim(),category:ee.trim(),purchase_date:z,purchase_cost:parseFloat(te)||0,current_status:se,description:ae.trim()};try{O&&Q?(await it(Q.name,d),j({open:!0,message:"Asset updated successfully",severity:"success"})):(await lt(d),j({open:!0,message:"Asset created successfully",severity:"success"})),q(),W()}catch(J){j({open:!0,message:J.message||"Operation failed",severity:"error"})}},Pe=(t,d)=>{n(d)},Te=t=>{i(parseInt(t.target.value,10)),n(0)},Ie=t=>{h(t.target.value),n(0)},re=()=>{j({...N,open:!1})},Re=!u.length&&!!o,ne=!u.length&&!o;return e.jsxs(Le,{children:[e.jsxs(l,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(m,{variant:"h4",sx:{flexGrow:1},children:"Assets"}),U.write&&e.jsx(H,{variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),onClick:ve,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Asset"})]}),e.jsxs(Be,{children:[e.jsx(ze,{numSelected:c.length,filterName:o,onFilterName:Ie,searchPlaceholder:"Search assets...",onDelete:c.length>0?Se:void 0}),e.jsx(Fe,{children:e.jsx(He,{sx:{overflow:"unset"},children:e.jsxs(Ye,{sx:{minWidth:800},children:[e.jsx(Ue,{order:g,orderBy:y,rowCount:u.length,numSelected:c.length,onSort:be,onSelectAllRows:t=>ye(t),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"asset_name",label:"Asset Name"},{id:"asset_tag",label:"Tag"},{id:"category",label:"Category"},{id:"current_status",label:"Status"},{id:"purchase_cost",label:"Cost"},{id:"purchase_date",label:"Purchase Date"},{id:"",label:""}]}),e.jsxs(Ge,{children:[u.map((t,d)=>e.jsx(ut,{index:s*a+d,hideCheckbox:!0,row:{id:t.name,asset_name:t.asset_name,asset_tag:t.asset_tag,category:t.category,current_status:t.current_status,purchase_cost:t.purchase_cost,purchase_date:t.purchase_date},selected:c.includes(t.name),onSelectRow:()=>Ce(t.name),onView:()=>_e(t),onEdit:()=>Ae(t),onDelete:()=>De(t.name),canEdit:U.write,canDelete:U.delete},t.name)),!ne&&e.jsx(qe,{height:68,emptyRows:Math.max(0,a-u.length)}),Re&&e.jsx(Je,{searchQuery:o}),ne&&e.jsx(ce,{children:e.jsx(p,{colSpan:7,children:e.jsx($e,{title:"No assets found",description:"You haven't added any assets yet. Click 'New Asset' to get started.",icon:"solar:laptop-bold-duotone"})})})]})]})})}),e.jsx(Qe,{component:"div",page:s,count:pe,rowsPerPage:a,onPageChange:Pe,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:Te})]}),e.jsx(de,{open:me,onClose:q,fullWidth:!0,maxWidth:"md",children:e.jsxs("form",{onSubmit:ke,children:[e.jsxs(he,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[O?"Edit Asset":"New Asset",e.jsx(_,{onClick:q,children:e.jsx(x,{icon:"mingcute:close-line"})})]}),e.jsx(ue,{dividers:!0,children:e.jsxs(l,{sx:{display:"grid",gap:3,margin:"1rem",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"}},children:[e.jsx(A,{fullWidth:!0,label:"Asset Name",value:X,onChange:t=>D(t.target.value),required:!0,placeholder:"Enter asset name"}),e.jsx(A,{fullWidth:!0,label:"Asset Tag",value:Z,onChange:t=>w(t.target.value),required:!0,placeholder:"Enter asset tag/ID"}),e.jsx(A,{fullWidth:!0,label:"Category",value:ee,onChange:t=>k(t.target.value),placeholder:"e.g., Laptop, Furniture"}),e.jsxs(Ke,{fullWidth:!0,required:!0,children:[e.jsx(Xe,{children:"Status"}),e.jsxs(Ze,{value:se,onChange:t=>I(t.target.value),label:"Status",children:[e.jsx(F,{value:"Available",children:"Available"}),e.jsx(F,{value:"Assigned",children:"Assigned"}),e.jsx(F,{value:"Maintenance",children:"Maintenance"}),e.jsx(F,{value:"Disposed",children:"Disposed"})]})]}),e.jsx(et,{dateAdapter:tt,children:e.jsx(st,{label:"Purchase Date",value:z?Oe(z):null,onChange:t=>P((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}})}),e.jsx(A,{fullWidth:!0,label:"Purchase Cost",type:"number",value:te,onChange:t=>T(t.target.value),placeholder:"Enter cost",inputProps:{step:"0.01",min:"0"}}),e.jsx(A,{fullWidth:!0,label:"Description",value:ae,onChange:t=>R(t.target.value),multiline:!0,rows:3,placeholder:"Enter asset description",sx:{gridColumn:{xs:"1",sm:"1 / -1"}}})]})}),e.jsx(at,{children:e.jsx(H,{type:"submit",variant:"contained",children:O?"Update":"Create"})})]})}),e.jsx(ht,{open:xe,onClose:()=>K(!1),asset:ge}),e.jsx(rt,{open:N.open,autoHideDuration:6e3,onClose:re,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(We,{onClose:re,severity:N.severity,sx:{width:"100%"},children:N.message})}),e.jsx(Me,{open:$.open,onClose:()=>M({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this asset?",action:e.jsx(H,{onClick:we,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function Jt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Assets - ${Ee.appName}`}),e.jsx(pt,{})]})}export{Jt as default};
