import{f as E,H as O,h as ce,J as de,r as l,j as e,B as i,T as f,p as D,I as g,v as H,d as v,q as m,w as pe}from"./index-Co7v2xsC.js";import{C as me}from"./config-global-BX9xwJzv.js";import{d as C}from"./dayjs.min-C2542nnJ.js";import{F as ue,i as he,a as xe,b as fe}from"./index-DcBM0rMB.js";import{i as ge}from"./index-BLaIkoYk.js";import{s as ve}from"./string-DcbcEmw6.js";import{D as ye,C as be}from"./Card-CDV3jV6O.js";import{h as F}from"./api-error-handler-CV6pRVHb.js";import{h as je}from"./utils-CQVN1UoU.js";import{C as Ce}from"./confirm-dialog--19ddTk_.js";import{T as we}from"./todo-dialog-gzK4SeKR.js";import{C as De}from"./call-dialog-CXUggpLW.js";import{M as Se}from"./meeting-dialog-CkNJOBVP.js";import{S as Ee}from"./Stack-GQIY7Xk9.js";import{D as P,a as A}from"./DialogContent-DtP-sWqR.js";import{D as G}from"./DialogTitle-C3eBZids.js";import{L as _e,A as ke}from"./AdapterDayjs-BPhbSeWE.js";import{T as N}from"./TextField-BmVWmDzd.js";import{G as h}from"./Grid-BdmJn5bP.js";import{F as L,a as $,S as B}from"./Select-B1EkSlUY.js";import{D as J}from"./DateTimePicker-jnzvj6J0.js";import{D as Te}from"./DialogActions-h_2rRG3x.js";import{S as Me}from"./Snackbar-BVA3LOhi.js";import"./DatePicker-BMZY9CMK.js";import"./useThemeProps-BDg4jra0.js";import"./leads-d5FzXGcx.js";import"./calls-Cmwi30yB.js";import"./Autocomplete-BIV6h0T7.js";import"./useFormControl-Cqn8lfES.js";import"./usePreviousProps-CVIlMhUg.js";import"./Popper-DDlcgFVJ.js";import"./Chip-Rg4Dn3a5.js";import"./meetings-CH-Mye0X.js";import"./index-Chjiymov.js";import"./visuallyHidden-Dan1xhjv.js";import"./Tabs-oMX5aKw-.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./timeViewRenderers-BsmXZnvp.js";async function Oe(o,d){const c=[];o&&d&&c.push(["Event","starts_on","between",[o,d]]);const a=new URLSearchParams({doctype:"Event",fields:JSON.stringify(["name","subject","starts_on","ends_on","event_category","event_type","status","description","color","all_day"]),filters:JSON.stringify(c),limit_page_length:"1000",order_by:"starts_on asc"}),w=await E(`/api/method/frappe.client.get_list?${a.toString()}`);return(await je(w)).message}async function Fe(o){const d=await O(),c=await E("/api/method/frappe.client.insert",{method:"POST",headers:d,body:JSON.stringify({doc:{doctype:"Event",...o}})});if(!c.ok){const a=await c.json();throw new Error(F(a,"Failed to create event"))}}async function M(o,d){const c=await O(),a=await E("/api/method/frappe.client.set_value",{method:"POST",headers:c,body:JSON.stringify({doctype:"Event",name:o,fieldname:d})});if(!a.ok){const w=await a.json();throw new Error(F(w,"Failed to update event"))}}async function We(o){const d=await O(),c=await E("/api/method/frappe.client.delete",{method:"POST",headers:d,body:JSON.stringify({doctype:"Event",name:o})});if(!c.ok){const a=await c.json();throw new Error(F(a,"Failed to delete event"))}}const Ye={subject:"",description:"",event_category:"Event",event_type:"Private",starts_on:"",ends_on:"",status:"Open"};function Ie(){const o=ce();de();const[d,c]=l.useState([]),[a,w]=l.useState(null),[W,y]=l.useState(!1),[r,x]=l.useState(Ye),[q,_]=l.useState({open:!1,id:null}),[k,u]=l.useState({open:!1,message:"",severity:"success"}),[U,b]=l.useState(!1),[V,Y]=l.useState(!1),[K,I]=l.useState(!1),[Q,z]=l.useState(!1),[j,X]=l.useState(null),p=l.useCallback(async(t,n)=>{try{const s=t==null?void 0:t.toISOString(),S=n==null?void 0:n.toISOString(),T=await Oe(s,S);c(T)}catch(s){console.error("Failed to load events:",s)}},[]);l.useEffect(()=>{p()},[p]);const Z=t=>{p(t.start,t.end)},R=t=>{X(null),b(!0)},ee=()=>{b(!1),Y(!0)},te=()=>{b(!1),I(!0)},oe=()=>{b(!1),z(!0)},ne=t=>{var S;const n=t.event.id,s=d.find(T=>T.name===n);s&&(w(s),x({subject:s.subject,description:ve(s.description||""),event_category:s.event_category||"Event",event_type:s.event_type||"Private",starts_on:s.starts_on.replace(" ","T"),ends_on:((S=s.ends_on)==null?void 0:S.replace(" ","T"))||"",status:s.status||"Open"}),y(!0))},se=async t=>{const{event:n}=t;try{await M(n.id,{starts_on:C(n.start).format("YYYY-MM-DD HH:mm:ss"),ends_on:n.end?C(n.end).format("YYYY-MM-DD HH:mm:ss"):void 0}),p()}catch(s){console.error("Failed to update event position:",s),u({open:!0,message:s.message||"Failed to update event position",severity:"error"}),t.revert()}},ae=async t=>{const{event:n}=t;try{await M(n.id,{starts_on:C(n.start).format("YYYY-MM-DD HH:mm:ss"),ends_on:n.end?C(n.end).format("YYYY-MM-DD HH:mm:ss"):void 0}),p()}catch(s){console.error("Failed to update event duration:",s),u({open:!0,message:s.message||"Failed to update event duration",severity:"error"}),t.revert()}},re=async()=>{var n;const t={...r,starts_on:(n=r.starts_on)==null?void 0:n.replace("T"," "),ends_on:r.ends_on?r.ends_on.replace("T"," "):void 0};try{a?await M(a.name,t):await Fe(t),y(!1),p(),u({open:!0,message:a?"Event updated successfully":"Event created successfully",severity:"success"})}catch(s){console.error("Failed to save event:",s),u({open:!0,message:s.message||"Failed to save event",severity:"error"})}},ie=async()=>{if(a)try{await We(a.name),y(!1),_({open:!1,id:null}),p(),u({open:!0,message:"Event deleted successfully",severity:"success"})}catch(t){console.error("Failed to delete event:",t),u({open:!0,message:t.message||"Failed to delete event",severity:"error"})}},le=d.map(t=>{let n=t.color||"#08a3cd";if(!t.color)switch(t.status){case"Completed":case"Closed":n=o.palette.success.main;break;case"Cancelled":n=o.palette.error.main;break;case"Scheduled":n="#08a3cd";break;case"Open":n=o.palette.warning.main;break;default:n="#08a3cd"}return{id:t.name,title:t.subject,start:t.starts_on,end:t.ends_on||t.starts_on,allDay:t.all_day===1,color:n,extendedProps:{eventType:t.event_type,status:t.status,category:t.event_category}}});return e.jsxs(ye,{maxWidth:"xl",children:[e.jsxs(Ee,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsxs(i,{children:[e.jsx(f,{variant:"h4",children:"Events Calendar"}),e.jsx(f,{variant:"body2",sx:{color:"text.secondary"},children:"Manage your schedule and important events"})]}),e.jsx(D,{variant:"contained",color:"info",startIcon:e.jsx(g,{icon:"mingcute:add-line"}),onClick:()=>R(),children:"Add Events"})]}),e.jsx(be,{sx:{display:"flex",flexDirection:"column",pt:3},children:e.jsx(i,{sx:{p:3,pt:0,"& .fc":{"--fc-border-color":o.palette.divider,"--fc-daygrid-event-dot-width":"8px","--fc-list-event-dot-width":"10px","--fc-today-bg-color":o.palette.primary.lighter},"& .fc .fc-toolbar":{mb:3,gap:1.5,flexDirection:{xs:"column",md:"row"},"& .fc-toolbar-title":{fontSize:"1.25rem",fontWeight:700}},"& .fc .fc-button":{border:"none",py:"8px",px:"12px",borderRadius:"8px",fontSize:"0.875rem",fontWeight:600,textTransform:"capitalize",backgroundColor:o.palette.background.neutral,color:o.palette.text.primary,transition:o.transitions.create(["background-color","color","box-shadow"]),"&:hover":{backgroundColor:o.palette.action.hover},"&:focus":{boxShadow:"none"},"&.fc-button-active":{backgroundColor:"#08a3cd",color:o.palette.common.white,"&:hover":{backgroundColor:"#068eb1"}},"&.fc-today-button":{border:"1px solid #08a3cd","&:disabled":{opacity:.48}}},"& .fc .fc-col-header-cell":{py:1.5,backgroundColor:"#08a3cd",color:o.palette.common.white,"&:first-of-type":{borderTopLeftRadius:"12px"},"&:last-of-type":{borderTopRightRadius:"12px"},"& .fc-col-header-cell-cushion":{textDecoration:"none",fontSize:"0.875rem",fontWeight:700}},"& .fc-view-harness":{borderRadius:"12px",overflow:"hidden",border:`1px solid ${o.palette.divider}`},"& .fc-scrollgrid":{border:"none"},"& .fc .fc-daygrid-day":{"&:hover":{backgroundColor:o.palette.action.hover}},"& .fc .fc-daygrid-day-number":{p:1.5,fontSize:"0.875rem",fontWeight:600,color:o.palette.text.primary},"& .fc .fc-event":{border:"none",borderRadius:"6px",fontWeight:600,fontSize:"0.75rem",mx:"4px",my:"1px",p:"2px 4px",cursor:"pointer"},"& .fc .fc-daygrid-event":{boxShadow:"none"},"& .fc .fc-list":{border:"none","& .fc-list-day-cushion":{backgroundColor:o.palette.background.neutral}}},children:e.jsx(ue,{plugins:[he,ge,xe,fe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:"dayGridMonth",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:3,weekends:!0,events:le,datesSet:Z,eventClick:ne,eventDrop:se,eventResize:ae,select:t=>{R()},eventContent:t=>{const{category:n}=t.event.extendedProps;let s="solar:notes-bold";return n==="Call"?s="solar:phone-bold":n==="Meeting"&&(s="solar:calendar-add-bold"),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5,width:1,px:.5,overflow:"hidden"},children:[e.jsx(g,{icon:s,width:14,sx:{flexShrink:0}}),e.jsxs(i,{component:"span",sx:{flexGrow:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.75rem",fontWeight:600},children:[t.timeText&&e.jsx(i,{component:"span",sx:{mr:.5,fontWeight:600},children:t.timeText}),t.event.title]})]})},height:"auto",eventDisplay:"block",eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},views:{dayGridMonth:{titleFormat:{year:"numeric",month:"long"}},timeGridWeek:{titleFormat:{year:"numeric",month:"short",day:"numeric"}},timeGridDay:{titleFormat:{year:"numeric",month:"long",day:"numeric"}}}})})}),e.jsxs(P,{open:W,onClose:()=>y(!1),fullWidth:!0,maxWidth:"md",children:[e.jsxs(G,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a?"Edit Event":"New Event",e.jsx(H,{"aria-label":"close",onClick:()=>y(!1),sx:{color:t=>t.palette.grey[500]},children:e.jsx(g,{icon:"mingcute:close-line"})})]}),e.jsx(A,{dividers:!0,children:e.jsx(_e,{dateAdapter:ke,children:e.jsxs(i,{sx:{pt:1,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:t=>v(t.palette.primary.main,.1),color:"primary.main"},children:e.jsx(g,{icon:"solar:pen-bold",width:20})}),e.jsx(f,{variant:"subtitle1",sx:{fontWeight:"600"},children:"Event Overview"})]}),e.jsx(N,{fullWidth:!0,label:"Subject",value:r.subject,onChange:t=>x({...r,subject:t.target.value})})]}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{size:{xs:12,md:6},children:e.jsxs(L,{fullWidth:!0,children:[e.jsx($,{children:"Event Category"}),e.jsxs(B,{label:"Event Category",value:r.event_category,onChange:t=>x({...r,event_category:t.target.value}),children:[e.jsx(m,{value:"Event",children:"Event"}),e.jsx(m,{value:"Meeting",children:"Meeting"}),e.jsx(m,{value:"Call",children:"Call"}),e.jsx(m,{value:"Email",children:"Email"}),e.jsx(m,{value:"Other",children:"Other"})]})]})}),e.jsx(h,{size:{xs:12,md:6},children:e.jsxs(L,{fullWidth:!0,children:[e.jsx($,{children:"Status"}),e.jsxs(B,{label:"Status",value:r.status,onChange:t=>x({...r,status:t.target.value}),children:[e.jsx(m,{value:"Open",children:"Open"}),e.jsx(m,{value:"Scheduled",children:"Scheduled"}),e.jsx(m,{value:"Completed",children:"Completed"}),e.jsx(m,{value:"Closed",children:"Closed"}),e.jsx(m,{value:"Cancelled",children:"Cancelled"})]})]})})]}),e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:t=>v(t.palette.info.main,.1),color:"info.main"},children:e.jsx(g,{icon:"solar:clock-circle-outline",width:20})}),e.jsx(f,{variant:"subtitle1",sx:{fontWeight:"600"},children:"Schedule Details"})]}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{size:{xs:12,md:6},children:e.jsx(J,{label:"Starts On",value:r.starts_on?C(r.starts_on):null,onChange:t=>x({...r,starts_on:t?t.format("YYYY-MM-DD HH:mm:ss"):""}),slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiInputBase-root":{fontSize:"0.813rem",height:"36px"},"& .MuiInputLabel-root":{fontSize:"0.813rem"}}}}})}),e.jsx(h,{size:{xs:12,md:6},children:e.jsx(J,{label:"Ends On",value:r.ends_on?C(r.ends_on):null,onChange:t=>x({...r,ends_on:t?t.format("YYYY-MM-DD HH:mm:ss"):""}),slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiInputBase-root":{fontSize:"0.813rem",height:"36px"},"& .MuiInputLabel-root":{fontSize:"0.813rem"}}}}})})]})]}),e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:t=>v(t.palette.warning.main,.1),color:"warning.main"},children:e.jsx(g,{icon:"solar:chat-round-dots-bold",width:20})}),e.jsx(f,{variant:"subtitle1",sx:{fontWeight:"600"},children:"Description"})]}),e.jsx(N,{fullWidth:!0,multiline:!0,rows:4,label:"Details",value:r.description,onChange:t=>x({...r,description:t.target.value})})]})]})})}),e.jsxs(Te,{sx:{p:2,gap:1},children:[a&&e.jsx(D,{color:"error",variant:"outlined",onClick:()=>_({open:!0,id:a.name}),sx:{mr:"auto"},children:"Delete"}),e.jsx(D,{color:"inherit",variant:"outlined",onClick:()=>y(!1),children:"Cancel"}),e.jsx(D,{variant:"contained",onClick:re,children:a?"Save Changes":"Create Event"})]})]}),e.jsx(Ce,{open:q.open,onClose:()=>_({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this event?",action:e.jsx(D,{onClick:ie,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),e.jsx(Me,{open:k.open,autoHideDuration:6e3,onClose:()=>u(t=>({...t,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(pe,{onClose:()=>u(t=>({...t,open:!1})),severity:k.severity,sx:{width:"100%"},children:k.message})}),e.jsxs(P,{open:U,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(G,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Choose Event Type",e.jsx(H,{onClick:()=>b(!1),sx:{color:"text.secondary"},children:e.jsx(g,{icon:"mingcute:close-line"})})]}),e.jsx(A,{children:e.jsx(h,{container:!0,spacing:2,sx:{py:2},children:[{label:"Calls",icon:"/assets/images/calls-3d-white.png",color:"primary",sub:"Schedule a call",handler:ee},{label:"Meeting",icon:"/assets/images/meeting-3d-white.png",color:"success",sub:"Schedule a meeting",handler:te},{label:"To-do",icon:"/assets/images/todo-3d-white.png",color:"warning",sub:"Create a task",handler:oe}].map(t=>e.jsx(h,{size:{xs:12,md:4},children:e.jsxs(i,{onClick:t.handler,sx:{p:3,borderRadius:2.5,cursor:"pointer",transition:o.transitions.create(["all"],{duration:o.transitions.duration.shorter}),textAlign:"center",bgcolor:v(o.palette[t.color].main,.04),border:`1px solid ${v(o.palette[t.color].main,.1)}`,backdropFilter:"blur(12px) saturate(160%)","&:hover":{bgcolor:v(o.palette[t.color].main,.08),borderColor:o.palette[t.color].main,transform:"translateY(-6px)",boxShadow:`0 12px 24px -4px ${v(o.palette[t.color].main,.16)}`,"& img":{transform:"scale(1.1) rotate(5deg)"}}},children:[e.jsx(i,{sx:{mb:1,display:"inline-flex",transition:o.transitions.create(["transform"])},children:e.jsx(i,{component:"img",src:t.icon,sx:{width:80,height:80,objectFit:"contain",mixBlendMode:"multiply",filter:"contrast(1.2) brightness(1.1)",transition:o.transitions.create(["transform"])}})}),e.jsx(f,{variant:"h6",sx:{fontWeight:700,mb:.5},children:t.label}),e.jsx(f,{variant:"body2",sx:{color:"text.secondary",fontSize:"0.813rem"},children:t.sub})]})},t.label))})})]}),e.jsx(De,{open:V,onClose:()=>Y(!1),initialData:j?{call_start_time:j}:void 0,onSuccess:p}),e.jsx(Se,{open:K,onClose:()=>I(!1),initialData:j?{from:j}:void 0,onSuccess:p}),e.jsx(we,{open:Q,onClose:()=>z(!1),initialData:j?{date:j.split("T")[0]}:void 0,onSuccess:p})]})}function bt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Events - ${me.appName}`}),e.jsx(Ie,{})]})}export{bt as default};
