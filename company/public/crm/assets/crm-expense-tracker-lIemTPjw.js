import{f as k,H as z,r as l,j as e,v as E,I as C,B as y,q as V,p as F,d as v,T as w,y as he,S as G}from"./index-Co7v2xsC.js";import{C as Q,D as xe}from"./Card-CDV3jV6O.js";import{h as B}from"./api-error-handler-CV6pRVHb.js";import{E as me}from"./empty-content-BBDmaj4d.js";import{C as fe}from"./confirm-dialog--19ddTk_.js";import{U as ge,a as be,b as ye,T as je}from"./user-table-toolbar-BXgkag6p.js";import{d as D}from"./dayjs.min-C2542nnJ.js";import{D as Ce,a as Se}from"./DialogContent-DtP-sWqR.js";import{D as Te}from"./DialogTitle-C3eBZids.js";import{T as P}from"./TextField-BmVWmDzd.js";import{L as K,A as X}from"./AdapterDayjs-BPhbSeWE.js";import{D as Y}from"./DatePicker-BMZY9CMK.js";import{D as we}from"./DialogActions-h_2rRG3x.js";import{c as Z}from"./format-number-DSNgsWBE.js";import{S as R}from"./Stack-GQIY7Xk9.js";import{L as ve}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as ee,d as T,T as ke,a as De,e as Re}from"./TableRow-DqeBPnxy.js";import{C as Ee}from"./Checkbox-CoJXcvzD.js";import{B as _e}from"./Badge-DIppMJwA.js";import{T as Me}from"./TablePagination-CEaYVDlQ.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";async function Ie(t){const s=new URLSearchParams;t!=null&&t.start_date&&s.append("start_date",t.start_date),t!=null&&t.end_date&&s.append("end_date",t.end_date);const r=await k(`/api/method/company.company.frontend_api.get_crm_expense_tracker_stats?${s.toString()}`);if(!r.ok)throw new Error("Failed to fetch stats");return(await r.json()).message}async function Pe(t){var n,x,c;const s=[];t.search&&s.push(["CRM Expense Tracker","titlenotes","like",`%${t.search}%`]),(n=t.filters)!=null&&n.type&&t.filters.type!=="all"&&s.push(["CRM Expense Tracker","type","=",t.filters.type]),(x=t.filters)!=null&&x.start_date&&s.push(["CRM Expense Tracker","date_time",">=",t.filters.start_date]),(c=t.filters)!=null&&c.end_date&&s.push(["CRM Expense Tracker","date_time","<=",t.filters.end_date]);let r="creation desc";if(t.sort_by){const d=t.sort_by.split("_"),m=d.pop();r=`${d.join("_")} ${m}`}const o=new URLSearchParams({doctype:"CRM Expense Tracker",fields:JSON.stringify(["name","type","titlenotes","amount","date_time","creation"]),filters:JSON.stringify(s),limit_start:String((t.page-1)*t.page_size),limit_page_length:String(t.page_size),order_by:r}),[i,u]=await Promise.all([k(`/api/method/frappe.client.get_list?${o.toString()}`),k(`/api/method/frappe.client.get_count?doctype=CRM Expense Tracker&filters=${encodeURIComponent(JSON.stringify(s))}`)]);if(!i.ok)throw new Error("Failed to fetch records");const h=await i.json(),g=await u.json();return{data:h.message||[],total:g.message||0}}async function Fe(t){const s=await z(),r=await k("/api/method/frappe.client.insert",{method:"POST",headers:s,body:JSON.stringify({doc:{doctype:"CRM Expense Tracker",...t}})}),o=await r.json();if(!r.ok)throw new Error(B(o,"Failed to create record"));return o.message}async function Oe(t,s){const r=await z(),o=await k("/api/method/frappe.client.set_value",{method:"POST",headers:r,body:JSON.stringify({doctype:"CRM Expense Tracker",name:t,fieldname:s})}),i=await o.json();if(!o.ok)throw new Error(B(i,"Failed to update record"));return i.message}async function We(t){const s=await z(),r=await k("/api/method/frappe.client.delete",{method:"POST",headers:s,body:JSON.stringify({doctype:"CRM Expense Tracker",name:t})}),o=await r.json();if(!r.ok)throw new Error(B(o,"Failed to delete record"));return o.message}function Ae({open:t,onClose:s,onSubmit:r,currentData:o}){const[i,u]=l.useState("Income"),[h,g]=l.useState(""),[n,x]=l.useState(""),[c,d]=l.useState(D()),[m,S]=l.useState(!1);l.useEffect(()=>{t&&S(!1),o?(u(o.type||"Income"),g(o.titlenotes||""),x(o.amount||""),d(o.date_time?D(o.date_time):D())):(u("Income"),g(""),x(""),d(D()))},[o,t]);const j=()=>{S(!0);const b=!!h.trim(),_=!!n&&Number(n)>0;!b||!_||r({type:i,titlenotes:h,amount:Number(n),date_time:c?c.format("YYYY-MM-DD HH:mm:ss"):D().format("YYYY-MM-DD HH:mm:ss")})};return e.jsxs(Ce,{open:t,onClose:s,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(Te,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o?"Edit Record":"New Record",e.jsx(E,{onClick:s,children:e.jsx(C,{icon:"mingcute:close-line"})})]}),e.jsx(Se,{dividers:!0,children:e.jsxs(y,{sx:{display:"grid",gap:3,p:2},children:[e.jsxs(P,{select:!0,fullWidth:!0,label:"Type",value:i,onChange:b=>u(b.target.value),children:[e.jsx(V,{value:"Income",children:"Income"}),e.jsx(V,{value:"Expense",children:"Expense"})]}),e.jsx(P,{fullWidth:!0,label:"Title (Notes)",value:h,onChange:b=>g(b.target.value),required:!0,error:m&&!h.trim(),helperText:m&&!h.trim()?"Title is required":""}),e.jsx(P,{fullWidth:!0,label:"Amount",type:"number",value:n,onChange:b=>x(b.target.value),required:!0,error:m&&(!n||Number(n)<=0),helperText:m&&(!n||Number(n)<=0)?"Valid amount is required":"",slotProps:{input:{startAdornment:e.jsx(y,{sx:{mr:1,color:"text.disabled"},children:"â‚¹"})}}}),e.jsx(K,{dateAdapter:X,children:e.jsx(Y,{label:"Date",value:c,onChange:b=>d(b),slotProps:{textField:{fullWidth:!0}}})})]})}),e.jsx(we,{children:e.jsx(F,{variant:"contained",onClick:j,color:"primary",children:o?"Update":"Create"})})]})}function Ne({stats:t}){const s=[{label:"Total Income",value:t.total_income,color:"success",icon:"solar:database-bold-duotone"},{label:"Total Expense",value:t.total_expense,color:"error",icon:"solar:bill-list-bold-duotone"},{label:"Balance",value:t.balance,color:"info",icon:"solar:wallet-money-bold-duotone"}];return e.jsx(R,{direction:{xs:"column",sm:"row"},spacing:3,sx:{mb:5},children:s.map(r=>e.jsxs(Q,{sx:{p:3,width:1,display:"flex",alignItems:"center",borderRadius:2,boxShadow:"none",color:o=>o.palette[r.color].darker,bgcolor:o=>v(o.palette[r.color].main,.08),border:o=>`1px solid ${v(o.palette[r.color].main,.16)}`,transition:o=>o.transitions.create(["background-color","box-shadow"],{duration:o.transitions.duration.shorter}),"&:hover":{bgcolor:o=>v(o.palette[r.color].main,.12),boxShadow:o=>o.customShadows.z4}},children:[e.jsx(y,{sx:{width:52,height:52,flexShrink:0,borderRadius:1.5,display:"flex",alignItems:"center",justifyContent:"center",color:o=>o.palette[r.color].main,bgcolor:o=>v(o.palette[r.color].main,.12),mr:2.5},children:e.jsx(C,{icon:r.icon,width:32})}),e.jsxs(y,{children:[e.jsx(w,{variant:"subtitle2",sx:{opacity:.72,fontWeight:"bold",textTransform:"uppercase",fontSize:11,letterSpacing:.5},children:r.label}),e.jsx(w,{variant:"h3",children:Z(r.value)})]})]},r.label))})}function Ye({row:t,selected:s,onSelectRow:r,onEdit:o,onDelete:i,index:u,hideCheckbox:h=!1}){const{type:g,titlenotes:n,amount:x,creation:c,name:d}=t;return e.jsxs(ee,{hover:!0,tabIndex:-1,role:"checkbox",selected:s,children:[!h&&e.jsx(T,{padding:"checkbox",children:e.jsx(Ee,{disableRipple:!0,checked:s,onChange:r})}),typeof u=="number"&&e.jsx(T,{align:"center",children:e.jsx(y,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:m=>v(m.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:m=>`1px solid ${v(m.palette.primary.main,.16)}`,mx:"auto"},children:u+1})}),e.jsx(T,{children:e.jsx(w,{variant:"body2",noWrap:!0,children:n||"-"})}),e.jsx(T,{children:e.jsx(ve,{variant:"soft",color:g==="Income"&&"success"||"error",sx:{textTransform:"capitalize"},children:g})}),e.jsx(T,{children:Z(x)}),e.jsx(T,{align:"right",children:e.jsxs(y,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(E,{size:"small",color:"info",onClick:o,children:e.jsx(C,{icon:"solar:pen-bold"})}),e.jsx(E,{size:"small",color:"error",onClick:i,children:e.jsx(C,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function ze({open:t,onOpen:s,onClose:r,filters:o,onFilters:i,canReset:u,onResetFilters:h}){const g=d=>{i({type:d.target.value})},n=d=>{i({startDate:d})},x=d=>{i({endDate:d})},c=e.jsxs(y,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(w,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(E,{onClick:h,disabled:!u,sx:{mr:.5,color:u?"primary.main":"text.disabled","&:hover":{bgcolor:u?"primary.lighter":"transparent"}},children:e.jsx(_e,{color:"error",variant:"dot",invisible:!u,children:e.jsx(C,{icon:"solar:restart-bold",width:20})})}),e.jsx(E,{onClick:r,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(C,{icon:"mingcute:close-line",width:20})})]});return e.jsxs(he,{anchor:"right",open:t,onClose:r,slotProps:{paper:{sx:{width:320,boxShadow:d=>d.customShadows.z24}}},sx:{zIndex:d=>d.zIndex.drawer+100},children:[c,e.jsx(G,{children:e.jsxs(R,{spacing:3,sx:{p:3},children:[e.jsxs(R,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Type"}),e.jsxs(P,{select:!0,fullWidth:!0,value:o.type,onChange:g,SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"Income",children:"Income"}),e.jsx("option",{value:"Expense",children:"Expense"})]})]}),e.jsxs(R,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Date Range"}),e.jsx(K,{dateAdapter:X,children:e.jsxs(R,{spacing:2,children:[e.jsx(Y,{label:"Start Date",value:o.startDate,onChange:n,slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}}}),e.jsx(Y,{label:"End Date",value:o.endDate,onChange:x,slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}}})]})})]})]})}),e.jsx(y,{sx:{p:2.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.neutral"},children:e.jsx(F,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(C,{icon:"solar:trash-bin-trash-bold"}),onClick:h,disabled:!u,sx:{borderRadius:1.5,borderColor:"divider",fontWeight:600,"&:hover":{borderColor:"error.main",color:"error.main",bgcolor:"error.lighter"},"&.Mui-disabled":{borderColor:"divider"}},children:"Clear All Filters"})})]})}function Be(){const[t,s]=l.useState(0),[r,o]=l.useState(5),[i,u]=l.useState(""),[h,g]=l.useState("creation_desc"),[n,x]=l.useState([]),[c,d]=l.useState({type:"all",startDate:null,endDate:null}),[m,S]=l.useState(!1),[j,b]=l.useState([]),[_,te]=l.useState(0),[O,H]=l.useState(!0),[oe,re]=l.useState({total_income:0,total_expense:0,balance:0}),[ae,L]=l.useState(!1),[W,q]=l.useState(null),[A,N]=l.useState({open:!1,id:null}),M=l.useCallback(async()=>{H(!0);try{const a=c.startDate?c.startDate.startOf("day").format("YYYY-MM-DD HH:mm:ss"):void 0,p=c.endDate?c.endDate.endOf("day").format("YYYY-MM-DD HH:mm:ss"):void 0,[f,ue]=await Promise.all([Pe({page:t+1,page_size:r,search:i,filters:{type:c.type,start_date:a,end_date:p},sort_by:h}),Ie({start_date:a,end_date:p})]);b(f.data),te(f.total),re(ue)}catch(a){console.error(a)}finally{H(!1)}},[t,r,i,c,h]);l.useEffect(()=>{M()},[M]);const $=a=>{q(a||null),L(!0)},U=()=>{L(!1),q(null)},se=async a=>{try{W?await Oe(W.name,a):await Fe(a),U(),M()}catch(p){console.error(p)}},ne=async()=>{if(A.id)try{await We(A.id),N({open:!1,id:null}),M()}catch(a){console.error(a)}},le=a=>{if(a){x(j.map(p=>p.name));return}x([])},ie=a=>{const p=n.indexOf(a);let f=[];p===-1?f=f.concat(n,a):p===0?f=f.concat(n.slice(1)):p===n.length-1?f=f.concat(n.slice(0,-1)):p>0&&(f=f.concat(n.slice(0,p),n.slice(p+1))),x(f)},ce=a=>{d(p=>({...p,...a})),s(0)},de=()=>{d({type:"all",startDate:null,endDate:null})},I=c.type!=="all"||!!c.startDate||!!c.endDate,pe=!O&&!j.length&&(!!i||I),J=!O&&!j.length&&!i&&!I;return e.jsxs(xe,{children:[e.jsxs(y,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(w,{variant:"h4",sx:{flexGrow:1},children:"Expense Tracker"}),e.jsx(F,{variant:"contained",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),onClick:()=>$(),sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"Add Expense Tracker"})]}),e.jsx(Ne,{stats:oe}),e.jsxs(Q,{children:[e.jsx(ge,{numSelected:n.length,filterName:i,onFilterName:a=>{u(a.target.value),s(0)},onOpenFilter:()=>S(!0),canReset:I,searchPlaceholder:"Search by ID or title...",onDelete:()=>{}}),e.jsx(G,{children:e.jsx(ke,{sx:{overflow:"unset"},children:e.jsxs(De,{sx:{minWidth:800},children:[e.jsx(be,{rowCount:_,numSelected:n.length,onSelectAllRows:le,hideCheckbox:!0,showIndex:!0,headLabel:[{id:"type",label:"Type"},{id:"titlenotes",label:"Title (Notes)"},{id:"amount",label:"Amount"},{id:""}]}),e.jsxs(Re,{children:[j.map((a,p)=>e.jsx(Ye,{index:t*r+p,row:{id:a.name,name:a.name,type:a.type,titlenotes:a.titlenotes,amount:a.amount,creation:a.creation},selected:n.includes(a.name),onSelectRow:()=>ie(a.name),onEdit:()=>$(a),onDelete:()=>N({open:!0,id:a.name}),hideCheckbox:!0},a.name)),pe&&e.jsx(ye,{searchQuery:i}),J&&e.jsx(ee,{children:e.jsx(T,{colSpan:7,children:e.jsx(me,{title:"No records found",description:"You haven't added any expense tracker records yet. Click 'Add Expense Tracker' to get started.",icon:"solar:wallet-money-bold-duotone"})})}),!O&&j.length<r&&!J&&e.jsx(je,{height:68,emptyRows:r-j.length})]})]})})}),e.jsx(Me,{component:"div",count:_,page:t,rowsPerPage:r,onPageChange:(a,p)=>s(p),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:a=>{o(parseInt(a.target.value,10)),s(0)}})]}),e.jsx(Ae,{open:ae,onClose:U,onSubmit:se,currentData:W}),e.jsx(ze,{open:m,onOpen:()=>S(!0),onClose:()=>S(!1),filters:c,onFilters:ce,canReset:I,onResetFilters:de}),e.jsx(fe,{open:A.open,onClose:()=>N({open:!1,id:null}),title:"Delete",content:"Are you sure you want to delete this record?",action:e.jsx(F,{variant:"contained",color:"error",onClick:ne,children:"Delete"})})]})}function yt(){return e.jsx(Be,{})}export{yt as default};
