import{r as a,j as e,B as P,T as _,d as W,v as T,I as v,p as R,q as ee,y as te,S as z,W as re,w as ne}from"./index-Co7v2xsC.js";import{C as oe}from"./config-global-BX9xwJzv.js";import{f as ae}from"./format-time-9uMX-KY9.js";import{f as se,d as le}from"./purchase-CQE7gI0T.js";import{D as ie,C as ce}from"./Card-CDV3jV6O.js";import{E as de}from"./empty-content-BBDmaj4d.js";import{C as he}from"./confirm-dialog--19ddTk_.js";import{c as I,d as b,b as pe,T as me,a as ue,e as xe}from"./TableRow-DqeBPnxy.js";import{c as ge}from"./format-number-DSNgsWBE.js";import{C as L}from"./Checkbox-CoJXcvzD.js";import{a as be,T as ye}from"./TablePagination-CEaYVDlQ.js";import{O as fe,I as je,M as ve}from"./Select-B1EkSlUY.js";import{S as k}from"./Stack-GQIY7Xk9.js";import{A as B}from"./Autocomplete-BIV6h0T7.js";import{T as A}from"./TextField-BmVWmDzd.js";import{B as _e}from"./Badge-DIppMJwA.js";import{S as Ce}from"./Snackbar-BVA3LOhi.js";import"./purchase-create-view-CI9dcBgx.js";import"./dayjs.min-C2542nnJ.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./useFormControl-Cqn8lfES.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./usePreviousProps-CVIlMhUg.js";import"./Popper-DDlcgFVJ.js";import"./Chip-Rg4Dn3a5.js";import"./invoice-CmnDHtbD.js";import"./leads-d5FzXGcx.js";import"./data-import-KyR0bLZ-.js";import"./tax-type-form-dialog-Ctl86VPY.js";import"./AdapterDayjs-BPhbSeWE.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./DatePicker-BMZY9CMK.js";import"./AlertTitle-BbqQne_Q.js";function Pe(t,i,d,l,m){const[c,u]=a.useState([]),[g,h]=a.useState(0),[s,x]=a.useState(!0),[j,y]=a.useState(0),r=()=>y(p=>p+1);return a.useEffect(()=>{x(!0),se({page:t+1,page_size:i,search:d,sort_by:l,filterValues:m}).then(p=>{u(p.data),h(p.total)}).catch(p=>{console.error("Failed to fetch purchases",p),u([]),h(0)}).finally(()=>x(!1))},[t,i,d,l,j,m]),{data:c,total:g,loading:s,refetch:r}}function Se({query:t}){return e.jsx(I,{children:e.jsx(b,{align:"center",colSpan:9,sx:{py:3},children:e.jsxs(P,{sx:{textAlign:"center"},children:[e.jsx(_,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(_,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function Te({emptyRows:t,height:i}){return t?e.jsx(I,{sx:{...i&&{height:i*t}},children:e.jsx(b,{colSpan:9})}):null}function we({row:t,selected:i,onSelectRow:d,onView:l,onEdit:m,onDelete:c,canEdit:u=!0,canDelete:g=!0,hideCheckbox:h=!1,index:s}){return e.jsxs(I,{hover:!0,tabIndex:-1,role:"checkbox",selected:i,children:[!h&&e.jsx(b,{padding:"checkbox",children:e.jsx(L,{disableRipple:!0,checked:i,onChange:d})}),typeof s=="number"&&e.jsx(b,{align:"center",children:e.jsx(P,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:x=>W(x.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:x=>`1px solid ${W(x.palette.primary.main,.16)}`,mx:"auto",transition:x=>x.transitions.create(["all"],{duration:x.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:s+1})}),e.jsx(b,{children:t.name}),e.jsx(b,{component:"th",scope:"row",children:e.jsx(P,{sx:{gap:2,display:"flex",alignItems:"center"},children:t.bill_no})}),e.jsx(b,{children:t.vendor_name}),e.jsx(b,{children:ae(t.bill_date)}),e.jsx(b,{align:"right",children:ge(t.grand_total)}),e.jsx(b,{children:t.payment_type}),e.jsx(b,{align:"right",children:e.jsxs(P,{sx:{display:"flex",justifyContent:"flex-end"},children:[u&&t.paid_amount===0&&e.jsx(T,{onClick:m,sx:{color:"primary.main"},children:e.jsx(v,{icon:"solar:pen-bold"})}),g&&t.paid_amount===0&&e.jsx(T,{onClick:c,sx:{color:"error.main"},children:e.jsx(v,{icon:"solar:trash-bin-trash-bold"})}),e.jsx(T,{onClick:l,sx:{color:"info.main"},children:e.jsx(v,{icon:"solar:eye-bold"})})]})})]})}function ke({order:t,onSort:i,orderBy:d,rowCount:l,headLabel:m,numSelected:c,onSelectAllRows:u,hideCheckbox:g=!1,showIndex:h=!1}){return e.jsx(pe,{children:e.jsxs(I,{children:[!g&&e.jsx(b,{padding:"checkbox",children:e.jsx(L,{indeterminate:c>0&&c<l,checked:l>0&&c===l,onChange:s=>u(s.target.checked)})}),h&&e.jsx(b,{align:"center",children:"Sno"}),m.map(s=>e.jsx(b,{align:s.align||"left",sx:{width:s.width,minWidth:s.minWidth},children:s.label},s.id))]})})}const E=[{value:"modified_desc",label:"Newest First"},{value:"creation_asc",label:"Oldest First"},{value:"grand_total_desc",label:"Amount: High to Low"},{value:"grand_total_asc",label:"Amount: Low to High"},{value:"vendor_name_asc",label:"Vendor: A to Z"},{value:"vendor_name_desc",label:"Vendor: Z to A"}];function Re({numSelected:t,filterName:i,onFilterName:d,searchPlaceholder:l="Search purchases...",onDelete:m,sortBy:c="modified_desc",onSortChange:u,onOpenFilter:g,canReset:h}){var w;const[s,x]=a.useState(null),j=o=>{x(o.currentTarget)},y=()=>{x(null)},r=o=>{u&&u(o),y()},p=((w=E.find(o=>o.value===c))==null?void 0:w.label)||"Sort";return e.jsxs(be,{sx:{height:96,display:"flex",justifyContent:"space-between",p:o=>o.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(_,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(fe,{value:i,onChange:d,placeholder:l,startAdornment:e.jsx(je,{position:"start",children:e.jsx(v,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:480,width:1}}),e.jsx(P,{sx:{display:"flex",gap:1,alignItems:"center"},children:t>0?e.jsx(T,{onClick:m,children:e.jsx(v,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(R,{disableRipple:!0,color:"inherit",onClick:g,endIcon:e.jsx(v,{icon:"ic:round-filter-list",width:20,sx:h?{color:"error.main"}:void 0}),sx:{color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",height:40,px:2,fontWeight:500,borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:"Filters"}),u&&e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"text",color:"inherit",startIcon:e.jsx(v,{icon:"solar:sort-bold"}),onClick:j,sx:{minWidth:160,height:40,px:2,color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500,"&:hover":{bgcolor:"action.hover"}},children:p}),e.jsx(ve,{anchorEl:s,open:!!s,onClose:y,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1,minWidth:200,boxShadow:o=>o.customShadows.z20}}},children:E.map(o=>e.jsx(ee,{selected:o.value===c,onClick:()=>r(o.value),sx:{typography:"body2",...o.value===c&&{bgcolor:f=>W(f.palette.primary.main,.08),fontWeight:"fontWeightSemiBold"}},children:o.label},o.value))})]})]})})]})}function Ie(t,i,d){return t?Math.max(0,(1+t)*i-d):0}const Oe=["Next day Payment","Due On Receipt","15 days","30 days","60 days","1 Year"];function Fe({open:t,onOpen:i,onClose:d,filters:l,onFilters:m,canReset:c,onResetFilters:u,options:g}){const h=(r,p)=>{m({[r]:p})},s=e.jsxs(P,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(_,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(T,{onClick:u,disabled:!c,sx:{mr:.5,color:c?"primary.main":"text.disabled","&:hover":{bgcolor:c?"primary.lighter":"transparent"}},children:e.jsx(_e,{color:"error",variant:"dot",invisible:!c,children:e.jsx(v,{icon:"solar:restart-bold",width:20})})}),e.jsx(T,{onClick:d,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(v,{icon:"mingcute:close-line",width:20})})]}),x=e.jsxs(k,{spacing:1.5,children:[e.jsx(_,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Vendor"}),e.jsx(B,{fullWidth:!0,size:"small",value:l.vendor_name==="all"?null:g.vendors.find(r=>r.name===l.vendor_name)||null,onChange:(r,p)=>{h("vendor_name",p?p.name:"all")},options:g.vendors,getOptionLabel:r=>`${r.first_name} (${r.name})`,renderInput:r=>e.jsx(A,{...r,placeholder:"Search vendors...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}})})]}),j=e.jsxs(k,{spacing:1.5,children:[e.jsx(_,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Payment Type"}),e.jsx(B,{fullWidth:!0,size:"small",value:l.payment_type==="all"?null:g.payment_types.find(r=>r.name===l.payment_type)||null,onChange:(r,p)=>{h("payment_type",p?p.name:"all")},options:g.payment_types,getOptionLabel:r=>r.name,renderInput:r=>e.jsx(A,{...r,placeholder:"Search payment types...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}})})]}),y=e.jsxs(k,{spacing:1.5,children:[e.jsx(_,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Payment Terms"}),e.jsxs(A,{select:!0,fullWidth:!0,value:l.payment_terms,onChange:r=>h("payment_terms",r.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Payment Terms"}),Oe.map(r=>e.jsx("option",{value:r,children:r},r))]})]});return e.jsxs(te,{anchor:"right",open:t,onClose:d,slotProps:{paper:{sx:{width:340,boxShadow:r=>r.customShadows.z24}}},sx:{zIndex:r=>r.zIndex.drawer+100},children:[s,e.jsx(z,{children:e.jsxs(k,{spacing:3,sx:{p:3},children:[x,j,y]})}),e.jsx(P,{sx:{p:2.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.neutral"},children:e.jsx(R,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(v,{icon:"solar:trash-bin-trash-bold"}),onClick:u,disabled:!c,sx:{borderRadius:1.5,borderColor:"divider",fontWeight:600,"&:hover":{borderColor:"error.main",color:"error.main",bgcolor:"error.lighter"},"&.Mui-disabled":{borderColor:"divider"}},children:"Clear All Filters"})})]})}const Ae=[{id:"name",label:"Purchase ID"},{id:"bill_no",label:"Bill No"},{id:"vendor_name",label:"Vendor"},{id:"bill_date",label:"Bill Date"},{id:"grand_total",label:"Grand Total",align:"right"},{id:"payment_type",label:"Payment Type"},{id:""}];function We(){const t=De(),i=re(),[d,l]=a.useState({open:!1,id:null}),[m,c]=a.useState(""),[u,g]=a.useState("modified_desc"),[h,s]=a.useState({open:!1,message:"",severity:"success"}),[x,j]=a.useState(!1),[y,r]=a.useState({vendor_name:"all",payment_type:"all",payment_terms:"all"}),[p,w]=a.useState([]),[o,f]=a.useState([]),{data:S,total:F,loading:D,refetch:M}=Pe(t.page,t.rowsPerPage,m,u,y),H=n=>{r(C=>({...C,...n})),t.onResetPage()},V=()=>{r({vendor_name:"all",payment_type:"all",payment_terms:"all"}),t.onResetPage()},O=y.vendor_name!=="all"||y.payment_type!=="all"||y.payment_terms!=="all";a.useState(()=>{Promise.all([fetch('/api/method/frappe.client.get_list?doctype=Contacts&fields=["name","first_name"]&link_full_match=0&limit_page_length=999&filters=[["Contacts","customer_type","=","Purchase"]]',{credentials:"include"}),fetch('/api/method/frappe.client.get_list?doctype=Payment Type&fields=["name"]&limit_page_length=999',{credentials:"include"})]).then(async([n,C])=>{const Q=await n.json(),X=await C.json();w(Q.message||[]),f(X.message||[])}).catch(n=>console.error("Failed to fetch dropdown options",n))});const $=a.useCallback(n=>{c(n.target.value),t.onResetPage()},[t]),G=()=>{i.push("/purchase/new")},q=n=>{i.push(`/purchase/edit/${encodeURIComponent(n)}`)},U=n=>{i.push(`/purchase/${encodeURIComponent(n)}`)},Y=a.useCallback(n=>{l({open:!0,id:n})},[]),Z=async()=>{if(d.id)try{await le(d.id),s({open:!0,message:"Purchase deleted successfully",severity:"success"}),await M()}catch(n){console.error(n),s({open:!0,message:"Failed to delete purchase",severity:"error"})}finally{l({open:!1,id:null})}},N=()=>{s(n=>({...n,open:!1}))},J=!D&&S.length===0&&(!!m||O),K=!D&&S.length===0&&!m&&!O;return e.jsxs(ie,{children:[e.jsxs(k,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(_,{variant:"h4",children:"Purchases"}),e.jsx(R,{variant:"contained",color:"info",startIcon:e.jsx(v,{icon:"mingcute:add-line"}),onClick:G,children:"New Purchase"})]}),e.jsxs(ce,{children:[e.jsx(Re,{numSelected:t.selected.length,filterName:m,onFilterName:$,sortBy:u,onSortChange:g,onOpenFilter:()=>j(!0),canReset:O}),e.jsx(z,{children:e.jsx(me,{sx:{overflow:"unset"},children:e.jsxs(ue,{sx:{minWidth:800},children:[e.jsx(ke,{order:t.order,orderBy:t.orderBy,rowCount:F,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:n=>t.onSelectAllRows(n,S.map(C=>C.name)),hideCheckbox:!0,showIndex:!0,headLabel:Ae}),e.jsxs(xe,{children:[S.map((n,C)=>e.jsx(we,{index:t.page*t.rowsPerPage+C,hideCheckbox:!0,row:{id:n.name,name:n.name,bill_no:n.bill_no,vendor_name:n.vendor_name||"",bill_date:n.bill_date,grand_total:n.grand_total||0,payment_type:n.payment_type||"",paid_amount:n.paid_amount||0},selected:t.selected.includes(n.name),onSelectRow:()=>t.onSelectRow(n.name),onEdit:()=>q(n.name),onView:()=>U(n.name),onDelete:()=>Y(n.name)},n.name)),e.jsx(Te,{height:77,emptyRows:Ie(t.page,t.rowsPerPage,F)}),J&&e.jsx(Se,{query:m}),K&&e.jsx(I,{children:e.jsx(b,{colSpan:7,children:e.jsx(de,{title:"No purchases found",description:"Create a new purchase order to track your procurement.",icon:"solar:bag-3-bold-duotone"})})})]})]})})}),e.jsx(ye,{page:t.page,component:"div",count:F,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:t.onChangeRowsPerPage})]}),e.jsx(Fe,{open:x,onOpen:()=>j(!0),onClose:()=>j(!1),filters:y,onFilters:H,canReset:O,onResetFilters:V,options:{vendors:p,payment_types:o}}),e.jsx(Ce,{open:h.open,autoHideDuration:6e3,onClose:N,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ne,{onClose:N,severity:h.severity,sx:{width:"100%"},children:h.message})}),e.jsx(he,{open:d.open,onClose:()=>l({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this purchase?",action:e.jsx(R,{variant:"contained",color:"error",onClick:Z,sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function De(){const[t,i]=a.useState(0),[d,l]=a.useState("bill_no"),[m,c]=a.useState(5),[u,g]=a.useState([]),[h,s]=a.useState("asc"),x=a.useCallback(o=>{s(d===o&&h==="asc"?"desc":"asc"),l(o)},[h,d]),j=a.useCallback((o,f)=>{g(o?f:[])},[]),y=a.useCallback(o=>{g(f=>f.includes(o)?f.filter(S=>S!==o):[...f,o])},[]),r=()=>i(0);return{page:t,order:h,orderBy:d,rowsPerPage:m,selected:u,onSort:x,onSelectRow:y,onSelectAllRows:j,onResetPage:r,onChangePage:(o,f)=>i(f),onChangeRowsPerPage:o=>{c(parseInt(o.target.value,10)),r()}}}function vt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Purchases - ${oe.appName}`}),e.jsx(We,{})]})}export{vt as default};
