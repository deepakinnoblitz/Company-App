import{W as Q,r as a,j as t,T as c,p as j,$ as H,B as A,q as X,D as f,d as v,v as J,I as C,w as K}from"./index-Co7v2xsC.js";import{d as Z}from"./dayjs.min-C2542nnJ.js";import{c as k}from"./format-number-DSNgsWBE.js";import{D as V,C as ee}from"./Card-CDV3jV6O.js";import{a as te,g as se,u as re,c as ae}from"./expenses-deJDgINb.js";import{S as p}from"./Stack-GQIY7Xk9.js";import{T as d}from"./TextField-BmVWmDzd.js";import{L as ne,A as ie}from"./AdapterDayjs-BPhbSeWE.js";import{D as oe}from"./DatePicker-BMZY9CMK.js";import{T as le,a as ce,b as de,c as z,d as n,e as pe}from"./TableRow-DqeBPnxy.js";import{S as xe}from"./Snackbar-BVA3LOhi.js";import{A as ue}from"./AlertTitle-BbqQne_Q.js";function Ie({id:i}){const S=Q(),[_,$]=a.useState([]),[N,B]=a.useState(""),[y,w]=a.useState(""),[g,T]=a.useState(new Date().toISOString().split("T")[0]),[I,W]=a.useState(""),[E,P]=a.useState(""),[o,u]=a.useState([{items:"",quantity:1,price:0,amount:0}]),[D,R]=a.useState(!1),[h,l]=a.useState({open:!1,message:"",severity:"success"});a.useEffect(()=>{te("Payment Type",["name","payment_type"]).then($).catch(e=>console.error("Failed to load Payment Type data:",e)),i&&se(i).then(e=>{B(e.expense_no||""),w(e.expense_category||""),T(e.date||""),W(e.payment_type||""),P(e.description||""),u(e.table_qecz||[])}).catch(e=>console.error("Failed to fetch expense:",e))},[i]);const F=()=>{u([...o,{items:"",quantity:1,price:0,amount:0}])},L=e=>{const r=o.filter((s,x)=>x!==e);u(r)},b=(e,r,s)=>{const x=[...o],m={...x[e],[r]:s},G=Number(m.quantity||0),M=Number(m.price||0);m.amount=G*M,x[e]=m,u(x)},O=o.reduce((e,r)=>e+Number(r.quantity||0),0),q=o.reduce((e,r)=>e+Number(r.amount||0),0),U=async()=>{if(!y){l({open:!0,message:"Please enter expense category",severity:"error"});return}if(!g){l({open:!0,message:"Please select a date",severity:"error"});return}const e=o.filter(r=>r.items!=="");if(e.length===0){l({open:!0,message:"Please add at least one item",severity:"error"});return}try{R(!0);const r={expense_category:y,date:g,payment_type:I,description:E,table_qecz:e,total:q};i?(await re(i,r),l({open:!0,message:"Expense updated successfully",severity:"success"})):(await ae({...r,expense_no:`EXP-${Date.now()}`}),l({open:!0,message:"Expense created successfully",severity:"success"})),setTimeout(()=>S.push("/expenses"),1500)}catch(r){console.error(r),l({open:!0,message:r.message||"Failed to save expense",severity:"error"})}finally{R(!1)}},Y=()=>{S.push("/expenses")};return t.jsxs(V,{maxWidth:"xl",children:[t.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[t.jsx(c,{variant:"h4",children:i?"Edit Expense":"New Expense"}),t.jsxs(p,{direction:"row",spacing:2,children:[t.jsx(j,{variant:"outlined",color:"inherit",onClick:Y,children:"Cancel"}),t.jsx(j,{variant:"contained",color:"primary",onClick:U,disabled:D,children:D?t.jsx(H,{size:24}):i?"Update Expense":"Save Expense"})]})]}),t.jsxs(ee,{sx:{p:4},children:[t.jsxs(A,{sx:{display:"grid",columnGap:3,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[i&&t.jsx(d,{fullWidth:!0,label:"Expense No",value:N,InputProps:{readOnly:!0}}),t.jsx(d,{fullWidth:!0,label:"Expense Category",value:y,onChange:e=>w(e.target.value),required:!0}),t.jsx(ne,{dateAdapter:ie,children:t.jsx(oe,{label:"Date",value:Z(g),onChange:e=>T((e==null?void 0:e.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}})}),t.jsx(d,{fullWidth:!0,select:!0,label:"Payment Type",value:I,onChange:e=>W(e.target.value),required:!0,children:_.map(e=>t.jsx(X,{value:e.name,children:e.payment_type||e.name},e.name))})]}),t.jsx(f,{sx:{my:4}}),t.jsx(c,{variant:"h6",sx:{mb:2},children:"Items"}),t.jsx(le,{sx:{overflow:"unset",border:e=>`1px solid ${e.palette.divider}`,borderRadius:1.5,bgcolor:"background.paper",boxShadow:e=>e.customShadows.z8},children:t.jsxs(ce,{sx:{minWidth:800},children:[t.jsx(de,{sx:{bgcolor:e=>v(e.palette.grey[500],.08)},children:t.jsxs(z,{children:[t.jsx(n,{sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Items"}),t.jsx(n,{width:120,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Qty"}),t.jsx(n,{width:150,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Price"}),t.jsx(n,{width:150,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Amount"}),t.jsx(n,{width:60})]})}),t.jsx(pe,{children:o.map((e,r)=>t.jsxs(z,{sx:{verticalAlign:"top",transition:s=>s.transitions.create("background-color"),"&:hover":{bgcolor:s=>v(s.palette.primary.main,.02)},"&:nth-of-type(even)":{bgcolor:s=>v(s.palette.grey[500],.02)}},children:[t.jsx(n,{sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(d,{fullWidth:!0,size:"small",variant:"standard",value:e.items,onChange:s=>b(r,"items",s.target.value),placeholder:"Item description",InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})}),t.jsx(n,{sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(d,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.quantity===0?"":e.quantity,onChange:s=>b(r,"quantity",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})}),t.jsx(n,{sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(d,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.price===0?"":e.price,onChange:s=>b(r,"price",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})}),t.jsx(n,{align:"right",sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(c,{variant:"subtitle2",color:"primary.main",children:k(e.amount)})}),t.jsx(n,{sx:{px:1,py:1},children:t.jsx(J,{color:"error",onClick:()=>L(r),size:"small",sx:{opacity:.6,"&:hover":{opacity:1}},children:t.jsx(C,{icon:"solar:trash-bin-trash-bold"})})})]},r))})]})}),t.jsx(j,{startIcon:t.jsx(C,{icon:"mingcute:add-line"}),onClick:F,sx:{mt:2},children:"Add Item"}),t.jsx(f,{sx:{my:4}}),t.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",gap:3},children:[t.jsx(d,{fullWidth:!0,multiline:!0,rows:4,label:"Description",value:E,onChange:e=>P(e.target.value),sx:{maxWidth:500}}),t.jsxs(p,{spacing:2,sx:{width:400,mt:3},children:[t.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(C,{icon:"solar:box-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Total Quantity"})]}),t.jsx(c,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:O})]}),t.jsx(f,{sx:{borderStyle:"dashed"}}),t.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsx(c,{variant:"subtitle1",sx:{fontWeight:800},children:"Grand Total"}),t.jsx(c,{variant:"subtitle1",sx:{fontWeight:800,color:"primary.main"},children:k(q)})]})]})]})]}),t.jsx(xe,{open:h.open,autoHideDuration:6e3,onClose:()=>l(e=>({...e,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(K,{severity:h.severity,sx:{width:"100%",boxShadow:e=>e.customShadows.z20},children:[t.jsx(ue,{children:h.severity==="success"?"Success":"Error"}),h.message]})})]})}export{Ie as E};
