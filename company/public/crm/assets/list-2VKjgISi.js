import{r as n,j as e,a1 as re,T as S,B as k,d as F,v as P,I as y,p as T,q as ne,y as se,S as M,W as ae,w as ie}from"./index-Co7v2xsC.js";import{C as le}from"./config-global-BX9xwJzv.js";import"./estimation-create-view-Dwo-yjK4.js";import{f as ce,d as de}from"./estimation-B3H7gbs5.js";import{getDoctypeList as W}from"./leads-d5FzXGcx.js";import{D as me,C as he}from"./Card-CDV3jV6O.js";import{E as ue}from"./empty-content-BBDmaj4d.js";import{C as pe}from"./confirm-dialog--19ddTk_.js";import{c as D,d as b,b as xe,T as ge,a as fe,e as be}from"./TableRow-DqeBPnxy.js";import{f as je}from"./format-time-9uMX-KY9.js";import{c as Ce}from"./format-number-DSNgsWBE.js";import{C as H}from"./Checkbox-CoJXcvzD.js";import{a as ye,T as ve}from"./TablePagination-CEaYVDlQ.js";import{O as _e,I as Se,M as we}from"./Select-B1EkSlUY.js";import{B as $}from"./Badge-DIppMJwA.js";import{d as ke}from"./dayjs.min-C2542nnJ.js";import{S as I}from"./Stack-GQIY7Xk9.js";import{A as z}from"./Autocomplete-BIV6h0T7.js";import{T as B}from"./TextField-BmVWmDzd.js";import{L as Pe,A as Re}from"./AdapterDayjs-BPhbSeWE.js";import{D as Ie}from"./DatePicker-BMZY9CMK.js";import{S as Te}from"./Snackbar-BVA3LOhi.js";import"./print-q83xVReF.js";import"./invoice-CmnDHtbD.js";import"./api-error-handler-CV6pRVHb.js";import"./data-import-KyR0bLZ-.js";import"./contact-form-dialog-1sJlvlMf.js";import"./mui-tel-input.es-qb3PikOv.js";import"./location_data-s7SeKs4x.js";import"./contacts-Y516V3QZ.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./tax-type-form-dialog-Ctl86VPY.js";import"./AlertTitle-BbqQne_Q.js";import"./useFormControl-Cqn8lfES.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./usePreviousProps-CVIlMhUg.js";import"./Popper-DDlcgFVJ.js";import"./Chip-Rg4Dn3a5.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";function De(t,i,s,l,c){const[d,a]=n.useState([]),[f,m]=n.useState(0),[x,p]=n.useState(!0),[C,j]=n.useState(0),o=()=>j(h=>h+1);return n.useEffect(()=>{p(!0),ce({page:t+1,page_size:i,search:s,sort_by:l,filters:c}).then(h=>{a(h.data),m(h.total)}).catch(h=>{console.error("Failed to fetch estimations",h),a([]),m(0)}).finally(()=>p(!1))},[t,i,s,l,c,C]),{data:d,total:f,loading:x,refetch:o}}function Ee(t,i,s){return t>0?Math.max(0,(1+t)*i-s):0}function Ae({searchQuery:t}){return e.jsx(D,{children:e.jsx(b,{align:"center",colSpan:7,children:e.jsxs(re,{sx:{textAlign:"center"},children:[e.jsx(S,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(S,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function Fe({emptyRows:t,height:i}){return t?e.jsx(D,{sx:{...i&&{height:i*t}},children:e.jsx(b,{colSpan:9})}):null}function Oe({row:t,selected:i,onSelectRow:s,onView:l,onEdit:c,onDelete:d,canEdit:a=!0,canDelete:f=!0,hideCheckbox:m=!1,index:x}){return e.jsxs(D,{hover:!0,tabIndex:-1,role:"checkbox",selected:i,children:[!m&&e.jsx(b,{padding:"checkbox",children:e.jsx(H,{disableRipple:!0,checked:i,onChange:s})}),typeof x=="number"&&e.jsx(b,{align:"center",children:e.jsx(k,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:p=>F(p.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:p=>`1px solid ${F(p.palette.primary.main,.16)}`,mx:"auto",transition:p=>p.transitions.create(["all"],{duration:p.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:x+1})}),e.jsx(b,{component:"th",scope:"row",children:e.jsx(k,{sx:{gap:2,display:"flex",alignItems:"center"},children:t.ref_no})}),e.jsx(b,{children:t.client_name}),e.jsx(b,{children:t.customer_name}),e.jsx(b,{children:je(t.estimate_date)}),e.jsx(b,{align:"right",children:Ce(t.grand_total)}),e.jsx(b,{align:"right",children:e.jsxs(k,{sx:{display:"flex",justifyContent:"flex-end"},children:[a&&e.jsx(P,{onClick:c,sx:{color:"primary.main"},children:e.jsx(y,{icon:"solar:pen-bold"})}),f&&e.jsx(P,{onClick:d,sx:{color:"error.main"},children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})}),e.jsx(P,{onClick:l,sx:{color:"info.main"},children:e.jsx(y,{icon:"solar:eye-bold"})})]})})]})}function Ne({rowCount:t,headLabel:i,numSelected:s,onSelectAllRows:l,hideCheckbox:c=!1,showIndex:d=!1}){return e.jsx(xe,{children:e.jsxs(D,{children:[!c&&e.jsx(b,{padding:"checkbox",children:e.jsx(H,{indeterminate:s>0&&s<t,checked:t>0&&s===t,onChange:a=>l(a.target.checked)})}),d&&e.jsx(b,{align:"center",children:"Sno"}),i.map(a=>e.jsx(b,{align:a.align||"left",sx:{width:a.width,minWidth:a.minWidth},children:a.label},a.id))]})})}const L=[{value:"modified_desc",label:"Newest First"},{value:"creation_asc",label:"Oldest First"},{value:"grand_total_desc",label:"Amount: High to Low"},{value:"grand_total_asc",label:"Amount: Low to High"},{value:"client_name_asc",label:"Customer ID: A to Z"},{value:"client_name_desc",label:"Customer ID: Z to A"},{value:"customer_name_asc",label:"Customer Name: A to Z"},{value:"customer_name_desc",label:"Customer Name: Z to A"}];function We({numSelected:t,filterName:i,onFilterName:s,onDelete:l,sortBy:c="estimate_date_desc",onSortChange:d,onOpenFilter:a,canReset:f}){var h;const[m,x]=n.useState(null),p=u=>{x(u.currentTarget)},C=()=>{x(null)},j=u=>{d&&d(u),C()},o=((h=L.find(u=>u.value===c))==null?void 0:h.label)||"Sort";return e.jsxs(ye,{sx:{height:96,display:"flex",justifyContent:"space-between",p:u=>u.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(S,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(_e,{value:i,onChange:s,placeholder:"Search estimations...",startAdornment:e.jsx(Se,{position:"start",children:e.jsx(y,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:480,width:1}}),e.jsx(k,{sx:{display:"flex",gap:1,alignItems:"center"},children:t>0?e.jsx(P,{onClick:l,children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[a&&e.jsx(T,{disableRipple:!0,color:"inherit",onClick:a,startIcon:e.jsx($,{color:"error",variant:"dot",invisible:!f,children:e.jsx(y,{icon:"ic:round-filter-list"})}),sx:{height:40,px:2,bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500},children:"Filters"}),d&&e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"text",color:"inherit",startIcon:e.jsx(y,{icon:"solar:sort-bold"}),onClick:p,sx:{minWidth:160,height:40,px:2,color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500,"&:hover":{bgcolor:"action.hover"}},children:o}),e.jsx(we,{anchorEl:m,open:!!m,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1,minWidth:200,boxShadow:u=>u.customShadows.z20}}},children:L.map(u=>e.jsx(ne,{selected:u.value===c,onClick:()=>j(u.value),sx:{typography:"body2",...u.value===c&&{bgcolor:g=>F(g.palette.primary.main,.08),fontWeight:"fontWeightSemiBold"}},children:u.label},u.value))})]})]})})]})}function ze({open:t,onOpen:i,onClose:s,filters:l,onFilters:c,canReset:d,onResetFilters:a,options:f}){const m=(o,h)=>{c({[o]:h})},x=e.jsxs(k,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(S,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(P,{onClick:a,disabled:!d,sx:{mr:.5,color:d?"primary.main":"text.disabled","&:hover":{bgcolor:d?"primary.lighter":"transparent"}},children:e.jsx($,{color:"error",variant:"dot",invisible:!d,children:e.jsx(y,{icon:"solar:restart-bold",width:20})})}),e.jsx(P,{onClick:s,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(y,{icon:"mingcute:close-line",width:20})})]}),p=e.jsxs(I,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Customer"}),e.jsx(z,{fullWidth:!0,size:"small",value:l.client_name==="all"?null:f.customers.find(o=>o.name===l.client_name)||null,onChange:(o,h)=>{m("client_name",h?h.name:"all")},options:f.customers,getOptionLabel:o=>`${o.customer_name} (${o.name})`,renderInput:o=>e.jsx(B,{...o,placeholder:"Search customers...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}})})]}),C=e.jsxs(I,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Reference No"}),e.jsx(z,{fullWidth:!0,size:"small",value:l.ref_no||null,onChange:(o,h)=>{m("ref_no",h||"")},options:f.refNos,renderInput:o=>e.jsx(B,{...o,placeholder:"Select reference no...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}})})]}),j=e.jsxs(I,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Estimation Date"}),e.jsx(Pe,{dateAdapter:Re,children:e.jsx(Ie,{value:l.estimate_date?ke(l.estimate_date):null,onChange:o=>{m("estimate_date",o?o.format("YYYY-MM-DD"):"")},slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}}})})]});return e.jsxs(se,{anchor:"right",open:t,onClose:s,slotProps:{paper:{sx:{width:340,boxShadow:o=>o.customShadows.z24}}},sx:{zIndex:o=>o.zIndex.drawer+100},children:[x,e.jsx(M,{children:e.jsxs(I,{spacing:3,sx:{p:3},children:[p,C,j]})}),e.jsx(k,{sx:{p:2.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.neutral"},children:e.jsx(T,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),onClick:a,disabled:!d,sx:{borderRadius:1.5,borderColor:"divider",fontWeight:600,"&:hover":{borderColor:"error.main",color:"error.main",bgcolor:"error.lighter"},"&.Mui-disabled":{borderColor:"divider"}},children:"Clear All Filters"})})]})}const Be=[{id:"ref_no",label:"Ref No"},{id:"client_name",label:"Customer ID"},{id:"customer_name",label:"Customer"},{id:"estimate_date",label:"Date"},{id:"grand_total",label:"Amount",align:"right"},{id:""}];function Le(){const t=Me(),i=ae(),[s,l]=n.useState({open:!1,id:null}),[c,d]=n.useState(""),[a,f]=n.useState("modified_desc"),[m,x]=n.useState({open:!1,message:"",severity:"success"}),[p,C]=n.useState(!1),[j,o]=n.useState({client_name:"all",ref_no:"",estimate_date:""}),[h,u]=n.useState([]),[g,v]=n.useState([]);n.useEffect(()=>{(async()=>{try{const _=await W("Contacts",["name","first_name","company_name"]);u(_.map(R=>({name:R.name,customer_name:R.first_name||R.name})));const te=await W("Estimation",["ref_no"]),oe=Array.from(new Set(te.map(R=>R.ref_no).filter(Boolean)));v(oe)}catch(_){console.error("Failed to fetch filter options",_)}})()},[]);const{data:w,total:A,loading:O,refetch:Y}=De(t.page,t.rowsPerPage,c,a,j),Z=r=>{o(_=>({..._,...r})),t.onResetPage()},G=()=>{o({client_name:"all",ref_no:"",estimate_date:""}),t.onResetPage()},E=j.client_name!=="all"||!!j.ref_no||!!j.estimate_date,U=n.useCallback(r=>{d(r.target.value),t.onResetPage()},[t]),q=()=>{i.push("/estimations/new")},Q=r=>{i.push(`/estimations/${encodeURIComponent(r)}/edit`)},V=r=>{i.push(`/estimations/${encodeURIComponent(r)}/view`)},J=n.useCallback(r=>{l({open:!0,id:r})},[]),K=async()=>{if(s.id)try{await de(s.id),x({open:!0,message:"Estimation deleted successfully",severity:"success"}),await Y()}catch(r){console.error(r),x({open:!0,message:"Failed to delete estimation",severity:"error"})}finally{l({open:!1,id:null})}},N=()=>{x(r=>({...r,open:!1}))},X=!O&&w.length===0&&(!!c||E),ee=!O&&w.length===0&&!c&&!E;return e.jsxs(me,{children:[e.jsxs(I,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(S,{variant:"h4",children:"Estimations"}),e.jsx(T,{variant:"contained",color:"info",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),onClick:q,children:"New Estimation"})]}),e.jsxs(he,{children:[e.jsx(We,{numSelected:t.selected.length,filterName:c,onFilterName:U,sortBy:a,onSortChange:f,onOpenFilter:()=>C(!0),canReset:E}),e.jsx(M,{children:e.jsx(ge,{sx:{overflow:"unset"},children:e.jsxs(fe,{sx:{minWidth:800},children:[e.jsx(Ne,{rowCount:A,numSelected:t.selected.length,onSelectAllRows:r=>t.onSelectAllRows(r,w.map(_=>_.name)),hideCheckbox:!0,showIndex:!0,headLabel:Be}),e.jsxs(be,{children:[w.map((r,_)=>e.jsx(Oe,{index:t.page*t.rowsPerPage+_,hideCheckbox:!0,row:{id:r.name,ref_no:r.ref_no,client_name:r.client_name||"",customer_name:r.customer_name||"",estimate_date:r.estimate_date,grand_total:r.grand_total||0},selected:t.selected.includes(r.name),onSelectRow:()=>t.onSelectRow(r.name),onEdit:()=>Q(r.name),onView:()=>V(r.name),onDelete:()=>J(r.name)},r.name)),e.jsx(Fe,{height:77,emptyRows:Ee(t.page,t.rowsPerPage,A)}),X&&e.jsx(Ae,{searchQuery:c}),ee&&e.jsx(D,{children:e.jsx(b,{colSpan:6,children:e.jsx(ue,{title:"No estimations found",description:"Create a new estimation to track your sales pipeline.",icon:"solar:document-text-bold-duotone"})})})]})]})})}),e.jsx(ve,{page:t.page,component:"div",count:A,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:t.onChangeRowsPerPage})]}),e.jsx(ze,{open:p,onOpen:()=>C(!0),onClose:()=>C(!1),filters:j,onFilters:Z,canReset:E,onResetFilters:G,options:{customers:h,refNos:g}}),e.jsx(Te,{open:m.open,autoHideDuration:6e3,onClose:N,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ie,{onClose:N,severity:m.severity,sx:{width:"100%"},children:m.message})}),e.jsx(pe,{open:s.open,onClose:()=>l({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this estimation?",action:e.jsx(T,{variant:"contained",color:"error",onClick:K,sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function Me(){const[t,i]=n.useState(0),[s,l]=n.useState("ref_no"),[c,d]=n.useState(5),[a,f]=n.useState([]),[m,x]=n.useState("asc"),p=n.useCallback(g=>{x(s===g&&m==="asc"?"desc":"asc"),l(g)},[m,s]),C=n.useCallback((g,v)=>{f(g?v:[])},[]),j=n.useCallback(g=>{f(v=>v.includes(g)?v.filter(w=>w!==g):[...v,g])},[]),o=()=>i(0);return{page:t,order:m,orderBy:s,rowsPerPage:c,selected:a,onSort:p,onSelectRow:j,onSelectAllRows:C,onResetPage:o,onChangePage:(g,v)=>i(v),onChangeRowsPerPage:g=>{d(parseInt(g.target.value,10)),o()}}}function Et(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Estimations - ${le.appName}`}),e.jsx(Le,{})]})}export{Et as default};
