import{Z as jt,W as Je,r as p,j as e,$ as Ge,T as h,p as f,I as y,B as W,d as m,D as G,v as Ze,w as Ke}from"./index-Co7v2xsC.js";import{d as Xe}from"./dayjs.min-C2542nnJ.js";import{c as F}from"./format-number-DSNgsWBE.js";import{h as vt}from"./print-q83xVReF.js";import{c as Ve}from"./invoice-CmnDHtbD.js";import{u as et}from"./data-import-KyR0bLZ-.js";import{getDoctypeList as oe,getDoc as tt}from"./leads-d5FzXGcx.js";import{D as Le,C as st}from"./Card-CDV3jV6O.js";import{g as _t,u as Ct,c as It,a as St,b as wt}from"./estimation-B3H7gbs5.js";import{C as Tt}from"./confirm-dialog--19ddTk_.js";import{C as it}from"./contact-form-dialog-1sJlvlMf.js";import{T as Be,a as L,b as nt}from"./tax-type-form-dialog-Ctl86VPY.js";import{S as u}from"./Stack-GQIY7Xk9.js";import{L as at,A as rt}from"./AdapterDayjs-BPhbSeWE.js";import{A as le,c as ot}from"./Autocomplete-BIV6h0T7.js";import{T as x}from"./TextField-BmVWmDzd.js";import{D as lt}from"./DatePicker-BMZY9CMK.js";import{T as ct,a as dt,b as pt,c as qe,d as g,e as ut}from"./TableRow-DqeBPnxy.js";import{S as mt}from"./Snackbar-BVA3LOhi.js";import{A as ht}from"./AlertTitle-BbqQne_Q.js";import{D as xt,a as gt}from"./DialogContent-DtP-sWqR.js";import{D as yt}from"./DialogTitle-C3eBZids.js";import{D as ft}from"./DialogActions-h_2rRG3x.js";const Ye=ot();function Kt(){const{id:I}=jt(),ee=Je(),[ce,de]=p.useState([]),[te,H]=p.useState([]),[Y,A]=p.useState([]),[$,pe]=p.useState(""),[se,Q]=p.useState(""),[ie,J]=p.useState(""),[ue,me]=p.useState(""),[ne,Z]=p.useState(""),[Ce,he]=p.useState(""),[Ie,N]=p.useState(""),[D,k]=p.useState([]),[xe,w]=p.useState(!1),[_,z]=p.useState([]),[ge,E]=p.useState("Flat"),[K,Se]=p.useState(0),[we,ae]=p.useState(!0),[P,Te]=p.useState(!1),[R,We]=p.useState(!1),[Ae,B]=p.useState(!1),[O,j]=p.useState({open:!1,message:"",severity:"success"}),[Ne,q]=p.useState(!1),[De,Pe]=p.useState(!1),[M,X]=p.useState({item_name:"",item_code:"",rate:0}),[U,ye]=p.useState(null),[re,Re]=p.useState(!1),[S,Oe]=p.useState(!1),[fe,Fe]=p.useState("");p.useEffect(()=>{oe("Contacts",["name","first_name","company_name","address"]).then(de),oe("Item",["name","item_name","rate","item_code"]).then(H),oe("Tax Types",["name","tax_name","tax_percentage","tax_type"]).then(A),I&&_t(I).then(t=>{if(pe(t.client_name||""),Q(t.customer_name||""),J(t.billing_name||""),me(t.estimate_date||""),Z(t.billing_address||""),he(t.description||""),N(t.terms_and_conditions||""),t.attachments)try{const a=JSON.parse(t.attachments);Array.isArray(a)?k(a):k([{name:t.attachments.split("/").pop()||"Attachment",url:t.attachments}])}catch{k([{name:t.attachments.split("/").pop()||"Attachment",url:t.attachments}])}else k([]);E(t.overall_discount_type||"Flat"),Se(t.overall_discount||0),z(t.table_qecz||[])}).finally(()=>ae(!1))},[I]);const be=async t=>{if(pe(t),t)try{const a=await tt("Contacts",t);Q(a.first_name||""),J(a.company_name||""),Z(a.address||"")}catch(a){console.error("Failed to fetch contact details:",a)}else Q(""),J(""),Z("")},$e=()=>{z([..._,{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,cgst:0,sgst:0,igst:0,sub_total:0}])},Ee=t=>{const a=_.filter((i,o)=>o!==t);z(a)},C=async(t,a,i)=>{const o=[..._],d={...o[t],[a]:i};if(a==="service"){const T=te.find(_e=>_e.name===i);T?(d.price=T.rate||0,d.description=T.item_name||"",d.hsn_code=T.item_code||""):(d.price=0,d.description="",d.hsn_code="",d.quantity=1,d.discount=0,d.tax_type="",d.tax_percent=0)}let v="";if(a==="tax_type"){const T=Y.find(_e=>_e.name===i);T?(d.tax_percent=T.tax_percentage||0,v=T.tax_type||""):(d.tax_percent=0,v="")}else if(d.tax_type){const T=Y.find(_e=>_e.name===d.tax_type);v=(T==null?void 0:T.tax_type)||""}const ve=d.quantity*d.price,bt=d.discount_type==="Flat"?d.discount:ve*d.discount/100,He=Math.max(0,ve-bt);d.tax_amount=He*d.tax_percent/100,d.sub_total=He+d.tax_amount,v==="GST"?(d.cgst=d.tax_amount/2,d.sgst=d.tax_amount/2,d.igst=0):v==="IGST"?(d.cgst=0,d.sgst=0,d.igst=d.tax_amount):(d.cgst=0,d.sgst=0,d.igst=0),o[t]=d,z(o)},Me=async()=>{if(!M.item_name){j({open:!0,message:"Please enter Item Name",severity:"error"});return}try{Re(!0);const t=await Ve(M),a={name:t.name,item_name:t.item_name,item_code:t.item_code||"",rate:t.rate||0};if(H(i=>[...i,a]),U!==null){const i=[..._];i[U]={...i[U],service:t.name,description:t.item_name||"",hsn_code:t.item_code||"",price:t.rate||0};const o=i[U],d=o.quantity*o.price,v=o.discount_type==="Flat"?o.discount:d*o.discount/100,ve=Math.max(0,d-v);o.tax_amount=ve*o.tax_percent/100,o.sub_total=ve+o.tax_amount,z(i)}q(!1),X({item_name:"",item_code:"",rate:0}),j({open:!0,message:"Item created successfully",severity:"success"})}catch(t){j({open:!0,message:t.message||"Failed to create item",severity:"error"})}finally{Re(!1)}},je=_.reduce((t,a)=>{const i=a.quantity*a.price,o=a.discount_type==="Flat"?a.discount:i*a.discount/100;return t+(i-o)},0),ke=_.reduce((t,a)=>t+a.tax_amount,0),ze=je+ke,s=_.reduce((t,a)=>t+a.quantity,0),l=ge==="Flat"?K:ze*K/100,n=Math.max(0,ze-l),r=t=>{var i;const a=(i=t.target.files)==null?void 0:i[0];a&&k([a])},c=t=>{k(a=>a.filter((i,o)=>o!==t))},b=async()=>{if(!I||!$)return;const t=_.filter(a=>a.service!=="");if(t.length===0){j({open:!0,message:"Please add at least one item",severity:"error"});return}try{Te(!0);let a="";if(D.length>0&&D[0]instanceof File){w(!0);try{a=(await et(D[0],"Estimation",I,"attachments")).file_url}catch(o){throw new Error(`File upload failed: ${o.message}`)}finally{w(!1)}}else D.length>0&&(a=D[0].url||"");const i={client_name:$,customer_name:se,billing_name:ie,estimate_date:ue,billing_address:ne,description:Ce,terms_and_conditions:Ie,attachments:a,overall_discount_type:ge,overall_discount:K,total_qty:s,total_amount:je,grand_total:n,table_qecz:t.map(o=>({name:o.name,service:o.service,hsn_code:o.hsn_code,description:o.description,quantity:o.quantity,price:o.price,discount_type:o.discount_type,discount:o.discount,tax_type:o.tax_type,tax_amount:o.tax_amount,cgst:o.cgst,sgst:o.sgst,igst:o.igst,sub_total:o.sub_total}))};await Ct(I,i),j({open:!0,message:"Estimation updated successfully",severity:"success"}),setTimeout(()=>ee.push("/estimations"),1500)}catch(a){console.error(a),j({open:!0,message:a.message||"Failed to update estimation",severity:"error"})}finally{Te(!1)}};if(we)return e.jsx(Le,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(Ge,{})});const V=()=>{I&&vt(St(I))},Ue=async()=>{if(I)try{We(!0);const t=await It(I);ee.push(`/invoices/${encodeURIComponent(t)}/view`,{converted:!0})}catch(t){console.error("Failed to convert estimation:",t),j({open:!0,message:"Failed to convert estimation",severity:"error"})}finally{We(!1),B(!1)}};return e.jsxs(Le,{maxWidth:"xl",children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,className:"no-print",children:[e.jsx(h,{variant:"h4",children:"Edit Estimation"}),e.jsxs(u,{direction:"row",spacing:2,children:[e.jsx(f,{variant:"outlined",color:"inherit",onClick:()=>ee.push("/estimations"),children:"Cancel"}),e.jsx(f,{variant:"outlined",color:"primary",onClick:V,startIcon:e.jsx(y,{icon:"solar:printer-bold"}),children:"Print"}),e.jsx(f,{variant:"contained",color:"warning",onClick:()=>B(!0),startIcon:e.jsx(y,{icon:"solar:transfer-horizontal-bold"}),disabled:R,children:R?"Converting...":"Convert to Invoice"}),e.jsx(f,{variant:"contained",color:"primary",onClick:b,loading:P,children:"Save Changes"})]})]}),e.jsx(at,{dateAdapter:rt,children:e.jsxs(st,{sx:{p:4},children:[e.jsxs(W,{sx:{display:"grid",columnGap:3,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsxs(u,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(le,{fullWidth:!0,options:ce,getOptionLabel:t=>t.first_name?`${t.name} - ${t.first_name}`:t.name||"",value:ce.find(t=>t.name===$)||null,onChange:(t,a)=>be((a==null?void 0:a.name)||""),renderInput:t=>e.jsx(x,{...t,label:"Customer ID",required:!0})}),$&&e.jsx(f,{variant:"contained",color:"primary",onClick:()=>Pe(!0),sx:{height:35,px:2},children:"Edit"})]}),e.jsx(x,{fullWidth:!0,label:"Customer Name",value:se,onChange:t=>Q(t.target.value),slotProps:{input:{readOnly:!0}},sx:{bgcolor:t=>m(t.palette.grey[500],.08)}}),e.jsx(x,{fullWidth:!0,label:"Billing Name",value:ie,onChange:t=>J(t.target.value),slotProps:{input:{readOnly:!0}},sx:{bgcolor:t=>m(t.palette.grey[500],.08)}}),e.jsx(lt,{label:"Estimate Date",value:ue?Xe(ue):null,onChange:t=>me((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(x,{fullWidth:!0,label:"Billing Address",multiline:!0,rows:2,value:ne,onChange:t=>Z(t.target.value),sx:{gridColumn:"span 2",bgcolor:t=>m(t.palette.grey[500],.08)},slotProps:{input:{readOnly:!0}}})]}),e.jsx(G,{sx:{my:4}}),e.jsx(h,{variant:"h6",sx:{mb:2},children:"Items"}),e.jsx(ct,{sx:{overflow:"unset",border:t=>`1px solid ${t.palette.divider}`,borderRadius:1.5,bgcolor:"background.paper",boxShadow:t=>t.customShadows.z8},children:e.jsxs(dt,{sx:{minWidth:960},children:[e.jsx(pt,{sx:{bgcolor:t=>m(t.palette.grey[500],.08)},children:e.jsxs(qe,{children:[e.jsx(g,{width:180,sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Service"}),e.jsx(g,{width:80,sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"HSN"}),e.jsx(g,{sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Description"}),e.jsx(g,{width:80,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Qty"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Price"}),e.jsx(g,{width:140,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Discount"}),e.jsx(g,{width:150,sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Type"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Amt"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Total"}),e.jsx(g,{width:40})]})}),e.jsx(ut,{children:_.map((t,a)=>e.jsxs(qe,{sx:{verticalAlign:"top",transition:i=>i.transitions.create("background-color"),"&:hover":{bgcolor:i=>m(i.palette.primary.main,.02)},"&:nth-of-type(even)":{bgcolor:i=>m(i.palette.grey[500],.02)}},children:[[{field:"service",component:e.jsx(le,{fullWidth:!0,size:"small",options:te,getOptionLabel:i=>typeof i=="string"?i:i.inputValue?i.inputValue:i.item_name||i.name||"",filterOptions:(i,o)=>{const d=Ye(i,o),{inputValue:v}=o;return d.push({inputValue:v||"",item_name:v?`+ Create "${v}"`:"+ Create item",isNew:!0}),d},value:te.find(i=>i.name===t.service)||null,onChange:(i,o)=>{typeof o=="string"?C(a,"service",o):o&&o.isNew?(ye(a),X(d=>({...d,item_name:o.inputValue})),q(!0)):C(a,"service",(o==null?void 0:o.name)||"")},ListboxProps:{sx:{width:"350px","& .MuiAutocomplete-option":{py:1.5,px:2,borderRadius:.75,mx:.5,my:.25}}},slotProps:{paper:{sx:{mt:.5,boxShadow:i=>i.customShadows.z20,borderRadius:1.5}}},renderInput:i=>e.jsx(x,{...i,placeholder:"Select Service",variant:"standard",InputProps:{...i.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(i,o)=>e.jsx(W,{component:"li",...i,sx:{typography:"body2",...o.isNew&&{color:"primary.main",fontWeight:600,bgcolor:d=>m(d.palette.primary.main,.08),borderTop:d=>`1px solid ${d.palette.divider}`,mt:.5,"&:hover":{bgcolor:d=>m(d.palette.primary.main,.16)}}},children:o.isNew?e.jsxs(u,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(u,{spacing:0,children:[e.jsx(h,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(h,{variant:"caption",sx:{opacity:.8},children:"Item"})]})]}):o.item_name||o.name})})},{field:"hsn_code",component:e.jsx(x,{fullWidth:!0,size:"small",variant:"standard",value:t.hsn_code,onChange:i=>C(a,"hsn_code",i.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"description",component:e.jsx(x,{fullWidth:!0,multiline:!0,size:"small",variant:"standard",value:t.description,onChange:i=>C(a,"description",i.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"quantity",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:t.quantity===0?"":t.quantity,onChange:i=>C(a,"quantity",Number(i.target.value)),onFocus:i=>i.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"price",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:t.price===0?"":t.price,onChange:i=>C(a,"price",Number(i.target.value)),onFocus:i=>i.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"discount",component:e.jsxs(u,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsxs(Be,{size:"small",value:t.discount_type,exclusive:!0,onChange:(i,o)=>{o!==null&&C(a,"discount_type",o)},sx:{height:28,"& .MuiToggleButton-root":{px:1,py:0,border:"none",typography:"body2","&.Mui-selected":{bgcolor:i=>m(i.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:i=>m(i.palette.primary.main,.2)}}}},children:[e.jsx(L,{value:"Flat",children:"₹"}),e.jsx(L,{value:"Percentage",children:"%"})]}),e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:t.discount===0?"":t.discount,onChange:i=>C(a,"discount",Number(i.target.value)),onFocus:i=>i.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})]})},{field:"tax_type",component:e.jsx(le,{fullWidth:!0,size:"small",options:Y,getOptionLabel:i=>typeof i=="string"?i:i.inputValue?i.inputValue:i.tax_name||i.name||"",filterOptions:(i,o)=>{const d=Ye(i,o),{inputValue:v}=o;return d.push({inputValue:v||"",tax_name:v?`+ Create "${v}"`:"Create Tax Type",isNew:!0}),d},value:Y.find(i=>i.name===t.tax_type)||null,onChange:(i,o)=>{typeof o=="string"?C(a,"tax_type",o):o&&o.isNew?(ye(a),Fe(o.inputValue),Oe(!0)):C(a,"tax_type",(o==null?void 0:o.name)||"")},renderInput:i=>e.jsx(x,{...i,placeholder:"Select Tax",variant:"standard",InputProps:{...i.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(i,o)=>e.jsx(W,{component:"li",...i,sx:{typography:"body2",...o.isNew&&{color:"primary.main",fontWeight:600,bgcolor:d=>m(d.palette.primary.main,.08),borderTop:d=>`1px solid ${d.palette.divider}`,mt:.5,"&:hover":{bgcolor:d=>m(d.palette.primary.main,.16)}}},children:o.isNew?e.jsxs(u,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(u,{spacing:0,children:[e.jsx(h,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(h,{variant:"caption",sx:{opacity:.8},children:"Tax Type"})]})]}):o.tax_name||o.name})})}].map((i,o)=>e.jsx(g,{sx:{px:1,py:1,borderRight:d=>`1px solid ${d.palette.divider}`,transition:d=>d.transitions.create(["background-color","box-shadow"]),"&:focus-within":{bgcolor:d=>m(d.palette.primary.main,.05)}},children:i.component},o)),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:i=>`1px solid ${i.palette.divider}`},children:e.jsx(h,{variant:"body2",sx:{fontWeight:"fontWeightMedium"},children:F(t.tax_amount)})}),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:i=>`1px solid ${i.palette.divider}`},children:e.jsx(h,{variant:"subtitle2",color:"primary.main",children:F(t.sub_total)})}),e.jsx(g,{sx:{px:1,py:1},children:e.jsx(Ze,{color:"error",onClick:()=>Ee(a),size:"small",sx:{opacity:.6,"&:hover":{opacity:1}},children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})})]},a))})]})}),e.jsx(f,{startIcon:e.jsx(y,{icon:"mingcute:add-line"}),onClick:$e,sx:{mt:2},children:"Add Item"}),e.jsx(G,{sx:{my:4}}),e.jsx(W,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(u,{spacing:2,sx:{width:400,mt:3},children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:box-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Total Quantity"})]}),e.jsx(h,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:s})]}),e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:bill-list-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Taxable Amount"})]}),e.jsx(h,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:F(je)})]}),e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:calculator-minimalistic-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Total Tax"})]}),e.jsx(h,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:F(ke)})]}),e.jsxs(u,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,sx:{flexGrow:1},children:[e.jsx(y,{icon:"solar:tag-horizontal-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Overall Discount"})]}),e.jsxs(Be,{size:"small",value:ge,exclusive:!0,onChange:(t,a)=>{a!==null&&E(a)},sx:{height:32,"& .MuiToggleButton-root":{px:1,py:0,typography:"body2","&.Mui-selected":{bgcolor:t=>m(t.palette.primary.main,.1),color:"primary.main"}}},children:[e.jsx(L,{value:"Flat",children:"₹"}),e.jsx(L,{value:"Percentage",children:"%"})]}),e.jsx(x,{size:"small",type:"number",variant:"standard",value:K===0?"":K,onChange:t=>Se(Number(t.target.value)),onFocus:t=>t.target.select(),sx:{width:100,"& .MuiInputBase-root":{bgcolor:t=>m(t.palette.grey[500],.08),borderRadius:.75,px:1,"&:hover":{bgcolor:t=>m(t.palette.grey[500],.12)},"&.Mui-focused":{bgcolor:t=>m(t.palette.primary.main,.08)}}},inputProps:{sx:{textAlign:"right",typography:"body2"}}})]}),e.jsx(G,{}),e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:wad-of-money-bold-duotone",sx:{color:"primary.main",width:24,height:24}}),e.jsx(h,{variant:"subtitle1",sx:{color:"primary.main"},children:"Grand Total"})]}),e.jsx(h,{variant:"h6",color:"primary",sx:{width:120,textAlign:"right"},children:F(n)})]})]})}),e.jsx(G,{sx:{my:4,borderStyle:"dashed"}}),e.jsxs(W,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[e.jsxs(u,{spacing:3,children:[e.jsx(x,{fullWidth:!0,label:"Description",multiline:!0,rows:4,value:Ce,onChange:t=>he(t.target.value)}),e.jsx(x,{fullWidth:!0,label:"Terms & Conditions / Remarks",multiline:!0,rows:4,value:Ie,onChange:t=>N(t.target.value)})]}),e.jsxs(W,{sx:{p:3,borderRadius:2,bgcolor:t=>m(t.palette.grey[500],.04),border:t=>`1px dashed ${m(t.palette.grey[500],.2)}`},children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2.5},children:[e.jsx(h,{variant:"h6",children:"Attachments"}),e.jsxs(f,{variant:"contained",component:"label",color:"primary",size:"small",startIcon:e.jsx(y,{icon:"solar:upload-bold"}),disabled:xe,children:[xe?"Uploading...":"Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:r})]})]}),e.jsx(u,{spacing:1,children:D.length===0?e.jsxs(u,{alignItems:"center",justifyContent:"center",sx:{py:3,color:"text.disabled"},children:[e.jsx(y,{icon:"solar:file-bold",width:40,height:40,sx:{mb:1,opacity:.48}}),e.jsx(h,{variant:"body2",children:"No attachments yet"})]}):D.map((t,a)=>e.jsxs(u,{direction:"row",alignItems:"center",sx:{px:1.5,py:.75,borderRadius:1.5,bgcolor:i=>m(i.palette.grey[500],.08)},children:[e.jsx(y,{icon:"solar:link-bold",width:20,sx:{mr:1,color:"text.secondary",flexShrink:0}}),e.jsx(h,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:typeof t=="string"?t:t.url||t.name}),e.jsx(f,{size:"small",color:"inherit",onClick:()=>c(a),sx:{px:1.5,py:0,height:26,borderRadius:1.5,minWidth:"auto",typography:"caption",bgcolor:"background.paper",border:i=>`1px solid ${m(i.palette.grey[500],.24)}`,"&:hover":{bgcolor:i=>m(i.palette.grey[500],.08)}},children:"Clear"})]},a))})]})]})]})}),e.jsx(it,{open:De,onClose:()=>Pe(!1),contactId:$,onSuccess:()=>{$&&be($)}}),e.jsx(nt,{open:S,initialName:fe,onClose:()=>Oe(!1),onSuccess:t=>{A(a=>[...a,t]),U!==null&&C(U,"tax_type",t.name)}}),e.jsx(mt,{open:O.open,autoHideDuration:6e3,onClose:()=>j(t=>({...t,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(Ke,{severity:O.severity,sx:{width:"100%",boxShadow:t=>t.customShadows.z20},children:[e.jsx(ht,{children:O.severity==="success"?"Success":"Error"}),O.message]})}),e.jsxs(xt,{open:Ne,onClose:()=>!re&&q(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(yt,{children:"Create item"}),e.jsx(gt,{children:e.jsxs(u,{spacing:3,sx:{pt:1},children:[e.jsx(x,{fullWidth:!0,label:"Item Name",value:M.item_name,onChange:t=>X(a=>({...a,item_name:t.target.value})),required:!0}),e.jsx(x,{fullWidth:!0,label:"HSN Code",value:M.item_code,onChange:t=>X(a=>({...a,item_code:t.target.value}))}),e.jsx(x,{fullWidth:!0,label:"Rate",type:"number",value:M.rate,onChange:t=>X(a=>({...a,rate:Number(t.target.value)}))})]})}),e.jsxs(ft,{children:[e.jsx(f,{color:"inherit",onClick:()=>q(!1),disabled:re,children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:Me,disabled:re,children:re?e.jsx(Ge,{size:24}):"Create"})]})]}),e.jsx(Tt,{open:Ae,onClose:()=>!R&&B(!1),title:"Confirm Conversion",content:"Are you sure you want to convert this estimation into an invoice? This will create a new invoice document.",action:e.jsx(f,{onClick:Ue,color:"warning",variant:"contained",disabled:R,sx:{borderRadius:1.5,minWidth:100},children:R?"Converting...":"Confirm"})})]})}const Qe=ot();function Xt(){const I=Je(),[ee,ce]=p.useState([]),[de,te]=p.useState([]),[H,Y]=p.useState([]),[A,$]=p.useState(""),[pe,se]=p.useState(""),[Q,ie]=p.useState(""),[J,ue]=p.useState(new Date().toISOString().split("T")[0]),[me,ne]=p.useState(""),[Z,Ce]=p.useState(""),[he,Ie]=p.useState(""),[N,D]=p.useState([]),[k,xe]=p.useState(!1),[w,_]=p.useState([{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,cgst:0,sgst:0,igst:0,sub_total:0}]),[z,ge]=p.useState("Flat"),[E,K]=p.useState(0),[Se,we]=p.useState(!1),[ae,P]=p.useState({open:!1,message:"",severity:"success"}),[Te,R]=p.useState(!1),[We,Ae]=p.useState(!1),[B,O]=p.useState({item_name:"",item_code:"",rate:0}),[j,Ne]=p.useState(null),[q,De]=p.useState(!1),[Pe,M]=p.useState(!1),[X,U]=p.useState("");p.useEffect(()=>{oe("Contacts",["name","first_name","company_name","address"]).then(s=>{console.log("Contacts data loaded:",s),ce(s)}).catch(s=>{console.error("Failed to load Contacts data:",s),ce([])}),oe("Item",["name","item_name","rate","item_code"]).then(te).catch(s=>console.error("Failed to load Item data:",s)),oe("Tax Types",["name","tax_name","tax_percentage","tax_type"]).then(Y).catch(s=>console.error("Failed to load Tax Types data:",s))},[]);const ye=async s=>{if($(s),s)try{const l=await tt("Contacts",s);se(l.first_name||""),ie(l.company_name||""),ne(l.address||"")}catch(l){console.error("Failed to fetch contact details:",l)}else se(""),ie(""),ne("")},re=()=>{_([...w,{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,cgst:0,sgst:0,igst:0,sub_total:0}])},Re=s=>{const l=w.filter((n,r)=>r!==s);_(l)},S=async(s,l,n)=>{const r=[...w],c={...r[s],[l]:n};if(l==="service"){const a=de.find(i=>i.name===n);a?(c.price=a.rate||0,c.description=a.item_name||"",c.hsn_code=a.item_code||""):(c.price=0,c.description="",c.hsn_code="",c.quantity=1,c.discount=0,c.tax_type="",c.tax_percent=0)}let b="";if(l==="tax_type"){const a=H.find(i=>i.name===n);a?(c.tax_percent=a.tax_percentage||0,b=a.tax_type||""):(c.tax_percent=0,b="")}else if(c.tax_type){const a=H.find(i=>i.name===c.tax_type);b=(a==null?void 0:a.tax_type)||""}const V=c.quantity*c.price,Ue=c.discount_type==="Flat"?c.discount:V*c.discount/100,t=Math.max(0,V-Ue);c.tax_amount=t*c.tax_percent/100,c.sub_total=t+c.tax_amount,b==="GST"?(c.cgst=c.tax_amount/2,c.sgst=c.tax_amount/2,c.igst=0):b==="IGST"?(c.cgst=0,c.sgst=0,c.igst=c.tax_amount):(c.cgst=0,c.sgst=0,c.igst=0),r[s]=c,_(r)},Oe=async()=>{if(!B.item_name){P({open:!0,message:"Please enter Item Name",severity:"error"});return}try{De(!0);const s=await Ve(B),l={name:s.name,item_name:s.item_name,item_code:s.item_code||"",rate:s.rate||0};if(te(n=>[...n,l]),j!==null){const n=[...w];n[j]={...n[j],service:s.name,description:s.item_name||"",hsn_code:s.item_code||"",price:s.rate||0};const r=n[j],c=r.quantity*r.price,b=r.discount_type==="Flat"?r.discount:c*r.discount/100,V=Math.max(0,c-b);r.tax_amount=V*r.tax_percent/100,r.sub_total=V+r.tax_amount,_(n)}R(!1),O({item_name:"",item_code:"",rate:0}),P({open:!0,message:"Item created successfully",severity:"success"})}catch(s){P({open:!0,message:s.message||"Failed to create item",severity:"error"})}finally{De(!1)}},fe=w.reduce((s,l)=>{const n=l.quantity*l.price,r=l.discount_type==="Flat"?l.discount:n*l.discount/100;return s+(n-r)},0),Fe=w.reduce((s,l)=>s+l.tax_amount,0),be=fe+Fe,$e=w.reduce((s,l)=>s+l.quantity,0),Ee=z==="Flat"?E:be*E/100,C=Math.max(0,be-Ee),Me=s=>{var n;const l=(n=s.target.files)==null?void 0:n[0];l&&D([l])},je=s=>{D(l=>l.filter((n,r)=>r!==s))},ke=async()=>{if(!A){P({open:!0,message:"Please select a customer",severity:"error"});return}const s=w.filter(l=>l.service!=="");if(s.length===0){P({open:!0,message:"Please add at least one item",severity:"error"});return}try{we(!0);let l="";if(N.length>0&&N[0]instanceof File){xe(!0);try{l=(await et(N[0])).file_url}catch(r){throw new Error(`File upload failed: ${r.message}`)}finally{xe(!1)}}else N.length>0&&(l=N[0].url||"");const n={client_name:A,customer_name:pe,billing_name:Q,estimate_date:J,billing_address:me,description:Z,terms_and_conditions:he,attachments:l,overall_discount_type:z,overall_discount:E,total_qty:$e,total_amount:fe,grand_total:C,table_qecz:s.map(r=>({service:r.service,hsn_code:r.hsn_code,description:r.description,quantity:r.quantity,price:r.price,discount_type:r.discount_type,discount:r.discount,tax_type:r.tax_type,tax_amount:r.tax_amount,cgst:r.cgst,sgst:r.sgst,igst:r.igst,sub_total:r.sub_total}))};await wt(n),P({open:!0,message:"Estimation created successfully",severity:"success"}),setTimeout(()=>I.push("/estimations"),1500)}catch(l){console.error(l),P({open:!0,message:l.message||"Failed to create estimation",severity:"error"})}finally{we(!1)}},ze=()=>{I.push("/estimations")};return e.jsxs(Le,{maxWidth:"xl",children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(h,{variant:"h4",children:"New Estimation"}),e.jsxs(u,{direction:"row",spacing:2,children:[e.jsx(f,{variant:"outlined",color:"inherit",onClick:ze,children:"Cancel"}),e.jsx(f,{variant:"contained",color:"primary",onClick:ke,loading:Se,children:"Save Estimation"})]})]}),e.jsx(at,{dateAdapter:rt,children:e.jsxs(st,{sx:{p:4},children:[e.jsxs(W,{sx:{display:"grid",columnGap:3,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsxs(u,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(le,{fullWidth:!0,options:ee,getOptionLabel:s=>s.first_name?`${s.name} - ${s.first_name}`:s.name||"",value:ee.find(s=>s.name===A)||null,onChange:(s,l)=>ye((l==null?void 0:l.name)||""),renderInput:s=>e.jsx(x,{...s,label:"Customer ID",required:!0})}),A&&e.jsx(f,{variant:"contained",color:"primary",onClick:()=>Ae(!0),sx:{height:35,px:2},children:"Edit"})]}),e.jsx(x,{fullWidth:!0,label:"Customer Name",value:pe,onChange:s=>se(s.target.value),slotProps:{input:{readOnly:!0}},sx:{bgcolor:s=>m(s.palette.grey[500],.05)}}),e.jsx(x,{fullWidth:!0,label:"Billing Name",value:Q,onChange:s=>ie(s.target.value),slotProps:{input:{readOnly:!0}},sx:{bgcolor:s=>m(s.palette.grey[500],.05)}}),e.jsx(lt,{label:"Estimate Date",value:Xe(J),onChange:s=>ue((s==null?void 0:s.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(x,{fullWidth:!0,label:"Billing Address",multiline:!0,rows:2,value:me,onChange:s=>ne(s.target.value),sx:{gridColumn:"span 2",bgcolor:s=>m(s.palette.grey[500],.08)},slotProps:{input:{readOnly:!0}}})]}),e.jsx(G,{sx:{my:4}}),e.jsx(h,{variant:"h6",sx:{mb:2},children:"Items"}),e.jsx(ct,{sx:{overflow:"unset",border:s=>`1px solid ${s.palette.divider}`,borderRadius:1.5,bgcolor:"background.paper",boxShadow:s=>s.customShadows.z8},children:e.jsxs(dt,{sx:{minWidth:960},children:[e.jsx(pt,{sx:{bgcolor:s=>m(s.palette.grey[500],.08)},children:e.jsxs(qe,{children:[e.jsx(g,{width:180,sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Service"}),e.jsx(g,{width:80,sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"HSN"}),e.jsx(g,{sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Description"}),e.jsx(g,{width:80,align:"right",sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Qty"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Price"}),e.jsx(g,{width:140,align:"right",sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Discount"}),e.jsx(g,{width:150,sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Type"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Amt"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:s=>`1px solid ${s.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Total"}),e.jsx(g,{width:40})]})}),e.jsx(ut,{children:w.map((s,l)=>e.jsxs(qe,{sx:{verticalAlign:"top",transition:n=>n.transitions.create("background-color"),"&:hover":{bgcolor:n=>m(n.palette.primary.main,.02)},"&:nth-of-type(even)":{bgcolor:n=>m(n.palette.grey[500],.02)}},children:[[{field:"service",component:e.jsx(le,{fullWidth:!0,size:"small",options:de,getOptionLabel:n=>typeof n=="string"?n:n.inputValue?n.inputValue:n.item_name||n.name||"",filterOptions:(n,r)=>{const c=Qe(n,r),{inputValue:b}=r;return c.push({inputValue:b||"",item_name:b?`+ Create "${b}"`:"+ Create Item",isNew:!0}),c},value:de.find(n=>n.name===s.service)||null,onChange:(n,r)=>{typeof r=="string"?S(l,"service",r):r&&r.isNew?(Ne(l),O(c=>({...c,item_name:r.inputValue})),R(!0)):S(l,"service",(r==null?void 0:r.name)||"")},ListboxProps:{sx:{width:"350px","& .MuiAutocomplete-option":{py:1.5,px:2,borderRadius:.75,mx:.5,my:.25}}},slotProps:{paper:{sx:{mt:.5,boxShadow:n=>n.customShadows.z20,borderRadius:1.5}}},renderInput:n=>e.jsx(x,{...n,placeholder:"Select Service",variant:"standard",InputProps:{...n.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(n,r)=>e.jsx(W,{component:"li",...n,sx:{typography:"body2",...r.isNew&&{color:"primary.main",fontWeight:600,bgcolor:c=>m(c.palette.primary.main,.08),borderTop:c=>`1px solid ${c.palette.divider}`,mt:.5,"&:hover":{bgcolor:c=>m(c.palette.primary.main,.16)}}},children:r.isNew?e.jsxs(u,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(u,{spacing:0,children:[e.jsx(h,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(h,{variant:"caption",sx:{opacity:.8},children:"Item"})]})]}):r.item_name||r.name})})},{field:"hsn_code",component:e.jsx(x,{fullWidth:!0,size:"small",variant:"standard",value:s.hsn_code,onChange:n=>S(l,"hsn_code",n.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"description",component:e.jsx(x,{fullWidth:!0,multiline:!0,size:"small",variant:"standard",value:s.description,onChange:n=>S(l,"description",n.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"quantity",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:s.quantity===0?"":s.quantity,onChange:n=>S(l,"quantity",Number(n.target.value)),onFocus:n=>n.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"price",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:s.price===0?"":s.price,onChange:n=>S(l,"price",Number(n.target.value)),onFocus:n=>n.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"discount",component:e.jsxs(u,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsxs(Be,{size:"small",value:s.discount_type,exclusive:!0,onChange:(n,r)=>{r!==null&&S(l,"discount_type",r)},sx:{height:28,"& .MuiToggleButton-root":{px:1,py:0,border:"none",typography:"body2","&.Mui-selected":{bgcolor:n=>m(n.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:n=>m(n.palette.primary.main,.2)}}}},children:[e.jsx(L,{value:"Flat",children:"₹"}),e.jsx(L,{value:"Percentage",children:"%"})]}),e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:s.discount===0?"":s.discount,onChange:n=>S(l,"discount",Number(n.target.value)),onFocus:n=>n.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})]})},{field:"tax_type",component:e.jsx(le,{fullWidth:!0,size:"small",options:H,getOptionLabel:n=>typeof n=="string"?n:n.inputValue?n.inputValue:n.tax_name||n.name||"",filterOptions:(n,r)=>{const c=Qe(n,r),{inputValue:b}=r;return c.push({inputValue:b||"",tax_name:b?`+ Create "${b}"`:"Create Tax Type",isNew:!0}),c},value:H.find(n=>n.name===s.tax_type)||null,onChange:(n,r)=>{typeof r=="string"?S(l,"tax_type",r):r&&r.isNew?(Ne(l),U(r.inputValue),M(!0)):S(l,"tax_type",(r==null?void 0:r.name)||"")},renderInput:n=>e.jsx(x,{...n,placeholder:"Select Tax",variant:"standard",InputProps:{...n.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(n,r)=>e.jsx(W,{component:"li",...n,sx:{typography:"body2",...r.isNew&&{color:"primary.main",fontWeight:600,bgcolor:c=>m(c.palette.primary.main,.08),borderTop:c=>`1px solid ${c.palette.divider}`,mt:.5,"&:hover":{bgcolor:c=>m(c.palette.primary.main,.16)}}},children:r.isNew?e.jsxs(u,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(u,{spacing:0,children:[e.jsx(h,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(h,{variant:"caption",sx:{opacity:.8},children:"Tax Type"})]})]}):r.tax_name||r.name})})}].map((n,r)=>e.jsx(g,{sx:{px:1,py:1,borderRight:c=>`1px solid ${c.palette.divider}`,transition:c=>c.transitions.create(["background-color","box-shadow"]),"&:focus-within":{bgcolor:c=>m(c.palette.primary.main,.05)}},children:n.component},r)),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:n=>`1px solid ${n.palette.divider}`},children:e.jsx(h,{variant:"body2",sx:{fontWeight:"fontWeightMedium"},children:F(s.tax_amount)})}),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:n=>`1px solid ${n.palette.divider}`},children:e.jsx(h,{variant:"subtitle2",color:"primary.main",children:F(s.sub_total)})}),e.jsx(g,{sx:{px:1,py:1},children:e.jsx(Ze,{color:"error",onClick:()=>Re(l),size:"small",sx:{opacity:.6,"&:hover":{opacity:1}},children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})})]},l))})]})}),e.jsx(f,{startIcon:e.jsx(y,{icon:"mingcute:add-line"}),onClick:re,sx:{mt:2},children:"Add Item"}),e.jsx(G,{sx:{my:4}}),e.jsx(W,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(u,{spacing:2,sx:{width:400,mt:3},children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:box-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Total Quantity"})]}),e.jsx(h,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:$e})]}),e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:bill-list-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Taxable Amount"})]}),e.jsx(h,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:F(fe)})]}),e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:calculator-minimalistic-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Total Tax"})]}),e.jsx(h,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:F(Fe)})]}),e.jsxs(u,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,sx:{flexGrow:1},children:[e.jsx(y,{icon:"solar:tag-horizontal-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Overall Discount"})]}),e.jsxs(Be,{size:"small",value:z,exclusive:!0,onChange:(s,l)=>{l!==null&&ge(l)},sx:{height:32,"& .MuiToggleButton-root":{px:1,py:0,typography:"body2","&.Mui-selected":{bgcolor:s=>m(s.palette.primary.main,.1),color:"primary.main"}}},children:[e.jsx(L,{value:"Flat",children:"₹"}),e.jsx(L,{value:"Percentage",children:"%"})]}),e.jsx(x,{size:"small",type:"number",variant:"standard",value:E===0?"":E,onChange:s=>K(Number(s.target.value)),onFocus:s=>s.target.select(),sx:{width:100,"& .MuiInputBase-root":{bgcolor:s=>m(s.palette.grey[500],.08),borderRadius:.75,px:1,"&:hover":{bgcolor:s=>m(s.palette.grey[500],.12)},"&.Mui-focused":{bgcolor:s=>m(s.palette.primary.main,.08)}}},inputProps:{sx:{textAlign:"right",typography:"body2"}}})]}),e.jsx(G,{}),e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:wad-of-money-bold-duotone",sx:{color:"primary.main",width:24,height:24}}),e.jsx(h,{variant:"subtitle1",sx:{color:"primary.main"},children:"Grand Total"})]}),e.jsx(h,{variant:"h6",color:"primary",sx:{width:120,textAlign:"right"},children:F(C)})]})]})}),e.jsx(G,{sx:{my:4,borderStyle:"dashed"}}),e.jsxs(W,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[e.jsxs(u,{spacing:3,children:[e.jsx(x,{fullWidth:!0,label:"Description",multiline:!0,rows:4,value:Z,onChange:s=>Ce(s.target.value)}),e.jsx(x,{fullWidth:!0,label:"Terms & Conditions / Remarks",multiline:!0,rows:4,value:he,onChange:s=>Ie(s.target.value)})]}),e.jsxs(W,{sx:{p:3,borderRadius:2,bgcolor:s=>m(s.palette.grey[500],.04),border:s=>`1px dashed ${m(s.palette.grey[500],.2)}`},children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2.5},children:[e.jsx(h,{variant:"h6",children:"Attachments"}),e.jsxs(f,{variant:"contained",component:"label",color:"primary",size:"small",startIcon:e.jsx(y,{icon:"solar:upload-bold"}),disabled:k,children:[k?"Uploading...":"Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:Me})]})]}),e.jsx(u,{spacing:1,children:N.length===0?e.jsxs(u,{alignItems:"center",justifyContent:"center",sx:{py:3,color:"text.disabled"},children:[e.jsx(y,{icon:"solar:file-bold",width:40,height:40,sx:{mb:1,opacity:.48}}),e.jsx(h,{variant:"body2",children:"No attachments yet"})]}):N.map((s,l)=>e.jsxs(u,{direction:"row",alignItems:"center",sx:{px:1.5,py:.75,borderRadius:1.5,bgcolor:n=>m(n.palette.grey[500],.08)},children:[e.jsx(y,{icon:"solar:link-bold",width:20,sx:{mr:1,color:"text.secondary",flexShrink:0}}),e.jsx(h,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:typeof s=="string"?s:s.url||s.name}),e.jsx(f,{size:"small",color:"inherit",onClick:()=>je(l),sx:{px:1.5,py:0,height:26,borderRadius:1.5,minWidth:"auto",typography:"caption",bgcolor:"background.paper",border:n=>`1px solid ${m(n.palette.grey[500],.24)}`,"&:hover":{bgcolor:n=>m(n.palette.grey[500],.08)}},children:"Clear"})]},l))})]})]})]})}),e.jsx(it,{open:We,onClose:()=>Ae(!1),contactId:A,onSuccess:()=>{A&&ye(A)}}),e.jsx(nt,{open:Pe,initialName:X,onClose:()=>M(!1),onSuccess:s=>{Y(l=>[...l,s]),j!==null&&S(j,"tax_type",s.name)}}),e.jsx(mt,{open:ae.open,autoHideDuration:6e3,onClose:()=>P(s=>({...s,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(Ke,{severity:ae.severity,sx:{width:"100%",boxShadow:s=>s.customShadows.z20},children:[e.jsx(ht,{children:ae.severity==="success"?"Success":"Error"}),ae.message]})}),e.jsxs(xt,{open:Te,onClose:()=>!q&&R(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(yt,{children:"Create Item"}),e.jsx(gt,{children:e.jsxs(u,{spacing:3,sx:{pt:1},children:[e.jsx(x,{fullWidth:!0,label:"Item Name",value:B.item_name,onChange:s=>O(l=>({...l,item_name:s.target.value})),required:!0}),e.jsx(x,{fullWidth:!0,label:"HSN Code",value:B.item_code,onChange:s=>O(l=>({...l,item_code:s.target.value}))}),e.jsx(x,{fullWidth:!0,label:"Rate",type:"number",value:B.rate,onChange:s=>O(l=>({...l,rate:Number(s.target.value)}))})]})}),e.jsxs(ft,{children:[e.jsx(f,{color:"inherit",onClick:()=>R(!1),disabled:q,children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:Oe,disabled:q,children:q?e.jsx(Ge,{size:24}):"Create"})]})]})]})}export{Xt as E,Kt as a};
