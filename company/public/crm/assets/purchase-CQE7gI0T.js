import{f as a,H as h}from"./index-Co7v2xsC.js";import{h as u}from"./api-error-handler-CV6pRVHb.js";async function _(e){const t=[],s=[];e.filterValues&&Object.entries(e.filterValues).forEach(([c,o])=>{o&&o!=="all"&&(c==="vendor_name"?t.push(["Purchase",c,"=",o]):t.push(["Purchase",c,"=",o]))}),e.search&&(s.push(["Purchase","vendor_name","like",`%${e.search}%`]),s.push(["Purchase","bill_no","like",`%${e.search}%`]));let r="creation desc";if(e.sort_by){const[c,o]=e.sort_by.split("_").reduce((d,f)=>(f==="asc"||f==="desc"?d[1]=f:d[0]=d[0]?`${d[0]}_${f}`:f,d),["","desc"]);r=`${c} ${o}`}const n=new URLSearchParams({doctype:"Purchase",fields:JSON.stringify(["name","vendor_name","bill_no","bill_date","payment_type","payment_terms","due_date","grand_total","paid_amount","balance_amount","description","owner","creation"]),filters:JSON.stringify(t),or_filters:JSON.stringify(s),limit_start:String((e.page-1)*e.page_size),limit_page_length:String(e.page_size),order_by:r}),[i,p]=await Promise.all([a(`/api/method/frappe.client.get_list?${n.toString()}`),a(`/api/method/frappe.client.get_count?doctype=Purchase&filters=${encodeURIComponent(JSON.stringify(t))}&or_filters=${encodeURIComponent(JSON.stringify(s))}`)]);if(!i.ok)throw new Error("Failed to fetch purchases");const l=await i.json(),m=await p.json();return{data:l.message||[],total:m.message||0}}async function w(e){const t=await h(),s=await a("/api/method/frappe.client.insert",{method:"POST",headers:t,body:JSON.stringify({doc:{doctype:"Purchase",...e}})}),r=await s.json();if(!s.ok)throw new Error(u(r,"Failed to create purchase"));return r.message}async function P(e,t){const s=await h(),r=await a("/api/method/frappe.client.set_value",{method:"POST",headers:s,body:JSON.stringify({doctype:"Purchase",name:e,fieldname:t})}),n=await r.json();if(!r.ok)throw new Error(u(n,"Failed to update purchase"));return n.message}async function S(e){const t=await h(),s=await a("/api/method/frappe.client.delete",{method:"POST",headers:t,body:JSON.stringify({doctype:"Purchase",name:e})}),r=await s.json();if(!s.ok)throw new Error(u(r,"Failed to delete purchase"));return r.message}async function O(e){const t=await a(`/api/method/frappe.client.get?doctype=Purchase&name=${e}`);if(!t.ok)throw new Error("Failed to fetch purchase details");return(await t.json()).message}async function b(e,t,s){const r={doctype:e};t&&(r.fields=JSON.stringify(t)),s&&(r.filters=JSON.stringify(s));const n=new URLSearchParams(r),i=await a(`/api/method/company.company.frontend_api.get_doctype_list?${n.toString()}`);return i.ok?(await i.json()).message||[]:[]}function $(e){return`/api/method/frappe.utils.print_format.download_pdf?doctype=Purchase&name=${encodeURIComponent(e)}`}export{b as a,$ as b,w as c,S as d,_ as f,O as g,P as u};
