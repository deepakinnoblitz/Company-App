import{f as i,H as a}from"./index-Co7v2xsC.js";import{h as c}from"./api-error-handler-CV6pRVHb.js";async function w(e){const o=[],t=[];e.filters&&(e.filters.client_name&&e.filters.client_name!=="all"&&o.push(["Invoice","client_name","=",e.filters.client_name]),e.filters.ref_no&&o.push(["Invoice","ref_no","=",e.filters.ref_no]),e.filters.invoice_date&&o.push(["Invoice","invoice_date","=",e.filters.invoice_date])),e.search&&(t.push(["Invoice","ref_no","like",`%${e.search}%`]),t.push(["Invoice","customer_name","like",`%${e.search}%`]),t.push(["Invoice","phone_number","like",`%${e.search}%`]));let n="creation desc";if(e.sort_by){const[u,y]=e.sort_by.split("_").reduce((r,s)=>(s==="asc"||s==="desc"?r[1]=s:r[0]=r[0]?`${r[0]}_${s}`:s,r),["","desc"]);n=`${u} ${y}`}const d=new URLSearchParams({doctype:"Invoice",fields:JSON.stringify(["name","ref_no","client_name","customer_name","invoice_date","grand_total","received_amount","balance_amount","creation"]),filters:JSON.stringify(o),or_filters:JSON.stringify(t),limit_start:String((e.page-1)*e.page_size),limit_page_length:String(e.page_size),order_by:n}),[f,l]=await Promise.all([i(`/api/method/frappe.client.get_list?${d.toString()}`),i(`/api/method/frappe.client.get_count?doctype=Invoice&filters=${encodeURIComponent(JSON.stringify(o))}&or_filters=${encodeURIComponent(JSON.stringify(t))}`)]);if(!f.ok)throw new Error("Failed to fetch invoices");const p=await f.json(),h=await l.json();return{data:p.message||[],total:h.message||0}}async function g(e){const o=await a(),t=await i("/api/method/frappe.client.insert",{method:"POST",headers:o,body:JSON.stringify({doc:{doctype:"Invoice",...e}})}),n=await t.json();if(!t.ok)throw new Error(c(n,"Failed to create invoice"));return n.message}async function v(e,o){const t=await a(),n=await i("/api/method/frappe.client.set_value",{method:"POST",headers:t,body:JSON.stringify({doctype:"Invoice",name:e,fieldname:o})}),d=await n.json();if(!n.ok)throw new Error(c(d,"Failed to update invoice"));return d.message}async function I(e){const o=await a(),t=await i("/api/method/frappe.client.delete",{method:"POST",headers:o,body:JSON.stringify({doctype:"Invoice",name:e})}),n=await t.json();if(!t.ok)throw new Error(c(n,"Failed to delete invoice"));return n.message}async function S(e){const o=await i(`/api/method/frappe.client.get?doctype=Invoice&name=${encodeURIComponent(e)}`);if(!o.ok)throw new Error("Failed to fetch invoice details");return(await o.json()).message}function O(e){return`/api/method/frappe.utils.print_format.download_pdf?doctype=Invoice&name=${encodeURIComponent(e)}`}async function j(e){const o=await a(),t=await i("/api/method/frappe.client.insert",{method:"POST",headers:o,body:JSON.stringify({doc:{doctype:"Item",...e}})}),n=await t.json();if(!t.ok)throw new Error(c(n,"Failed to create item"));return n.message}async function $(e){const o=await a(),t=await i("/api/method/frappe.client.insert",{method:"POST",headers:o,body:JSON.stringify({doc:{doctype:"Tax Types",...e}})}),n=await t.json();if(!t.ok)throw new Error(c(n,"Failed to create tax type"));return n.message}export{g as a,O as b,j as c,I as d,$ as e,w as f,S as g,v as u};
