import{r as s,j as e,a1 as oe,T as S,B as T,d as W,v as w,I as j,p as R,q as z,y as re,S as G,W as se,w as ae}from"./index-Co7v2xsC.js";import{C as le}from"./config-global-BX9xwJzv.js";import{f as ie,a as M,d as ce}from"./expenses-deJDgINb.js";import{D as de,C as pe}from"./Card-CDV3jV6O.js";import{E as xe}from"./empty-content-BBDmaj4d.js";import{C as he}from"./confirm-dialog--19ddTk_.js";import{c as E,d as y,b as ue,T as ge,a as me,e as ye}from"./TableRow-DqeBPnxy.js";import{C as U}from"./Checkbox-CoJXcvzD.js";import{a as be,T as je}from"./TablePagination-CEaYVDlQ.js";import{O as fe,I as ve,M as Ce}from"./Select-B1EkSlUY.js";import{B as Z}from"./Badge-DIppMJwA.js";import{d as L}from"./dayjs.min-C2542nnJ.js";import{S as P}from"./Stack-GQIY7Xk9.js";import{T as A}from"./TextField-BmVWmDzd.js";import{A as Y}from"./Autocomplete-BIV6h0T7.js";import{D as H}from"./DatePicker-BMZY9CMK.js";import{L as Se,A as _e}from"./AdapterDayjs-BPhbSeWE.js";import{S as Pe}from"./Snackbar-BVA3LOhi.js";import{A as we}from"./AlertTitle-BbqQne_Q.js";import"./styles-wAmuuHpw.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./useFormControl-Cqn8lfES.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./usePreviousProps-CVIlMhUg.js";import"./Popper-DDlcgFVJ.js";import"./Chip-Rg4Dn3a5.js";import"./useThemeProps-BDg4jra0.js";import"./index-Chjiymov.js";import"./visuallyHidden-Dan1xhjv.js";function ke(t,c,p,a,u){const[d,g]=s.useState([]),[i,x]=s.useState(0),[m,l]=s.useState(!0),[f,v]=s.useState(0),C=()=>v(n=>n+1);return s.useEffect(()=>{l(!0),ie({page:t+1,page_size:c,search:p,filters:a,sort_by:u}).then(n=>{g(n.data),x(n.total)}).catch(n=>{console.error("Failed to fetch expenses",n),g([]),x(0)}).finally(()=>l(!1))},[t,c,p,a,u,f]),{data:d,total:i,loading:m,refetch:C}}function Te(t,c,p){return t?Math.max(0,(1+t)*c-p):0}function Re({searchQuery:t}){return e.jsx(E,{children:e.jsx(y,{align:"center",colSpan:7,children:e.jsxs(oe,{sx:{textAlign:"center"},children:[e.jsx(S,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(S,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function Ee({emptyRows:t,height:c}){return t?e.jsx(E,{sx:{...c&&{height:c*t}},children:e.jsx(y,{colSpan:9})}):null}function De({row:t,selected:c,onSelectRow:p,onView:a,onEdit:u,onDelete:d,canEdit:g,canDelete:i,hideCheckbox:x=!1,index:m}){return e.jsxs(E,{hover:!0,tabIndex:-1,role:"checkbox",selected:c,children:[!x&&e.jsx(y,{padding:"checkbox",children:e.jsx(U,{disableRipple:!0,checked:c,onChange:p})}),typeof m=="number"&&e.jsx(y,{align:"center",children:e.jsx(T,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:l=>W(l.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:l=>`1px solid ${W(l.palette.primary.main,.16)}`,mx:"auto",transition:l=>l.transitions.create(["all"],{duration:l.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:m+1})}),e.jsx(y,{children:t.expense_no||"-"}),e.jsx(y,{children:t.expense_category||"-"}),e.jsx(y,{children:t.date?new Date(t.date).toLocaleDateString():"-"}),e.jsx(y,{children:t.payment_type||"-"}),e.jsx(y,{children:t.total?`₹${t.total.toLocaleString()}`:"-"}),e.jsx(y,{align:"right",children:e.jsxs(T,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(w,{size:"small",color:"primary",onClick:a,children:e.jsx(j,{icon:"solar:eye-bold"})}),g&&e.jsx(w,{size:"small",color:"info",onClick:u,children:e.jsx(j,{icon:"solar:pen-bold"})}),i&&e.jsx(w,{size:"small",color:"error",onClick:d,children:e.jsx(j,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function Ie({order:t,onSort:c,orderBy:p,rowCount:a,headLabel:u,numSelected:d,onSelectAllRows:g}){return e.jsx(ue,{children:e.jsxs(E,{children:[e.jsx(y,{padding:"checkbox",children:e.jsx(U,{indeterminate:d>0&&d<a,checked:a>0&&d===a,onChange:i=>g(i.target.checked)})}),u.map(i=>e.jsx(y,{align:i.align||"left",sx:{width:i.width,minWidth:i.minWidth},children:i.label},i.id))]})})}const $=[{value:"modified_desc",label:"Newest First"},{value:"modified_asc",label:"Oldest First"},{value:"date_desc",label:"Date: Newest First"},{value:"date_asc",label:"Date: Oldest First"},{value:"total_desc",label:"Amount: High to Low"},{value:"total_asc",label:"Amount: Low to High"},{value:"expense_category_asc",label:"Category: A to Z"},{value:"expense_category_desc",label:"Category: Z to A"}];function Fe({numSelected:t,filterName:c,onFilterName:p,searchPlaceholder:a="Search expenses...",onDelete:u,sortBy:d="modified_desc",onSortChange:g,onOpenFilter:i,canReset:x}){var h;const[m,l]=s.useState(null),f=r=>{l(r.currentTarget)},v=()=>{l(null)},C=r=>{g&&g(r),v()},n=((h=$.find(r=>r.value===d))==null?void 0:h.label)||"Sort";return e.jsxs(be,{sx:{height:96,display:"flex",justifyContent:"space-between",p:r=>r.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(S,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(fe,{value:c,onChange:p,placeholder:a,startAdornment:e.jsx(ve,{position:"start",children:e.jsx(j,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:480,width:1}}),e.jsx(T,{sx:{display:"flex",gap:1,alignItems:"center"},children:t>0?e.jsx(w,{onClick:u,children:e.jsx(j,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[i&&e.jsx(R,{disableRipple:!0,color:"inherit",startIcon:e.jsx(Z,{color:"error",variant:"dot",invisible:!x,children:e.jsx(j,{icon:"ic:round-filter-list"})}),onClick:i,sx:{height:40,px:2,bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500},children:"Filters"}),g&&e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"text",color:"inherit",startIcon:e.jsx(j,{icon:"solar:sort-bold"}),onClick:f,sx:{minWidth:160,height:40,px:2,color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500,"&:hover":{bgcolor:"action.hover"}},children:n}),e.jsx(Ce,{anchorEl:m,open:!!m,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1,minWidth:200,boxShadow:r=>r.customShadows.z20}}},children:$.map(r=>e.jsx(z,{selected:r.value===d,onClick:()=>C(r.value),sx:{typography:"body2",...r.value===d&&{bgcolor:b=>W(b.palette.primary.main,.08),fontWeight:"fontWeightSemiBold"}},children:r.label},r.value))})]})]})})]})}function Oe({open:t,onOpen:c,onClose:p,filters:a,onFilters:u,canReset:d,onResetFilters:g,options:i}){const x=(n,h)=>{u({[n]:h})},m=e.jsxs(T,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(S,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(w,{onClick:g,disabled:!d,sx:{mr:.5,color:d?"primary.main":"text.disabled","&:hover":{bgcolor:d?"primary.lighter":"transparent"}},children:e.jsx(Z,{color:"error",variant:"dot",invisible:!d,children:e.jsx(j,{icon:"solar:restart-bold",width:20})})}),e.jsx(w,{onClick:p,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(j,{icon:"mingcute:close-line",width:20})})]}),l=e.jsxs(P,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Expense ID"}),e.jsx(A,{fullWidth:!0,size:"small",value:a.expense_id||"",onChange:n=>x("expense_id",n.target.value),placeholder:"Enter expense ID...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}})]}),f=e.jsxs(P,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Expense Category"}),e.jsx(Y,{fullWidth:!0,freeSolo:!0,size:"small",value:a.expense_category==="all"?"":a.expense_category,onChange:(n,h)=>{x("expense_category",h||"all")},onInputChange:(n,h)=>{x("expense_category",h||"all")},options:i.categories,renderInput:n=>e.jsx(A,{...n,placeholder:"Type or select category...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(n,h)=>s.createElement(z,{...n,key:h,sx:{typography:"body2",fontSize:"13px"}},h)})]}),v=e.jsxs(P,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Payment Type"}),e.jsx(Y,{fullWidth:!0,size:"small",value:a.payment_type==="all"?null:a.payment_type,onChange:(n,h)=>{x("payment_type",h||"all")},options:i.paymentTypes,renderInput:n=>e.jsx(A,{...n,placeholder:"Select payment type...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(n,h)=>s.createElement(z,{...n,key:h,sx:{typography:"body2",fontSize:"13px"}},h)})]}),C=e.jsxs(P,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Expense Date Range"}),e.jsxs(P,{direction:"row",spacing:2,children:[e.jsx(H,{label:"Start Date",value:a.start_date?L(a.start_date):null,onChange:n=>{x("start_date",n?n.format("YYYY-MM-DD"):null)},slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}}}),e.jsx(H,{label:"End Date",value:a.end_date?L(a.end_date):null,onChange:n=>{x("end_date",n?n.format("YYYY-MM-DD"):null)},slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}}})]})]});return e.jsx(re,{anchor:"right",open:t,onClose:p,PaperProps:{sx:{width:360}},sx:{zIndex:n=>n.zIndex.drawer+2},children:e.jsxs(Se,{dateAdapter:_e,children:[m,e.jsx(G,{children:e.jsxs(P,{spacing:3,sx:{p:3},children:[l,f,v,C]})}),e.jsx(T,{sx:{p:3},children:e.jsx(R,{fullWidth:!0,color:"inherit",size:"large",variant:"outlined",startIcon:e.jsx(j,{icon:"solar:trash-bin-trash-bold"}),onClick:g,disabled:!d,children:"Clear All Filters"})})]})})}const Ae=[{id:"expense_no",label:"Expense No"},{id:"expense_category",label:"Category"},{id:"date",label:"Date"},{id:"payment_type",label:"Payment Type"},{id:"total",label:"Total",align:"right"},{id:""}];function We(){const t=ze(),c=se(),[p,a]=s.useState({open:!1,id:null}),[u,d]=s.useState(""),[g,i]=s.useState("modified_desc"),[x,m]=s.useState(!1),[l,f]=s.useState({expense_id:"",expense_category:"all",payment_type:"all",start_date:null,end_date:null}),[v,C]=s.useState([]),[n,h]=s.useState([]);s.useEffect(()=>{M("Expense Category",["name"]).then(o=>{C(o.map(_=>_.name))}),M("Payment Type",["name"]).then(o=>{h(o.map(_=>_.name))})},[]);const r=o=>{f(_=>({..._,...o})),t.onResetPage()},b=()=>{f({expense_id:"",expense_category:"all",payment_type:"all",start_date:null,end_date:null}),t.onResetPage()},k=!!l.expense_id||l.expense_category!=="all"||l.payment_type!=="all"||!!l.start_date||!!l.end_date,[D,F]=s.useState({open:!1,message:"",severity:"success"}),{data:I,total:O,loading:N,refetch:q}=ke(t.page,t.rowsPerPage,u,l,g),Q=s.useCallback(o=>{d(o.target.value),t.onResetPage()},[t]),V=()=>{c.push("/expenses/new")},J=o=>{c.push(`/expenses/${encodeURIComponent(o)}/edit`)},K=o=>{c.push(`/expenses/${encodeURIComponent(o)}/view`)},X=s.useCallback(o=>{a({open:!0,id:o})},[]),ee=async()=>{if(p.id)try{await ce(p.id),F({open:!0,message:"Expense deleted successfully",severity:"success"}),await q()}catch(o){console.error(o),F({open:!0,message:"Failed to delete expense",severity:"error"})}finally{a({open:!1,id:null})}},B=()=>{F(o=>({...o,open:!1}))},te=!N&&I.length===0&&!!u,ne=!N&&I.length===0&&!u&&!k;return e.jsxs(de,{children:[e.jsxs(P,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(S,{variant:"h4",children:"Expenses"}),e.jsx(R,{variant:"contained",color:"info",startIcon:e.jsx(j,{icon:"mingcute:add-line"}),onClick:V,children:"New Expense"})]}),e.jsxs(pe,{children:[e.jsx(Fe,{numSelected:t.selected.length,filterName:u,onFilterName:Q,sortBy:g,onSortChange:i,onOpenFilter:()=>m(!0),canReset:k}),e.jsx(G,{children:e.jsx(ge,{sx:{overflow:"unset"},children:e.jsxs(me,{sx:{minWidth:800},children:[e.jsx(Ie,{order:t.order,orderBy:t.orderBy,rowCount:O,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:o=>t.onSelectAllRows(o,I.map(_=>_.name)),headLabel:Ae}),e.jsxs(ye,{children:[I.map(o=>e.jsx(De,{row:{id:o.name,expense_no:o.expense_no||"",expense_category:o.expense_category||"",date:o.date,payment_type:o.payment_type||"",total:o.total||0},selected:t.selected.includes(o.name),onSelectRow:()=>t.onSelectRow(o.name),onEdit:()=>J(o.name),onView:()=>K(o.name),onDelete:()=>X(o.name),canEdit:!0,canDelete:!0},o.name)),e.jsx(Ee,{height:77,emptyRows:Te(t.page,t.rowsPerPage,O)}),te&&e.jsx(Re,{searchQuery:u}),ne&&e.jsx(E,{children:e.jsx(y,{colSpan:6,children:e.jsx(xe,{title:"No expenses found",description:"Record and track your business expenses efficiently.",icon:"solar:bill-list-bold-duotone"})})})]})]})})}),e.jsx(je,{page:t.page,component:"div",count:O,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:t.onChangeRowsPerPage})]}),e.jsx(Pe,{open:D.open,autoHideDuration:6e3,onClose:B,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(ae,{onClose:B,severity:D.severity,sx:{width:"100%",boxShadow:o=>o.customShadows.z20},children:[e.jsx(we,{children:D.severity==="success"?"Success":"Error"}),D.message]})}),e.jsx(he,{open:p.open,onClose:()=>a({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this expense?",action:e.jsx(R,{variant:"contained",color:"error",onClick:ee,sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),e.jsx(Oe,{open:x,onOpen:()=>m(!0),onClose:()=>m(!1),filters:l,onFilters:r,canReset:k,onResetFilters:b,options:{categories:v,paymentTypes:n}})]})}function ze(){const[t,c]=s.useState(0),[p,a]=s.useState("expense_category"),[u,d]=s.useState(5),[g,i]=s.useState([]),[x,m]=s.useState("asc"),l=s.useCallback(r=>{m(p===r&&x==="asc"?"desc":"asc"),a(r)},[x,p]),f=s.useCallback((r,b)=>{i(r?b:[])},[]),v=s.useCallback(r=>{i(b=>b.includes(r)?b.filter(k=>k!==r):[...b,r])},[]),C=()=>c(0);return{page:t,order:x,orderBy:p,rowsPerPage:u,selected:g,onSort:l,onSelectRow:v,onSelectAllRows:f,onResetPage:C,onChangePage:(r,b)=>c(b),onChangeRowsPerPage:r=>{d(parseInt(r.target.value,10)),C()}}}function yt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Expenses - ${le.appName}`}),e.jsx(We,{})]})}export{yt as default};
