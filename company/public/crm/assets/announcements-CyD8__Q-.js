import{f as S,H as L,r as o,j as e,B as l,d as M,v as C,I as h,T as m,D as we,p as W,S as Se,w as Ce}from"./index-Co7v2xsC.js";import{C as Ae}from"./config-global-BX9xwJzv.js";import{h as $}from"./api-error-handler-CV6pRVHb.js";import{D as ve,C as De}from"./Card-CDV3jV6O.js";import{E as ke}from"./empty-content-BBDmaj4d.js";import{C as Te}from"./confirm-dialog--19ddTk_.js";import{U as Pe,a as Re,b as _e,T as Ie}from"./user-table-toolbar-BXgkag6p.js";import{c as X,d as b,T as Oe,a as Ee,e as Ne}from"./TableRow-DqeBPnxy.js";import{C as Fe}from"./Checkbox-CoJXcvzD.js";import{D as Y,a as Z}from"./DialogContent-DtP-sWqR.js";import{D as ee}from"./DialogTitle-C3eBZids.js";import{T as We}from"./TablePagination-CEaYVDlQ.js";import{T as G}from"./TextField-BmVWmDzd.js";import{D as Be}from"./DialogActions-h_2rRG3x.js";import{S as Le}from"./Snackbar-BVA3LOhi.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";async function $e(t){const a=[];t.search&&a.push([["Announcement","announcement_name","like",`%${t.search}%`]]);const s=t.orderBy&&t.order?`${t.orderBy} ${t.order}`:"creation desc",r=new URLSearchParams({doctype:"Announcement",fields:JSON.stringify(["*"]),filters:JSON.stringify(a),limit_start:String((t.page-1)*t.page_size),limit_page_length:String(t.page_size),order_by:s}),[i,g]=await Promise.all([S(`/api/method/frappe.client.get_list?${r.toString()}`),S(`/api/method/frappe.client.get_count?doctype=Announcement&filters=${encodeURIComponent(JSON.stringify(a))}`)]);if(!i.ok)throw new Error("Failed to fetch announcements");const x=await i.json(),j=await g.json();return{data:x.message||[],total:j.message||0}}const ze=t=>$e(t);async function He(t){const a=await L(),s=await S("/api/method/frappe.client.insert",{method:"POST",headers:a,body:JSON.stringify({doc:{doctype:"Announcement",...t}})});if(!s.ok){const r=await s.json();throw new Error($(r,"Failed to create announcement"))}return(await s.json()).message}async function Je(t,a){const s=await L(),r=await S("/api/method/frappe.client.set_value",{method:"POST",headers:s,body:JSON.stringify({doctype:"Announcement",name:t,fieldname:a})});if(!r.ok){const i=await r.json();throw new Error($(i,"Failed to update announcement"))}return(await r.json()).message}async function Q(t){const a=await L(),s=await S("/api/method/frappe.client.delete",{method:"POST",headers:a,body:JSON.stringify({doctype:"Announcement",name:t})});if(!s.ok){const r=await s.json();throw new Error($(r,"Failed to delete announcement"))}return!0}async function Ue(){const t=await S("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Announcement");return t.ok?(await t.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}function Ve(t,a,s,r,i){const[g,x]=o.useState([]),[j,y]=o.useState(0),[w,c]=o.useState(!0),p=o.useCallback(async()=>{c(!0);try{const u=await ze({page:t,page_size:a,search:s,orderBy:r,order:i});x(u.data),y(u.total)}catch(u){console.error("Failed to fetch announcements:",u)}finally{c(!1)}},[t,a,s,r,i]);return o.useEffect(()=>{p()},[p]),{data:g,total:j,loading:w,refetch:p}}function qe({row:t,selected:a,onSelectRow:s,onView:r,onEdit:i,onDelete:g,canEdit:x,canDelete:j,hideCheckbox:y=!1,index:w}){return e.jsxs(X,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,children:[!y&&e.jsx(b,{padding:"checkbox",children:e.jsx(Fe,{disableRipple:!0,checked:a,onChange:s})}),typeof w=="number"&&e.jsx(b,{align:"center",children:e.jsx(l,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:c=>M(c.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:c=>`1px solid ${M(c.palette.primary.main,.16)}`,mx:"auto",transition:c=>c.transitions.create(["all"],{duration:c.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:w+1})}),e.jsx(b,{children:t.announcement_name||"-"}),e.jsx(b,{children:t.announcement?`${t.announcement.substring(0,100)}${t.announcement.length>100?"...":""}`:"-"}),e.jsx(b,{children:t.creation?new Date(t.creation).toLocaleDateString():"-"}),e.jsx(b,{align:"right",children:e.jsxs(l,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(C,{size:"small",color:"primary",onClick:r,children:e.jsx(h,{icon:"solar:eye-bold"})}),x&&e.jsx(C,{size:"small",color:"info",onClick:i,children:e.jsx(h,{icon:"solar:pen-bold"})}),j&&e.jsx(C,{size:"small",color:"error",onClick:g,children:e.jsx(h,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function Me({open:t,onClose:a,announcement:s}){return e.jsxs(Y,{open:t,onClose:a,fullWidth:!0,maxWidth:"md",children:[e.jsxs(ee,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(m,{variant:"h6",sx:{fontWeight:800},children:"Announcement Details"}),e.jsx(C,{onClick:a,sx:{color:r=>r.palette.grey[500],bgcolor:"background.paper",boxShadow:r=>{var i;return(i=r.customShadows)==null?void 0:i.z1}},children:e.jsx(h,{icon:"mingcute:close-line"})})]}),e.jsx(Z,{sx:{p:4,m:2,mt:4},children:s?e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(l,{sx:{width:80,height:80,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"warning.lighter",color:"warning.main"},children:e.jsx(h,{icon:"solar:bell-bold",width:40})}),e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(m,{variant:"h5",sx:{fontWeight:800},children:s.announcement_name}),e.jsxs(m,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:["Published on ",s.creation?new Date(s.creation).toLocaleDateString():"-"]})]}),e.jsx(l,{sx:{textAlign:"right"},children:e.jsxs(m,{variant:"caption",sx:{display:"block",color:"text.disabled",fontWeight:700},children:["ID: ",s.name]})})]}),e.jsx(we,{sx:{borderStyle:"dashed"}}),e.jsxs(l,{children:[e.jsx(K,{title:"Announcement",icon:"solar:chat-line-bold"}),e.jsx(l,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:e.jsx(m,{variant:"body2",sx:{fontWeight:500,lineHeight:1.8,"& p":{margin:0,marginBottom:1},"& p:last-child":{marginBottom:0},"& ul, & ol":{paddingLeft:3,marginBottom:1},"& li":{marginBottom:.5}},dangerouslySetInnerHTML:{__html:s.announcement||"-"}})})]}),e.jsxs(l,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(K,{title:"Information",icon:"solar:info-circle-bold",noMargin:!0}),e.jsxs(l,{sx:{mt:3,display:"grid",gap:3,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"}},children:[e.jsx(B,{label:"Title",value:s.announcement_name,icon:"solar:document-text-bold"}),e.jsx(B,{label:"Created On",value:s.creation?new Date(s.creation).toLocaleString():"-",icon:"solar:calendar-bold"}),e.jsx(B,{label:"Last Modified",value:s.modified?new Date(s.modified).toLocaleString():"-",icon:"solar:calendar-bold"})]})]})]}):e.jsxs(l,{sx:{py:10,textAlign:"center"},children:[e.jsx(h,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(m,{variant:"h6",sx:{color:"text.secondary"},children:"No Announcement Found"})]})})]})}function K({title:t,icon:a,noMargin:s=!1}){return e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:s?0:2.5},children:[e.jsx(h,{icon:a,width:20,sx:{color:"primary.main"}}),e.jsx(m,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:t})]})}function B({label:t,value:a,icon:s}){return e.jsxs(l,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:t}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(h,{icon:s,width:16,sx:{color:"text.disabled"}}),e.jsx(m,{variant:"body2",sx:{fontWeight:700},children:a||"-"})]})]})}function Ge(){const[t,a]=o.useState(0),[s,r]=o.useState(10),[i,g]=o.useState(""),[x,j]=o.useState("desc"),[y,w]=o.useState("creation"),[c,p]=o.useState([]),{data:u,total:ne,refetch:k}=Ve(t+1,s,i,y,x),[te,T]=o.useState(!1),[P,R]=o.useState(!1),[z,_]=o.useState(null),[I,O]=o.useState({open:!1,id:null}),[H,A]=o.useState(""),[J,v]=o.useState(""),[se,U]=o.useState(!1),[ae,oe]=o.useState(null),[E,re]=o.useState({read:!1,write:!1,delete:!1}),[D,f]=o.useState({open:!1,message:"",severity:"success"});o.useState(()=>{Ue().then(re)});const ie=n=>{j(y===n&&x==="asc"?"desc":"asc"),w(n)},le=n=>{p(n?u.map(d=>d.name):[])},ce=n=>{p(d=>d.includes(n)?d.filter(F=>F!==n):[...d,n])},de=async()=>{try{await Promise.all(c.map(n=>Q(n))),f({open:!0,message:`${c.length} announcement(s) deleted successfully`,severity:"success"}),p([]),k()}catch(n){f({open:!0,message:n.message||"Failed to delete announcements",severity:"error"})}},ue=()=>{R(!1),_(null),A(""),v(""),T(!0)},N=()=>{T(!1),R(!1),_(null),A(""),v("")},me=o.useCallback(n=>{_(n),A(n.announcement_name||""),v(n.announcement||""),R(!0),T(!0)},[]),he=o.useCallback(n=>{oe(n),U(!0)},[]),xe=o.useCallback(n=>{O({open:!0,id:n})},[]),pe=async()=>{if(I.id)try{await Q(I.id),f({open:!0,message:"Announcement deleted successfully",severity:"success"}),k()}catch(n){f({open:!0,message:n.message||"Failed to delete announcement",severity:"error"})}finally{O({open:!1,id:null})}},fe=async n=>{n.preventDefault();const d={announcement_name:H.trim(),announcement:J.trim()};try{P&&z?(await Je(z.name,d),f({open:!0,message:"Announcement updated successfully",severity:"success"})):(await He(d),f({open:!0,message:"Announcement created successfully",severity:"success"})),N(),k()}catch(F){f({open:!0,message:F.message||"Operation failed",severity:"error"})}},ge=(n,d)=>{a(d)},je=n=>{r(parseInt(n.target.value,10)),a(0)},ye=n=>{g(n.target.value),a(0)},V=()=>{f({...D,open:!1})},be=!u.length&&!!i,q=!u.length&&!i;return e.jsxs(ve,{children:[e.jsxs(l,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(m,{variant:"h4",sx:{flexGrow:1},children:"Announcements"}),E.write&&e.jsx(W,{variant:"contained",startIcon:e.jsx(h,{icon:"mingcute:add-line"}),onClick:ue,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Announcement"})]}),e.jsxs(De,{children:[e.jsx(Pe,{numSelected:c.length,filterName:i,onFilterName:ye,searchPlaceholder:"Search announcements...",onDelete:c.length>0?de:void 0}),e.jsx(Se,{children:e.jsx(Oe,{sx:{overflow:"unset"},children:e.jsxs(Ee,{sx:{minWidth:800},children:[e.jsx(Re,{order:x,orderBy:y,rowCount:u.length,numSelected:c.length,onSort:ie,onSelectAllRows:n=>le(n),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"announcement_name",label:"Title"},{id:"announcement",label:"Announcement"},{id:"creation",label:"Created On"},{id:"",label:""}]}),e.jsxs(Ne,{children:[u.map((n,d)=>e.jsx(qe,{index:t*s+d,hideCheckbox:!0,row:{id:n.name,announcement_name:n.announcement_name,announcement:n.announcement,creation:n.creation},selected:c.includes(n.name),onSelectRow:()=>ce(n.name),onView:()=>he(n),onEdit:()=>me(n),onDelete:()=>xe(n.name),canEdit:E.write,canDelete:E.delete},n.name)),be&&e.jsx(_e,{searchQuery:i}),q&&e.jsx(X,{children:e.jsx(b,{colSpan:4,children:e.jsx(ke,{title:"No announcements",description:"There are no announcements to display at this time.",icon:"solar:bell-bold-duotone"})})}),!q&&e.jsx(Ie,{height:68,emptyRows:Math.max(0,s-u.length)})]})]})})}),e.jsx(We,{component:"div",page:t,count:ne,rowsPerPage:s,onPageChange:ge,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:je})]}),e.jsx(Y,{open:te,onClose:N,fullWidth:!0,maxWidth:"sm",children:e.jsxs("form",{onSubmit:fe,children:[e.jsxs(ee,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[P?"Edit Announcement":"New Announcement",e.jsx(C,{onClick:N,children:e.jsx(h,{icon:"mingcute:close-line"})})]}),e.jsx(Z,{dividers:!0,children:e.jsxs(l,{sx:{display:"grid",gap:3,margin:"1rem"},children:[e.jsx(G,{fullWidth:!0,label:"Title",value:H,onChange:n=>A(n.target.value),required:!0,placeholder:"Enter announcement title"}),e.jsx(G,{fullWidth:!0,label:"Announcement",value:J,onChange:n=>v(n.target.value),multiline:!0,rows:6,placeholder:"Enter announcement details",required:!0})]})}),e.jsx(Be,{children:e.jsx(W,{type:"submit",variant:"contained",children:P?"Update":"Create"})})]})}),e.jsx(Me,{open:se,onClose:()=>U(!1),announcement:ae}),e.jsx(Le,{open:D.open,autoHideDuration:6e3,onClose:V,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ce,{onClose:V,severity:D.severity,sx:{width:"100%"},children:D.message})}),e.jsx(Te,{open:I.open,onClose:()=>O({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this announcement?",action:e.jsx(W,{onClick:pe,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function jn(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Announcements - ${Ae.appName}`}),e.jsx(Ge,{})]})}export{jn as default};
