import{r as l,K as y,N as le,j as e,a as at,g as ot,s as X,c as nt,b as rt,Q as ke,B as j,d as xe,T as k,v as q,I as M,D as it,p as ne,S as lt,w as ge}from"./index-Co7v2xsC.js";import{C as ct}from"./config-global-BX9xwJzv.js";import{d as w}from"./dayjs.min-C2542nnJ.js";import{h as Pe,g as dt,a as ut,i as ye,j as mt,k as pt}from"./hr-management-CfgPc5UQ.js";import{getDoctypeList as ft}from"./leads-d5FzXGcx.js";import{D as ht,C as bt}from"./Card-CDV3jV6O.js";import{E as xt}from"./empty-content-BBDmaj4d.js";import{C as gt}from"./confirm-dialog--19ddTk_.js";import{U as yt,a as Tt,b as jt,T as vt}from"./user-table-toolbar-BXgkag6p.js";import{L as Ce}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as De,d as A,T as kt,a as Pt,e as Ct}from"./TableRow-DqeBPnxy.js";import{C as Dt}from"./Checkbox-CoJXcvzD.js";import{D as Se,a as we}from"./DialogContent-DtP-sWqR.js";import{D as Me}from"./DialogTitle-C3eBZids.js";import{T as St}from"./TablePagination-CEaYVDlQ.js";import{c as wt,s as ce,u as V,d as _e,e as Mt,f as _t,P as At,g as Ot,a7 as It,k as Lt,i as Rt,l as Ft,a8 as U,m as Te,n as Wt,o as Et,Y as Ae,y as Oe,z as Ht,E as t,F as Ie,I as Vt,N as Nt,O as $t,L as zt,A as Yt}from"./AdapterDayjs-BPhbSeWE.js";import{T as re}from"./TextField-BmVWmDzd.js";import{D as Bt}from"./DialogActions-h_2rRG3x.js";import{S as je}from"./Snackbar-BVA3LOhi.js";import{D as Ut}from"./DatePicker-BMZY9CMK.js";import{u as Z}from"./useThemeProps-BDg4jra0.js";import{v as de,P as Q,a as Qt,r as qt,b as Kt,c as ve,g as ie}from"./timeViewRenderers-BsmXZnvp.js";import"./api-error-handler-CV6pRVHb.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";function Gt(o={}){const{enableAccessibleFieldDOMStructure:n=!0,ampm:i}=o;return l.useMemo(()=>({valueType:"time",validator:de,internal_valueManager:ce,internal_fieldValueManager:wt,internal_enableAccessibleFieldDOMStructure:n,internal_useApplyDefaultValuesToFieldInternalProps:Xt,internal_useOpenPickerButtonAriaLabel:Jt(i)}),[i,n])}function Jt(o){return function(i){const a=V(),r=_e();return l.useMemo(()=>{const f=o??a.is12HourCycleInCurrentLocale()?"fullTime12h":"fullTime24h",p=a.isValid(i)?a.format(i,f):null;return r.openTimePickerDialogue(p)},[i,r,a])}}function Xt(o){const n=V(),i=Le(o),a=l.useMemo(()=>o.ampm??n.is12HourCycleInCurrentLocale(),[o.ampm,n]);return l.useMemo(()=>y({},o,i,{format:o.format??(a?n.formats.fullTime12h:n.formats.fullTime24h)}),[o,i,a,n])}function Le(o){return l.useMemo(()=>({disablePast:o.disablePast??!1,disableFuture:o.disableFuture??!1}),[o.disablePast,o.disableFuture])}const Zt=o=>{const n=Gt(o);return Mt({manager:n,props:o})},es=["slots","slotProps","InputProps","inputProps"],Re=l.forwardRef(function(n,i){const a=Z({props:n,name:"MuiTimeField"}),{slots:r,slotProps:f}=a,p=le(a,es),g=_t({slotProps:f,ref:i,externalForwardedProps:p}),d=Zt(g);return e.jsx(At,{slots:r,slotProps:f,inputRef:p.inputRef,children:e.jsx(Ot,{fieldResponse:d,defaultOpenPickerIcon:It})})});function ts(o){return ot("MuiTimePickerToolbar",o)}const K=at("MuiTimePickerToolbar",["root","separator","hourMinuteLabel","hourMinuteLabelLandscape","hourMinuteLabelReverse","ampmSelection","ampmLandscape","ampmLabel"]),ss=["ampm","ampmInClock","className","classes"],as=(o,n)=>{const{pickerOrientation:i,toolbarDirection:a}=n;return rt({root:["root"],separator:["separator"],hourMinuteLabel:["hourMinuteLabel",i==="landscape"&&"hourMinuteLabelLandscape",a==="rtl"&&"hourMinuteLabelReverse"],ampmSelection:["ampmSelection",i==="landscape"&&"ampmLandscape"],ampmLabel:["ampmLabel"]},ts,o)},os=X(Wt,{name:"MuiTimePickerToolbar",slot:"Root"})({}),ns=X(Qt,{name:"MuiTimePickerToolbar",slot:"Separator"})({outline:0,margin:"0 4px 0 2px",cursor:"default"}),rs=X("div",{name:"MuiTimePickerToolbar",slot:"HourMinuteLabel",overridesResolver:(o,n)=>[{[`&.${K.hourMinuteLabelLandscape}`]:n.hourMinuteLabelLandscape,[`&.${K.hourMinuteLabelReverse}`]:n.hourMinuteLabelReverse},n.hourMinuteLabel]})({display:"flex",justifyContent:"flex-end",alignItems:"flex-end",variants:[{props:{toolbarDirection:"rtl"},style:{flexDirection:"row-reverse"}},{props:{pickerOrientation:"landscape"},style:{marginTop:"auto"}}]}),is=X("div",{name:"MuiTimePickerToolbar",slot:"AmPmSelection",overridesResolver:(o,n)=>[{[`.${K.ampmLabel}`]:n.ampmLabel},{[`&.${K.ampmLandscape}`]:n.ampmLandscape},n.ampmSelection]})({display:"flex",flexDirection:"column",marginRight:"auto",marginLeft:12,[`& .${K.ampmLabel}`]:{fontSize:17},variants:[{props:{pickerOrientation:"landscape"},style:{margin:"4px 0 auto",flexDirection:"row",justifyContent:"space-around",flexBasis:"100%"}}]});function ls(o){const n=Z({props:o,name:"MuiTimePickerToolbar"}),{ampm:i,ampmInClock:a,className:r,classes:f}=n,p=le(n,ss),g=V(),d=_e(),T=Lt(),m=as(f,T),{value:h,setValue:D,disabled:O,readOnly:I,view:S,setView:P,views:v}=Rt(),c=!!(i&&!a&&v.includes("hours")),{meridiemMode:R,handleMeridiemChange:G}=Ft(h,i,L=>D(L,{changeImportance:"set",source:"view"})),N=L=>g.isValid(h)?g.format(h,L):"--",F=e.jsx(ns,{tabIndex:-1,value:":",variant:"h3",selected:!1,className:m.separator});return e.jsxs(os,y({landscapeDirection:"row",toolbarTitle:d.timePickerToolbarTitle,ownerState:T,className:nt(m.root,r)},p,{children:[e.jsxs(rs,{className:m.hourMinuteLabel,ownerState:T,children:[U(v,"hours")&&e.jsx(Q,{tabIndex:-1,variant:"h3",onClick:()=>P("hours"),selected:S==="hours",value:N(i?"hours12h":"hours24h")}),U(v,["hours","minutes"])&&F,U(v,"minutes")&&e.jsx(Q,{tabIndex:-1,variant:"h3",onClick:()=>P("minutes"),selected:S==="minutes",value:N("minutes")}),U(v,["minutes","seconds"])&&F,U(v,"seconds")&&e.jsx(Q,{variant:"h3",onClick:()=>P("seconds"),selected:S==="seconds",value:N("seconds")})]}),c&&e.jsxs(is,{className:m.ampmSelection,ownerState:T,children:[e.jsx(Q,{disableRipple:!0,variant:"subtitle2",selected:R==="am",typographyClassName:m.ampmLabel,value:Te(g,"am"),onClick:I?void 0:()=>G("am"),disabled:O}),e.jsx(Q,{disableRipple:!0,variant:"subtitle2",selected:R==="pm",typographyClassName:m.ampmLabel,value:Te(g,"pm"),onClick:I?void 0:()=>G("pm"),disabled:O})]})]}))}function Fe(o,n){var g;const i=V(),a=Z({props:o,name:n}),r=Le(a),f=a.ampm??i.is12HourCycleInCurrentLocale(),p=l.useMemo(()=>{var d;return((d=a.localeText)==null?void 0:d.toolbarTitle)==null?a.localeText:y({},a.localeText,{timePickerToolbarTitle:a.localeText.toolbarTitle})},[a.localeText]);return y({},a,r,{ampm:f,localeText:p},Et({views:a.views,openTo:a.openTo,defaultViews:["hours","minutes"],defaultOpenTo:"hours"}),{slots:y({toolbar:ls},a.slots),slotProps:y({},a.slotProps,{toolbar:y({ampm:f,ampmInClock:a.ampmInClock},(g=a.slotProps)==null?void 0:g.toolbar)})})}const We=l.forwardRef(function(n,i){var S,P;const a=V(),r=Fe(n,"MuiDesktopTimePicker"),{shouldRenderTimeInASingleColumn:f,views:p,timeSteps:g}=qt(r),d=f?Kt:ve,T=y({hours:d,minutes:d,seconds:d,meridiem:d},r.viewRenderers),m=r.ampmInClock??!0,D=((S=T.hours)==null?void 0:S.name)===ve.name?p:p.filter(v=>v!=="meridiem"),O=y({},r,{ampmInClock:m,timeSteps:g,viewRenderers:T,format:Ae(a,r),views:f?["hours"]:D,slots:y({field:Re},r.slots),slotProps:y({},r.slotProps,{field:v=>{var c;return y({},ke((c=r.slotProps)==null?void 0:c.field,v),Oe(r))},toolbar:y({hidden:!0,ampmInClock:m},(P=r.slotProps)==null?void 0:P.toolbar)})}),{renderPicker:I}=Ht({ref:i,props:O,valueManager:ce,valueType:"time",validator:de,steps:null});return I()});We.propTypes={ampm:t.bool,ampmInClock:t.bool,autoFocus:t.bool,className:t.string,closeOnSelect:t.bool,defaultValue:t.object,disabled:t.bool,disableFuture:t.bool,disableIgnoringDatePartForTimeValidation:t.bool,disableOpenPicker:t.bool,disablePast:t.bool,enableAccessibleFieldDOMStructure:t.any,format:t.string,formatDensity:t.oneOf(["dense","spacious"]),inputRef:Ie,label:t.node,localeText:t.object,maxTime:t.object,minTime:t.object,minutesStep:t.number,name:t.string,onAccept:t.func,onChange:t.func,onClose:t.func,onError:t.func,onOpen:t.func,onSelectedSectionsChange:t.func,onViewChange:t.func,open:t.bool,openTo:t.oneOf(["hours","meridiem","minutes","seconds"]),orientation:t.oneOf(["landscape","portrait"]),readOnly:t.bool,reduceAnimations:t.bool,referenceDate:t.object,selectedSections:t.oneOfType([t.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),t.number]),shouldDisableTime:t.func,skipDisabled:t.bool,slotProps:t.object,slots:t.object,sx:t.oneOfType([t.arrayOf(t.oneOfType([t.func,t.object,t.bool])),t.func,t.object]),thresholdToRenderTimeInASingleColumn:t.number,timeSteps:t.shape({hours:t.number,minutes:t.number,seconds:t.number}),timezone:t.string,value:t.object,view:t.oneOf(["hours","meridiem","minutes","seconds"]),viewRenderers:t.shape({hours:t.func,meridiem:t.func,minutes:t.func,seconds:t.func}),views:t.arrayOf(t.oneOf(["hours","minutes","seconds"]).isRequired)};const Ee=l.forwardRef(function(n,i){var T;const a=V(),r=Fe(n,"MuiMobileTimePicker"),f=y({hours:ie,minutes:ie,seconds:ie},r.viewRenderers),p=r.ampmInClock??!1,g=y({},r,{ampmInClock:p,viewRenderers:f,format:Ae(a,r),slots:y({field:Re},r.slots),slotProps:y({},r.slotProps,{field:m=>{var h;return y({},ke((h=r.slotProps)==null?void 0:h.field,m),Oe(r))},toolbar:y({hidden:!1,ampmInClock:p},(T=r.slotProps)==null?void 0:T.toolbar)})}),{renderPicker:d}=Vt({ref:i,props:g,valueManager:ce,valueType:"time",validator:de,steps:null});return d()});Ee.propTypes={ampm:t.bool,ampmInClock:t.bool,autoFocus:t.bool,className:t.string,closeOnSelect:t.bool,defaultValue:t.object,disabled:t.bool,disableFuture:t.bool,disableIgnoringDatePartForTimeValidation:t.bool,disableOpenPicker:t.bool,disablePast:t.bool,enableAccessibleFieldDOMStructure:t.any,format:t.string,formatDensity:t.oneOf(["dense","spacious"]),inputRef:Ie,label:t.node,localeText:t.object,maxTime:t.object,minTime:t.object,minutesStep:t.number,name:t.string,onAccept:t.func,onChange:t.func,onClose:t.func,onError:t.func,onOpen:t.func,onSelectedSectionsChange:t.func,onViewChange:t.func,open:t.bool,openTo:t.oneOf(["hours","minutes","seconds"]),orientation:t.oneOf(["landscape","portrait"]),readOnly:t.bool,reduceAnimations:t.bool,referenceDate:t.object,selectedSections:t.oneOfType([t.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),t.number]),shouldDisableTime:t.func,slotProps:t.object,slots:t.object,sx:t.oneOfType([t.arrayOf(t.oneOfType([t.func,t.object,t.bool])),t.func,t.object]),timezone:t.string,value:t.object,view:t.oneOf(["hours","minutes","seconds"]),viewRenderers:t.shape({hours:t.func,minutes:t.func,seconds:t.func}),views:t.arrayOf(t.oneOf(["hours","minutes","seconds"]).isRequired)};const cs=["desktopModeMediaQuery"],ds=l.forwardRef(function(n,i){const a=Z({props:n,name:"MuiTimePicker"}),{desktopModeMediaQuery:r=Nt}=a,f=le(a,cs);return $t(r,{defaultMatches:!0})?e.jsx(We,y({ref:i},f)):e.jsx(Ee,y({ref:i},f))});function us(o,n,i,a,r){const[f,p]=l.useState([]),[g,d]=l.useState(0),[T,m]=l.useState(!0),h=l.useCallback(async()=>{m(!0);try{const D=await Pe({page:o,page_size:n,search:i,orderBy:a,order:r});p(D.data),d(D.total)}catch(D){console.error("Failed to fetch attendance:",D)}finally{m(!1)}},[o,n,i,a,r]);return l.useEffect(()=>{h()},[h]),{data:f,total:g,loading:T,refetch:h}}function ms({row:o,selected:n,onSelectRow:i,onView:a,onEdit:r,onDelete:f,canEdit:p,canDelete:g,hideCheckbox:d=!1,index:T}){const m=h=>{switch(h){case"Present":return"success";case"Absent":return"error";case"On Leave":return"warning";case"Holiday":return"info";case"Half Day":return"warning";default:return"default"}};return e.jsxs(De,{hover:!0,tabIndex:-1,role:"checkbox",selected:n,children:[!d&&e.jsx(A,{padding:"checkbox",children:e.jsx(Dt,{disableRipple:!0,checked:n,onChange:i})}),typeof T=="number"&&e.jsx(A,{align:"center",children:e.jsx(j,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:h=>xe(h.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:h=>`1px solid ${xe(h.palette.primary.main,.16)}`,mx:"auto",transition:h=>h.transitions.create(["all"],{duration:h.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:T+1})}),e.jsx(A,{children:e.jsxs(j,{children:[e.jsx(k,{variant:"subtitle2",noWrap:!0,children:o.employeeName}),e.jsx(k,{variant:"caption",sx:{color:"text.secondary"},children:o.employee})]})}),e.jsx(A,{children:e.jsx(k,{variant:"body2",noWrap:!0,children:o.attendanceDate})}),e.jsx(A,{children:e.jsx(Ce,{color:m(o.status),children:o.status})}),e.jsx(A,{children:e.jsx(k,{variant:"body2",noWrap:!0,children:o.inTime||"-"})}),e.jsx(A,{children:e.jsx(k,{variant:"body2",noWrap:!0,children:o.out_time||"-"})}),e.jsx(A,{align:"right",children:e.jsxs(j,{sx:{display:"flex",justifyContent:"flex-end",gap:.5},children:[e.jsx(q,{size:"small",onClick:a,sx:{color:"info.main"},children:e.jsx(M,{icon:"solar:eye-bold"})}),p&&e.jsx(q,{size:"small",onClick:r,sx:{color:"primary.main"},children:e.jsx(M,{icon:"solar:pen-bold"})}),g&&e.jsx(q,{size:"small",onClick:f,sx:{color:"error.main"},children:e.jsx(M,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function ps({open:o,onClose:n,attendanceId:i}){const[a,r]=l.useState(null),[f,p]=l.useState(!1);l.useEffect(()=>{o&&i?(p(!0),dt("Attendance",i).then(r).catch(d=>console.error("Failed to fetch attendance details:",d)).finally(()=>p(!1))):r(null)},[o,i]);const g=d=>{switch(d){case"Present":return"success";case"Absent":return"error";case"On Leave":return"warning";case"Holiday":return"info";case"Half Day":return"warning";default:return"default"}};return e.jsxs(Se,{open:o,onClose:n,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(Me,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(k,{variant:"h6",sx:{fontWeight:800},children:"Attendance Details"}),e.jsx(q,{onClick:n,sx:{color:d=>d.palette.grey[500],bgcolor:"background.paper",boxShadow:d=>{var T;return(T=d.customShadows)==null?void 0:T.z1}},children:e.jsx(M,{icon:"mingcute:close-line"})})]}),e.jsx(we,{sx:{p:4,m:2,mt:4},children:f?e.jsx(j,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(M,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):a?e.jsxs(j,{sx:{display:"flex",flexDirection:"column",gap:4},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,border:d=>`1px solid ${d.palette.divider}`},children:[e.jsx(M,{icon:"solar:user-circle-bold",width:40,sx:{color:"text.secondary"}}),e.jsxs(j,{children:[e.jsx(k,{variant:"subtitle1",sx:{fontWeight:800},children:a.employee_name}),e.jsxs(k,{variant:"body2",sx:{color:"text.secondary"},children:["ID: ",a.employee]})]})]}),e.jsxs(j,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[e.jsx(H,{label:"Attendance Date",value:a.attendance_date,icon:"solar:calendar-bold"}),e.jsxs(j,{children:[e.jsx(k,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:"Status"}),e.jsx(Ce,{color:g(a.status),variant:"soft",children:a.status})]})]}),e.jsx(it,{sx:{borderStyle:"dashed"}}),e.jsxs(j,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[e.jsx(H,{label:"In Time",value:a.in_time,icon:"solar:clock-circle-bold"}),e.jsx(H,{label:"Out Time",value:a.out_time,icon:"solar:clock-circle-bold"})]}),e.jsx(j,{sx:{p:2,bgcolor:"background.neutral",borderRadius:2},children:e.jsxs(j,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsx(H,{label:"Working Hours",value:a.working_hours_display||"0h 0m",icon:"solar:timer-bold"}),e.jsx(H,{label:"Overtime",value:a.overtime_display||"0h 0m",icon:"solar:timer-bold"})]})}),a.leave_type&&e.jsx(H,{label:"Leave Type",value:a.leave_type,icon:"solar:leaf-bold"})]}):e.jsxs(j,{sx:{py:10,textAlign:"center"},children:[e.jsx(M,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(k,{variant:"h6",sx:{color:"text.secondary"},children:"No Record Found"})]})})]})}function H({label:o,value:n,icon:i,color:a="text.primary"}){return e.jsxs(j,{children:[e.jsx(k,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:o}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{icon:i,width:16,sx:{color:"text.disabled"}}),e.jsx(k,{variant:"body2",sx:{fontWeight:700,color:a},children:n||"-"})]})]})}function fs(){const[o,n]=l.useState(0),[i,a]=l.useState(5),[r,f]=l.useState(""),[p,g]=l.useState("desc"),[d,T]=l.useState("attendance_date"),[m,h]=l.useState([]),[D,O]=l.useState(!1),[I,S]=l.useState(!1),[P,v]=l.useState(null),[c,R]=l.useState({status:"Present",attendance_date:w().format("YYYY-MM-DD")}),[G,N]=l.useState([]),[F,L]=l.useState({open:!1,id:null}),[ee,_]=l.useState({open:!1,message:"",severity:"success"}),[$,J]=l.useState({message:"",severity:"info"}),[He,ue]=l.useState(!1),[Ve,me]=l.useState(null),[te,Ne]=l.useState({read:!0,write:!0,delete:!0}),{data:W,total:pe,loading:$e,refetch:se}=us(o+1,i,r,d,p),ze=!W.length&&!!r,fe=!W.length&&!r&&!$e;l.useEffect(()=>{ut("Attendance").then(Ne),ft("Employee",["name","employee_name"]).then(N).catch(console.error)},[]);const Ye=()=>{R({status:"Present",attendance_date:w().format("YYYY-MM-DD")}),O(!0)},ae=()=>{O(!1),v(null)},oe=(s,u)=>{R(x=>{const C={...x,[s]:u};if((s==="in_time"||s==="out_time")&&C.in_time&&C.out_time){const Y=w(`2000-01-01 ${C.in_time}`),E=w(`2000-01-01 ${C.out_time}`);if(E.isAfter(Y)){const b=E.diff(Y)/(1e3*60*60);C.working_hours_decimal=b.toFixed(2);const be=Math.floor(b),st=Math.round((b-be)*60);C.working_hours_display=`${be}h ${st}m`}else C.working_hours_decimal=0,C.working_hours_display="0h 0m"}return C})},he=()=>{_(s=>({...s,open:!1}))},Be=s=>{L({open:!0,id:s})},Ue=async()=>{if(F.id)try{await ye(F.id),_({open:!0,message:"Attendance record deleted successfully",severity:"success"}),await se()}catch(s){console.error(s),_({open:!0,message:s.message||"Failed to delete record",severity:"error"})}finally{L({open:!1,id:null})}},Qe=()=>{if(!c.employee)return"Employee is required";if(!c.attendance_date)return"Attendance Date is required";if(!c.status)return"Status is required";const s=w(c.attendance_date),u=w().startOf("day");if(s.isAfter(u))return"Attendance cannot be marked for future dates";if(c.status==="Present"||c.status==="Half Day"){if(!c.in_time)return"In Time is required for "+c.status;if(!c.out_time)return"Out Time is required for "+c.status}if(c.in_time&&c.out_time){const x=w(`2000-01-01 ${c.in_time}`);if(!w(`2000-01-01 ${c.out_time}`).isAfter(x))return"Out Time must be after In Time"}return null},qe=async()=>{const s=Qe();if(s){_({open:!0,message:s,severity:"error"});return}try{S(!0),J({message:"",severity:"info"});const u=await Pe({page:1,page_size:1,filters:[["Attendance","employee","=",c.employee],["Attendance","attendance_date","=",c.attendance_date]]});if(u.data.length>0&&u.data[0].name!==P){_({open:!0,message:`Attendance already marked for ${c.employee} on ${c.attendance_date}`,severity:"error"}),S(!1);return}P?(await mt(P,c),_({open:!0,message:"Attendance updated successfully",severity:"success"})):(await pt(c),_({open:!0,message:"Attendance marked successfully",severity:"success"})),await se(),ae()}catch(u){console.error(u),J({message:u.message||"Error saving attendance",severity:"error"})}finally{S(!1)}},Ke=s=>{v(s);const u=W.find(x=>x.name===s);u&&R({...u}),O(!0)},Ge=s=>{me(s),ue(!0)},Je=()=>{ue(!1),me(null)},Xe=s=>{g(d===s&&p==="asc"?"desc":"asc"),T(s)},Ze=s=>{if(s){const u=W.map(x=>x.name);h(u);return}h([])},et=s=>{const u=m.indexOf(s);let x=[];u===-1?x=x.concat(m,s):u===0?x=x.concat(m.slice(1)):u===m.length-1?x=x.concat(m.slice(0,-1)):u>0&&(x=x.concat(m.slice(0,u),m.slice(u+1))),h(x)},tt=async()=>{try{await Promise.all(m.map(s=>ye(s))),_({open:!0,message:`${m.length} records deleted successfully`,severity:"success"}),h([]),await se()}catch(s){_({open:!0,message:s.message||"Error during bulk delete",severity:"error"})}},z=(s,u,x="text",C=[],Y={},E=!1)=>{const B={fullWidth:!0,label:u,value:c[s]||"",onChange:b=>oe(s,b.target.value),InputLabelProps:{shrink:!0},required:E,...Y,sx:{"& .MuiFormLabel-asterisk":{color:"red"},...Y.sx}};return x==="select"||x==="link"?e.jsxs(re,{...B,select:!0,SelectProps:{native:!0},children:[e.jsxs("option",{value:"",children:["Select ",u]}),C.map(b=>e.jsx("option",{value:b.name||b,children:b.employee_name?`${b.employee_name} (${b.name})`:b.name||b},b.name||b))]}):x==="date"?e.jsx(Ut,{label:u,value:c[s]?w(c[s]):null,onChange:b=>oe(s,(b==null?void 0:b.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,required:E,InputLabelProps:{shrink:!0},sx:B.sx}}}):x==="time"?e.jsx(ds,{label:u,value:c[s]?w(`2000-01-01 ${c[s]}`):null,onChange:b=>oe(s,(b==null?void 0:b.format("HH:mm:ss"))||""),slotProps:{textField:{fullWidth:!0,required:E,InputLabelProps:{shrink:!0},sx:B.sx}}}):e.jsx(re,{...B})};return e.jsxs(ht,{children:[e.jsxs(j,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(k,{variant:"h4",sx:{flexGrow:1},children:"Attendance"}),te.write&&e.jsx(ne,{variant:"contained",startIcon:e.jsx(M,{icon:"mingcute:add-line"}),onClick:Ye,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"Mark Attendance"})]}),e.jsxs(bt,{children:[e.jsx(yt,{numSelected:m.length,filterName:r,onFilterName:s=>{f(s.target.value),n(0)},onDelete:tt,searchPlaceholder:"Search attendance..."}),e.jsx(lt,{children:e.jsx(kt,{sx:{overflow:"unset"},children:e.jsxs(Pt,{sx:{minWidth:800},children:[e.jsx(Tt,{order:p,orderBy:d,rowCount:pe,numSelected:m.length,onSort:Xe,onSelectAllRows:s=>Ze(s),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"employee_name",label:"Employee",minWidth:180},{id:"attendance_date",label:"Date",minWidth:120},{id:"status",label:"Status",minWidth:100},{id:"in_time",label:"In Time",minWidth:120},{id:"out_time",label:"Out Time",minWidth:120},{id:"",label:"Actions",align:"right"}]}),e.jsxs(Ct,{children:[W.map((s,u)=>e.jsx(ms,{index:o*i+u,hideCheckbox:!0,row:{id:s.name,employee:s.employee,employeeName:s.employee_name,attendanceDate:s.attendance_date,status:s.status,inTime:s.in_time,out_time:s.out_time},selected:m.includes(s.name),onSelectRow:()=>et(s.name),onView:()=>Ge(s.name),onEdit:()=>Ke(s.name),onDelete:()=>Be(s.name),canEdit:te.write,canDelete:te.delete},s.name)),ze&&e.jsx(jt,{searchQuery:r}),fe&&e.jsx(De,{children:e.jsx(A,{colSpan:6,children:e.jsx(xt,{title:"No attendance records",description:"You haven't marked any attendance yet.",icon:"solar:calendar-date-bold-duotone"})})}),!fe&&e.jsx(vt,{height:68,emptyRows:Math.max(0,i-W.length)})]})]})})}),e.jsx(St,{component:"div",count:pe,page:o,rowsPerPage:i,onPageChange:(s,u)=>n(u),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s=>{a(parseInt(s.target.value,10)),n(0)}})]}),e.jsxs(Se,{open:D,onClose:ae,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(Me,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[P?"Edit Attendance":"Mark Attendance",e.jsx(q,{onClick:ae,sx:{color:s=>s.palette.grey[500]},children:e.jsx(M,{icon:"mingcute:close-line"})})]}),e.jsx(we,{dividers:!0,children:e.jsx(zt,{dateAdapter:Yt,children:e.jsxs(j,{display:"grid",margin:2,gridTemplateColumns:"1fr",gap:3,children:[z("employee","Employee","select",G,{},!0),z("attendance_date","Attendance Date","date",[],{},!0),z("status","Status","select",["Present","Absent","Half Day","On Leave","Holiday"],{},!0),e.jsxs(j,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:[z("in_time","In Time","time"),z("out_time","Out Time","time")]}),c.working_hours_display&&e.jsx(re,{fullWidth:!0,label:"Working Hours",value:c.working_hours_display,InputProps:{readOnly:!0},InputLabelProps:{shrink:!0},variant:"filled"})]})})}),e.jsx(Bt,{children:e.jsx(ne,{variant:"contained",onClick:qe,disabled:I,sx:{bgcolor:"#08a3cd","&:hover":{bgcolor:"#068fb3"}},children:I?"Saving...":P?"Update Record":"Save Record"})})]}),e.jsx(gt,{open:F.open,onClose:()=>L({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this attendance record?",action:e.jsx(ne,{onClick:Ue,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),e.jsx(je,{open:ee.open,autoHideDuration:6e3,onClose:he,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ge,{onClose:he,severity:ee.severity,sx:{width:"100%"},children:ee.message})}),e.jsx(ps,{open:He,onClose:Je,attendanceId:Ve}),e.jsx(je,{open:!!$.message,autoHideDuration:6e3,onClose:()=>J({...$,message:""}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ge,{onClose:()=>J({...$,message:""}),severity:$.severity,sx:{width:"100%",whiteSpace:"pre-line"},children:$.message})})]})}function Ks(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Attendance - ${ct.appName}`}),e.jsx(fs,{})]})}export{Ks as default};
