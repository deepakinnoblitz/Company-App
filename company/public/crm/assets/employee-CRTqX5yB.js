import{r as o,j as e,B as l,d as oe,T as p,v as W,I as j,D as Be,p as Q,S as Me,w as le}from"./index-Co7v2xsC.js";import{C as $e}from"./config-global-BX9xwJzv.js";import{d as He}from"./dayjs.min-C2542nnJ.js";import{y as ze}from"./mui-tel-input.es-qb3PikOv.js";import{f as Ue,g as Ye,a as Ge,b as Je,c as Qe,d as ie,u as Ve,e as Ke}from"./hr-management-CfgPc5UQ.js";import{getDoctypeList as Xe}from"./leads-d5FzXGcx.js";import{D as Ze,C as qe}from"./Card-CDV3jV6O.js";import{E as et}from"./empty-content-BBDmaj4d.js";import{C as tt}from"./confirm-dialog--19ddTk_.js";import{U as st,a as nt,b as at,T as rt}from"./user-table-toolbar-BXgkag6p.js";import{L as de}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as me,d as D,T as ot,a as lt,e as it}from"./TableRow-DqeBPnxy.js";import{C as ct}from"./Checkbox-CoJXcvzD.js";import{D as pe,a as ue}from"./DialogContent-DtP-sWqR.js";import{D as he}from"./DialogTitle-C3eBZids.js";import{T as dt}from"./TablePagination-CEaYVDlQ.js";import{L as mt,A as pt}from"./AdapterDayjs-BPhbSeWE.js";import{D as ut}from"./DialogActions-h_2rRG3x.js";import{S as ce}from"./Snackbar-BVA3LOhi.js";import{T as V}from"./TextField-BmVWmDzd.js";import{D as ht}from"./DatePicker-BMZY9CMK.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./api-error-handler-CV6pRVHb.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";function xt(c,u,d,a,f){const[S,v]=o.useState([]),[E,h]=o.useState(0),[C,i]=o.useState(!0),_=o.useCallback(async()=>{i(!0);try{const k=await Ue({page:c,page_size:u,search:d,orderBy:a,order:f});v(k.data),h(k.total)}catch(k){console.error("Failed to fetch employees:",k)}finally{i(!1)}},[c,u,d,a,f]);return o.useEffect(()=>{_()},[_]),{data:S,total:E,loading:C,refetch:_}}function ft({row:c,selected:u,onSelectRow:d,onView:a,onEdit:f,onDelete:S,canEdit:v,canDelete:E,hideCheckbox:h=!1,index:C}){return e.jsxs(me,{hover:!0,tabIndex:-1,role:"checkbox",selected:u,children:[!h&&e.jsx(D,{padding:"checkbox",children:e.jsx(ct,{disableRipple:!0,checked:u,onChange:d})}),typeof C=="number"&&e.jsx(D,{align:"center",children:e.jsx(l,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:i=>oe(i.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:i=>`1px solid ${oe(i.palette.primary.main,.16)}`,mx:"auto",transition:i=>i.transitions.create(["all"],{duration:i.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:C+1})}),e.jsx(D,{component:"th",scope:"row",children:e.jsx(l,{sx:{gap:2,display:"flex",alignItems:"center"},children:e.jsx(p,{variant:"subtitle2",noWrap:!0,children:c.name})})}),e.jsx(D,{children:e.jsx(p,{variant:"body2",noWrap:!0,children:c.employeeId})}),e.jsx(D,{children:e.jsx(p,{variant:"body2",noWrap:!0,children:c.department})}),e.jsx(D,{children:e.jsx(p,{variant:"body2",noWrap:!0,children:c.designation})}),e.jsx(D,{children:e.jsx(de,{color:c.status==="Active"&&"success"||"error",children:c.status})}),e.jsx(D,{align:"right",children:e.jsxs(l,{sx:{display:"flex",justifyContent:"flex-end",gap:.5},children:[e.jsx(W,{size:"small",onClick:a,sx:{color:"info.main"},children:e.jsx(j,{icon:"solar:eye-bold"})}),v&&e.jsx(W,{size:"small",onClick:f,sx:{color:"primary.main"},children:e.jsx(j,{icon:"solar:pen-bold"})}),E&&e.jsx(W,{size:"small",onClick:S,sx:{color:"error.main"},children:e.jsx(j,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function yt({open:c,onClose:u,employeeId:d}){const[a,f]=o.useState(null),[S,v]=o.useState(!1);o.useEffect(()=>{c&&d?(v(!0),Ye("Employee",d).then(f).catch(h=>console.error("Failed to fetch employee details:",h)).finally(()=>v(!1))):f(null)},[c,d]);const E=h=>e.jsx(de,{variant:"soft",color:h==="Active"?"success":"error",children:h});return e.jsxs(pe,{open:c,onClose:u,fullWidth:!0,maxWidth:"md",children:[e.jsxs(he,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(p,{variant:"h6",sx:{fontWeight:800},children:"Employee Profile"}),e.jsx(W,{onClick:u,sx:{color:h=>h.palette.grey[500],bgcolor:"background.paper",boxShadow:h=>{var C;return(C=h.customShadows)==null?void 0:C.z1}},children:e.jsx(j,{icon:"mingcute:close-line"})})]}),e.jsx(ue,{sx:{p:4,m:2,mt:4},children:S?e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(j,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):a?e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(l,{sx:{width:80,height:80,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.lighter",color:"primary.main",overflow:"hidden"},children:a.profile_picture?e.jsx(l,{component:"img",src:a.profile_picture,sx:{width:1,height:1,objectFit:"cover"}}):e.jsx(j,{icon:"solar:user-bold",width:40})}),e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(p,{variant:"h5",sx:{fontWeight:800},children:a.employee_name}),e.jsxs(p,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:[a.designation," at ",a.department]})]}),e.jsxs(l,{sx:{textAlign:"right"},children:[E(a.status),e.jsxs(p,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled",fontWeight:700},children:["ID: ",a.name]})]})]}),e.jsx(Be,{sx:{borderStyle:"dashed"}}),e.jsxs(l,{children:[e.jsx(K,{title:"Contact Information",icon:"solar:phone-calling-bold"}),e.jsxs(l,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(b,{label:"Official Email",value:a.email,icon:"solar:letter-bold"}),e.jsx(b,{label:"Personal Email",value:a.personal_email,icon:"solar:letter-bold"}),e.jsx(b,{label:"Phone",value:a.phone,icon:"solar:phone-bold"}),e.jsx(b,{label:"Office Phone",value:a.office_phone_number,icon:"solar:phone-bold"})]})]}),e.jsxs(l,{children:[e.jsx(K,{title:"Employment Details",icon:"solar:case-bold"}),e.jsxs(l,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(b,{label:"Department",value:a.department,icon:"solar:buildings-bold"}),e.jsx(b,{label:"Designation",value:a.designation,icon:"solar:medal-star-bold"}),e.jsx(b,{label:"Joining Date",value:a.date_of_joining,icon:"solar:calendar-bold"}),e.jsx(b,{label:"Date of Birth",value:a.dob,icon:"solar:calendar-bold"}),e.jsx(b,{label:"Country",value:a.country,icon:"solar:earth-bold"})]})]}),e.jsxs(l,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(K,{title:"Financial Summary",icon:"solar:wallet-money-bold",noMargin:!0}),e.jsxs(l,{sx:{mt:3,display:"grid",gap:3,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"}},children:[e.jsx(b,{label:"CTC (Monthly)",value:a.ctc?`$${a.ctc}`:"-",icon:"solar:money-bag-bold",color:"success.main"}),e.jsx(b,{label:"Bank Account",value:a.bank_account,icon:"solar:card-bold"})]})]})]}):e.jsxs(l,{sx:{py:10,textAlign:"center"},children:[e.jsx(j,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(p,{variant:"h6",sx:{color:"text.secondary"},children:"No Profile Found"})]})})]})}function K({title:c,icon:u,noMargin:d=!1}){return e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:d?0:2.5},children:[e.jsx(j,{icon:u,width:20,sx:{color:"primary.main"}}),e.jsx(p,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:c})]})}function b({label:c,value:u,icon:d,color:a="text.primary"}){return e.jsxs(l,{children:[e.jsx(p,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:c}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(j,{icon:d,width:16,sx:{color:"text.disabled"}}),e.jsx(p,{variant:"body2",sx:{fontWeight:700,color:a},children:u||"-"})]})]})}function gt(){const[c,u]=o.useState(0),[d,a]=o.useState(5),[f,S]=o.useState(""),[v,E]=o.useState("asc"),[h,C]=o.useState("employee_name"),[i,_]=o.useState([]),[k,L]=o.useState(!1),[X,Z]=o.useState(!1),[R,q]=o.useState(null),[xe,ee]=o.useState(!1),[fe,te]=o.useState(null),[ye,ge]=o.useState({}),[P,N]=o.useState({status:"Active",ctc:0}),[O,be]=o.useState({}),[se,je]=o.useState([]),[A,w]=o.useState({message:"",severity:"info"}),[B,M]=o.useState({open:!1,id:null}),[$,F]=o.useState({open:!1,message:"",severity:"success"}),[H,ve]=o.useState({read:!0,write:!0,delete:!0}),{data:I,total:ne,loading:Ce,refetch:z}=xt(c+1,d,f,h,v),De=!I.length&&!!f,ae=!I.length&&!f&&!Ce;o.useEffect(()=>{Ge("Employee").then(ve),Je("Employee").then(t=>{const n={};t.fields.forEach(s=>{const y={...s};if(y.depends_on){let x=y.depends_on;x.startsWith("eval:")&&(x=x.replace("eval:","")),x=x.replace(/doc\./g,"formData.");try{y._visibility_fn=new Function("formData",`try { return ${x}; } catch(e) { return true; }`)}catch(T){console.error(`Failed to compile depends_on for ${y.fieldname}`,T),y._visibility_fn=()=>!0}}n[s.fieldname]=y}),ge(n),t.fields.forEach(s=>{s.fieldtype==="Link"&&s.options&&Xe(s.options,["name"]).then(y=>{be(x=>({...x,[s.fieldname]:y}))}).catch(console.error)})}).catch(console.error),Qe().then(je).catch(console.error)},[]);const U=t=>t?t.startsWith("+")&&t.includes("-")?t.replace("-"," "):t:"",_e=t=>{if(!t)return"";let n=t.replace(/\s/g,"");const s=t.trim().split(/\s+/);return s.length>1&&s[0].startsWith("+")&&(n=`${s[0]}-${s.slice(1).join("")}`),n},Y=(t,n)=>{let s=n;(t==="phone"||t==="office_phone_number")&&(s=_e(n)),N(y=>{const x={...y,[t]:s};if(t==="ctc"&&se.length>0){const T=parseFloat(s)||0;se.forEach(g=>{const m=g.field_name;if(!m)return;let J=0;parseFloat(g.static_amount)>0?J=parseFloat(g.static_amount):parseFloat(g.percentage)>0&&(J=T*parseFloat(g.percentage)/100),x[m]=J})}return x})},Se=()=>{N({status:"Active",ctc:0}),L(!0)},G=()=>{L(!1),q(null),N({status:"Active",ctc:0}),w({message:"",severity:"info"})},Ee=t=>{te(t),ee(!0)},we=()=>{ee(!1),te(null)},re=()=>{F(t=>({...t,open:!1}))},ke=t=>{M({open:!0,id:t})},Pe=async()=>{if(B.id)try{await ie(B.id),F({open:!0,message:"Employee deleted successfully",severity:"success"}),await z()}catch(t){console.error(t),F({open:!0,message:"Failed to delete employee",severity:"error"})}finally{M({open:!1,id:null})}},Ie=t=>{E(h===t&&v==="asc"?"desc":"asc"),C(t)},Te=t=>{if(t){const n=I.map(s=>s.name);_(n);return}_([])},Ae=t=>{const n=i.indexOf(t);let s=[];n===-1?s=s.concat(i,t):n===0?s=s.concat(i.slice(1)):n===i.length-1?s=s.concat(i.slice(0,-1)):n>0&&(s=s.concat(i.slice(0,n),i.slice(n+1))),_(s)},Fe=async()=>{try{await Promise.all(i.map(t=>ie(t))),F({open:!0,message:`${i.length} employees deleted successfully`,severity:"success"}),_([]),await z()}catch(t){F({open:!0,message:t.message||"Error during bulk delete",severity:"error"})}},We=async()=>{try{Z(!0),w({message:"",severity:"info"});const t={...P};t.employee_name&&(t.employee_name=t.employee_name.trim()),t.employee_id&&(t.employee_id=t.employee_id.trim()),t.email&&(t.email=t.email.trim()),R?(await Ve(R,t),w({message:"Employee updated successfully",severity:"success"})):(await Ke(t),w({message:"Employee created successfully",severity:"success"})),await z(),setTimeout(()=>{G()},1500)}catch(t){console.error(t),w({message:t.message||"Error saving employee",severity:"error"})}finally{Z(!1)}},Re=t=>{q(t);const n=I.find(s=>s.name===t);if(n){const s={...n};s.phone&&(s.phone=U(s.phone)),s.office_phone_number&&(s.office_phone_number=U(s.office_phone_number)),N(s)}L(!0)},Ne=(t,n)=>{u(n)},Oe=t=>{a(parseInt(t.target.value,10)),u(0)},Le=t=>{const n=ye[t];return n?n.hidden?!1:n._visibility_fn?n._visibility_fn(P):!0:!0},r=(t,n,s="text",y=[],x={},T=!1)=>{if(!Le(t))return null;const g={fullWidth:!0,label:n,value:P[t]||"",onChange:m=>Y(t,m.target.value),InputLabelProps:{shrink:!0},required:T,...x,sx:{"& .MuiFormLabel-asterisk":{color:"red"},...x.sx}};return s==="phone"?e.jsx(ze,{...g,defaultCountry:"IN",value:U(P[t]||""),onChange:m=>Y(t,m)}):s==="select"||s==="link"?e.jsxs(V,{...g,select:!0,SelectProps:{native:!0},children:[e.jsxs("option",{value:"",children:["Select ",n]}),y.map(m=>e.jsx("option",{value:m.name||m,children:m.name||m},m.name||m))]}):s==="date"?e.jsx(ht,{label:n,value:P[t]?He(P[t]):null,onChange:m=>Y(t,(m==null?void 0:m.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,required:T,InputLabelProps:{shrink:!0},sx:g.sx}}}):s==="number"?e.jsx(V,{...g,type:"number"}):e.jsx(V,{...g})};return e.jsxs(Ze,{children:[e.jsxs(l,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(p,{variant:"h4",sx:{flexGrow:1},children:"Employees"}),H.write&&e.jsx(Q,{variant:"contained",startIcon:e.jsx(j,{icon:"mingcute:add-line"}),onClick:Se,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Employee"})]}),e.jsxs(qe,{children:[e.jsx(st,{numSelected:i.length,filterName:f,onFilterName:t=>{S(t.target.value),u(0)},onDelete:Fe,searchPlaceholder:"Search employees..."}),e.jsx(Me,{children:e.jsx(ot,{sx:{overflow:"unset"},children:e.jsxs(lt,{sx:{minWidth:800},children:[e.jsx(nt,{order:v,orderBy:h,rowCount:ne,numSelected:i.length,onSort:Ie,onSelectAllRows:t=>Te(t),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"employee_name",label:"Name",minWidth:180},{id:"employee_id",label:"ID",minWidth:80},{id:"department",label:"Department",minWidth:120},{id:"designation",label:"Designation",minWidth:120},{id:"status",label:"Status",minWidth:100},{id:"",label:"Actions",align:"right"}]}),e.jsxs(it,{children:[I.map((t,n)=>e.jsx(ft,{index:c*d+n,hideCheckbox:!0,row:{id:t.name,employeeId:t.employee_id,name:t.employee_name,department:t.department,designation:t.designation,status:t.status},selected:i.includes(t.name),onSelectRow:()=>Ae(t.name),onView:()=>Ee(t.name),onEdit:()=>Re(t.name),onDelete:()=>ke(t.name),canEdit:H.write,canDelete:H.delete},t.name)),De&&e.jsx(at,{searchQuery:f}),ae&&e.jsx(me,{children:e.jsx(D,{colSpan:6,children:e.jsx(et,{title:"No employees found",description:"Click 'New Employee' to add your first team member.",icon:"solar:users-group-rounded-bold-duotone"})})}),!ae&&e.jsx(rt,{height:68,emptyRows:Math.max(0,d-I.length)})]})]})})}),e.jsx(dt,{component:"div",count:ne,page:c,rowsPerPage:d,onPageChange:Ne,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:Oe})]}),e.jsxs(pe,{open:k,onClose:G,fullWidth:!0,maxWidth:"md",children:[e.jsxs(he,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[R?"Edit Employee":"New Employee",e.jsx(W,{onClick:G,sx:{color:t=>t.palette.grey[500]},children:e.jsx(j,{icon:"mingcute:close-line"})})]}),e.jsx(ue,{dividers:!0,children:e.jsx(mt,{dateAdapter:pt,children:e.jsxs(l,{sx:{p:2},children:[e.jsx(p,{variant:"h6",sx:{mb:2,color:"primary.main"},children:"Personal Information"}),e.jsxs(l,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:3,sx:{mb:4},children:[r("employee_name","Employee Name","text",[],{},!0),r("email","Email","text",[],{},!0),r("personal_email","Personal Email"),r("phone","Phone Number","phone"),r("dob","Date of Birth","date"),r("country","Country","link",O.country||[]),r("profile_picture","Profile Picture URL")]}),e.jsx(p,{variant:"h6",sx:{mb:2,color:"primary.main"},children:"Employment Details"}),e.jsxs(l,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:3,sx:{mb:4},children:[r("employee_id","Employee ID","text",[],{},!0),r("department","Department","link",O.department||[]),r("designation","Designation","link",O.designation||[]),r("status","Status","select",["Active","Inactive"],{},!0),r("date_of_joining","Joining Date","date",[],{},!0),r("user","User Login (Email)","link",O.user||[])]}),e.jsx(p,{variant:"h6",sx:{mb:2,color:"primary.main"},children:"Financial & Bank Details"}),e.jsxs(l,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:3,sx:{mb:4},children:[r("bank_name","Bank Name"),r("bank_account","Bank Account"),r("pf_number","PF Number"),r("esi_no","ESI No"),r("office_phone_number","Office Phone","phone")]}),e.jsx(p,{variant:"h6",sx:{mb:2,color:"primary.main"},children:"Salary Details (Auto-calculated)"}),e.jsxs(l,{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:3,children:[r("ctc","CTC (Annual)","number",[],{},!0),r("basic_pay","Basic Pay","number"),r("hra","HRA","number"),r("conveyance_allowances","Conveyance Allowances","number"),r("medical_allowances","Medical Allowances","number"),r("other_allowances","Other Allowances","number"),r("pf","PF Deduction","number"),r("health_insurance","Health Insurance","number"),r("professional_tax","Professional Tax","number"),r("loan_recovery","Loan Recovery","number")]})]})})}),e.jsx(ut,{children:e.jsx(Q,{variant:"contained",onClick:We,disabled:X,sx:{bgcolor:"#08a3cd","&:hover":{bgcolor:"#068fb3"}},children:X?"Saving...":R?"Update Employee":"Create Employee"})})]}),e.jsx(tt,{open:B.open,onClose:()=>M({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this employee?",action:e.jsx(Q,{onClick:Pe,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),e.jsx(ce,{open:$.open,autoHideDuration:6e3,onClose:re,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(le,{onClose:re,severity:$.severity,sx:{width:"100%"},children:$.message})}),e.jsx(yt,{open:xe,onClose:we,employeeId:fe}),e.jsx(ce,{open:!!A.message,autoHideDuration:6e3,onClose:()=>w({...A,message:""}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(le,{onClose:()=>w({...A,message:""}),severity:A.severity,sx:{width:"100%",whiteSpace:"pre-line"},children:A.message})})]})}function qt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Employees - ${$e.appName}`}),e.jsx(gt,{})]})}export{qt as default};
