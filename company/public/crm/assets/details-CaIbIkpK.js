import{Z as k,W as M,r as u,j as e,$ as Q,T as r,p as h,I as a,B as g,d as s,D as B}from"./index-Co7v2xsC.js";import{C as Y}from"./config-global-BX9xwJzv.js";import"./format-time-9uMX-KY9.js";import"./purchase-create-view-CI9dcBgx.js";import{c as o}from"./format-number-DSNgsWBE.js";import{h as Z}from"./print-q83xVReF.js";import{D as C,C as K}from"./Card-CDV3jV6O.js";import{g as X,d as ee,b as te}from"./purchase-CQE7gI0T.js";import{C as re}from"./confirm-dialog--19ddTk_.js";import{S as i}from"./Stack-GQIY7Xk9.js";import{T as ie,a as ne,b as se,c as P,d as n,e as ae}from"./TableRow-DqeBPnxy.js";import"./dayjs.min-C2542nnJ.js";import"./invoice-CmnDHtbD.js";import"./api-error-handler-CV6pRVHb.js";import"./leads-d5FzXGcx.js";import"./data-import-KyR0bLZ-.js";import"./tax-type-form-dialog-Ctl86VPY.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./TextField-BmVWmDzd.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./DialogActions-h_2rRG3x.js";import"./AdapterDayjs-BPhbSeWE.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";import"./Autocomplete-BIV6h0T7.js";import"./usePreviousProps-CVIlMhUg.js";import"./DatePicker-BMZY9CMK.js";import"./Snackbar-BVA3LOhi.js";import"./AlertTitle-BbqQne_Q.js";function oe(){const{id:c}=k(),j=M(),[I,R]=u.useState(null),[$,A]=u.useState(!0),[y,W]=u.useState(!1),[F,b]=u.useState(!1);if(u.useEffect(()=>{c&&X(c).then(R).catch(t=>console.error("Failed to fetch purchase details:",t)).finally(()=>A(!1))},[c]),$)return e.jsx(C,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(Q,{})});if(!I)return e.jsxs(C,{children:[e.jsx(r,{variant:"h4",children:"Purchase not found"}),e.jsx(h,{onClick:()=>j.push("/purchase"),sx:{mt:3},children:"Go back to list"})]});const{vendor_name:G,bill_date:N,bill_no:E,payment_type:O,payment_terms:H,due_date:V,description:D,attach:p,overall_discount_type:T,overall_discount:f,total_amount:q,grand_total:_,paid_amount:v,balance_amount:d,table_qecz:w=[]}=I;let m=[];if(p)try{const t=JSON.parse(p);Array.isArray(t)?m=t:m=[{name:p.split("/").pop()||"Attachment",url:p}]}catch{m=[{name:p.split("/").pop()||"Attachment",url:p}]}const S=w.reduce((t,x)=>t+(x.tax_amount||0),0),L=q+S,U=T==="Flat"?f:L*f/100,z=()=>{c&&Z(te(c))},J=async()=>{if(c)try{W(!0),await ee(c),j.push("/purchase")}catch(t){console.error("Failed to delete purchase:",t)}finally{W(!1),b(!1)}};return e.jsxs(C,{children:[e.jsxs(i,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,className:"no-print",children:[e.jsxs(r,{variant:"h4",children:["Purchase: ",c]}),e.jsxs(i,{direction:"row",spacing:2,children:[e.jsx(h,{variant:"outlined",color:"inherit",onClick:()=>j.push("/purchase"),startIcon:e.jsx(a,{icon:"solar:arrow-left-bold"}),children:"Back to List"}),e.jsx(h,{variant:"outlined",color:"primary",onClick:z,startIcon:e.jsx(a,{icon:"solar:printer-bold"}),children:"Print"}),v===0&&e.jsx(h,{variant:"contained",color:"error",onClick:()=>b(!0),startIcon:e.jsx(a,{icon:"solar:trash-bin-trash-bold"}),children:"Delete"}),v===0&&e.jsx(h,{variant:"contained",color:"primary",onClick:()=>j.push(`/purchase/edit/${encodeURIComponent(c||"")}`),startIcon:e.jsx(a,{icon:"solar:pen-bold"}),children:"Edit Purchase"})]})]}),e.jsx(K,{sx:{p:4,borderRadius:2},children:e.jsxs(i,{spacing:4,children:[e.jsxs(g,{sx:{display:"grid",columnGap:4,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsxs(i,{spacing:1.5,children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(a,{icon:"solar:user-rounded-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Vendor Details"})]}),e.jsxs(g,{sx:{p:2,borderRadius:1.5,bgcolor:t=>s(t.palette.grey[500],.04),border:t=>`1px solid ${s(t.palette.grey[500],.08)}`},children:[e.jsx(r,{variant:"subtitle1",color:"primary.main",children:G}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[O," | ",H]})]})]}),e.jsxs(i,{spacing:1.5,children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(a,{icon:"solar:calendar-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Doc Logistics"})]}),e.jsxs(i,{spacing:2,sx:{p:2,borderRadius:1.5,bgcolor:t=>s(t.palette.grey[500],.04),border:t=>`1px solid ${s(t.palette.grey[500],.08)}`},children:[e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.disabled",children:"Bill Date"}),e.jsx(r,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:N})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.disabled",children:"Bill No"}),e.jsx(r,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:E||"-"})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.disabled",children:"Due Date"}),e.jsx(r,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold",color:"error.main"},children:V||"-"})]})]})]}),e.jsxs(i,{spacing:1.5,children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(a,{icon:"solar:wad-of-money-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Financial Status"})]}),e.jsxs(i,{spacing:2,sx:{p:2,borderRadius:1.5,bgcolor:t=>s((d||0)>0?t.palette.error.main:t.palette.success.main,.04),border:t=>`1px solid ${s((d||0)>0?t.palette.error.main:t.palette.success.main,.12)}`},children:[e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Grand Total"}),e.jsx(r,{variant:"subtitle1",color:"primary.main",children:o(_)})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Balance Due"}),e.jsx(r,{variant:"h6",color:(d||0)>0?"error.main":"success.main",children:o(d)})]})]})]})]}),e.jsxs(g,{children:[e.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2,color:"text.secondary"},children:[e.jsx(a,{icon:"solar:list-bold-duotone",width:20}),e.jsx(r,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Purchase Items"})]}),e.jsx(ie,{sx:{overflow:"unset",border:t=>`1px solid ${s(t.palette.grey[500],.12)}`,borderRadius:1.5},children:e.jsxs(ne,{sx:{minWidth:800},children:[e.jsx(se,{children:e.jsxs(P,{sx:{bgcolor:t=>s(t.palette.grey[500],.04)},children:[e.jsx(n,{sx:{fontWeight:"fontWeightBold",py:2},children:"Item"}),e.jsx(n,{sx:{fontWeight:"fontWeightBold",py:2},children:"HSN"}),e.jsx(n,{sx:{fontWeight:"fontWeightBold",py:2},children:"Description"}),e.jsx(n,{width:60,align:"center",sx:{fontWeight:"fontWeightBold",py:2},children:"Qty"}),e.jsx(n,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Price"}),e.jsx(n,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Discount"}),e.jsx(n,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Tax Type"}),e.jsx(n,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Tax Amt"}),e.jsx(n,{width:120,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Total"})]})}),e.jsx(ae,{children:w.map((t,x)=>e.jsxs(P,{sx:{"&:hover":{bgcolor:l=>s(l.palette.primary.main,.02)}},children:[e.jsx(n,{sx:{py:2},children:e.jsx(r,{variant:"subtitle2",children:t.service})}),e.jsx(n,{sx:{py:2},children:e.jsx(r,{variant:"body2",children:t.hsn_code||"-"})}),e.jsx(n,{sx:{py:2},children:e.jsx(r,{variant:"caption",sx:{color:"text.secondary",display:"block",maxWidth:200},children:t.description})}),e.jsx(n,{align:"center",sx:{py:2},children:t.quantity}),e.jsx(n,{align:"right",sx:{py:2},children:o(t.price)}),e.jsx(n,{align:"right",sx:{py:2},children:t.discount>0?e.jsxs(r,{variant:"caption",color:"success.main",children:["-",t.discount_type==="Flat"?o(t.discount):`${t.discount}%`]}):"-"}),e.jsx(n,{align:"right",sx:{py:2},children:e.jsx(r,{variant:"caption",color:"text.secondary",children:t.tax_type||"-"})}),e.jsx(n,{align:"right",sx:{py:2},children:o(t.tax_amount)}),e.jsx(n,{align:"right",sx:{py:2},children:e.jsx(r,{variant:"subtitle2",color:"primary",children:o(t.sub_total)})})]},x))})]})})]}),e.jsxs(g,{sx:{display:"grid",columnGap:4,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},alignItems:"start"},children:[e.jsxs(i,{spacing:3,children:[D&&e.jsxs(i,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Description"}),e.jsx(r,{variant:"body2",sx:{p:2,borderRadius:1.5,bgcolor:t=>s(t.palette.primary.main,.04),border:t=>`1px solid ${s(t.palette.primary.main,.12)}`,whiteSpace:"pre-wrap",minHeight:80,color:"text.secondary"},children:D})]}),m.length>0&&e.jsxs(i,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Attachments"}),e.jsx(i,{spacing:1,children:m.map((t,x)=>e.jsxs(i,{direction:"row",alignItems:"center",component:"a",href:t.url,target:"_blank",sx:{px:2,py:1,borderRadius:1.5,textDecoration:"none",color:"inherit",bgcolor:l=>s(l.palette.primary.main,.04),border:l=>`1px solid ${s(l.palette.primary.main,.12)}`,transition:l=>l.transitions.create(["background-color","transform"]),"&:hover":{bgcolor:l=>s(l.palette.primary.main,.08),transform:"translateY(-1px)"}},children:[e.jsx(a,{icon:"solar:link-bold",width:18,sx:{mr:1,color:"primary.main",flexShrink:0}}),e.jsx(r,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:t.name||t.url.split("/").pop()}),e.jsx(a,{icon:"solar:download-bold",width:16,sx:{ml:1,color:"text.disabled"}})]},x))})]})]}),e.jsxs(i,{spacing:2,sx:{p:3,borderRadius:2,bgcolor:t=>s(t.palette.grey[500],.04),border:t=>`1px solid ${s(t.palette.grey[500],.08)}`},children:[e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Taxable Amount"}),e.jsx(r,{variant:"subtitle2",children:o(w.reduce((t,x)=>t+(x.sub_total-x.tax_amount),0))})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Total Tax"}),e.jsxs(r,{variant:"subtitle2",color:"error.main",children:["+",o(S)]})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Discount (",T==="Flat"?"Flat":`${f}%`,")"]}),e.jsxs(r,{variant:"subtitle2",color:"success.main",children:["-",o(U)]})]}),e.jsx(B,{sx:{borderStyle:"dashed"}}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"subtitle1",children:"Grand Total"}),e.jsx(r,{variant:"h6",children:o(_)})]}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(a,{icon:"solar:hand-money-bold-duotone",width:16,sx:{color:"success.main"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Paid Amount"})]}),e.jsx(r,{variant:"subtitle2",color:"success.main",children:o(v)})]}),e.jsx(B,{sx:{borderStyle:"dashed"}}),e.jsxs(i,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(a,{icon:"solar:wallet-2-bold-duotone",width:20,sx:{color:(d||0)>0?"error.main":"success.main"}}),e.jsx(r,{variant:"subtitle1",sx:{color:(d||0)>0?"error.main":"success.main"},children:"Balance Due"})]}),e.jsx(r,{variant:"h5",color:(d||0)>0?"error.main":"success.main",children:o(d)})]})]})]})]})}),e.jsx(re,{open:F,onClose:()=>!y&&b(!1),title:"Confirm Delete",content:"Are you sure you want to delete this purchase?",action:e.jsx(h,{variant:"contained",color:"error",onClick:J,disabled:y,sx:{borderRadius:1.5,minWidth:100},children:y?"Deleting...":"Delete"})})]})}function Ve(){const{id:c}=k();return e.jsxs(e.Fragment,{children:[e.jsxs("title",{children:[" ",`Purchase Detail - ${Y.appName}`]}),e.jsx(oe,{})]})}export{Ve as default};
