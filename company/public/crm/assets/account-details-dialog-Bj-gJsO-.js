import{f as u,H as w,r as b,j as e,T as l,B as i,v as _,I as d,p as S,D as v}from"./index-Co7v2xsC.js";import{h as A}from"./api-error-handler-CV6pRVHb.js";import{L as k}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{D,a as O}from"./DialogContent-DtP-sWqR.js";import{D as I}from"./DialogTitle-C3eBZids.js";async function R(t){const s=[];t.filterValues&&Object.entries(t.filterValues).forEach(([x,p])=>{p&&p!=="all"&&s.push(["Accounts",x,"=",p])});const o=t.search?[["Accounts","account_name","like",`%${t.search}%`],["Accounts","account_owner","like",`%${t.search}%`],["Accounts","phone_number","like",`%${t.search}%`],["Accounts","website","like",`%${t.search}%`]]:[];let a="creation desc";if(t.sort_by){const[x,p]=t.sort_by.split("_").reduce((h,g)=>(g==="asc"||g==="desc"?h[1]=g:h[0]=h[0]?`${h[0]}_${g}`:g,h),["","desc"]);a=`${x} ${p}`}const n=new URLSearchParams({doctype:"Accounts",fields:JSON.stringify(["name","account_name","phone_number","website","account_owner","gstin","country","state","city","owner","creation"]),filters:JSON.stringify(s),or_filters:JSON.stringify(o),limit_start:String((t.page-1)*t.page_size),limit_page_length:String(t.page_size),order_by:a}),[f,y]=await Promise.all([u(`/api/method/frappe.client.get_list?${n.toString()}`),u(`/api/method/frappe.client.get_count?doctype=Accounts&filters=${encodeURIComponent(JSON.stringify(s))}&or_filters=${encodeURIComponent(JSON.stringify(o))}`)]);if(!f.ok)throw new Error("Failed to fetch accounts");const m=await f.json(),c=await y.json();return{data:m.message||[],total:c.message||0}}async function F(t){const s=await w(),o=await u("/api/method/frappe.client.insert",{method:"POST",headers:s,body:JSON.stringify({doc:{doctype:"Accounts",...t}})}),a=await o.json();if(!o.ok)throw new Error(A(a,"Failed to create account"));return a.message}async function J(t,s){const o=await w(),a=await u("/api/method/frappe.client.set_value",{method:"POST",headers:o,body:JSON.stringify({doctype:"Accounts",name:t,fieldname:s})}),n=await a.json();if(!a.ok)throw new Error(A(n,"Failed to update account"));return n.message}async function L(t){const s=await w(),o=await u("/api/method/frappe.client.delete",{method:"POST",headers:s,body:JSON.stringify({doctype:"Accounts",name:t})}),a=await o.json();if(!o.ok)throw new Error(A(a,"Failed to delete account"));return a.message}async function B(){const t=await u("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Accounts");return t.ok?(await t.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}async function C(t){const s=await u(`/api/method/frappe.client.get?doctype=Accounts&name=${t}`);if(!s.ok)throw new Error("Failed to fetch account details");return(await s.json()).message}function z({open:t,onClose:s,accountId:o,onEdit:a}){const[n,f]=b.useState(null),[y,m]=b.useState(!1);return b.useEffect(()=>{t&&o?(m(!0),C(o).then(f).catch(c=>console.error("Failed to fetch account details:",c)).finally(()=>m(!1))):f(null)},[t,o]),e.jsxs(D,{open:t,onClose:s,fullWidth:!0,maxWidth:"md",children:[e.jsxs(I,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(l,{variant:"h6",sx:{fontWeight:800},children:"Account Profile"}),e.jsx(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:e.jsx(_,{onClick:s,sx:{color:c=>c.palette.grey[500],bgcolor:"background.paper",boxShadow:c=>{var x;return(x=c.customShadows)==null?void 0:x.z1}},children:e.jsx(d,{icon:"mingcute:close-line"})})})]}),e.jsx(O,{sx:{p:4,m:2,mt:4},children:y?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(d,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):n?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(i,{sx:{width:64,height:64,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.lighter",color:"primary.main"},children:e.jsx(d,{icon:"solar:buildings-bold",width:32})}),e.jsxs(i,{sx:{flexGrow:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:.5},children:[e.jsx(l,{variant:"h5",sx:{fontWeight:800},children:n.account_name}),a&&o&&e.jsx(S,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(d,{icon:"solar:pen-bold",width:16}),onClick:()=>{a(o),s()},sx:{height:28,borderRadius:1,px:1.5,typography:"subtitle2",fontWeight:700},children:"Edit"})]}),e.jsx(l,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:n.website||"No website provided"})]}),e.jsxs(i,{sx:{textAlign:"right"},children:[e.jsx(k,{variant:"soft",color:"info",children:"Account"}),e.jsxs(l,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled",fontWeight:700},children:["ID: ",n.name]})]})]}),e.jsx(v,{sx:{borderStyle:"dashed"}}),e.jsxs(i,{children:[e.jsx(j,{title:"Account Details",icon:"solar:info-circle-bold"}),e.jsxs(i,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(r,{label:"Account Name",value:n.account_name,icon:"solar:buildings-bold"}),e.jsx(r,{label:"Phone",value:n.phone_number,icon:"solar:phone-bold"}),e.jsx(r,{label:"Website",value:n.website,icon:"solar:globus-bold"}),e.jsx(r,{label:"GSTIN",value:n.gstin,icon:"solar:checklist-bold"}),e.jsx(r,{label:"Owner",value:n.owner,icon:"solar:user-bold"})]})]}),e.jsxs(i,{children:[e.jsx(j,{title:"Location",icon:"solar:map-point-bold"}),e.jsxs(i,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(r,{label:"City",value:n.city,icon:"solar:city-bold"}),e.jsx(r,{label:"State",value:n.state,icon:"solar:point-on-map-bold"}),e.jsx(r,{label:"Country",value:n.country,icon:"solar:earth-bold"})]})]}),e.jsxs(i,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(j,{title:"System Information",icon:"solar:clock-circle-bold",noMargin:!0}),e.jsxs(i,{sx:{mt:3,display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(r,{label:"Created On",value:new Date(n.creation).toLocaleString(),icon:"solar:calendar-date-bold"}),e.jsx(r,{label:"Modified On",value:new Date(n.modified).toLocaleString(),icon:"solar:calendar-minimalistic-bold"})]})]})]}):e.jsxs(i,{sx:{py:10,textAlign:"center"},children:[e.jsx(d,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(l,{variant:"h6",sx:{color:"text.secondary"},children:"No Profile Found"})]})})]})}function j({title:t,icon:s,noMargin:o=!1}){return e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:o?0:2.5},children:[e.jsx(d,{icon:s,width:20,sx:{color:"primary.main"}}),e.jsx(l,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:t})]})}function r({label:t,value:s,icon:o,color:a="text.primary"}){return e.jsxs(i,{children:[e.jsx(l,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:t}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(d,{icon:o,width:16,sx:{color:"text.disabled"}}),e.jsx(l,{variant:"body2",sx:{fontWeight:700,color:a},children:s||"-"})]})]})}export{z as A,F as c,L as d,R as f,B as g,J as u};
