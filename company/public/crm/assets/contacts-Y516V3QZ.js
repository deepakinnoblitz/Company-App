import{f as s,H as f}from"./index-Co7v2xsC.js";import{h as l}from"./api-error-handler-CV6pRVHb.js";async function u(t){const e=[];t.filterValues&&Object.entries(t.filterValues).forEach(([d,a])=>{a&&a!=="all"&&e.push(["Contacts",d,"=",a])});const n=t.search?[["Contacts","first_name","like",`%${t.search}%`],["Contacts","email","like",`%${t.search}%`],["Contacts","company_name","like",`%${t.search}%`],["Contacts","phone","like",`%${t.search}%`]]:[];let o="creation desc";if(t.sort_by){const[d,a]=t.sort_by.split("_").reduce((i,r)=>(r==="asc"||r==="desc"?i[1]=r:i[0]=i[0]?`${i[0]}_${r}`:r,i),["","desc"]);o=`${d} ${a}`}const c=new URLSearchParams({doctype:"Contacts",fields:JSON.stringify(["name","first_name","company_name","email","phone","designation","source_lead","address","notes","country","state","city","customer_type","owner","creation","modified"]),filters:JSON.stringify(e),or_filters:JSON.stringify(n),limit_start:String((t.page-1)*t.page_size),limit_page_length:String(t.page_size),order_by:o}),[p,y]=await Promise.all([s(`/api/method/frappe.client.get_list?${c.toString()}`),s(`/api/method/frappe.client.get_count?doctype=Contacts&filters=${encodeURIComponent(JSON.stringify(e))}&or_filters=${encodeURIComponent(JSON.stringify(n))}`)]);if(!p.ok)throw new Error("Failed to fetch contacts");const h=await p.json(),m=await y.json();return{data:h.message||[],total:m.message||0}}async function _(t){const e=await f(),n=await s("/api/method/frappe.client.insert",{method:"POST",headers:e,body:JSON.stringify({doc:{doctype:"Contacts",...t}})}),o=await n.json();if(!n.ok)throw new Error(l(o,"Failed to create contact"));return o.message}async function C(t,e){const n=await f(),o=await s("/api/method/frappe.client.set_value",{method:"POST",headers:n,body:JSON.stringify({doctype:"Contacts",name:t,fieldname:e})}),c=await o.json();if(!o.ok)throw new Error(l(c,"Failed to update contact"));return c.message}async function S(t){const e=await f(),n=await s("/api/method/frappe.client.delete",{method:"POST",headers:e,body:JSON.stringify({doctype:"Contacts",name:t})}),o=await n.json();if(!n.ok)throw new Error(l(o,"Failed to delete contact"));return o.message}async function O(){const t=await s("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Contacts");return t.ok?(await t.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}async function $(t){const e=await s(`/api/method/frappe.client.get?doctype=Contacts&name=${t}`);if(!e.ok)throw new Error("Failed to fetch contact details");return(await e.json()).message}export{$ as a,_ as c,S as d,u as f,O as g,C as u};
