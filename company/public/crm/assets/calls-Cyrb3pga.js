import{h as M,r as n,j as t,p as x,I as _,B as H,w as R}from"./index-Co7v2xsC.js";import{C as z}from"./config-global-BX9xwJzv.js";import{d as c}from"./dayjs.min-C2542nnJ.js";import{F as W,i as E,a as G,b as I}from"./index-DcBM0rMB.js";import{i as T}from"./index-BLaIkoYk.js";import{D as O,C as $}from"./Card-CDV3jV6O.js";import{f as N,u as g,d as B}from"./calls-Cmwi30yB.js";import{C as A}from"./confirm-dialog--19ddTk_.js";import{C as V}from"./call-dialog-CXUggpLW.js";import{C as L}from"./CardHeader-CmhzWAj1.js";import{S as P}from"./Snackbar-BVA3LOhi.js";import"./api-error-handler-CV6pRVHb.js";import"./utils-CQVN1UoU.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./string-DcbcEmw6.js";import"./leads-d5FzXGcx.js";import"./AdapterDayjs-BPhbSeWE.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Select-B1EkSlUY.js";import"./visuallyHidden-Dan1xhjv.js";import"./TextField-BmVWmDzd.js";import"./Chip-Rg4Dn3a5.js";import"./Stack-GQIY7Xk9.js";import"./Grid-BdmJn5bP.js";import"./Autocomplete-BIV6h0T7.js";import"./usePreviousProps-CVIlMhUg.js";import"./DateTimePicker-jnzvj6J0.js";import"./Tabs-oMX5aKw-.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./timeViewRenderers-BsmXZnvp.js";function U(){const r=M(),[f,y]=n.useState([]),[d,m]=n.useState(null),[b,s]=n.useState(!1),[C,h]=n.useState({open:!1,id:null}),[p,l]=n.useState({open:!1,message:"",severity:"success"}),i=n.useCallback(async(e,o)=>{try{const a=e==null?void 0:e.toISOString(),u=o==null?void 0:o.toISOString(),F=await N(a,u);y(F)}catch(a){console.error("Failed to load calls:",a)}},[]);n.useEffect(()=>{i()},[i]);const v=e=>{i(e.start,e.end)},D=e=>{const o=e.event.id,a=f.find(u=>u.name===o);a&&(m(a),s(!0))},S=()=>{m(null),s(!0)},w=async e=>{const{event:o}=e;try{await g(o.id,{call_start_time:c(o.start).format("YYYY-MM-DD HH:mm:ss"),call_end_time:o.end?c(o.end).format("YYYY-MM-DD HH:mm:ss"):void 0}),i()}catch(a){console.error("Failed to update call position:",a),l({open:!0,message:a.message||"Failed to update call position",severity:"error"}),e.revert()}},k=async e=>{const{event:o}=e;try{await g(o.id,{call_start_time:c(o.start).format("YYYY-MM-DD HH:mm:ss"),call_end_time:o.end?c(o.end).format("YYYY-MM-DD HH:mm:ss"):void 0}),i()}catch(a){console.error("Failed to update call duration:",a),l({open:!0,message:a.message||"Failed to update call duration",severity:"error"}),e.revert()}},j=async()=>{if(d)try{await B(d.name),s(!1),h({open:!1,id:null}),i(),l({open:!0,message:"Call deleted successfully",severity:"success"})}catch(e){console.error("Failed to delete call:",e),l({open:!0,message:e.message||"Failed to delete call",severity:"error"})}},Y=f.map(e=>({id:e.name,title:e.title||"Untitled Call",start:e.call_start_time,end:e.call_end_time,color:e.color||(e.outgoing_call_status==="Completed"?r.palette.success.main:r.palette.warning.main)}));return t.jsxs(O,{children:[t.jsxs($,{sx:{display:"flex",flexDirection:"column"},children:[t.jsx(L,{title:"Calls Calendar",subheader:"Manage your scheduled calls",action:t.jsx(x,{variant:"contained",onClick:S,startIcon:t.jsx(_,{icon:"mingcute:add-line"}),children:"New Call"}),sx:{mb:1}}),t.jsx(H,{sx:{p:3,pt:0,"& .fc":{"--fc-border-color":r.palette.divider,"--fc-daygrid-event-dot-width":"8px","--fc-list-event-dot-width":"10px","--fc-today-bg-color":r.palette.primary.lighter},"& .fc .fc-toolbar":{mb:3,gap:1.5,flexDirection:{xs:"column",md:"row"},"& .fc-toolbar-title":{fontSize:"1.25rem",fontWeight:700}},"& .fc .fc-button":{border:"none",py:"8px",px:"12px",borderRadius:"8px",fontSize:"0.875rem",fontWeight:600,textTransform:"capitalize",backgroundColor:r.palette.background.neutral,color:r.palette.text.primary,transition:r.transitions.create(["background-color","color","box-shadow"]),"&:hover":{backgroundColor:r.palette.action.hover},"&:focus":{boxShadow:"none"},"&.fc-button-active":{backgroundColor:"#08a3cd",color:r.palette.common.white,"&:hover":{backgroundColor:"#068eb1"}},"&.fc-today-button":{border:"1px solid #08a3cd","&:disabled":{opacity:.48}}},"& .fc .fc-col-header-cell":{py:1.5,backgroundColor:"#08a3cd",color:r.palette.common.white,"&:first-of-type":{borderTopLeftRadius:"12px"},"&:last-of-type":{borderTopRightRadius:"12px"},"& .fc-col-header-cell-cushion":{textDecoration:"none",fontSize:"0.875rem",fontWeight:700}},"& .fc-view-harness":{borderRadius:"12px",overflow:"hidden",border:`1px solid ${r.palette.divider}`},"& .fc-scrollgrid":{border:"none"},"& .fc .fc-daygrid-day":{"&:hover":{backgroundColor:r.palette.action.hover}},"& .fc .fc-daygrid-day-number":{p:1.5,fontSize:"0.875rem",fontWeight:600,color:r.palette.text.primary},"& .fc .fc-event":{border:"none",borderRadius:"6px",fontWeight:600,fontSize:"0.75rem",mx:"4px",my:"1px",p:"2px 4px",cursor:"pointer"},"& .fc .fc-daygrid-event":{boxShadow:"none"},"& .fc .fc-list":{border:"none","& .fc-list-day-cushion":{backgroundColor:r.palette.background.neutral}}},children:t.jsx(W,{plugins:[E,T,G,I],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:"dayGridMonth",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:3,weekends:!0,events:Y,datesSet:v,eventClick:D,eventDrop:w,eventResize:k,select:e=>{m(null),s(!0)},height:"auto",eventDisplay:"block",eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},views:{dayGridMonth:{titleFormat:{year:"numeric",month:"long"}},timeGridWeek:{titleFormat:{year:"numeric",month:"short",day:"numeric"}},timeGridDay:{titleFormat:{year:"numeric",month:"long",day:"numeric"}}}})})]}),t.jsx(V,{open:b,onClose:()=>s(!1),selectedCall:d,onSuccess:i}),t.jsx(A,{open:C.open,onClose:()=>h({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this call?",action:t.jsx(x,{onClick:j,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),t.jsx(P,{open:p.open,autoHideDuration:6e3,onClose:()=>l(e=>({...e,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:t.jsx(R,{onClose:()=>l(e=>({...e,open:!1})),severity:p.severity,sx:{width:"100%"},children:p.message})})]})}function Me(){return t.jsxs(t.Fragment,{children:[t.jsx("title",{children:`Calls - ${z.appName}`}),t.jsx(U,{})]})}export{Me as default};
