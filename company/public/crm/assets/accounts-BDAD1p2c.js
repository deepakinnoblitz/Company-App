import{j as e,B as h,d as Be,v as H,I as S,r as n,T as p,p as D,w as Ne,q as ke,x as jt,y as yt,S as Je}from"./index-Co7v2xsC.js";import{C as vt}from"./config-global-BX9xwJzv.js";import{y as Ct}from"./mui-tel-input.es-qb3PikOv.js";import{g as St}from"./error-handler-Bmy_4JQL.js";import{D as wt,C as It}from"./Card-CDV3jV6O.js";import{l as ue}from"./location_data-s7SeKs4x.js";import{g as kt,f as _t,A as Dt,d as Le,u as At,c as Ot}from"./account-details-dialog-Bj-gJsO-.js";import{E as Pt}from"./empty-content-BBDmaj4d.js";import{C as Ft}from"./confirm-dialog--19ddTk_.js";import{U as Nt,a as Wt,T as He,b as Tt}from"./user-table-toolbar-BXgkag6p.js";import{c as L,d as m,T as _e,a as De,b as Fe,e as Ae}from"./TableRow-DqeBPnxy.js";import{C as Et}from"./Checkbox-CoJXcvzD.js";import{g as Rt,a as Mt,u as zt,c as Bt,b as Ue,d as Ge,e as Lt,s as Ht,f as Ut,h as Gt}from"./data-import-KyR0bLZ-.js";import{F as $e,S as Ve}from"./Select-B1EkSlUY.js";import{S as ae}from"./Stack-GQIY7Xk9.js";import{T as N}from"./TextField-BmVWmDzd.js";import{D as qe,a as Ze}from"./DialogContent-DtP-sWqR.js";import{D as Qe}from"./DialogTitle-C3eBZids.js";import{S as $t,a as Vt,b as Jt}from"./Stepper-GJqW6VSQ.js";import{D as Ke}from"./DialogActions-h_2rRG3x.js";import{B as qt}from"./Badge-DIppMJwA.js";import{T as Zt}from"./TablePagination-CEaYVDlQ.js";import{S as Qt}from"./Snackbar-BVA3LOhi.js";import"./api-error-handler-CV6pRVHb.js";import"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function Kt({row:f,selected:M,onSelectRow:A,onView:d,onEdit:w,onDelete:b,canEdit:I=!0,canDelete:v=!0,hideCheckbox:g=!1,index:k}){return e.jsxs(L,{hover:!0,tabIndex:-1,role:"checkbox",selected:M,children:[!g&&e.jsx(m,{padding:"checkbox",children:e.jsx(Et,{disableRipple:!0,checked:M,onChange:A})}),typeof k=="number"&&e.jsx(m,{align:"center",children:e.jsx(h,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:c=>Be(c.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:c=>`1px solid ${Be(c.palette.primary.main,.16)}`,mx:"auto",transition:c=>c.transitions.create(["all"],{duration:c.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:k+1})}),e.jsx(m,{component:"th",scope:"row",children:e.jsx(h,{sx:{gap:2,display:"flex",alignItems:"center"},children:f.account_name})}),e.jsx(m,{children:f.phone_number}),e.jsx(m,{children:f.gstin}),e.jsx(m,{children:f.city}),e.jsx(m,{children:f.state}),e.jsx(m,{children:f.country}),e.jsx(m,{children:f.website}),e.jsx(m,{align:"right",children:e.jsxs(h,{sx:{display:"flex",justifyContent:"flex-end"},children:[I&&e.jsx(H,{onClick:w,sx:{color:"primary.main"},children:e.jsx(S,{icon:"solar:pen-bold"})}),v&&e.jsx(H,{onClick:b,sx:{color:"error.main"},children:e.jsx(S,{icon:"solar:trash-bin-trash-bold"})}),e.jsx(H,{onClick:d,sx:{color:"info.main"},children:e.jsx(S,{icon:"solar:eye-bold"})})]})})]})}const Xt=["Upload","Map Columns","Preview","Import"];function Yt({open:f,onClose:M,onRefresh:A}){const[d,w]=n.useState(0),[b,I]=n.useState(null),[v,g]=n.useState(!1),[k,c]=n.useState(""),[j,W]=n.useState(null),[l,z]=n.useState([]),[_,y]=n.useState({}),[T,he]=n.useState(null),[J,pe]=n.useState([]),[q,me]=n.useState(0),[oe,F]=n.useState(""),[U,O]=n.useState([]);n.useEffect(()=>{f&&Rt("Accounts").then(z).catch(console.error)},[f]);const Z=s=>{var a;(a=s.target.files)!=null&&a[0]&&(I(s.target.files[0]),F(""))},P=async()=>{if(b){g(!0);try{const s=await zt(b),a=await Bt({reference_doctype:"Accounts",import_file:s.file_url,import_type:"Insert New Records"});c(a.name);const o=await Ue(a.name);W(o);const i={};o.columns.forEach((u,C)=>{var je,se;if(u.header_title==="Sr. No")return;if((je=u.df)!=null&&je.fieldname){i[C]=u.df.fieldname;return}const E=(se=u.header_title)==null?void 0:se.trim().toLowerCase(),be=l.find(de=>{var B,ye,ne;return((B=de.label)==null?void 0:B.trim().toLowerCase())===E||((ye=de.fieldname)==null?void 0:ye.trim().toLowerCase())===E||((ne=de.fieldname)==null?void 0:ne.replace(/_/g," ").toLowerCase())===E});i[C]=be?be.fieldname:"Don't Import"}),y(i),w(1)}catch(s){F(s.message||"Upload failed")}finally{g(!1)}}},ie=async()=>{g(!0);try{const s={};Object.entries(_).forEach(([i,u])=>{const C=parseInt(i,10);C>0&&(s[C-1]=u==="Don't Import"?"__skip__":u)}),await Ge(k,{template_options:JSON.stringify({column_to_field_map:s})});const o=await Ue(k);W(o),O(o.data||[]),w(2)}catch(s){F(s.message||"Failed to save mapping")}finally{g(!1)}},Oe=async()=>{g(!0);try{const s={};Object.entries(_).forEach(([u,C])=>{const E=parseInt(u,10);E>0&&(s[E-1]=C==="Don't Import"?"__skip__":C)}),await Ge(k,{template_options:JSON.stringify({column_to_field_map:s})});const i=[j.columns.map(u=>u.header_title),...U];await Lt(k,i),await Ht(k),w(3),xe(k)}catch(s){F(s.message||"Failed to start import"),g(!1)}},xe=async s=>{const a=setInterval(async()=>{try{const o=await Ut(s);if(he(o),o.total_records>0){const i=(o.success||0)+(o.failed||0);me(i/o.total_records*100)}if(["Success","Partial Success","Error","Timed Out"].includes(o.status)){clearInterval(a),g(!1);const i=await Gt(s);pe(i),A()}}catch(o){console.error("Polling error:",o)}},2e3)},le=()=>{w(0),I(null),c(""),W(null),y({}),Q([]),he(null),pe([]),me(0),F(""),g(!1)},G=()=>{v||(le(),M())},[$,Q]=n.useState([]),ce=s=>{y({..._,[s]:"Don't Import"}),Q([...$,s])},K=()=>{Q([])},X=(s,a,o)=>{const i=[...U];i[s][a]=o,O(i)},Y=(s,a)=>{y({..._,[s]:a})},fe=e.jsxs(h,{sx:{py:4,display:"flex",flexFlow:"column",alignItems:"center"},children:[e.jsxs(h,{sx:{p:5,width:"100%",maxWidth:400,border:"2px dashed",borderColor:"divider",borderRadius:1.5,cursor:"pointer",bgcolor:"background.neutral",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:s=>s.transitions.create("opacity"),"&:hover":{opacity:.72},position:"relative",overflow:"hidden"},component:"label",children:[e.jsx("input",{type:"file",hidden:!0,accept:".csv, .xlsx",onChange:Z}),e.jsx(S,{icon:"solar:cloud-upload-bold-duotone",width:64,sx:{mb:2,color:"primary.main",position:"relative",zIndex:1}}),e.jsx(p,{variant:"h6",sx:{position:"relative",zIndex:1},children:b?b.name:"Select data file"}),e.jsx(p,{variant:"body2",sx:{color:"text.secondary",position:"relative",zIndex:1},children:"Drop file here or click to browse"})]}),e.jsx(D,{size:"small",color:"primary",startIcon:e.jsx(S,{icon:"solar:download-bold-duotone"}),onClick:()=>window.open(Mt("Accounts"),"_blank"),sx:{mt:2},children:"Download Sample Template"}),oe&&e.jsx(Ne,{severity:"error",sx:{mt:2,width:"100%",maxWidth:400},children:oe})]}),ee=e.jsxs(h,{children:[$.length>0&&e.jsx(h,{sx:{mb:1,display:"flex",justifyContent:"flex-end"},children:e.jsxs(D,{size:"small",variant:"text",onClick:K,startIcon:e.jsx(S,{icon:"solar:eye-bold"}),children:["Show ",$.length," skipped columns"]})}),e.jsx(_e,{sx:{mt:1,maxHeight:400},children:e.jsxs(De,{stickyHeader:!0,size:"small",children:[e.jsx(Fe,{children:e.jsxs(L,{children:[e.jsx(m,{children:"File Column"}),e.jsx(m,{children:"Account Field"})]})}),e.jsx(Ae,{children:j==null?void 0:j.columns.filter(s=>s.header_title!=="Sr. No").filter(s=>!$.includes(j.columns.indexOf(s))).map(s=>{var o,i;const a=j.columns.indexOf(s);return e.jsxs(L,{children:[e.jsxs(m,{children:[e.jsx(p,{variant:"subtitle2",children:s.header_title||`Column ${a+1}`}),e.jsxs(p,{variant:"caption",sx:{color:"text.secondary"},children:["Sample: ",((i=(o=j.data)==null?void 0:o[0])==null?void 0:i[a])||"N/A"]})]}),e.jsx(m,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{fullWidth:!0,size:"small",children:e.jsxs(Ve,{value:_[a]||"Don't Import",onChange:u=>y({..._,[a]:u.target.value}),children:[e.jsx(ke,{value:"Don't Import",children:"Don't Import"}),l.map(u=>e.jsxs(ke,{value:u.fieldname,children:[u.label," (",u.fieldname,")"]},u.fieldname))]})}),e.jsx(H,{size:"small",color:"error",onClick:()=>ce(a),children:e.jsx(S,{icon:"solar:trash-bin-trash-bold"})})]})})]},a)})})]})})]}),ge=e.jsxs(h,{sx:{mt:2},children:[(()=>{const s=((j==null?void 0:j.warnings)||[]).filter(a=>{var i;const o=((i=a.message)==null?void 0:i.toLowerCase())||"";return!(o.includes("__skip__")||a.type==="info"&&(o.includes("mapping column")||o.includes("cannot match column")||o.includes("with any field")))});return s.length===0?null:e.jsxs(ae,{spacing:1,sx:{mb:3},children:[e.jsxs(p,{variant:"subtitle1",color:"warning.main",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(S,{icon:"solar:danger-bold"})," Warnings (",s.length,")"]}),s.slice(0,5).map((a,o)=>e.jsxs(Ne,{severity:a.type==="info"?"info":"warning",sx:{py:0},children:[a.row?`Row ${a.row}: `:"",a.message.replace(/<[^>]*>?/gm,"")]},o)),s.length>5&&e.jsxs(p,{variant:"caption",children:["...and ",s.length-5," more warnings"]})]})})(),e.jsxs(p,{variant:"subtitle2",sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(S,{icon:"solar:table-split-bold-duotone",width:20}),"Data Preview & Mapping (Editable)"]}),e.jsx(_e,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:450,bgcolor:"background.paper",boxShadow:s=>s.customShadows.dropdown},children:e.jsxs(De,{size:"small",stickyHeader:!0,sx:{borderCollapse:"separate",borderSpacing:0},children:[e.jsx(Fe,{children:e.jsx(L,{children:j==null?void 0:j.columns.map((s,a)=>{if(s.header_title==="Sr. No")return null;const o=_[a]==="Don't Import";return e.jsxs(m,{sx:{whiteSpace:"nowrap",bgcolor:"background.neutral",borderRight:1,borderBottom:2,borderColor:"divider",p:1.5,opacity:o?.6:1,transition:i=>i.transitions.create("opacity"),minWidth:160},children:[e.jsx(p,{variant:"caption",sx:{fontWeight:"bold",display:"block",mb:1,color:o?"text.disabled":"text.primary",textTransform:"uppercase",letterSpacing:.5},children:s.header_title}),e.jsx($e,{fullWidth:!0,size:"small",children:e.jsxs(Ve,{value:_[a]||"Don't Import",onChange:i=>Y(a,i.target.value),sx:{height:32,fontSize:"0.75rem",bgcolor:o?"transparent":"background.paper","& .MuiOutlinedInput-notchedOutline":{borderColor:o?"transparent":"primary.light"}},children:[e.jsx(ke,{value:"Don't Import",sx:{color:"text.disabled",fontStyle:"italic"},children:"Don't Import"}),l.map(i=>e.jsx(ke,{value:i.fieldname,sx:{fontSize:"0.75rem"},children:i.label},i.fieldname))]})})]},a)})})}),e.jsx(Ae,{children:U.map((s,a)=>e.jsx(L,{sx:{"&:hover":{bgcolor:"action.hover"}},children:s.map((o,i)=>{if(i===0)return null;const u=_[i]==="Don't Import";return e.jsx(m,{sx:{p:0,borderRight:1,borderColor:"divider",bgcolor:u?"action.hover":"inherit",opacity:u?.5:1},children:e.jsx(N,{fullWidth:!0,size:"small",value:o||"",onChange:C=>X(a,i,C.target.value),variant:"standard",slotProps:{input:{disableUnderline:!0,sx:{fontSize:"0.875rem",px:1.5,py:1,height:"100%","&:focus-within":{bgcolor:"background.paper",boxShadow:C=>`inset 0 0 0 2px ${C.palette.primary.main}`}}}}})},i)})},a))})]})})]}),te=e.jsx(h,{sx:{py:4},children:e.jsxs(ae,{spacing:3,children:[e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(p,{variant:"subtitle1",children:"Importing..."}),e.jsxs(p,{variant:"body2",children:[Math.round(q),"%"]})]}),e.jsx(jt,{variant:"determinate",value:q,sx:{height:10,borderRadius:5}})]}),T&&e.jsxs(h,{sx:{p:2,bgcolor:"background.neutral",borderRadius:1,display:"flex",gap:4},children:[e.jsxs(h,{children:[e.jsx(p,{variant:"caption",display:"block",color:"text.secondary",children:"Total"}),e.jsx(p,{variant:"h6",children:T.total_records})]}),e.jsxs(h,{children:[e.jsx(p,{variant:"caption",display:"block",color:"success.main",children:"Success"}),e.jsx(p,{variant:"h6",color:"success.main",children:T.success||0})]}),e.jsxs(h,{children:[e.jsx(p,{variant:"caption",display:"block",color:"error.main",children:"Failed"}),e.jsx(p,{variant:"h6",color:"error.main",children:T.failed||0})]})]}),J.length>0&&e.jsxs(h,{children:[e.jsx(p,{variant:"subtitle2",sx:{mb:1},children:"Detailed Error Logs"}),e.jsx(_e,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:300},children:e.jsxs(De,{size:"small",stickyHeader:!0,children:[e.jsx(Fe,{children:e.jsxs(L,{children:[e.jsx(m,{children:"Row(s)"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Message / Exception"})]})}),e.jsx(Ae,{children:J.map((s,a)=>e.jsxs(L,{children:[e.jsx(m,{children:JSON.parse(s.row_indexes).join(", ")}),e.jsx(m,{children:e.jsx(S,{icon:s.success?"solar:check-circle-bold":"solar:close-circle-bold",color:s.success?"success.main":"error.main"})}),e.jsx(m,{sx:{fontSize:"0.75rem",maxWidth:400},children:s.success?`Created: ${s.docname}`:e.jsx(h,{children:e.jsx(p,{variant:"caption",color:"error",component:"pre",sx:{whiteSpace:"pre-wrap",fontFamily:"monospace"},children:s.messages!=="[]"?JSON.parse(s.messages).join(`
`):s.exception})})})]},a))})]})})]})]})});return e.jsxs(qe,{open:f,onClose:G,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Qe,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Import Accounts",e.jsx(H,{onClick:G,disabled:v,children:e.jsx(S,{icon:"mingcute:close-line"})})]}),e.jsxs(Ze,{dividers:!0,sx:{pb:4},children:[e.jsx($t,{activeStep:d,sx:{py:2},children:Xt.map(s=>e.jsx(Vt,{children:e.jsx(Jt,{children:s})},s))}),d===0&&fe,d===1&&ee,d===2&&ge,d===3&&te]}),e.jsxs(Ke,{sx:{p:2},children:[d>0&&d<3&&e.jsx(D,{variant:"outlined",onClick:()=>w(d-1),disabled:v,children:"Back"}),e.jsx(h,{sx:{flexGrow:1}}),d===0&&e.jsx(D,{variant:"contained",onClick:P,disabled:!b||v,children:v?"Processing...":"Next: Mapping"}),d===1&&e.jsx(D,{variant:"contained",onClick:ie,disabled:v,children:v?"Saving...":"Next: Preview"}),d===2&&e.jsx(D,{variant:"contained",onClick:Oe,disabled:v,children:"Start Import"}),d===3&&!v&&e.jsx(D,{variant:"contained",onClick:G,children:"Finish"})]})]})}function es({open:f,onOpen:M,onClose:A,filters:d,onFilters:w,canReset:b,onResetFilters:I,options:v}){const g=(l,z)=>{w(l==="country"?{[l]:z,state:"all",city:"all"}:l==="state"?{[l]:z,city:"all"}:{[l]:z})},k=e.jsxs(h,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(p,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(H,{onClick:I,disabled:!b,sx:{mr:.5,color:b?"primary.main":"text.disabled","&:hover":{bgcolor:b?"primary.lighter":"transparent"}},children:e.jsx(qt,{color:"error",variant:"dot",invisible:!b,children:e.jsx(S,{icon:"solar:restart-bold",width:20})})}),e.jsx(H,{onClick:A,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(S,{icon:"mingcute:close-line",width:20})})]}),c=e.jsxs(ae,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Country"}),e.jsxs(N,{select:!0,fullWidth:!0,value:d.country,onChange:l=>g("country",l.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Countries"}),v.countries.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),j=e.jsxs(ae,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"State"}),e.jsxs(N,{select:!0,fullWidth:!0,value:d.state,onChange:l=>g("state",l.target.value),SelectProps:{native:!0},size:"small",disabled:!d.country||d.country==="all",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:!d.country||d.country==="all"?"Select Country First":"All States"}),v.states.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),W=e.jsxs(ae,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"City"}),e.jsxs(N,{select:!0,fullWidth:!0,value:d.city,onChange:l=>g("city",l.target.value),SelectProps:{native:!0},size:"small",disabled:!d.state||d.state==="all",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:!d.state||d.state==="all"?"Select State First":"All Cities"}),v.cities.map(l=>e.jsx("option",{value:l,children:l},l))]})]});return e.jsxs(yt,{anchor:"right",open:f,onClose:A,slotProps:{paper:{sx:{width:340,boxShadow:l=>l.customShadows.z24}}},sx:{zIndex:l=>l.zIndex.drawer+100},children:[k,e.jsx(Je,{children:e.jsxs(ae,{spacing:3,sx:{p:3},children:[c,j,W]})}),e.jsx(h,{sx:{p:2.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.neutral"},children:e.jsx(D,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(S,{icon:"solar:trash-bin-trash-bold"}),onClick:I,disabled:!b,sx:{borderRadius:1.5,borderColor:"divider",fontWeight:600,"&:hover":{borderColor:"error.main",color:"error.main",bgcolor:"error.lighter"},"&.Mui-disabled":{borderColor:"divider"}},children:"Clear All Filters"})})]})}function ts(){const[f,M]=n.useState([]),[A,d]=n.useState(!1),[w,b]=n.useState(0),[I,v]=n.useState(5),[g,k]=n.useState(""),[c,j]=n.useState({country:"all",state:"all",city:"all"}),[W,l]=n.useState("modified_desc"),[z,_]=n.useState(0),[y,T]=n.useState([]),[he,J]=n.useState(!1),[pe,q]=n.useState(!1),[me,oe]=n.useState(!1),[F,U]=n.useState(!1),[O,Z]=n.useState(null),[P,ie]=n.useState(!1),[Oe,xe]=n.useState(!1),[le,G]=n.useState({open:!1,id:null}),[$,Q]=n.useState(!1),[ce,K]=n.useState(""),[X,Y]=n.useState(""),[fe,ee]=n.useState(""),[ge,te]=n.useState(""),[s,a]=n.useState(""),[o,i]=n.useState(""),[u,C]=n.useState(""),[E,be]=n.useState([]),[je,se]=n.useState([]),[de,B]=n.useState([]),[ye,ne]=n.useState([]),[Xe,ve]=n.useState([]),[Ce,Ye]=n.useState({read:!1,write:!1,delete:!1}),[Se,R]=n.useState({open:!1,message:"",severity:"success"}),[We,V]=n.useState({}),Te=n.useCallback(async()=>{try{const t=await kt();Ye(t)}catch(t){console.error("Failed to load permissions",t)}},[]),re=n.useCallback(async()=>{d(!0);try{const t=await _t({page:w+1,page_size:I,search:g,filterValues:c,sort_by:W});M(t.data||[]),_(t.total||0)}catch(t){console.error("Failed to fetch accounts",t),M([]),_(0)}finally{d(!1)}},[w,I,g,c,W]),et=t=>{j(r=>({...r,...t})),b(0)},tt=()=>{j({country:"all",state:"all",city:"all"}),b(0)},we=c.country!=="all"||c.state!=="all"||c.city!=="all";n.useEffect(()=>{Te()},[Te]),n.useEffect(()=>{re()},[re]),n.useEffect(()=>{const t=Array.from(new Set(ue.map(r=>r.country)));be(["",...t])},[]),n.useEffect(()=>{if(s){const t=ue.find(r=>r.country===s);if(t){const r=t.states.map(x=>x.name);se(["",...r,"Others"])}else se([])}else se([]),B([])},[s]),n.useEffect(()=>{if(o&&s)if(o==="Others")B(["Others"]);else{const t=ue.find(r=>r.country===s);if(t){const r=t.states.find(x=>x.name===o);B(r?["",...r.cities,"Others"]:["Others"])}}else B([])},[o,s]),n.useEffect(()=>{if(c.country&&c.country!=="all"){const t=ue.find(r=>r.country===c.country);if(t){const r=t.states.map(x=>x.name);ne([...r,"Others"])}else ne([])}else ne([])},[c.country]),n.useEffect(()=>{if(c.state&&c.state!=="all"&&c.country&&c.country!=="all")if(c.state==="Others")ve(["Others"]);else{const t=ue.find(r=>r.country===c.country);if(t){const r=t.states.find(x=>x.name===c.state);ve(r?[...r.cities,"Others"]:["Others"])}}else ve([])},[c.state,c.country]);const st=()=>{U(!1),ie(!1),Z(null),K(""),Y(""),ee(""),te(""),a(""),i(""),C(""),V({}),q(!0)},Pe=()=>{q(!1),V({}),U(!1),ie(!1),Z(null),K(""),Y(""),ee(""),te(""),a(""),i(""),C("")},nt=()=>{oe(!0)},rt=()=>{oe(!1)},Ee=()=>{R({...Se,open:!1})},at=n.useCallback(t=>{G({open:!0,id:t})},[]),ot=async()=>{if(le.id)try{await Le(le.id),R({open:!0,message:"Account deleted successfully",severity:"success"}),re()}catch(t){R({open:!0,message:t.message||"Failed to delete account",severity:"error"})}finally{G({open:!1,id:null})}},it=async()=>{try{await Promise.all(y.map(t=>Le(t))),R({open:!0,message:`${y.length} accounts deleted successfully`,severity:"success"}),T([]),re()}catch(t){R({open:!0,message:t.message||"Error during bulk delete",severity:"error"})}},lt=(t,r)=>{if(t){T(r);return}T([])},ct=t=>{const r=y.indexOf(t);let x=[];r===-1?x=x.concat(y,t):r===0?x=x.concat(y.slice(1)):r===y.length-1?x=x.concat(y.slice(0,-1)):r>0&&(x=x.concat(y.slice(0,r),y.slice(r+1))),T(x)},dt=async()=>{const t={},r=[];if(ce||(t.accountName=!0,r.push("Account Name")),X||(t.phoneNumber=!0,r.push("Phone Number")),Object.keys(t).length>0){V(t),R({open:!0,message:`Please fill in mandatory fields: ${r.join(", ")}`,severity:"error"});return}V({});let x=X.replace(/\s/g,"");const Ie=X.trim().split(/\s+/);Ie.length>1&&Ie[0].startsWith("+")&&(x=`${Ie[0]}-${Ie.slice(1).join("")}`);const ze={account_name:ce,phone_number:x,website:fe,gstin:ge,country:s,state:o,city:u};try{Q(!0),F&&O?(await At(O.name,ze),R({open:!0,message:"Account updated successfully",severity:"success"})):(await Ot(ze),R({open:!0,message:"Account created successfully",severity:"success"})),Pe(),re()}catch(gt){const bt=St(gt);R({open:!0,message:bt,severity:"error"})}finally{Q(!1)}},ut=t=>t?t.startsWith("+")&&t.includes("-")?t.replace("-"," "):t:"",Re=n.useCallback(t=>{const r=f.find(x=>x.name===t);r&&(Z(r),V({}),K(r.account_name||""),Y(ut(r.phone_number||"")),ee(r.website||""),te(r.gstin||""),a(r.country||""),i(r.state||""),C(r.city||""),U(!0),ie(!1),q(!0))},[f]),ht=n.useCallback(t=>{Z(t),xe(!0)},[]),pt=(t,r)=>{b(r)},mt=t=>{v(parseInt(t.target.value,10)),b(0)},xt=t=>{k(t.target.value),b(0)},ft=!A&&!f.length&&(!!g||we),Me=!A&&!f.length&&!g&&!we;return e.jsxs(wt,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(p,{variant:"h4",flexGrow:1,children:"Accounts"}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[Ce.write&&e.jsx(D,{variant:"outlined",startIcon:e.jsx(S,{icon:"solar:import-bold-duotone"}),onClick:nt,sx:{color:"#08a3cd",borderColor:"#08a3cd","&:hover":{borderColor:"#068fb3",bgcolor:"rgba(8, 163, 205, 0.04)"}},children:"Import"}),Ce.write&&e.jsx(D,{variant:"contained",startIcon:e.jsx(S,{icon:"mingcute:add-line"}),onClick:st,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Account"})]})]}),e.jsxs(It,{children:[e.jsx(Nt,{numSelected:y.length,filterName:g,onFilterName:xt,searchPlaceholder:"Search accounts...",onOpenFilter:()=>J(!0),canReset:we,sortBy:W,onSortChange:l,onDelete:it,sortOptions:[{value:"modified_desc",label:"Newest First"},{value:"modified_asc",label:"Oldest First"},{value:"account_name_asc",label:"Account Name: A to Z"},{value:"account_name_desc",label:"Account Name: Z to A"}]}),e.jsx(Je,{children:e.jsx(_e,{sx:{overflow:"unset"},children:e.jsxs(De,{sx:{minWidth:800},children:[e.jsx(Wt,{rowCount:z,numSelected:y.length,onSelectAllRows:t=>lt(t,f.map(r=>r.name)),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"account_name",label:"Account Name"},{id:"phone_number",label:"Phone Number"},{id:"gstin",label:"GSTIN"},{id:"city",label:"City"},{id:"state",label:"State"},{id:"country",label:"Country"},{id:"website",label:"Website"},{id:"",label:""}]}),e.jsxs(Ae,{children:[A&&e.jsx(He,{height:68,emptyRows:I}),!A&&f.map((t,r)=>e.jsx(Kt,{index:w*I+r,hideCheckbox:!0,row:{id:t.name,account_name:t.account_name,phone_number:t.phone_number,website:t.website,gstin:t.gstin,city:t.city,state:t.state,country:t.country},selected:y.includes(t.name),onSelectRow:()=>ct(t.name),onView:()=>ht(t),onEdit:()=>Re(t.name),onDelete:()=>at(t.name),canEdit:Ce.write,canDelete:Ce.delete},t.name)),ft&&e.jsx(Tt,{searchQuery:g}),Me&&e.jsx(L,{children:e.jsx(m,{colSpan:8,children:e.jsx(Pt,{title:"No accounts found",description:"Create a new account to manage your business relationships.",icon:"solar:buildings-bold-duotone"})})}),!Me&&e.jsx(He,{height:68,emptyRows:Math.max(0,I-f.length)})]})]})})}),e.jsx(Zt,{component:"div",page:w,count:z,rowsPerPage:I,onPageChange:pt,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:mt})]}),e.jsx(es,{open:he,onOpen:()=>J(!0),onClose:()=>J(!1),filters:c,onFilters:et,canReset:we,onResetFilters:tt,options:{countries:E.filter(t=>t!==""),states:ye,cities:Xe}}),e.jsxs(qe,{open:pe,onClose:Pe,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(Qe,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[P?"Account Details":F?"Edit Account":"New Account",e.jsx(H,{"aria-label":"close",onClick:Pe,sx:{color:t=>t.palette.grey[500]},children:e.jsx(S,{icon:"mingcute:close-line"})})]}),e.jsx(Ze,{dividers:!0,children:e.jsxs(h,{sx:{display:"grid",margin:"1rem",columnGap:2,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(N,{fullWidth:!0,label:"Account Name",name:"account_name",value:ce,onChange:t=>{K(t.target.value),t.target.value&&V(r=>({...r,accountName:!1}))},required:!0,error:!!We.accountName,disabled:P,placeholder:"e.g. Acme Corp"}),e.jsx(Ct,{fullWidth:!0,defaultCountry:"IN",label:"Phone Number",name:"phone_number",value:X,disabled:P,onChange:t=>{Y(t),t&&V(r=>({...r,phoneNumber:!1}))},required:!0,error:!!We.phoneNumber,sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"inherit",color:"inherit"}}}),e.jsx(N,{fullWidth:!0,label:"GSTIN",name:"gstin",value:ge,onChange:t=>te(t.target.value),disabled:P,placeholder:"e.g. 22AAAAA0000A1Z5"}),e.jsxs(N,{select:!0,fullWidth:!0,label:"Country",name:"country",value:s,onChange:t=>a(t.target.value),disabled:P,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"inherit",color:"inherit"}},children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),E.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(N,{select:!0,fullWidth:!0,label:"State",name:"state",value:o,onChange:t=>i(t.target.value),disabled:P||!s,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"inherit",color:"inherit"}},children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),je.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(N,{select:!0,fullWidth:!0,label:"City",name:"city",value:u,onChange:t=>C(t.target.value),disabled:P||!o,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"inherit",color:"inherit"}},children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),de.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(N,{fullWidth:!0,label:"Website",name:"website",value:fe,onChange:t=>ee(t.target.value),disabled:P,placeholder:"e.g. https://www.acme.com",sx:{gridColumn:{sm:"span 2"}}})]})}),e.jsx(Ke,{children:!P&&e.jsx(D,{variant:"contained",onClick:dt,disabled:$,children:$?F?"Updating...":"Creating...":F?"Update":"Create"})})]}),e.jsx(Qt,{open:Se.open,autoHideDuration:6e3,onClose:Ee,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ne,{onClose:Ee,severity:Se.severity,sx:{width:"100%"},children:Se.message})}),e.jsx(Yt,{open:me,onClose:rt,onRefresh:re}),e.jsx(Dt,{open:Oe,onClose:()=>{xe(!1)},accountId:O==null?void 0:O.name,onEdit:()=>Re(O==null?void 0:O.name)}),e.jsx(Ft,{open:le.open,onClose:()=>G({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this account?",action:e.jsx(D,{variant:"contained",color:"error",onClick:ot,sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function Ns(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Accounts - ${vt.appName}`}),e.jsx(ts,{})]})}export{Ns as default};
