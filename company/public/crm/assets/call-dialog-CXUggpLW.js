import{r as c,j as a,B as d,T as x,v as Y,I as $,q as m,p as D,w as H}from"./index-Co7v2xsC.js";import{d as A}from"./dayjs.min-C2542nnJ.js";import{s as B}from"./string-DcbcEmw6.js";import{getDoctypeList as g}from"./leads-d5FzXGcx.js";import{u as M,c as P}from"./calls-Cmwi30yB.js";import{D as R,a as G}from"./DialogContent-DtP-sWqR.js";import{D as N}from"./DialogTitle-C3eBZids.js";import{L as q,A as J}from"./AdapterDayjs-BPhbSeWE.js";import{S as L}from"./Stack-GQIY7Xk9.js";import{T as o}from"./TextField-BmVWmDzd.js";import{G as r}from"./Grid-BdmJn5bP.js";import{F as T,a as I,S as W}from"./Select-B1EkSlUY.js";import{A as j}from"./Autocomplete-BIV6h0T7.js";import{D as k}from"./DateTimePicker-jnzvj6J0.js";import{D as K}from"./DialogActions-h_2rRG3x.js";import{S as Q}from"./Snackbar-BVA3LOhi.js";const v={title:"",call_purpose:"",call_agenda:"",call_for:"Lead",outgoing_call_status:"Scheduled",call_start_time:"",call_end_time:"",lead_name:""};function me({open:_,onClose:u,selectedCall:n,initialData:h,onSuccess:b}){const[t,s]=c.useState(v),[p,f]=c.useState({open:!1,message:"",severity:"success"}),[y,O]=c.useState([]),[S,z]=c.useState([]),[C,E]=c.useState([]);c.useEffect(()=>{_&&(g("Lead",["name","lead_name","converted_contact","converted_account"]).then(O),g("Contacts",["name","first_name","last_name"]).then(z),g("Accounts",["name","account_name"]).then(E))},[_]),c.useEffect(()=>{var e;s(n?{title:n.title,call_purpose:n.call_purpose||"",call_agenda:B(n.call_agenda||""),call_for:n.call_for||"Lead",outgoing_call_status:n.outgoing_call_status||"Scheduled",call_start_time:n.call_start_time.replace(" ","T"),call_end_time:((e=n.call_end_time)==null?void 0:e.replace(" ","T"))||"",lead_name:n.lead_name||"",contact_name:n.contact_name||"",account_name:n.account_name||""}:h?{...v,...h}:v)},[n,h,_]);const F=async()=>{var e,l;try{const i={...t,call_start_time:(e=t.call_start_time)==null?void 0:e.replace("T"," "),call_end_time:((l=t.call_end_time)==null?void 0:l.replace("T"," "))||void 0};n?await M(n.name,i):await P(i),u(),b&&b()}catch(i){console.error("Failed to save call:",i),f({open:!0,message:i.message||"Failed to save call",severity:"error"})}};return a.jsxs(a.Fragment,{children:[a.jsxs(R,{open:_,onClose:u,fullWidth:!0,maxWidth:"sm",children:[a.jsxs(N,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(d,{sx:{display:"flex",alignItems:"center",gap:1.5},children:a.jsx(x,{variant:"h6",sx:{fontWeight:700},children:n?"Edit Call":"New Call"})}),a.jsx(Y,{onClick:u,sx:{color:"text.secondary"},children:a.jsx($,{icon:"mingcute:close-line"})})]}),a.jsx(G,{dividers:!0,sx:{borderBottom:"none",px:3,pb:0},children:a.jsx(q,{dateAdapter:J,children:a.jsxs(d,{sx:{py:2,display:"flex",flexDirection:"column",gap:4},children:[a.jsxs(d,{children:[a.jsx(x,{variant:"overline",sx:{color:"text.secondary",fontWeight:700,mb:2,display:"block"},children:"General Information"}),a.jsxs(L,{spacing:2.5,children:[a.jsx(o,{fullWidth:!0,label:"Title",placeholder:"Enter call title",value:t.title,onChange:e=>s({...t,title:e.target.value})}),a.jsxs(r,{container:!0,spacing:2,children:[a.jsx(r,{size:{xs:12,md:6},children:a.jsxs(T,{fullWidth:!0,children:[a.jsx(I,{children:"Call For"}),a.jsxs(W,{label:"Call For",value:t.call_for,onChange:e=>s({...t,call_for:e.target.value,lead_name:"",contact_name:"",account_name:""}),children:[a.jsx(m,{value:"Lead",children:"Lead"}),a.jsx(m,{value:"Contact",children:"Contact"}),a.jsx(m,{value:"Accounts",children:"Accounts"})]})]})}),t.call_for==="Lead"&&a.jsx(r,{size:{xs:12,md:6},children:a.jsx(j,{fullWidth:!0,options:y,getOptionLabel:e=>typeof e=="string"?e:`${e.lead_name} (${e.name})`,value:y.find(e=>e.name===t.lead_name)||null,onChange:(e,l)=>{s({...t,lead_name:(l==null?void 0:l.name)||"",contact_name:(l==null?void 0:l.converted_contact)||"",account_name:(l==null?void 0:l.converted_account)||""})},renderInput:e=>a.jsx(o,{...e,label:"Select Lead"})})}),t.call_for==="Contact"&&a.jsx(r,{size:{xs:12,md:6},children:a.jsx(j,{fullWidth:!0,options:S,getOptionLabel:e=>typeof e=="string"?e:`${e.first_name||""} ${e.last_name||""} (${e.name})`.trim(),value:S.find(e=>e.name===t.contact_name)||null,onChange:(e,l)=>s({...t,contact_name:(l==null?void 0:l.name)||""}),renderInput:e=>a.jsx(o,{...e,label:"Select Contact"})})}),t.call_for==="Accounts"&&a.jsx(r,{size:{xs:12,md:6},children:a.jsx(j,{fullWidth:!0,options:C,getOptionLabel:e=>typeof e=="string"?e:`${e.account_name} (${e.name})`,value:C.find(e=>e.name===t.account_name)||null,onChange:(e,l)=>s({...t,account_name:(l==null?void 0:l.name)||""}),renderInput:e=>a.jsx(o,{...e,label:"Select Account"})})}),a.jsx(r,{size:{xs:12},children:a.jsxs(T,{fullWidth:!0,children:[a.jsx(I,{children:"Status"}),a.jsxs(W,{label:"Status",value:t.outgoing_call_status,onChange:e=>s({...t,outgoing_call_status:e.target.value}),children:[a.jsx(m,{value:"Scheduled",children:"Scheduled"}),a.jsx(m,{value:"Completed",children:"Completed"})]})]})})]})]})]}),a.jsxs(d,{children:[a.jsx(x,{variant:"overline",sx:{color:"text.secondary",fontWeight:700,mb:2,display:"block"},children:"Time Schedule"}),a.jsxs(r,{container:!0,spacing:2,children:[a.jsx(r,{size:{xs:12,md:6},children:a.jsx(k,{label:"Start Time",value:t.call_start_time?A(t.call_start_time):null,onChange:e=>s({...t,call_start_time:e?e.format("YYYY-MM-DD HH:mm:ss"):""})})}),a.jsx(r,{size:{xs:12,md:6},children:a.jsx(k,{label:"End Time",value:t.call_end_time?A(t.call_end_time):null,onChange:e=>s({...t,call_end_time:e?e.format("YYYY-MM-DD HH:mm:ss"):""})})})]})]}),a.jsxs(d,{children:[a.jsx(x,{variant:"overline",sx:{color:"text.secondary",fontWeight:700,mb:2,display:"block"},children:"Details & Agenda"}),a.jsxs(L,{spacing:2.5,children:[a.jsx(o,{fullWidth:!0,label:"Purpose",placeholder:"Reason for the call",value:t.call_purpose,onChange:e=>s({...t,call_purpose:e.target.value})}),a.jsx(o,{fullWidth:!0,multiline:!0,rows:4,label:"Agenda",placeholder:"Points to discuss...",value:t.call_agenda,onChange:e=>s({...t,call_agenda:e.target.value})})]})]})]})})}),a.jsxs(K,{sx:{p:3,pt:2,gap:1.5},children:[a.jsx(D,{color:"inherit",variant:"outlined",onClick:u,sx:{borderRadius:1},children:"Cancel"}),a.jsx(D,{variant:"contained",color:"info",onClick:F,sx:{borderRadius:1,px:3},children:n?"Save Changes":"Create Call"})]})]}),a.jsx(Q,{open:p.open,autoHideDuration:6e3,onClose:()=>f(e=>({...e,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:a.jsx(H,{onClose:()=>f(e=>({...e,open:!1})),severity:p.severity,sx:{width:"100%"},children:p.message})})]})}export{me as C};
