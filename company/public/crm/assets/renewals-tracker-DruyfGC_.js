import{f as C,H as te,r as s,j as e,B as o,d as xe,v as D,I as b,T as m,S as we,D as pe,p as I,q as _,w as qe}from"./index-Co7v2xsC.js";import{d as ge}from"./dayjs.min-C2542nnJ.js";import{h as ae}from"./api-error-handler-CV6pRVHb.js";import{D as ze,C as Ge}from"./Card-CDV3jV6O.js";import{E as Qe}from"./empty-content-BBDmaj4d.js";import{C as Ve}from"./confirm-dialog--19ddTk_.js";import{U as Ke,a as Xe,b as Ze,T as et}from"./user-table-toolbar-BXgkag6p.js";import{L as ve}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as Se,d as y,T as tt,a as at,e as rt}from"./TableRow-DqeBPnxy.js";import{C as st}from"./Checkbox-CoJXcvzD.js";import{S as fe}from"./Stack-GQIY7Xk9.js";import{D as Ce,a as Re}from"./DialogContent-DtP-sWqR.js";import{D as ke}from"./DialogTitle-C3eBZids.js";import{T as nt}from"./TablePagination-CEaYVDlQ.js";import{T as E}from"./TextField-BmVWmDzd.js";import{F as X,a as Z,S as ee}from"./Select-B1EkSlUY.js";import{L as ot,A as lt}from"./AdapterDayjs-BPhbSeWE.js";import{D as je}from"./DatePicker-BMZY9CMK.js";import{D as it}from"./DialogActions-h_2rRG3x.js";import{S as ct}from"./Snackbar-BVA3LOhi.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";async function dt(r){const n=[];r.search&&n.push(["Renewal Tracker","item_name","like",`%${r.search}%`]);const a=r.orderBy&&r.order?`${r.orderBy} ${r.order}`:"renewal_date desc",l=new URLSearchParams({doctype:"Renewal Tracker",fields:JSON.stringify(["*"]),filters:JSON.stringify(n),limit_start:String((r.page-1)*r.page_size),limit_page_length:String(r.page_size),order_by:a}),[d,p]=await Promise.all([C(`/api/method/frappe.client.get_list?${l.toString()}`),C(`/api/method/frappe.client.get_count?doctype=Renewal Tracker&filters=${encodeURIComponent(JSON.stringify(n))}`)]);if(!d.ok)throw new Error("Failed to fetch renewals");const h=await d.json(),f=await p.json();return{data:h.message||[],total:f.message||0}}const ut=r=>dt(r);async function mt(r){const n=await te(),a=await C("/api/method/frappe.client.insert",{method:"POST",headers:n,body:JSON.stringify({doc:{doctype:"Renewal Tracker",...r}})});if(!a.ok){const l=await a.json();throw new Error(ae(l,"Failed to create renewal"))}return(await a.json()).message}async function ht(r,n){const a=await te(),l=await C("/api/method/frappe.client.set_value",{method:"POST",headers:a,body:JSON.stringify({doctype:"Renewal Tracker",name:r,fieldname:n})});if(!l.ok){const d=await l.json();throw new Error(ae(d,"Failed to update renewal"))}return(await l.json()).message}async function ye(r){const n=await te(),a=await C("/api/method/frappe.client.delete",{method:"POST",headers:n,body:JSON.stringify({doctype:"Renewal Tracker",name:r})});if(!a.ok){const l=await a.json();throw new Error(ae(l,"Failed to delete renewal"))}return!0}async function be(r){const n=await C(`/api/method/frappe.client.get?doctype=Renewal Tracker&name=${encodeURIComponent(r)}`);if(!n.ok)throw new Error("Failed to fetch renewal details");return(await n.json()).message}async function xt(){const r=await C("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Renewal Tracker");return r.ok?(await r.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}function pt(r,n,a,l,d){const[p,h]=s.useState([]),[f,S]=s.useState(0),[R,x]=s.useState(!0),[j,c]=s.useState(null),k=s.useCallback(async()=>{x(!0);try{const w=await ut({page:r,page_size:n,search:a,order_by:l,order:d});h(w.data),S(w.total),c(null)}catch(w){c(w)}finally{x(!1)}},[r,n,a,l,d]);return s.useEffect(()=>{k()},[k]),{data:p,total:f,loading:R,error:j,refetch:k}}function gt({row:r,selected:n,onSelectRow:a,onView:l,onEdit:d,onDelete:p,canEdit:h,canDelete:f,hideCheckbox:S=!1,index:R}){var j;const x=c=>{switch(c){case"Active":return"success";case"Expired":return"error";case"Pending":return"warning";default:return"default"}};return e.jsxs(Se,{hover:!0,selected:n,children:[!S&&e.jsx(y,{padding:"checkbox",children:e.jsx(st,{checked:n,onClick:a})}),typeof R=="number"&&e.jsx(y,{align:"center",children:e.jsx(o,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:c=>xe(c.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:c=>`1px solid ${xe(c.palette.primary.main,.16)}`,mx:"auto",transition:c=>c.transitions.create(["all"],{duration:c.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:R+1})}),e.jsx(y,{children:e.jsx(o,{onClick:l,sx:{color:"primary.main",fontWeight:600,cursor:"pointer","&:hover":{textDecoration:"underline"}},children:r.item_name})}),e.jsx(y,{children:r.category}),e.jsx(y,{children:r.renewal_date?new Date(r.renewal_date).toLocaleDateString():"-"}),e.jsxs(y,{align:"right",children:["₹",((j=r.amount)==null?void 0:j.toLocaleString())||0]}),e.jsx(y,{align:"center",children:e.jsx(ve,{variant:"soft",color:x(r.status),children:r.status})}),e.jsx(y,{align:"right",children:e.jsxs(o,{sx:{display:"flex",justifyContent:"flex-end",gap:.5,alignItems:"center"},children:[e.jsx(D,{onClick:l,sx:{color:"info.main"},children:e.jsx(b,{icon:"solar:eye-bold"})}),h&&e.jsx(D,{onClick:d,sx:{color:"primary.main"},children:e.jsx(b,{icon:"solar:pen-bold"})}),f&&e.jsx(D,{onClick:p,sx:{color:"error.main"},children:e.jsx(b,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function ft({open:r,onClose:n,renewal:a}){var p,h;if(!a)return null;const l=f=>{switch(f){case"Active":return"success";case"Expired":return"error";case"Pending":return"warning";default:return"default"}},d=e.jsxs(o,{sx:{p:3,display:"flex",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(o,{sx:{width:64,height:64,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.lighter",color:"primary.main",mr:3},children:e.jsx(b,{icon:"solar:restart-bold-duotone",width:32})}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(m,{variant:"h6",children:a.item_name}),e.jsxs(m,{variant:"body2",sx:{color:"text.secondary"},children:[a.category," • ",a.vendor||"Unknown Vendor"]})]}),e.jsxs(fe,{spacing:1,alignItems:"flex-end",children:[e.jsxs(m,{variant:"h5",sx:{color:"primary.main",fontWeight:700},children:["₹",((p=a.amount)==null?void 0:p.toLocaleString())||0]}),e.jsx(ve,{variant:"soft",color:l(a.status),children:a.status})]})]});return e.jsxs(Ce,{open:r,onClose:n,fullWidth:!0,maxWidth:"md",children:[e.jsxs(ke,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Renewal Details",e.jsx(D,{onClick:n,children:e.jsx(b,{icon:"mingcute:close-line"})})]}),e.jsx(we,{sx:{maxHeight:"80vh"},children:e.jsxs(Re,{sx:{p:0},children:[d,e.jsx(o,{sx:{p:3},children:e.jsxs(fe,{spacing:3,children:[e.jsxs(o,{children:[e.jsx(A,{title:"Renewal Information",icon:"solar:info-circle-bold"}),e.jsxs(o,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(v,{label:"Item Name",value:a.item_name,icon:"solar:tag-bold"}),e.jsx(v,{label:"Category",value:a.category,icon:"solar:checklist-bold"}),e.jsx(v,{label:"Vendor / Provider",value:a.vendor||"-",icon:"solar:shop-bold"}),e.jsx(v,{label:"Amount",value:`₹${((h=a.amount)==null?void 0:h.toLocaleString())||0}`,icon:"solar:wad-of-money-bold"})]})]}),e.jsxs(o,{children:[e.jsx(A,{title:"Dates & Periods",icon:"solar:calendar-bold"}),e.jsxs(o,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(v,{label:"Purchase Date",value:a.purchase_date?new Date(a.purchase_date).toLocaleDateString():"-",icon:"solar:calendar-add-bold"}),e.jsx(v,{label:"Renewal Date",value:a.renewal_date?new Date(a.renewal_date).toLocaleDateString():"-",icon:"solar:calendar-mark-bold"}),e.jsx(v,{label:"Renewal Period",value:a.renewal_period||"-",icon:"solar:clock-circle-bold"}),e.jsx(v,{label:"Status",value:a.status||"-",icon:"solar:info-circle-bold"})]})]}),a.remarks&&e.jsxs(o,{children:[e.jsx(A,{title:"Remarks",icon:"solar:notes-bold"}),e.jsx(o,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:e.jsx(m,{variant:"body2",sx:{fontWeight:500,whiteSpace:"pre-wrap"},children:a.remarks})})]}),e.jsxs(o,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(A,{title:"Record Information",icon:"solar:document-bold",noMargin:!0}),e.jsxs(o,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},mt:2},children:[e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:"Created On"}),e.jsx(m,{variant:"body2",children:new Date(a.creation).toLocaleString()})]}),e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:"Last Modified"}),e.jsx(m,{variant:"body2",children:new Date(a.modified).toLocaleString()})]}),e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:"Record ID"}),e.jsx(m,{variant:"body2",sx:{color:"primary.main",fontWeight:600},children:a.name})]})]})]})]})})]})})]})}function A({title:r,icon:n,action:a,noMargin:l=!1}){return e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:l?0:2,gap:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{icon:n,width:20,sx:{mr:1,color:"text.secondary"}}),e.jsx(m,{variant:"subtitle2",sx:{color:"text.secondary",textTransform:"uppercase",letterSpacing:1,fontWeight:700},children:r})]}),a&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(pe,{orientation:"vertical",flexItem:!0,sx:{height:16,my:"auto",borderStyle:"dashed"}}),a]})]}),!l&&e.jsx(pe,{sx:{mb:3}})]})}function v({label:r,value:n,icon:a}){return e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start"},children:[e.jsx(o,{sx:{p:1,mr:2,borderRadius:1,bgcolor:"background.neutral",color:"text.secondary",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(b,{icon:a,width:20})}),e.jsxs(o,{children:[e.jsx(m,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:r}),e.jsx(m,{variant:"body2",sx:{fontWeight:600},children:n||"-"})]})]})}const jt=["Domain","Email","SSL","Server","Laptop","Others"],yt=["Monthly","Quarterly","Yearly"],bt=["Active","Expired","Pending"];function wt(){const[r,n]=s.useState(0),[a,l]=s.useState(10),[d,p]=s.useState(""),[h,f]=s.useState("desc"),[S,R]=s.useState("renewal_date"),[x,j]=s.useState([]),{data:c,total:k,refetch:w}=pt(r+1,a,d,S,h),[De,F]=s.useState(!1),[L,W]=s.useState(!1),[re,O]=s.useState(null),[N,B]=s.useState({open:!1,id:null}),[Pe,se]=s.useState(!1),[Te,Ie]=s.useState(null),[ne,Y]=s.useState(""),[oe,U]=s.useState(""),[le,$]=s.useState(""),[M,H]=s.useState(""),[J,q]=s.useState(""),[ie,z]=s.useState(""),[ce,G]=s.useState(""),[de,Q]=s.useState(""),[ue,V]=s.useState(""),[K,_e]=s.useState({read:!1,write:!1,delete:!1}),[P,g]=s.useState({open:!1,message:"",severity:"success"});s.useEffect(()=>{xt().then(_e)},[]);const Ee=t=>{f(S===t&&h==="asc"?"desc":"asc"),R(t)},Ae=t=>{j(t?c.map(i=>i.name):[])},Fe=t=>{j(i=>i.includes(t)?i.filter(u=>u!==t):[...i,t])},Le=async()=>{try{await Promise.all(x.map(t=>ye(t))),g({open:!0,message:`${x.length} record(s) deleted successfully`,severity:"success"}),j([]),w()}catch(t){g({open:!0,message:t.message||"Failed to delete records",severity:"error"})}},We=()=>{W(!1),O(null),Y(""),U(""),$(""),H(""),q(""),z(""),G(""),Q("Active"),V(""),F(!0)},T=()=>{F(!1),W(!1),O(null)},Oe=s.useCallback(async t=>{var i;try{const u=await be(t.name);O(u),Y(u.item_name||""),U(u.category||""),$(u.vendor||""),H(u.purchase_date||""),q(u.renewal_date||""),z(((i=u.amount)==null?void 0:i.toString())||""),G(u.renewal_period||""),Q(u.status||"Active"),V(u.remarks||""),W(!0),F(!0)}catch(u){g({open:!0,message:u.message||"Failed to load record",severity:"error"})}},[]),Ne=s.useCallback(async t=>{try{const i=await be(t.name);Ie(i),se(!0)}catch(i){g({open:!0,message:i.message||"Failed to load record",severity:"error"})}},[]),Be=s.useCallback(t=>{B({open:!0,id:t})},[]),Ye=async()=>{if(N.id)try{await ye(N.id),g({open:!0,message:"Record deleted successfully",severity:"success"}),w()}catch(t){g({open:!0,message:t.message||"Failed to delete record",severity:"error"})}finally{B({open:!1,id:null})}},Ue=async t=>{t.preventDefault();const i={item_name:ne.trim(),category:oe,vendor:le.trim(),purchase_date:M,renewal_date:J,amount:parseFloat(ie)||0,renewal_period:ce,status:de,remarks:ue.trim()};try{L&&re?(await ht(re.name,i),g({open:!0,message:"Record updated successfully",severity:"success"})):(await mt(i),g({open:!0,message:"Record created successfully",severity:"success"})),T(),w()}catch(u){g({open:!0,message:u.message||"Operation failed",severity:"error"})}},$e=(t,i)=>{n(i)},Me=t=>{l(parseInt(t.target.value,10)),n(0)},He=t=>{p(t.target.value),n(0)},me=()=>{g({...P,open:!1})},Je=!c.length&&!!d,he=!c.length&&!d;return e.jsxs(ze,{children:[e.jsxs(o,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(m,{variant:"h4",sx:{flexGrow:1},children:"Renewals Tracker"}),K.write&&e.jsx(I,{variant:"contained",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),onClick:We,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Renewal"})]}),e.jsxs(Ge,{children:[e.jsx(Ke,{numSelected:x.length,filterName:d,onFilterName:He,searchPlaceholder:"Search renewals...",onDelete:x.length>0?Le:void 0}),e.jsx(we,{children:e.jsx(tt,{sx:{overflow:"unset"},children:e.jsxs(at,{sx:{minWidth:800},children:[e.jsx(Xe,{order:h,orderBy:S,rowCount:c.length,numSelected:x.length,onSort:Ee,onSelectAllRows:t=>Ae(t),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"item_name",label:"Item Name"},{id:"category",label:"Category"},{id:"renewal_date",label:"Renewal Date"},{id:"amount",label:"Amount",align:"right"},{id:"status",label:"Status",align:"center"},{id:"",label:"",align:"right"}]}),e.jsxs(rt,{children:[c.map((t,i)=>e.jsx(gt,{index:r*a+i,hideCheckbox:!0,row:{id:t.name,item_name:t.item_name,category:t.category,renewal_date:t.renewal_date,amount:t.amount,status:t.status},selected:x.includes(t.name),onSelectRow:()=>Fe(t.name),onView:()=>Ne(t),onEdit:()=>Oe(t),onDelete:()=>Be(t.name),canEdit:K.write,canDelete:K.delete},t.name)),Je&&e.jsx(Ze,{searchQuery:d}),he&&e.jsx(Se,{children:e.jsx(y,{colSpan:6,children:e.jsx(Qe,{title:"No renewals found",description:"You haven't added any renewal tracking records yet.",icon:"solar:reorder-bold-duotone"})})}),!he&&e.jsx(et,{height:68,emptyRows:Math.max(0,a-c.length)})]})]})})}),e.jsx(nt,{component:"div",page:r,count:k,rowsPerPage:a,onPageChange:$e,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:Me})]}),e.jsx(Ce,{open:De,onClose:T,fullWidth:!0,maxWidth:"sm",children:e.jsxs("form",{onSubmit:Ue,children:[e.jsxs(ke,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[L?"Edit Renewal":"New Renewal",e.jsx(D,{onClick:T,children:e.jsx(b,{icon:"mingcute:close-line"})})]}),e.jsx(Re,{dividers:!0,children:e.jsxs(o,{sx:{display:"grid",gap:3,margin:"1rem"},children:[e.jsx(E,{fullWidth:!0,label:"Item Name",value:ne,onChange:t=>Y(t.target.value),required:!0}),e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(Z,{children:"Category"}),e.jsx(ee,{value:oe,onChange:t=>U(t.target.value),label:"Category",children:jt.map(t=>e.jsx(_,{value:t,children:t},t))})]}),e.jsx(E,{fullWidth:!0,label:"Vendor / Provider",value:le,onChange:t=>$(t.target.value)}),e.jsx(ot,{dateAdapter:lt,children:e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsx(je,{label:"Purchase Date",value:M?ge(M):null,onChange:t=>H((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(je,{label:"Renewal Date",value:J?ge(J):null,onChange:t=>q((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}})]})}),e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsx(E,{fullWidth:!0,label:"Amount",type:"number",value:ie,onChange:t=>z(t.target.value),inputProps:{min:0,step:.01}}),e.jsxs(X,{fullWidth:!0,children:[e.jsx(Z,{children:"Renewal Period"}),e.jsxs(ee,{value:ce,onChange:t=>G(t.target.value),label:"Renewal Period",children:[e.jsx(_,{value:"",children:"None"}),yt.map(t=>e.jsx(_,{value:t,children:t},t))]})]})]}),e.jsxs(X,{fullWidth:!0,children:[e.jsx(Z,{children:"Status"}),e.jsx(ee,{value:de,onChange:t=>Q(t.target.value),label:"Status",children:bt.map(t=>e.jsx(_,{value:t,children:t},t))})]}),e.jsx(E,{fullWidth:!0,label:"Remarks",multiline:!0,rows:3,value:ue,onChange:t=>V(t.target.value)})]})}),e.jsxs(it,{children:[e.jsx(I,{onClick:T,children:"Cancel"}),e.jsx(I,{type:"submit",variant:"contained",children:L?"Update":"Create"})]})]})}),e.jsx(ft,{open:Pe,onClose:()=>se(!1),renewal:Te}),e.jsx(ct,{open:P.open,autoHideDuration:6e3,onClose:me,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(qe,{onClose:me,severity:P.severity,sx:{width:"100%"},children:P.message})}),e.jsx(Ve,{open:N.open,onClose:()=>B({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this renewal record?",action:e.jsx(I,{onClick:Ye,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function Zt(){return e.jsx(wt,{})}export{Zt as default};
