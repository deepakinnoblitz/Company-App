import{r as s,j as e,T as A,p as $,I as j,q as x,B as v,S as we,v as ke,h as Ee,d as _}from"./index-Co7v2xsC.js";import{C as Re}from"./config-global-BX9xwJzv.js";import{r as De,u as T,w as Pe}from"./reports-0l1D3gVE.js";import{D as Ie,C as U}from"./Card-CDV3jV6O.js";import{getDoctypeList as te,getStates as Oe,getCities as _e}from"./leads-d5FzXGcx.js";import{E as Te}from"./export-fields-dialog-DKDJ10Kv.js";import{C as We}from"./contact-details-dialog-Bn0oXz4c.js";import{S as C}from"./Stack-GQIY7Xk9.js";import{L as Fe,A as Ae}from"./AdapterDayjs-BPhbSeWE.js";import{D as se}from"./DatePicker-BMZY9CMK.js";import{F as W,S as F}from"./Select-B1EkSlUY.js";import{T as Le,a as ze,b as Ye,c as G,d as n,e as Be}from"./TableRow-DqeBPnxy.js";import{C as oe}from"./Checkbox-CoJXcvzD.js";import{T as Ne}from"./TablePagination-CEaYVDlQ.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./RadioGroup-B7r1ll7C.js";import"./useFormControl-Cqn8lfES.js";import"./FormControlLabel-CEvUm0a3.js";import"./DialogActions-h_2rRG3x.js";import"./contacts-Y516V3QZ.js";import"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./TextField-BmVWmDzd.js";import"./Chip-Rg4Dn3a5.js";import"./dayjs.min-C2542nnJ.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function Me(){const[l,p]=s.useState([]),[S,L]=s.useState([]),[h,u]=s.useState(!1),[o,f]=s.useState("all"),[d,w]=s.useState("all"),[b,k]=s.useState("all"),[E,V]=s.useState("all"),[R,q]=s.useState(null),[D,H]=s.useState(null),[ne,ae]=s.useState([]),[re,J]=s.useState([]),[le,K]=s.useState([]),[ie,ce]=s.useState([]),[z,Y]=s.useState(0),[P,de]=s.useState(10),[he,Q]=s.useState(!1),[xe,X]=s.useState(null),[i,B]=s.useState([]),pe=t=>{if(t.target.checked){const r=l.map(a=>a.name);B(r);return}B([])},ue=(t,r)=>{const a=i.indexOf(r);let c=[];a===-1?c=c.concat(i,r):a===0?c=c.concat(i.slice(1)):a===i.length-1?c=c.concat(i.slice(0,-1)):a>0&&(c=c.concat(i.slice(0,a),i.slice(a+1))),B(c)},[me,Z]=s.useState(!1),fe=async(t,r)=>{u(!0);try{const a=(i.length>0?i:l.map(m=>m.name)).filter(Boolean);if(a.length===0){u(!1);return}const c=[["name","in",a]],I=t.length>0?t:["name","first_name","company_name","email","phone"];I.includes("name")||I.push("name"),console.log("Exporting IDs:",a),console.log("Exporting Fields:",I);const Ce=new URLSearchParams({doctype:"Contacts",fields:JSON.stringify(I),filters:JSON.stringify(c),limit_page_length:"99999"}),M=await fetch(`/api/method/frappe.client.get_list?${Ce.toString()}`,{method:"GET",credentials:"include"});if(!M.ok){const m=await M.text();throw console.error("Export API Error:",m),new Error("Failed to fetch data for export")}const O=(await M.json()).message||[];console.log("Export Data Received:",O),(!O||O.length===0)&&console.warn("Export returned no data");const ee=T.json_to_sheet(O);if(r==="excel"){const m=T.book_new();T.book_append_sheet(m,ee,"Contacts"),Pe(m,"Contact_Report.xlsx")}else{const m=T.sheet_to_csv(ee),ve=new Blob([m],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a"),Se=URL.createObjectURL(ve);g.setAttribute("href",Se),g.setAttribute("download","Contact_Report.csv"),g.style.visibility="hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)}}catch(a){console.error(a)}finally{u(!1)}},ge=s.useCallback(t=>{X(t),Q(!0)},[]),je=s.useCallback((t,r)=>{Y(r)},[]),be=s.useCallback(t=>{de(parseInt(t.target.value,10)),Y(0)},[]),N=s.useCallback(async()=>{u(!0);try{const t={};o!=="all"&&(t.country=o),d!=="all"&&(t.state=d),b!=="all"&&(t.city=b),E!=="all"&&(t.owner=E),R&&(t.from_date=R.format("YYYY-MM-DD")),D&&(t.to_date=D.format("YYYY-MM-DD"));const r=await De("Contact Report",t);p(r.result||[]),L(r.report_summary||[]),Y(0)}catch(t){console.error("Failed to fetch contact report:",t)}finally{u(!1)}},[o,d,b,E,R,D]);s.useEffect(()=>{N()},[N]);const ye=()=>{q(null),H(null),f("all"),w("all"),k("all"),V("all")};return s.useEffect(()=>{te("Country").then(ae),te("User").then(ce)},[]),s.useEffect(()=>{o&&o!=="all"?Oe(o).then(t=>{J(t),t.includes(d)||w("all")}):(J([]),w("all"))},[o]),s.useEffect(()=>{o&&o!=="all"&&d&&d!=="all"?_e(o,d).then(t=>{K(t),t.includes(b)||k("all")}):(K([]),k("all"))},[o,d]),e.jsxs(Ie,{children:[e.jsxs(C,{spacing:3,children:[e.jsxs(C,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(A,{variant:"h4",children:"Contact Report"}),e.jsxs(C,{direction:"row",spacing:1,children:[e.jsx($,{variant:"outlined",startIcon:e.jsx(j,{icon:"solar:refresh-bold"}),onClick:N,disabled:h,children:"Refresh"}),e.jsx($,{variant:"outlined",color:"error",startIcon:e.jsx(j,{icon:"solar:restart-bold"}),onClick:ye,children:"Reset"})]})]}),e.jsxs(U,{sx:{p:2.5,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"background.neutral",border:t=>`1px solid ${t.palette.divider}`},children:[e.jsxs(Fe,{dateAdapter:Ae,children:[e.jsx(se,{label:"From Date",value:R,onChange:t=>q(t),slotProps:{textField:{size:"small"}}}),e.jsx(se,{label:"To Date",value:D,onChange:t=>H(t),slotProps:{textField:{size:"small"}}})]}),e.jsx(W,{size:"small",sx:{minWidth:160},children:e.jsxs(F,{value:o,onChange:t=>f(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"Country"}),ne.map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(W,{size:"small",sx:{minWidth:160},disabled:o==="all",children:e.jsxs(F,{value:d,onChange:t=>w(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"State"}),re.map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(W,{size:"small",sx:{minWidth:160},disabled:d==="all",children:e.jsxs(F,{value:b,onChange:t=>k(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"City"}),le.map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(W,{size:"small",sx:{minWidth:160},children:e.jsxs(F,{value:E,onChange:t=>V(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"Owner"}),e.jsx(x,{value:"Administrator",children:"Administrator"}),ie.filter(t=>t!=="Administrator").map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(v,{sx:{flexGrow:1}}),e.jsx($,{variant:"contained",startIcon:e.jsx(j,{icon:"solar:export-bold"}),onClick:()=>Z(!0),children:"Export"})]}),e.jsxs(v,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"}},children:[S.map((t,r)=>e.jsx(y,{item:t},r)),S.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{item:{label:"Total Contacts",value:0,indicator:"blue"}}),e.jsx(y,{item:{label:"Email Contacts",value:0,indicator:"green"}}),e.jsx(y,{item:{label:"Phone Contacts",value:0,indicator:"orange"}}),e.jsx(y,{item:{label:"Converted Contacts",value:0,indicator:"red"}})]})]}),e.jsxs(U,{children:[e.jsx(Le,{sx:{position:"relative",overflow:"unset"},children:e.jsx(we,{children:e.jsxs(ze,{size:"medium",stickyHeader:!0,children:[e.jsx(Ye,{children:e.jsxs(G,{sx:{bgcolor:"#f4f6f8"},children:[e.jsx(n,{padding:"checkbox",children:e.jsx(oe,{indeterminate:i.length>0&&i.length<l.length,checked:l.length>0&&i.length===l.length,onChange:pe})}),e.jsx(n,{sx:{fontWeight:700,color:"text.secondary"},children:"Name"}),e.jsx(n,{sx:{fontWeight:700,color:"text.secondary"},children:"Company"}),e.jsx(n,{sx:{fontWeight:700,color:"text.secondary"},children:"Email"}),e.jsx(n,{sx:{fontWeight:700,color:"text.secondary"},children:"Phone"}),e.jsx(n,{sx:{fontWeight:700,color:"text.secondary"},children:"Location"}),e.jsx(n,{sx:{fontWeight:700,color:"text.secondary"},children:"Source"}),e.jsx(n,{sx:{fontWeight:700,color:"text.secondary"},children:"Owner"}),e.jsx(n,{align:"right",sx:{fontWeight:700,color:"text.secondary",position:"sticky",right:0,bgcolor:"#f4f6f8",zIndex:11},children:"Actions"})]})}),e.jsxs(Be,{children:[l.slice(z*P,z*P+P).map((t,r)=>{const a=i.indexOf(t.name)!==-1;return e.jsxs(G,{hover:!0,role:"checkbox","aria-checked":a,selected:a,children:[e.jsx(n,{padding:"checkbox",children:e.jsx(oe,{checked:a,onClick:c=>ue(c,t.name)})}),e.jsx(n,{sx:{fontWeight:600},children:t.first_name}),e.jsx(n,{children:t.company_name}),e.jsx(n,{children:t.email}),e.jsx(n,{children:t.phone}),e.jsx(n,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.city,t.state,t.country].filter(Boolean).join(", ")}),e.jsx(n,{children:t.source_lead}),e.jsx(n,{children:t.owner_name}),e.jsx(n,{align:"right",sx:{position:"sticky",right:0,bgcolor:"background.paper",boxShadow:"-2px 0 4px rgba(145, 158, 171, 0.08)"},children:e.jsx(ke,{onClick:()=>ge(t.name),sx:{color:"info.main"},children:e.jsx(j,{icon:"solar:eye-bold"})})})]},r)}),l.length===0&&!h&&e.jsx(G,{children:e.jsx(n,{colSpan:9,align:"center",sx:{py:10},children:e.jsxs(C,{spacing:1,alignItems:"center",children:[e.jsx(j,{icon:"eva:slash-outline",width:48,sx:{color:"text.disabled"}}),e.jsx(A,{variant:"body2",sx:{color:"text.disabled"},children:"No data found"})]})})})]})]})})}),e.jsx(Ne,{component:"div",count:l.length,page:z,onPageChange:je,rowsPerPage:P,onRowsPerPageChange:be,rowsPerPageOptions:[5,10,25]})]})]}),e.jsx(We,{open:he,contactId:xe,onClose:()=>{Q(!1),X(null)}}),e.jsx(Te,{open:me,onClose:()=>Z(!1),doctype:"Contacts",onExport:fe})]})}function y({item:l}){var u;const p=Ee(),S=o=>{switch(o==null?void 0:o.toLowerCase()){case"blue":return p.palette.info.main;case"green":return p.palette.success.main;case"orange":return p.palette.warning.main;case"red":return p.palette.error.main;default:return p.palette.primary.main}},L=o=>{const f=o.toLowerCase();return f.includes("contact")?"solar:users-group-rounded-bold-duotone":f.includes("email")?"solar:letter-bold-duotone":f.includes("phone")?"solar:phone-bold-duotone":f.includes("converted")?"solar:check-circle-bold-duotone":"solar:chart-2-bold-duotone"},h=S(l.indicator);return e.jsxs(U,{sx:{p:3,boxShadow:"none",position:"relative",overflow:"hidden",bgcolor:_(h,.04),border:`1px solid ${_(h,.1)}`,transition:p.transitions.create(["transform","box-shadow"]),"&:hover":{transform:"translateY(-4px)",boxShadow:`0 12px 24px -4px ${_(h,.12)}`}},children:[e.jsxs(C,{direction:"row",alignItems:"center",spacing:2.5,children:[e.jsx(v,{sx:{width:48,height:48,flexShrink:0,display:"flex",borderRadius:1.5,alignItems:"center",justifyContent:"center",color:h,bgcolor:_(h,.1)},children:e.jsx(j,{icon:L(l.label),width:28})}),e.jsxs(v,{sx:{flexGrow:1},children:[e.jsx(A,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:700,mb:.5},children:l.label}),e.jsx(A,{variant:"h4",sx:{color:"text.primary",fontWeight:800},children:(u=l.value)==null?void 0:u.toLocaleString()})]})]}),e.jsx(v,{sx:{top:-16,right:-16,width:80,height:80,opacity:.08,position:"absolute",borderRadius:"50%",bgcolor:h}})]})}function St(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Contact Report - ${Re.appName}`}),e.jsx(Me,{})]})}export{St as default};
