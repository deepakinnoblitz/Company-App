import{r,j as e,T as a,v as Z,I as u,B as s,D as ge,p as q,q as J,S as me,h as ue,d as I}from"./index-Co7v2xsC.js";import{C as fe}from"./config-global-BX9xwJzv.js";import{d as je}from"./dayjs.min-C2542nnJ.js";import{r as ye,u as P,w as be}from"./reports-0l1D3gVE.js";import{getDoctypeList as ve}from"./leads-d5FzXGcx.js";import{D as we,C as B}from"./Card-CDV3jV6O.js";import{E as Ce}from"./export-fields-dialog-DKDJ10Kv.js";import{g as Se}from"./expenses-deJDgINb.js";import{L as Ee}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{D as De,a as ke}from"./DialogContent-DtP-sWqR.js";import{D as Te}from"./DialogTitle-C3eBZids.js";import{S as D}from"./Stack-GQIY7Xk9.js";import{T as _e}from"./TextField-BmVWmDzd.js";import{F as We,S as Ie}from"./Select-B1EkSlUY.js";import{L as Pe,A as Re}from"./AdapterDayjs-BPhbSeWE.js";import{D as K}from"./DatePicker-BMZY9CMK.js";import{T as Ae,a as Le,b as Fe,c as M,d as o,e as Oe}from"./TableRow-DqeBPnxy.js";import{C as X}from"./Checkbox-CoJXcvzD.js";import{T as Ye}from"./TablePagination-CEaYVDlQ.js";import"./api-error-handler-CV6pRVHb.js";import"./RadioGroup-B7r1ll7C.js";import"./useFormControl-Cqn8lfES.js";import"./FormControlLabel-CEvUm0a3.js";import"./DialogActions-h_2rRG3x.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function ze({open:n,onClose:d,expenseId:g}){var f,j;const[l,m]=r.useState(null),[y,b]=r.useState(!1);return r.useEffect(()=>{n&&g?(b(!0),Se(g).then(m).catch(i=>console.error("Failed to fetch expense details:",i)).finally(()=>b(!1))):m(null)},[n,g]),e.jsxs(De,{open:n,onClose:d,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Te,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:800},children:"Expense Details"}),e.jsx(Z,{onClick:d,sx:{color:i=>i.palette.grey[500],bgcolor:"background.paper",boxShadow:i=>{var v;return(v=i.customShadows)==null?void 0:v.z1}},children:e.jsx(u,{icon:"mingcute:close-line"})})]}),e.jsx(ke,{sx:{p:4,m:2,mt:4},children:y?e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(u,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):l?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(s,{sx:{width:80,height:80,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"warning.lighter",color:"warning.main"},children:e.jsx(u,{icon:"solar:wallet-money-bold",width:40})}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(a,{variant:"h5",sx:{fontWeight:800},children:l.expense_category}),e.jsx(a,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:l.date?new Date(l.date).toLocaleDateString():"-"})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Ee,{variant:"soft",color:"warning",children:"Expense"}),e.jsxs(a,{variant:"h4",sx:{fontWeight:800,color:"primary.main",mt:1},children:["₹",((f=l.total)==null?void 0:f.toLocaleString())||0]}),e.jsxs(a,{variant:"caption",sx:{display:"block",mt:.5,color:"text.disabled",fontWeight:700},children:["ID: ",l.name]})]})]}),e.jsx(ge,{sx:{borderStyle:"dashed"}}),e.jsxs(s,{children:[e.jsx(N,{title:"Expense Information",icon:"solar:document-bold"}),e.jsxs(s,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(R,{label:"Expense No",value:l.expense_no,icon:"solar:hashtag-square-bold"}),e.jsx(R,{label:"Category",value:l.expense_category,icon:"solar:tag-bold"}),e.jsx(R,{label:"Date",value:l.date?new Date(l.date).toLocaleDateString():"-",icon:"solar:calendar-bold"}),e.jsx(R,{label:"Payment Type",value:l.payment_type,icon:"solar:card-bold"})]})]}),e.jsxs(s,{children:[e.jsx(N,{title:"Items",icon:"solar:cart-large-minimalistic-bold"}),e.jsxs(s,{sx:{bgcolor:"background.neutral",borderRadius:2,overflow:"hidden",border:i=>`1px solid ${i.palette.divider}`},children:[e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",p:1.5,bgcolor:i=>i.palette.grey[200],borderBottom:i=>`1px solid ${i.palette.divider}`},children:[e.jsx(a,{variant:"caption",sx:{fontWeight:800,color:"text.secondary"},children:"ITEM"}),e.jsx(a,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"QTY"}),e.jsx(a,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"PRICE"}),e.jsx(a,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"AMOUNT"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[(j=l.table_qecz)==null?void 0:j.map((i,v)=>e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",p:1.5,borderBottom:k=>v!==l.table_qecz.length-1?`1px solid ${k.palette.divider}`:"none"},children:[e.jsx(s,{children:e.jsx(a,{variant:"subtitle2",children:i.items})}),e.jsx(a,{variant:"body2",sx:{textAlign:"right"},children:i.quantity}),e.jsx(a,{variant:"body2",sx:{textAlign:"right"},children:i.price}),e.jsx(a,{variant:"body2",sx:{textAlign:"right",fontWeight:600},children:i.amount})]},v)),(!l.table_qecz||l.table_qecz.length===0)&&e.jsx(s,{sx:{p:3,textAlign:"center"},children:e.jsx(a,{variant:"body2",sx:{color:"text.secondary"},children:"No items found"})})]})]})]}),l.description&&e.jsxs(s,{children:[e.jsx(N,{title:"Description",icon:"solar:notes-bold"}),e.jsx(s,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:l.description})})]})]}):e.jsxs(s,{sx:{py:10,textAlign:"center"},children:[e.jsx(u,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(a,{variant:"h6",sx:{color:"text.secondary"},children:"Expense Not Found"})]})})]})}function N({title:n,icon:d,noMargin:g=!1}){return e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,mb:g?0:2.5},children:[e.jsx(u,{icon:d,width:20,sx:{color:"primary.main"}}),e.jsx(a,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:n})]})}function R({label:n,value:d,icon:g}){return e.jsxs(s,{children:[e.jsx(a,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:n}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(u,{icon:g,width:16,sx:{color:"text.disabled"}}),e.jsx(a,{variant:"body2",sx:{fontWeight:700},children:d||"-"})]})]})}function qe(){const[n,d]=r.useState([]),[g,l]=r.useState([]),[m,y]=r.useState(!1),[b,f]=r.useState(""),[j,i]=r.useState("all"),[v,k]=r.useState(null),[T,$]=r.useState(null),[ee,te]=r.useState([]),[L,F]=r.useState(0),[_,se]=r.useState(10),[ne,G]=r.useState(!1),[U,V]=r.useState(null),[h,O]=r.useState([]),oe=t=>{if(t.target.checked){const x=n.map(c=>c.expense_no);O(x);return}O([])},re=(t,x)=>{const c=h.indexOf(x);let p=[];c===-1?p=p.concat(h,x):c===0?p=p.concat(h.slice(1)):c===h.length-1?p=p.concat(h.slice(0,-1)):c>0&&(p=p.concat(h.slice(0,c),h.slice(c+1))),O(p)},[ae,H]=r.useState(!1),le=async(t,x)=>{y(!0);try{const c=(h.length>0?h:n.map(w=>w.expense_no)).filter(Boolean);if(c.length===0){y(!1);return}const p=[["expense_no","in",c]],C=t.length>0?t:["expense_no","expense_category","date","payment_type","total"];C.includes("expense_no")||C.push("expense_no");const W=new URLSearchParams({doctype:"Expenses",fields:JSON.stringify(C),filters:JSON.stringify(p),limit_page_length:"99999"}),E=await fetch(`/api/method/frappe.client.get_list?${W.toString()}`,{method:"GET",credentials:"include"});if(!E.ok){const w=await E.text();throw console.error("Export API Error:",w),new Error("Failed to fetch data for export")}const z=(await E.json()).message||[];(!z||z.length===0)&&console.warn("Export returned no data");const Q=P.json_to_sheet(z);if(x==="excel"){const w=P.book_new();P.book_append_sheet(w,Q,"Expenses"),be(w,"Expense_Report.xlsx")}else{const w=P.sheet_to_csv(Q),pe=new Blob([w],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a"),he=URL.createObjectURL(pe);S.setAttribute("href",he),S.setAttribute("download","Expense_Report.csv"),S.style.visibility="hidden",document.body.appendChild(S),S.click(),document.body.removeChild(S)}}catch(c){console.error(c)}finally{y(!1)}},ie=r.useCallback(t=>{V(t),G(!0)},[]),ce=r.useCallback((t,x)=>{F(x)},[]),de=r.useCallback(t=>{se(parseInt(t.target.value,10)),F(0)},[]),Y=r.useCallback(async()=>{y(!0);try{const t={};b&&(t.expense_category=b),j!=="all"&&(t.payment_type=j),v&&(t.from_date=v.format("YYYY-MM-DD")),T&&(t.to_date=T.format("YYYY-MM-DD"));const x=await ye("Expense Report",t);d(x.result||[]),l(x.report_summary||[]),F(0)}catch(t){console.error("Failed to fetch expense report:",t)}finally{y(!1)}},[b,j,v,T]);r.useEffect(()=>{Y()},[Y]);const xe=()=>{f(""),i("all"),k(null),$(null)};return r.useEffect(()=>{ve("Payment Type").then(te)},[]),e.jsxs(we,{children:[e.jsxs(D,{spacing:3,children:[e.jsxs(D,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(a,{variant:"h4",children:"Expense Report"}),e.jsxs(D,{direction:"row",spacing:1,children:[e.jsx(q,{variant:"outlined",startIcon:e.jsx(u,{icon:"solar:refresh-bold"}),onClick:Y,disabled:m,children:"Refresh"}),e.jsx(q,{variant:"outlined",color:"error",startIcon:e.jsx(u,{icon:"solar:restart-bold"}),onClick:xe,children:"Reset"})]})]}),e.jsxs(B,{sx:{p:2.5,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"background.neutral",border:t=>`1px solid ${t.palette.divider}`},children:[e.jsx(_e,{label:"Category",value:b,onChange:t=>f(t.target.value),placeholder:"Search category...",size:"small",sx:{minWidth:200}}),e.jsx(We,{size:"small",sx:{minWidth:200},children:e.jsxs(Ie,{value:j,onChange:t=>i(t.target.value),displayEmpty:!0,children:[e.jsx(J,{value:"all",children:"All Payment Types"}),ee.map(t=>e.jsx(J,{value:t,children:t},t))]})}),e.jsxs(Pe,{dateAdapter:Re,children:[e.jsx(K,{label:"From Date",value:v,onChange:t=>k(t),slotProps:{textField:{size:"small"}}}),e.jsx(K,{label:"To Date",value:T,onChange:t=>$(t),slotProps:{textField:{size:"small"}}})]}),e.jsx(s,{sx:{flexGrow:1}}),e.jsx(q,{variant:"contained",startIcon:e.jsx(u,{icon:"solar:export-bold"}),onClick:()=>H(!0),children:"Export"})]}),e.jsxs(s,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[g.map((t,x)=>e.jsx(A,{item:t},x)),g.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{item:{label:"Total Expense Amount",value:0,indicator:"blue",datatype:"Currency"}}),e.jsx(A,{item:{label:"Total Quantity",value:0,indicator:"green",datatype:"Float"}}),e.jsx(A,{item:{label:"Expense Records",value:0,indicator:"orange"}})]})]}),e.jsxs(B,{children:[e.jsx(Ae,{sx:{position:"relative",overflow:"unset"},children:e.jsx(me,{children:e.jsxs(Le,{size:"medium",stickyHeader:!0,children:[e.jsx(Fe,{children:e.jsxs(M,{sx:{bgcolor:"#f4f6f8"},children:[e.jsx(o,{padding:"checkbox",children:e.jsx(X,{indeterminate:h.length>0&&h.length<n.length,checked:n.length>0&&h.length===n.length,onChange:oe})}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Expense No"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Category"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Date"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Payment Type"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Item"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Qty"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Price"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Amount"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Total"}),e.jsx(o,{align:"right",sx:{fontWeight:700,color:"text.secondary",position:"sticky",right:0,bgcolor:"#f4f6f8",zIndex:11},children:"Actions"})]})}),e.jsxs(Oe,{children:[n.slice(L*_,L*_+_).map((t,x)=>{var p,C,W;const c=h.indexOf(t.expense_no)!==-1;return e.jsxs(M,{hover:!0,role:"checkbox","aria-checked":c,selected:c,children:[e.jsx(o,{padding:"checkbox",children:e.jsx(X,{checked:c,onClick:E=>re(E,t.expense_no)})}),e.jsx(o,{children:t.expense_no}),e.jsx(o,{children:t.expense_category}),e.jsx(o,{children:t.date?je(t.date).format("DD MMM YYYY"):"-"}),e.jsx(o,{children:t.payment_type}),e.jsx(o,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.items}),e.jsx(o,{children:t.quantity}),e.jsxs(o,{children:["₹",((p=t.price)==null?void 0:p.toLocaleString())||0]}),e.jsxs(o,{children:["₹",((C=t.amount)==null?void 0:C.toLocaleString())||0]}),e.jsxs(o,{sx:{fontWeight:700},children:["₹",((W=t.total)==null?void 0:W.toLocaleString())||0]}),e.jsx(o,{align:"right",sx:{position:"sticky",right:0,bgcolor:"background.paper",boxShadow:"-2px 0 4px rgba(145, 158, 171, 0.08)"},children:e.jsx(Z,{onClick:()=>ie(t),sx:{color:"info.main"},children:e.jsx(u,{icon:"solar:eye-bold"})})})]},x)}),n.length===0&&!m&&e.jsx(M,{children:e.jsx(o,{colSpan:11,align:"center",sx:{py:10},children:e.jsxs(D,{spacing:1,alignItems:"center",children:[e.jsx(u,{icon:"eva:slash-outline",width:48,sx:{color:"text.disabled"}}),e.jsx(a,{variant:"body2",sx:{color:"text.disabled"},children:"No data found"})]})})})]})]})})}),e.jsx(Ye,{component:"div",count:n.length,page:L,onPageChange:ce,rowsPerPage:_,onRowsPerPageChange:de,rowsPerPageOptions:[5,10,25]})]})]}),e.jsx(ze,{open:ne,expenseId:U?U.name:null,onClose:()=>{G(!1),V(null)}}),e.jsx(Ce,{open:ae,onClose:()=>H(!1),doctype:"Expenses",onExport:le})]})}function A({item:n}){var y,b;const d=ue(),g=f=>{switch(f==null?void 0:f.toLowerCase()){case"blue":return d.palette.info.main;case"green":return d.palette.success.main;case"orange":return d.palette.warning.main;case"red":return d.palette.error.main;default:return d.palette.primary.main}},l=f=>{const j=f.toLowerCase();return j.includes("amount")?"solar:wad-of-money-bold-duotone":j.includes("quantity")?"solar:box-bold-duotone":j.includes("records")?"solar:document-text-bold-duotone":"solar:chart-2-bold-duotone"},m=g(n.indicator);return e.jsxs(B,{sx:{p:3,boxShadow:"none",position:"relative",overflow:"hidden",bgcolor:I(m,.04),border:`1px solid ${I(m,.1)}`,transition:d.transitions.create(["transform","box-shadow"]),"&:hover":{transform:"translateY(-4px)",boxShadow:`0 12px 24px -4px ${I(m,.12)}`}},children:[e.jsxs(D,{direction:"row",alignItems:"center",spacing:2.5,children:[e.jsx(s,{sx:{width:48,height:48,flexShrink:0,display:"flex",borderRadius:1.5,alignItems:"center",justifyContent:"center",color:m,bgcolor:I(m,.1)},children:e.jsx(u,{icon:l(n.label),width:28})}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(a,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:700,mb:.5},children:n.label}),e.jsx(a,{variant:"h4",sx:{color:"text.primary",fontWeight:800},children:n.datatype==="Currency"||typeof n.value=="number"&&n.label.toLowerCase().includes("amount")?`₹${(y=n.value)==null?void 0:y.toLocaleString()}`:(b=n.value)==null?void 0:b.toLocaleString()})]})]}),e.jsx(s,{sx:{top:-16,right:-16,width:80,height:80,opacity:.08,position:"absolute",borderRadius:"50%",bgcolor:m}})]})}function bt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Expense Report - ${fe.appName}`}),e.jsx(qe,{})]})}export{bt as default};
