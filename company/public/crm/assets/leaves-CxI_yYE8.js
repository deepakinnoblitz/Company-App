import{r as a,j as e,B as o,d as $,T as l,v as C,I as x,D as ve,p as F,S as Ce,w as De}from"./index-Co7v2xsC.js";import{C as Se}from"./config-global-BX9xwJzv.js";import{d as G}from"./dayjs.min-C2542nnJ.js";import{l as Te,g as Le,a as ke,m as Pe,n as we,o as Ae}from"./hr-management-CfgPc5UQ.js";import{getDoctypeList as Q}from"./leads-d5FzXGcx.js";import{D as We,C as Re}from"./Card-CDV3jV6O.js";import{E as Ie}from"./empty-content-BBDmaj4d.js";import{C as _e}from"./confirm-dialog--19ddTk_.js";import{L as K}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as X,d as f,T as Ee,a as Fe,e as Ne}from"./TableRow-DqeBPnxy.js";import{C as Oe}from"./Checkbox-CoJXcvzD.js";import{U as Ye,a as ze,b as qe,T as Be}from"./user-table-toolbar-BXgkag6p.js";import{D as Z,a as V}from"./DialogContent-DtP-sWqR.js";import{D as ee}from"./DialogTitle-C3eBZids.js";import{T as Me}from"./TablePagination-CEaYVDlQ.js";import{T as N}from"./TextField-BmVWmDzd.js";import{L as He,A as Ue}from"./AdapterDayjs-BPhbSeWE.js";import{D as J}from"./DatePicker-BMZY9CMK.js";import{D as $e}from"./DialogActions-h_2rRG3x.js";import{S as Ge}from"./Snackbar-BVA3LOhi.js";import"./api-error-handler-CV6pRVHb.js";import"./useFormControl-Cqn8lfES.js";import"./Select-B1EkSlUY.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";function Qe(s,c,i){const[r,d]=a.useState([]),[j,g]=a.useState(0),[y,n]=a.useState(!0),p=a.useCallback(async()=>{n(!0);try{const u=await Te({page:s,page_size:c,search:i});d(u.data),g(u.total)}catch(u){console.error("Failed to fetch leave applications:",u)}finally{n(!1)}},[s,c,i]);return a.useEffect(()=>{p()},[p]),{data:r,total:j,loading:y,refetch:p}}function Je({row:s,selected:c,onSelectRow:i,onView:r,onEdit:d,onDelete:j,canEdit:g,canDelete:y,hideCheckbox:n=!1,index:p}){const u=m=>{switch(m){case"Approved":return"success";case"Rejected":return"error";case"Pending":return"warning";case"Open":return"info";default:return"default"}};return e.jsxs(X,{hover:!0,tabIndex:-1,role:"checkbox",selected:c,children:[!n&&e.jsx(f,{padding:"checkbox",children:e.jsx(Oe,{disableRipple:!0,checked:c,onChange:i})}),typeof p=="number"&&e.jsx(f,{align:"center",children:e.jsx(o,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:m=>$(m.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:m=>`1px solid ${$(m.palette.primary.main,.16)}`,mx:"auto",transition:m=>m.transitions.create(["all"],{duration:m.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:p+1})}),e.jsx(f,{children:e.jsxs(o,{children:[e.jsx(l,{variant:"subtitle2",noWrap:!0,children:s.employeeName}),e.jsx(l,{variant:"caption",sx:{color:"text.secondary"},children:s.employee})]})}),e.jsx(f,{children:e.jsx(l,{variant:"body2",noWrap:!0,children:s.leaveType})}),e.jsx(f,{children:e.jsxs(l,{variant:"body2",noWrap:!0,children:[s.fromDate," to ",s.toDate]})}),e.jsx(f,{children:e.jsx(l,{variant:"body2",noWrap:!0,children:s.totalDays})}),e.jsx(f,{children:e.jsx(l,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:s.reason})}),e.jsx(f,{children:e.jsx(K,{color:u(s.status),children:s.status})}),e.jsx(f,{align:"right",children:e.jsxs(o,{sx:{display:"flex",justifyContent:"flex-end",gap:.5},children:[e.jsx(C,{size:"small",onClick:r,sx:{color:"info.main"},children:e.jsx(x,{icon:"solar:eye-bold"})}),g&&e.jsx(C,{size:"small",onClick:d,sx:{color:"primary.main"},children:e.jsx(x,{icon:"solar:pen-bold"})}),y&&e.jsx(C,{size:"small",onClick:j,sx:{color:"error.main"},children:e.jsx(x,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function Ke({open:s,onClose:c,leaveId:i}){const[r,d]=a.useState(null),[j,g]=a.useState(!1);a.useEffect(()=>{s&&i?(g(!0),Le("Leave Application",i).then(d).catch(n=>console.error("Failed to fetch leave details:",n)).finally(()=>g(!1))):d(null)},[s,i]);const y=n=>{switch(n){case"Approved":return"success";case"Rejected":return"error";case"Pending":return"warning";case"Open":return"info";default:return"default"}};return e.jsxs(Z,{open:s,onClose:c,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(ee,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(l,{variant:"h6",sx:{fontWeight:800},children:"Leave Application"}),e.jsx(C,{onClick:c,sx:{color:n=>n.palette.grey[500],bgcolor:"background.paper",boxShadow:n=>{var p;return(p=n.customShadows)==null?void 0:p.z1}},children:e.jsx(x,{icon:"mingcute:close-line"})})]}),e.jsx(V,{sx:{p:4,m:2,mt:4},children:j?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(x,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):r?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:4},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,border:n=>`1px solid ${n.palette.divider}`},children:[e.jsx(x,{icon:"solar:user-bold-duotone",width:40,sx:{color:"primary.main"}}),e.jsxs(o,{children:[e.jsx(l,{variant:"subtitle1",sx:{fontWeight:800},children:r.employee_name}),e.jsx(l,{variant:"body2",sx:{color:"text.secondary"},children:r.employee})]})]}),e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[e.jsx(D,{label:"Leave Type",value:r.leave_type,icon:"solar:tag-horizontal-bold"}),e.jsxs(o,{children:[e.jsx(l,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:"Status"}),e.jsx(K,{color:y(r.workflow_state||r.status),variant:"soft",children:r.workflow_state||r.status||"Pending"})]})]}),e.jsx(ve,{sx:{borderStyle:"dashed"}}),e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[e.jsx(D,{label:"From Date",value:r.from_date,icon:"solar:calendar-bold"}),e.jsx(D,{label:"To Date",value:r.to_date,icon:"solar:calendar-bold"})]}),e.jsx(D,{label:"Total Days",value:`${r.total_days} days`,icon:"solar:clock-circle-bold"}),e.jsxs(o,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(l,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:1,display:"block"},children:"Reason"}),e.jsx(l,{variant:"body2",sx:{color:"text.primary",fontWeight:600,whiteSpace:"pre-wrap"},children:r.reson||"No reason provided"})]}),r.attachment&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{icon:"solar:link-bold",width:16,sx:{color:"text.disabled"}}),e.jsx(l,{variant:"body2",component:"a",href:r.attachment,target:"_blank",sx:{color:"primary.main",fontWeight:700,textDecoration:"none"},children:"View Attachment"})]})]}):e.jsxs(o,{sx:{py:10,textAlign:"center"},children:[e.jsx(x,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(l,{variant:"h6",sx:{color:"text.secondary"},children:"No Application Found"})]})})]})}function D({label:s,value:c,icon:i,color:r="text.primary"}){return e.jsxs(o,{children:[e.jsx(l,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:s}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{icon:i,width:16,sx:{color:"text.disabled"}}),e.jsx(l,{variant:"body2",sx:{fontWeight:700,color:r},children:c||"-"})]})]})}function Xe(){const[s,c]=a.useState(0),[i,r]=a.useState(5),[d,j]=a.useState(""),[g,y]=a.useState(!1),[n,p]=a.useState(!1),[u,m]=a.useState(null),[O,S]=a.useState(""),[Y,T]=a.useState(""),[L,k]=a.useState(""),[P,w]=a.useState(""),[z,A]=a.useState(""),[te,ae]=a.useState([]),[se,re]=a.useState([]),[W,R]=a.useState({open:!1,id:null}),[I,b]=a.useState({open:!1,message:"",severity:"success"}),[oe,q]=a.useState(!1),[ne,B]=a.useState(null),[_,le]=a.useState({read:!0,write:!0,delete:!0}),{data:v,total:ie,loading:ce,refetch:M}=Qe(s+1,i,d),de=!v.length&&!!d,H=!v.length&&!d&&!ce;a.useEffect(()=>{ke("Leave Application").then(le),Q("Employee",["name","employee_name"]).then(ae).catch(console.error),Q("Leave Type",["name"]).then(re).catch(console.error)},[]);const pe=()=>{y(!0)},E=()=>{y(!1),m(null),S(""),T(""),k(""),w(""),A("")},U=()=>{b(t=>({...t,open:!1}))},ue=t=>{R({open:!0,id:t})},me=async()=>{if(W.id)try{await Ae(W.id),b({open:!0,message:"Leave application deleted successfully",severity:"success"}),await M()}catch(t){console.error(t),b({open:!0,message:"Failed to delete record",severity:"error"})}finally{R({open:!1,id:null})}},xe=async()=>{try{p(!0);const t={employee:O,leave_type:Y,from_date:L,to_date:P,reson:z};u?(await Pe(u,t),b({open:!0,message:"Leave application updated successfully",severity:"success"})):(await we(t),b({open:!0,message:"Leave application submitted successfully",severity:"success"})),await M(),E()}catch(t){console.error(t),b({open:!0,message:t.message||"Error saving leave application",severity:"error"})}finally{p(!1)}},he=t=>{m(t);const h=v.find(be=>be.name===t);h&&(S(h.employee||""),T(h.leave_type||""),k(h.from_date||""),w(h.to_date||""),A(h.reson||"")),y(!0)},fe=t=>{B(t),q(!0)},ye=()=>{q(!1),B(null)},ge=(t,h)=>{c(h)},je=t=>{r(parseInt(t.target.value,10)),c(0)};return e.jsxs(We,{children:[e.jsxs(o,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(l,{variant:"h4",sx:{flexGrow:1},children:"Leave Applications"}),_.write&&e.jsx(F,{variant:"contained",startIcon:e.jsx(x,{icon:"mingcute:add-line"}),onClick:pe,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Application"})]}),e.jsxs(Re,{children:[e.jsx(Ye,{numSelected:0,filterName:d,onFilterName:t=>{j(t.target.value),c(0)},searchPlaceholder:"Search leaves..."}),e.jsx(Ce,{children:e.jsx(Ee,{sx:{overflow:"unset"},children:e.jsxs(Fe,{sx:{minWidth:800},children:[e.jsx(ze,{order:"asc",orderBy:"name",rowCount:v.length,numSelected:0,onSort:()=>{},onSelectAllRows:()=>{},hideCheckbox:!0,showIndex:!0,headLabel:[{id:"employee",label:"Employee"},{id:"leaveType",label:"Lead Type"},{id:"fromDate",label:"Duration"},{id:"totalDays",label:"Days"},{id:"reason",label:"Reason"},{id:"status",label:"Status"},{id:"",label:""}]}),e.jsxs(Ne,{children:[v.map((t,h)=>e.jsx(Je,{index:s*i+h,hideCheckbox:!0,row:{id:t.name,employee:t.employee,employeeName:t.employee_name,leaveType:t.leave_type,fromDate:t.from_date,toDate:t.to_date,totalDays:t.total_days,reason:t.reson,status:t.workflow_state||t.status||"Pending"},selected:!1,onSelectRow:()=>{},onView:()=>fe(t.name),onEdit:()=>he(t.name),onDelete:()=>ue(t.name),canEdit:_.write,canDelete:_.delete},t.name)),de&&e.jsx(qe,{searchQuery:d}),H&&e.jsx(X,{children:e.jsx(f,{colSpan:6,children:e.jsx(Ie,{title:"No leave applications",description:"You haven't submitted any leave requests yet.",icon:"solar:calendar-add-bold-duotone"})})}),!H&&e.jsx(Be,{height:68,emptyRows:Math.max(0,i-v.length)})]})]})})}),e.jsx(Me,{component:"div",count:ie,page:s,rowsPerPage:i,onPageChange:ge,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:je})]}),e.jsxs(Z,{open:g,onClose:E,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(ee,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u?"Edit Leave Application":"New Leave Application",e.jsx(C,{onClick:E,sx:{color:t=>t.palette.grey[500]},children:e.jsx(x,{icon:"mingcute:close-line"})})]}),e.jsx(V,{dividers:!0,children:e.jsxs(o,{display:"grid",margin:2,gridTemplateColumns:"1fr",gap:3,children:[e.jsxs(N,{select:!0,fullWidth:!0,label:"Employee",value:O,onChange:t=>S(t.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),te.map(t=>e.jsxs("option",{value:t.name,children:[t.employee_name," (",t.name,")"]},t.name))]}),e.jsxs(N,{select:!0,fullWidth:!0,label:"Leave Type",value:Y,onChange:t=>T(t.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),se.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))]}),e.jsx(He,{dateAdapter:Ue,children:e.jsxs(o,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:[e.jsx(J,{label:"From Date",value:L?G(L):null,onChange:t=>k((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(J,{label:"To Date",value:P?G(P):null,onChange:t=>w((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}}}})]})}),e.jsx(N,{fullWidth:!0,label:"Reason",multiline:!0,rows:3,value:z,onChange:t=>A(t.target.value),required:!0})]})}),e.jsx($e,{children:e.jsx(F,{variant:"contained",onClick:xe,disabled:n,sx:{bgcolor:"#08a3cd","&:hover":{bgcolor:"#068fb3"}},children:n?"Submitting...":u?"Update Application":"Submit Application"})})]}),e.jsx(_e,{open:W.open,onClose:()=>R({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this leave application?",action:e.jsx(F,{onClick:me,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),e.jsx(Ge,{open:I.open,autoHideDuration:6e3,onClose:U,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(De,{onClose:U,severity:I.severity,sx:{width:"100%"},children:I.message})}),e.jsx(Ke,{open:oe,onClose:ye,leaveId:ne})]})}function Wt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Leaves - ${Se.appName}`}),e.jsx(Xe,{})]})}export{Wt as default};
