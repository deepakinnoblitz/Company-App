import{j as e,B as O,d as H,v as T,I as v,r as a,T as j,p as R,q as we,y as ke,S as X,W as De,w as Oe}from"./index-Co7v2xsC.js";import{C as Te}from"./config-global-BX9xwJzv.js";import{getDoctypeList as J}from"./leads-d5FzXGcx.js";import{f as Pe}from"./invoice-CmnDHtbD.js";import{D as Re,C as Fe}from"./Card-CDV3jV6O.js";import{f as We,d as Ae}from"./invoice-collection-BM_vtNuI.js";import{E as Ee}from"./empty-content-BBDmaj4d.js";import{C as ze}from"./confirm-dialog--19ddTk_.js";import{T as Le,e as Be,a as Me}from"./table-empty-rows-BA_Yxb7w.js";import{f as Ne}from"./format-time-9uMX-KY9.js";import{c as K}from"./format-number-DSNgsWBE.js";import{c as Y,d as p,b as $e,T as He,a as Ye,e as Ge}from"./TableRow-DqeBPnxy.js";import{C as ee}from"./Checkbox-CoJXcvzD.js";import{a as Ze,T as qe}from"./TablePagination-CEaYVDlQ.js";import{O as Qe,I as Ve,M as Je}from"./Select-B1EkSlUY.js";import{B as te}from"./Badge-DIppMJwA.js";import{d as Ke}from"./dayjs.min-C2542nnJ.js";import{S as D}from"./Stack-GQIY7Xk9.js";import{A as N}from"./Autocomplete-BIV6h0T7.js";import{T as $}from"./TextField-BmVWmDzd.js";import{D as Ue}from"./DatePicker-BMZY9CMK.js";import{L as Xe,A as et}from"./AdapterDayjs-BPhbSeWE.js";import{S as tt}from"./Snackbar-BVA3LOhi.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./useFormControl-Cqn8lfES.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./usePreviousProps-CVIlMhUg.js";import"./Popper-DDlcgFVJ.js";import"./Chip-Rg4Dn3a5.js";import"./useThemeProps-BDg4jra0.js";import"./index-Chjiymov.js";import"./visuallyHidden-Dan1xhjv.js";function ot({row:d,selected:f,onSelectRow:x,onView:l,onEdit:b,onDelete:c,isLatest:g=!0,hideCheckbox:m=!1,index:u}){return e.jsxs(Y,{hover:!0,tabIndex:-1,role:"checkbox",selected:f,children:[!m&&e.jsx(p,{padding:"checkbox",children:e.jsx(ee,{disableRipple:!0,checked:f,onChange:x})}),typeof u=="number"&&e.jsx(p,{align:"center",children:e.jsx(O,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:s=>H(s.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:s=>`1px solid ${H(s.palette.primary.main,.16)}`,mx:"auto",transition:s=>s.transitions.create(["all"],{duration:s.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:u+1})}),e.jsx(p,{component:"th",scope:"row",children:e.jsx(O,{sx:{gap:2,display:"flex",alignItems:"center"},children:d.name})}),e.jsx(p,{children:d.invoice}),e.jsx(p,{children:d.customer_name||d.customer}),e.jsx(p,{children:Ne(d.collection_date)}),e.jsx(p,{children:d.mode_of_payment}),e.jsx(p,{align:"right",children:K(d.amount_collected)}),e.jsx(p,{align:"right",children:K(d.amount_pending||0)}),e.jsx(p,{align:"right",children:e.jsxs(O,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(T,{onClick:l,sx:{color:"info.main"},children:e.jsx(v,{icon:"solar:eye-bold"})}),g&&e.jsx(T,{onClick:b,sx:{color:"primary.main"},children:e.jsx(v,{icon:"solar:pen-bold"})}),g&&e.jsx(T,{onClick:c,sx:{color:"error.main"},children:e.jsx(v,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function nt({order:d,onSort:f,orderBy:x,rowCount:l,headLabel:b,numSelected:c,onSelectAllRows:g,hideCheckbox:m=!1,showIndex:u=!1}){return e.jsx($e,{children:e.jsxs(Y,{children:[!m&&e.jsx(p,{padding:"checkbox",children:e.jsx(ee,{indeterminate:c>0&&c<l,checked:l>0&&c===l,onChange:s=>g(s.target.checked)})}),u&&e.jsx(p,{align:"center",children:"Sno"}),b.map(s=>e.jsx(p,{align:s.align||"left",sx:{width:s.width,minWidth:s.minWidth},children:s.label},s.id))]})})}const U=[{value:"modified_desc",label:"Newest First"},{value:"modified_asc",label:"Oldest First"},{value:"collection_date_desc",label:"Date: Newest First"},{value:"collection_date_asc",label:"Date: Oldest First"},{value:"amount_collected_desc",label:"Amount: High to Low"},{value:"amount_collected_asc",label:"Amount: Low to High"},{value:"customer_name_asc",label:"Customer: A to Z"},{value:"customer_name_desc",label:"Customer: Z to A"}];function st({numSelected:d,filterName:f,onFilterName:x,onDelete:l,sortBy:b="modified_desc",onSortChange:c,onOpenFilter:g,canReset:m}){var n;const[u,s]=a.useState(null),C=o=>{s(o.currentTarget)},y=()=>{s(null)},P=o=>{c&&c(o),y()},_=((n=U.find(o=>o.value===b))==null?void 0:n.label)||"Sort";return e.jsxs(Ze,{sx:{height:96,display:"flex",justifyContent:"space-between",p:o=>o.spacing(0,1,0,3),...d>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[d>0?e.jsxs(j,{component:"div",variant:"subtitle1",children:[d," selected"]}):e.jsx(Qe,{value:f,onChange:x,placeholder:"Search by ID, Invoice No or Customer...",startAdornment:e.jsx(Ve,{position:"start",children:e.jsx(v,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:480,width:1}}),e.jsx(O,{sx:{display:"flex",gap:1,alignItems:"center"},children:d>0?e.jsx(T,{onClick:l,children:e.jsx(v,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[g&&e.jsx(R,{disableRipple:!0,color:"inherit",startIcon:e.jsx(te,{color:"error",variant:"dot",invisible:!m,children:e.jsx(v,{icon:"ic:round-filter-list"})}),onClick:g,sx:{height:40,px:2,bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500},children:"Filters"}),c&&e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"text",color:"inherit",startIcon:e.jsx(v,{icon:"solar:sort-bold"}),onClick:C,sx:{minWidth:160,height:40,px:2,color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500,"&:hover":{bgcolor:"action.hover"}},children:_}),e.jsx(Je,{anchorEl:u,open:!!u,onClose:y,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1,minWidth:200,boxShadow:o=>o.customShadows.z20}}},children:U.map(o=>e.jsx(we,{selected:o.value===b,onClick:()=>P(o.value),sx:{typography:"body2",...o.value===b&&{bgcolor:F=>H(F.palette.primary.main,.08),fontWeight:"fontWeightSemiBold"}},children:o.label},o.value))})]})]})})]})}function rt({open:d,onOpen:f,onClose:x,filters:l,onFilters:b,canReset:c,onResetFilters:g,options:m}){const u=(n,o)=>{b({[n]:o})},s=e.jsxs(O,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(j,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(T,{onClick:g,disabled:!c,sx:{mr:.5,color:c?"primary.main":"text.disabled","&:hover":{bgcolor:c?"primary.lighter":"transparent"}},children:e.jsx(te,{color:"error",variant:"dot",invisible:!c,children:e.jsx(v,{icon:"solar:restart-bold",width:20})})}),e.jsx(T,{onClick:x,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(v,{icon:"mingcute:close-line",width:20})})]}),C=e.jsxs(D,{spacing:1.5,children:[e.jsx(j,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Customer"}),e.jsx(N,{fullWidth:!0,size:"small",value:l.customer==="all"?null:m.customers.find(n=>n.name===l.customer)||null,onChange:(n,o)=>{u("customer",o?o.name:"all")},options:m.customers,getOptionLabel:n=>`${n.customer_name} (${n.name})`,renderInput:n=>e.jsx($,{...n,placeholder:"Search customers...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(n,o)=>a.createElement("li",{...n,key:o.name},e.jsxs(j,{variant:"body2",sx:{fontSize:"13px"},children:[o.customer_name," (",o.name,")"]}))})]}),y=e.jsxs(D,{spacing:1.5,children:[e.jsx(j,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Invoice No"}),e.jsx(N,{fullWidth:!0,size:"small",value:l.invoice||null,onChange:(n,o)=>{u("invoice",o||"")},options:m.invoices,renderInput:n=>e.jsx($,{...n,placeholder:"Select invoice no...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(n,o)=>a.createElement("li",{...n,key:o},e.jsx(j,{variant:"body2",sx:{fontSize:"13px"},children:o}))})]}),P=e.jsxs(D,{spacing:1.5,children:[e.jsx(j,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Collection Date"}),e.jsx(Ue,{value:l.collection_date?Ke(l.collection_date):null,onChange:n=>{u("collection_date",n?n.format("YYYY-MM-DD"):null)},slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}}})]}),_=e.jsxs(D,{spacing:1.5,children:[e.jsx(j,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Mode of Payment"}),e.jsx(N,{fullWidth:!0,size:"small",value:l.mode_of_payment==="all"?null:m.modesOfPayment.find(n=>n===l.mode_of_payment)||null,onChange:(n,o)=>{u("mode_of_payment",o||"all")},options:m.modesOfPayment,renderInput:n=>e.jsx($,{...n,placeholder:"Select payment mode...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(n,o)=>a.createElement("li",{...n,key:o},e.jsx(j,{variant:"body2",sx:{fontSize:"13px"},children:o}))})]});return e.jsx(ke,{anchor:"right",open:d,onClose:x,PaperProps:{sx:{width:320,display:"flex",flexDirection:"column"}},sx:{zIndex:n=>n.zIndex.drawer+2},children:e.jsxs(Xe,{dateAdapter:et,children:[s,e.jsx(X,{sx:{flexGrow:1},children:e.jsxs(D,{spacing:3,sx:{p:3},children:[C,y,P,_]})}),e.jsx(O,{sx:{p:3},children:e.jsx(R,{fullWidth:!0,color:"inherit",size:"large",variant:"outlined",startIcon:e.jsx(v,{icon:"solar:trash-bin-trash-bold"}),onClick:g,disabled:!c,children:"Clear All Filters"})})]})})}const it=[{id:"name",label:"ID"},{id:"invoice",label:"Invoice No"},{id:"customer",label:"Customer"},{id:"collection_date",label:"Date"},{id:"mode_of_payment",label:"Mode"},{id:"amount_collected",label:"Amount",align:"right"},{id:"amount_pending",label:"Pending",align:"right"},{id:""}];function at(){const d=De(),[f,x]=a.useState(0),[l,b]=a.useState(5),[c,g]=a.useState("modified"),[m,u]=a.useState("desc"),[s,C]=a.useState([]),[y,P]=a.useState([]),[_,n]=a.useState(0),[o,F]=a.useState(!0),[A,E]=a.useState({open:!1,id:null}),[w,oe]=a.useState(""),[z,L]=a.useState({open:!1,message:"",severity:"success"}),[ne,B]=a.useState(!1),[S,G]=a.useState({customer:"all",invoice:"",collection_date:null,mode_of_payment:"all"}),[se,re]=a.useState([]),[ie,ae]=a.useState([]),[le,ce]=a.useState([]);a.useEffect(()=>{J("Contacts",["name","first_name","company_name"]).then(t=>{const r=t.map(i=>({name:i.name,customer_name:i.first_name+(i.company_name?` - ${i.company_name}`:"")}));re(r)}),Pe({page:1,page_size:1e3}).then(t=>{const r=t.data.map(i=>i.name);ae(r)}),J("Payment Type",["name"]).then(t=>{ce(t.map(r=>r.name))})},[]);const M=a.useCallback(async()=>{try{F(!0);const{data:t,total:r}=await We({page:f+1,page_size:l,search:w,filters:S,sort_by:`${c}_${m}`}),i=new Map;t.forEach(h=>{const q=i.get(h.invoice);if(!q)i.set(h.invoice,h.name);else{const k=t.find(Ie=>Ie.name===q),Q=new Date(h.collection_date),V=new Date((k==null?void 0:k.collection_date)||0);(Q>V||Q.getTime()===V.getTime()&&new Date(h.creation)>new Date((k==null?void 0:k.creation)||0))&&i.set(h.invoice,h.name)}});const I=t.map(h=>({...h,isLatest:i.get(h.invoice)===h.name}));P(I),n(r)}catch(t){console.error(t)}finally{F(!1)}},[f,l,w,c,m,S]);a.useEffect(()=>{M()},[M]);const de=t=>{G(r=>({...r,...t})),x(0)},me=()=>{G({customer:"all",invoice:"",collection_date:null,mode_of_payment:"all"}),x(0)},W=S.customer!=="all"||!!S.invoice||!!S.collection_date||S.mode_of_payment!=="all",he=t=>{t!==""&&(u(c===t&&m==="asc"?"desc":"asc"),g(t))},ue=t=>{if(t){const r=y.map(i=>i.name);C(r);return}C([])},pe=t=>{const r=s.indexOf(t);let i=[];r===-1?i=i.concat(s,t):r===0?i=i.concat(s.slice(1)):r===s.length-1?i=i.concat(s.slice(0,-1)):r>0&&(i=i.concat(s.slice(0,r),s.slice(r+1))),C(i)},xe=(t,r)=>{x(r)},ge=t=>{b(parseInt(t.target.value,10)),x(0)},fe=a.useCallback(t=>{oe(t),x(0)},[]),be=()=>{d.push("/invoice-collections/new")},ve=t=>{d.push(`/invoice-collections/${t}/edit`)},je=t=>{d.push(`/invoice-collections/${t}/view`)},ye=a.useCallback(t=>{E({open:!0,id:t})},[]),Ce=async()=>{if(A.id)try{await Ae(A.id),L({open:!0,message:"Collection deleted successfully",severity:"success"}),M(),C([])}catch(t){console.error(t),L({open:!0,message:t.message||"Failed to delete collection",severity:"error"})}finally{E({open:!1,id:null})}},Z=()=>{L(t=>({...t,open:!1}))},_e=!o&&y.length===0&&(!!w||W),Se=!o&&y.length===0&&!w&&!W;return e.jsxs(Re,{children:[e.jsxs(D,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(j,{variant:"h4",children:"Invoice Collections"}),e.jsx(R,{variant:"contained",color:"info",startIcon:e.jsx(v,{icon:"mingcute:add-line"}),onClick:be,children:"New Collection"})]}),e.jsxs(Fe,{children:[e.jsx(st,{numSelected:s.length,filterName:w,onFilterName:t=>fe(t.target.value),sortBy:`${c}_${m}`,onSortChange:t=>{const[r,i]=t.split("_").reduce((I,h)=>(h==="asc"||h==="desc"?I[1]=h:I[0]=I[0]?`${I[0]}_${h}`:h,I),["","desc"]);g(r),u(i)},onOpenFilter:()=>B(!0),canReset:W}),e.jsx(X,{children:e.jsx(He,{sx:{overflow:"unset"},children:e.jsxs(Ye,{sx:{minWidth:800},children:[e.jsx(nt,{order:m,orderBy:c,rowCount:_,numSelected:s.length,onSort:he,onSelectAllRows:ue,hideCheckbox:!0,showIndex:!0,headLabel:it}),e.jsxs(Ge,{children:[y.map((t,r)=>e.jsx(ot,{index:f*l+r,hideCheckbox:!0,row:t,selected:s.includes(t.name),onSelectRow:()=>pe(t.name),onView:()=>je(t.name),onEdit:()=>ve(t.name),onDelete:()=>ye(t.name),isLatest:t.isLatest},t.name)),e.jsx(Le,{height:77,emptyRows:Be(f,l,_)}),_e&&e.jsx(Me,{searchQuery:w}),Se&&e.jsx(Y,{children:e.jsx(p,{colSpan:8,children:e.jsx(Ee,{title:"No invoice collections found",description:"Track your invoice payments and collections here.",icon:"solar:bill-check-bold-duotone"})})})]})]})})}),e.jsx(qe,{page:f,component:"div",count:_,rowsPerPage:l,onPageChange:xe,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:ge})]}),e.jsx(rt,{open:ne,onOpen:()=>B(!0),onClose:()=>B(!1),filters:S,onFilters:de,canReset:W,onResetFilters:me,options:{customers:se,invoices:ie,modesOfPayment:le}}),e.jsx(tt,{open:z.open,autoHideDuration:6e3,onClose:Z,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Oe,{onClose:Z,severity:z.severity,sx:{width:"100%"},children:z.message})}),e.jsx(ze,{open:A.open,onClose:()=>E({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this collection?",action:e.jsx(R,{variant:"contained",color:"error",onClick:Ce,sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function Yt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Invoice Collections - ${Te.appName}`}),e.jsx(at,{})]})}export{Yt as default};
