import{f as A,H as U,r as l,j as e,B as m,d as z,A as _e,T as h,I as C,v as N,D as $,p as I,S as Q,L as ve,q as S,w as we}from"./index-Co7v2xsC.js";import{C as Ce}from"./config-global-BX9xwJzv.js";import{h as H}from"./api-error-handler-CV6pRVHb.js";import{getDoctypeList as ke}from"./leads-d5FzXGcx.js";import{D as Se,C as Re}from"./Card-CDV3jV6O.js";import{E as Ae}from"./empty-content-BBDmaj4d.js";import{U as De,a as Je,b as Ie,T as Pe}from"./user-table-toolbar-BXgkag6p.js";import{L as K}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as X,d as k,T as Te,a as Ne,e as Oe}from"./TableRow-DqeBPnxy.js";import{C as Ee}from"./Checkbox-CoJXcvzD.js";import{S as R}from"./Stack-GQIY7Xk9.js";import{D as Y,a as Z}from"./DialogContent-DtP-sWqR.js";import{D as ee}from"./DialogTitle-C3eBZids.js";import{T as We}from"./TablePagination-CEaYVDlQ.js";import{T as y}from"./TextField-BmVWmDzd.js";import{R as Fe}from"./Rating-9hFTuiPC.js";import{D as Le}from"./DialogActions-h_2rRG3x.js";import{S as $e}from"./Snackbar-BVA3LOhi.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./visuallyHidden-Dan1xhjv.js";async function Ue(r=1,s=10,a="",o="creation",c="desc"){const b=[];a&&b.push(["Job Applicant","applicant_name","like",`%${a}%`]);const j=`${o} ${c}`,_=new URLSearchParams({doctype:"Job Applicant",fields:JSON.stringify(["*"]),filters:JSON.stringify(b),limit_start:String((r-1)*s),limit_page_length:String(s),order_by:j}),[g,p]=await Promise.all([A(`/api/method/frappe.client.get_list?${_.toString()}`),A(`/api/method/frappe.client.get_count?doctype=Job Applicant&filters=${encodeURIComponent(JSON.stringify(b))}`)]);if(!g.ok)throw new Error("Failed to fetch job applicants");const f=await g.json(),d=await p.json();return{data:f.message||[],total:d.message||0}}async function G(r){const s=await A(`/api/method/frappe.client.get?doctype=Job Applicant&name=${encodeURIComponent(r)}`);if(!s.ok)throw new Error("Failed to fetch job applicant details");return(await s.json()).message}async function He(r){const s=await U(),a=await A("/api/method/frappe.client.insert",{method:"POST",headers:s,body:JSON.stringify({doc:{doctype:"Job Applicant",...r}})}),o=await a.json();if(!a.ok)throw new Error(H(o,"Failed to create job applicant"));return o.message}async function Be(r,s){const a=await U(),o=await A("/api/method/frappe.client.set_value",{method:"POST",headers:a,body:JSON.stringify({doctype:"Job Applicant",name:r,fieldname:s})}),c=await o.json();if(!o.ok)throw new Error(H(c,"Failed to update job applicant"));return c.message}async function M(r){const s=await U(),a=await A("/api/method/frappe.client.delete",{method:"POST",headers:s,body:JSON.stringify({doctype:"Job Applicant",name:r})}),o=await a.json();if(!a.ok)throw new Error(H(o,"Failed to delete job applicant"));return o.message}async function qe(){const r=await A("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Job Applicant");return r.ok?(await r.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}function Ve(r=1,s=10,a="",o="creation",c="desc"){const[b,j]=l.useState([]),[_,g]=l.useState(0),[p,f]=l.useState(!0),[d,u]=l.useState(null),D=l.useCallback(async()=>{try{f(!0);const v=await Ue(r,s,a,o,c);j(v.data),g(v.total),u(null)}catch(v){u(v),console.error("Failed to fetch job applicants:",v)}finally{f(!1)}},[r,s,a,o,c]);return l.useEffect(()=>{D()},[D]),{data:b,total:_,loading:p,error:d,refetch:D}}function ze({row:r,selected:s,onSelectRow:a,onView:o,onEdit:c,onDelete:b,canEdit:j,canDelete:_,hideCheckbox:g=!1,index:p}){const f=d=>{let u="default";switch(d){case"Accepted":u="success";break;case"Rejected":u="error";break;case"Hold":u="warning";break;case"Open":case"Received":u="info";break;case"Replied":u="primary";break;default:u="default"}return e.jsx(K,{variant:"soft",color:u,children:d})};return e.jsxs(X,{hover:!0,selected:s,children:[!g&&e.jsx(k,{padding:"checkbox",children:e.jsx(Ee,{checked:s,onClick:a})}),typeof p=="number"&&e.jsx(k,{align:"center",children:e.jsx(m,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:d=>z(d.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:d=>`1px solid ${z(d.palette.primary.main,.16)}`,mx:"auto",transition:d=>d.transitions.create(["all"],{duration:d.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:p+1})}),e.jsx(k,{children:e.jsxs(R,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(_e,{alt:r.applicant_name,sx:{bgcolor:"primary.main",color:"common.white"},children:r.applicant_name.charAt(0).toUpperCase()}),e.jsxs(m,{children:[e.jsx(h,{variant:"subtitle2",noWrap:!0,sx:{color:"primary.main",cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:o,children:r.applicant_name}),e.jsx(h,{variant:"caption",sx:{color:"text.secondary"},noWrap:!0,children:r.email_id})]})]})}),e.jsx(k,{children:r.job_title||"-"}),e.jsx(k,{children:r.phone_number||"-"}),e.jsx(k,{children:e.jsxs(R,{direction:"row",alignItems:"center",spacing:.5,children:[e.jsx(C,{icon:"solar:star-bold",width:16,sx:{color:"warning.main"}}),e.jsx(h,{variant:"body2",children:r.applicant_rating||0})]})}),e.jsx(k,{children:f(r.status)}),e.jsx(k,{align:"right",children:e.jsxs(m,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(N,{size:"small",color:"primary",onClick:o,children:e.jsx(C,{icon:"solar:eye-bold"})}),j&&e.jsx(N,{size:"small",color:"info",onClick:c,children:e.jsx(C,{icon:"solar:pen-bold"})}),_&&e.jsx(N,{size:"small",color:"error",onClick:b,children:e.jsx(C,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function Ge({open:r,onClose:s,applicant:a}){var _;if(!a)return null;const o=g=>{let p="default";switch(g){case"Accepted":p="success";break;case"Rejected":p="error";break;case"Hold":p="warning";break;case"Open":case"Received":p="info";break;case"Replied":p="primary";break;default:p="default"}return e.jsx(K,{variant:"filled",color:p,sx:{height:32,px:2,borderRadius:1},children:g})},c=e.jsx(m,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2,mb:3},children:e.jsxs(R,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,children:[e.jsxs(m,{children:[e.jsx(h,{variant:"h4",sx:{mb:1,fontWeight:700},children:a.applicant_name}),e.jsxs(R,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(h,{variant:"subtitle2",color:"text.secondary",children:a.job_title||"No Job Assigned"}),a.designation&&e.jsxs(e.Fragment,{children:[e.jsx($,{orientation:"vertical",flexItem:!0,sx:{height:12,my:"auto"}}),e.jsx(h,{variant:"subtitle2",color:"text.secondary",children:a.designation})]}),e.jsx($,{orientation:"vertical",flexItem:!0,sx:{height:12,my:"auto"}}),e.jsx(h,{variant:"subtitle2",color:"text.secondary",children:a.city||a.state||a.country||"Location N/A"})]})]}),o(a.status)]})}),b=e.jsxs(m,{sx:{display:"grid",gap:2.5,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},mb:4},children:[e.jsx(J,{icon:"solar:letter-bold",label:"Email",value:a.email_id,isLink:!0,href:`mailto:${a.email_id}`}),e.jsx(J,{icon:"solar:phone-bold",label:"Phone",value:a.phone_number||"-",isLink:!0,href:`tel:${a.phone_number}`}),e.jsx(J,{icon:"solar:star-bold",label:"Rating",value:((_=a.applicant_rating)==null?void 0:_.toString())||"0"}),e.jsx(J,{icon:"solar:share-bold",label:"Source",value:a.source||"-"}),e.jsx(J,{icon:"solar:wad-of-money-bold",label:"Expected Salary",value:a.lower_range?`${a.currency||"â‚¹"} ${a.lower_range} - ${a.upper_range}`:"Not Disclosed"})]}),j=e.jsxs(m,{sx:{mt:2},children:[e.jsx(Me,{title:"Application Details",icon:"solar:notes-bold"}),e.jsxs(m,{sx:{display:"grid",gap:3,mt:2},children:[e.jsxs(m,{children:[e.jsx(h,{variant:"subtitle2",sx:{mb:1},children:"Cover Letter"}),e.jsx(m,{sx:{p:2,bgcolor:"background.neutral",borderRadius:1},children:e.jsx(h,{variant:"body2",sx:{color:"text.secondary",whiteSpace:"pre-wrap"},children:a.cover_letter||"No cover letter provided."})})]}),(a.resume_attachment||a.resume_link)&&e.jsxs(m,{children:[e.jsx(h,{variant:"subtitle2",sx:{mb:1},children:"Resume / Portfolio"}),e.jsxs(R,{direction:"row",spacing:2,children:[a.resume_attachment&&e.jsx(I,{variant:"outlined",startIcon:e.jsx(C,{icon:"solar:download-bold"}),href:a.resume_attachment,target:"_blank",children:"Download Resume"}),a.resume_link&&e.jsx(I,{variant:"outlined",startIcon:e.jsx(C,{icon:"solar:link-bold"}),href:a.resume_link,target:"_blank",children:"Resume Link"})]})]})]})]});return e.jsxs(Y,{open:r,onClose:s,fullWidth:!0,maxWidth:"md",children:[e.jsxs(ee,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Job Applicant Details",e.jsx(N,{onClick:s,children:e.jsx(C,{icon:"mingcute:close-line"})})]}),e.jsx(Q,{sx:{maxHeight:"85vh"},children:e.jsxs(Z,{sx:{p:4},children:[c,b,e.jsx($,{sx:{my:4,borderStyle:"dashed"}}),j]})})]})}function Me({title:r,icon:s}){return e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(C,{icon:s,width:24,sx:{mr:1.5,color:"primary.main"}}),e.jsx(h,{variant:"subtitle1",sx:{fontWeight:700},children:r})]})}function J({icon:r,label:s,value:a,isLink:o,href:c}){return e.jsxs(R,{direction:"row",spacing:1.5,alignItems:"flex-start",children:[e.jsx(C,{icon:r,width:20,sx:{color:"text.disabled",mt:.2}}),e.jsxs(m,{children:[e.jsx(h,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:s}),o?e.jsx(ve,{href:c,color:"primary",variant:"body2",sx:{fontWeight:600},children:a}):e.jsx(h,{variant:"body2",sx:{fontWeight:600},children:a})]})]})}function Qe(){const[r,s]=l.useState(0),[a,o]=l.useState(10),[c,b]=l.useState(""),[j,_]=l.useState("desc"),[g,p]=l.useState("creation"),[f,d]=l.useState([]),{data:u,total:D,refetch:v}=Ve(r+1,a,c,g,j),[O,te]=l.useState({read:!1,write:!1,delete:!1}),[ae,ne]=l.useState([]),[re,E]=l.useState(!1),[se,B]=l.useState(!1),[ie,le]=l.useState(null),[P,W]=l.useState(null),[i,x]=l.useState({applicant_name:"",email_id:"",phone_number:"",job_title:"",status:"Received",source:"",applicant_rating:0,cover_letter:"",resume_attachment:"",resume_link:"",lower_range:"",upper_range:"",currency:"INR"}),[T,w]=l.useState({open:!1,message:"",severity:"success"});l.useEffect(()=>{(async()=>{const n=await qe();te(n);const L=await ke("Job Opening",["name","job_title"]);ne(L)})()},[]);const oe=t=>{_(g===t&&j==="asc"?"desc":"asc"),p(t)},ce=t=>{d(t?u.map(n=>n.name):[])},de=t=>{d(n=>n.includes(t)?n.filter(L=>L!==t):[...n,t])},ue=()=>{W(null),x({applicant_name:"",email_id:"",phone_number:"",job_title:"",status:"Received",source:"",applicant_rating:0,cover_letter:"",resume_attachment:"",resume_link:"",lower_range:"",upper_range:"",currency:"INR"}),E(!0)},F=()=>{E(!1),W(null)},pe=l.useCallback(async t=>{try{const n=await G(t.name);W(n),x({applicant_name:n.applicant_name,email_id:n.email_id,phone_number:n.phone_number,job_title:n.job_title,status:n.status,source:n.source,applicant_rating:n.applicant_rating,cover_letter:n.cover_letter,resume_attachment:n.resume_attachment,resume_link:n.resume_link,lower_range:n.lower_range,upper_range:n.upper_range,currency:n.currency||"INR"}),E(!0)}catch(n){w({open:!0,message:n.message||"Failed to load record",severity:"error"})}},[]),me=l.useCallback(async t=>{try{const n=await G(t.name);le(n),B(!0)}catch(n){w({open:!0,message:n.message||"Failed to load record",severity:"error"})}},[]),he=l.useCallback(async t=>{try{await M(t),w({open:!0,message:"Deleted successfully",severity:"success"}),v()}catch(n){w({open:!0,message:n.message||"Delete failed",severity:"error"})}},[v]),xe=async()=>{try{await Promise.all(f.map(t=>M(t))),w({open:!0,message:"Deleted successfully",severity:"success"}),d([]),v()}catch(t){w({open:!0,message:t.message||"Bulk delete failed",severity:"error"})}},ge=async()=>{try{P?(await Be(P.name,i),w({open:!0,message:"Updated successfully",severity:"success"})):(await He(i),w({open:!0,message:"Created successfully",severity:"success"})),F(),v()}catch(t){w({open:!0,message:t.message||"Action failed",severity:"error"})}},be=(t,n)=>{s(n)},je=t=>{o(parseInt(t.target.value,10)),s(0)},fe=t=>{b(t.target.value),s(0)},q=()=>{w({...T,open:!1})},ye=!u.length&&!!c,V=!u.length&&!c;return e.jsxs(Se,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:5},children:[e.jsx(h,{variant:"h4",children:"Job Applicants"}),O.write&&e.jsx(I,{variant:"contained",color:"primary",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),onClick:ue,children:"New Applicant"})]}),e.jsxs(Re,{children:[e.jsx(De,{numSelected:f.length,filterName:c,onFilterName:fe,onDelete:xe,searchPlaceholder:"Search applicants..."}),e.jsx(Q,{children:e.jsx(Te,{sx:{overflow:"unset"},children:e.jsxs(Ne,{sx:{minWidth:800},children:[e.jsx(Je,{order:j,orderBy:g,rowCount:u.length,numSelected:f.length,onSort:oe,onSelectAllRows:t=>ce(t),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"applicant_name",label:"Name"},{id:"job_title",label:"Job Opening"},{id:"phone_number",label:"Phone"},{id:"applicant_rating",label:"Rating"},{id:"status",label:"Status"},{id:"",label:""}]}),e.jsxs(Oe,{children:[u.map((t,n)=>e.jsx(ze,{index:r*a+n,hideCheckbox:!0,row:{id:t.name,applicant_name:t.applicant_name,email_id:t.email_id,phone_number:t.phone_number,job_title:t.job_title,status:t.status,applicant_rating:t.applicant_rating},selected:f.includes(t.name),onSelectRow:()=>de(t.name),onView:()=>me(t),onEdit:()=>pe(t),onDelete:()=>he(t.name),canEdit:O.write,canDelete:O.delete},t.name)),ye&&e.jsx(Ie,{searchQuery:c}),V&&e.jsx(X,{children:e.jsx(k,{colSpan:6,children:e.jsx(Ae,{title:"No applicants found",description:"There are no candidates for your job openings yet.",icon:"solar:user-resume-bold-duotone"})})}),!V&&e.jsx(Pe,{height:68,emptyRows:Math.max(0,a-u.length)})]})]})})}),e.jsx(We,{component:"div",page:r,count:D,rowsPerPage:a,onPageChange:be,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:je})]}),e.jsxs(Y,{open:re,onClose:F,fullWidth:!0,maxWidth:"md",children:[e.jsx(ee,{children:P?"Edit Applicant":"New Applicant"}),e.jsx(Z,{children:e.jsx(R,{spacing:3,sx:{mt:2},children:e.jsxs(m,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"}},children:[e.jsx(y,{fullWidth:!0,label:"Applicant Name",value:i.applicant_name,onChange:t=>x({...i,applicant_name:t.target.value}),required:!0}),e.jsx(y,{fullWidth:!0,label:"Email ID",value:i.email_id,onChange:t=>x({...i,email_id:t.target.value}),required:!0}),e.jsx(y,{fullWidth:!0,label:"Phone Number",value:i.phone_number,onChange:t=>x({...i,phone_number:t.target.value})}),e.jsx(y,{select:!0,fullWidth:!0,label:"Job Opening",value:i.job_title,onChange:t=>x({...i,job_title:t.target.value}),children:ae.map(t=>e.jsx(S,{value:t.name,children:t.job_title||t.name},t.name))}),e.jsxs(y,{select:!0,fullWidth:!0,label:"Status",value:i.status,onChange:t=>x({...i,status:t.target.value}),children:[e.jsx(S,{value:"Received",children:"Received"}),e.jsx(S,{value:"Open",children:"Open"}),e.jsx(S,{value:"Replied",children:"Replied"}),e.jsx(S,{value:"Hold",children:"Hold"}),e.jsx(S,{value:"Accepted",children:"Accepted"}),e.jsx(S,{value:"Rejected",children:"Rejected"})]}),e.jsx(y,{fullWidth:!0,label:"Source",value:i.source,onChange:t=>x({...i,source:t.target.value}),placeholder:"LinkedIn, Referral, etc."}),e.jsxs(m,{sx:{gridColumn:"span 2"},children:[e.jsx(h,{component:"legend",children:"Applicant Rating"}),e.jsx(Fe,{name:"applicant-rating",value:i.applicant_rating,onChange:(t,n)=>{x({...i,applicant_rating:n})}})]}),e.jsx(y,{fullWidth:!0,label:"Resume Link",value:i.resume_link,onChange:t=>x({...i,resume_link:t.target.value}),placeholder:"Google Drive, Dropbox, etc."}),e.jsx(y,{fullWidth:!0,label:"Resume Attachment",value:i.resume_attachment,onChange:t=>x({...i,resume_attachment:t.target.value}),placeholder:"File URL",helperText:"For now, please provide the URL of the uploaded resume."}),e.jsx(y,{fullWidth:!0,label:"Expected Salary (Lower)",type:"number",value:i.lower_range,onChange:t=>x({...i,lower_range:t.target.value})}),e.jsx(y,{fullWidth:!0,label:"Expected Salary (Upper)",type:"number",value:i.upper_range,onChange:t=>x({...i,upper_range:t.target.value})}),e.jsx(y,{fullWidth:!0,multiline:!0,rows:4,label:"Cover Letter",value:i.cover_letter,onChange:t=>x({...i,cover_letter:t.target.value}),sx:{gridColumn:"span 2"}})]})})}),e.jsxs(Le,{children:[e.jsx(I,{variant:"outlined",onClick:F,children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:ge,children:P?"Update":"Create"})]})]}),e.jsx(Ge,{open:se,onClose:()=>B(!1),applicant:ie}),e.jsx($e,{open:T.open,autoHideDuration:6e3,onClose:q,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(we,{onClose:q,severity:T.severity,sx:{width:"100%"},children:T.message})})]})}function wt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Job Applicants - ${Ce.appName}`}),e.jsx(Qe,{})]})}export{wt as default};
