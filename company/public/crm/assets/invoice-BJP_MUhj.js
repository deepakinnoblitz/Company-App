import{r as d,j as e,T as n,v as J,I as u,B as r,D as ne,h as K,p as M,S as ae,d as A}from"./index-Co7v2xsC.js";import{C as le}from"./config-global-BX9xwJzv.js";import{d as N}from"./dayjs.min-C2542nnJ.js";import{r as ie,u as z,w as Q}from"./reports-0l1D3gVE.js";import{D as ce,C as O}from"./Card-CDV3jV6O.js";import{E as de}from"./export-fields-dialog-DKDJ10Kv.js";import{g as xe}from"./invoice-CmnDHtbD.js";import{L as he}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{D as pe,a as ge}from"./DialogContent-DtP-sWqR.js";import{D as me}from"./DialogTitle-C3eBZids.js";import{S as k}from"./Stack-GQIY7Xk9.js";import{T as ue}from"./TextField-BmVWmDzd.js";import{L as fe,A as je}from"./AdapterDayjs-BPhbSeWE.js";import{D as H}from"./DatePicker-BMZY9CMK.js";import{T as be,a as ye,b as ve,c as B,d as s,e as Se}from"./TableRow-DqeBPnxy.js";import{C as V}from"./Checkbox-CoJXcvzD.js";import{T as Ie}from"./TablePagination-CEaYVDlQ.js";import"./api-error-handler-CV6pRVHb.js";import"./RadioGroup-B7r1ll7C.js";import"./useFormControl-Cqn8lfES.js";import"./FormControlLabel-CEvUm0a3.js";import"./DialogActions-h_2rRG3x.js";import"./Select-B1EkSlUY.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function Ce({open:c,onClose:l,invoiceId:i}){var g,v,D,S,_,C;const[o,f]=d.useState(null),[I,b]=d.useState(!1);return d.useEffect(()=>{c&&i?(b(!0),xe(i).then(f).catch(a=>console.error("Failed to fetch invoice details:",a)).finally(()=>b(!1))):f(null)},[c,i]),e.jsxs(pe,{open:c,onClose:l,fullWidth:!0,maxWidth:"md",children:[e.jsxs(me,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:800},children:"Invoice Profile"}),e.jsx(J,{onClick:l,sx:{color:a=>a.palette.grey[500],bgcolor:"background.paper",boxShadow:a=>{var y;return(y=a.customShadows)==null?void 0:y.z1}},children:e.jsx(u,{icon:"mingcute:close-line"})})]}),e.jsx(ge,{sx:{p:4,m:2,mt:4},children:I?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(u,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):o?e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(r,{sx:{width:64,height:64,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.lighter",color:"primary.main"},children:e.jsx(u,{icon:"solar:bill-list-bold-duotone",width:32})}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"h5",sx:{fontWeight:800},children:o.customer_name}),e.jsxs(n,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:["Ref No: ",o.ref_no||"-"]})]}),e.jsxs(r,{sx:{textAlign:"right"},children:[e.jsx(he,{variant:"soft",color:"success",children:"Invoice"}),e.jsxs(n,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled",fontWeight:700},children:["ID: ",o.name]})]})]}),e.jsx(ne,{sx:{borderStyle:"dashed"}}),e.jsxs(r,{children:[e.jsx(E,{title:"Invoice Details",icon:"solar:info-circle-bold"}),e.jsxs(r,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(p,{label:"Customer",value:o.customer_name,icon:"solar:user-bold"}),e.jsx(p,{label:"Ref No",value:o.ref_no,icon:"solar:tag-bold"}),e.jsx(p,{label:"Invoice Date",value:o.invoice_date,icon:"solar:calendar-date-bold"}),e.jsx(p,{label:"Due Date",value:o.due_date,icon:"solar:calendar-minimalistic-bold",color:"error.main"}),e.jsx(p,{label:"Billing Name",value:o.billing_name,icon:"solar:bill-list-bold"}),e.jsx(p,{label:"Phone Number",value:o.phone_number,icon:"solar:phone-bold"}),e.jsx(p,{label:"Grand Total",value:`₹${((g=o.grand_total)==null?void 0:g.toLocaleString())||0}`,icon:"solar:wad-of-money-bold",color:"primary.main"}),e.jsx(p,{label:"Received Amount",value:`₹${((v=o.received_amount)==null?void 0:v.toLocaleString())||0}`,icon:"solar:hand-money-bold",color:"success.main"}),e.jsx(p,{label:"Balance",value:`₹${((D=o.balance_amount)==null?void 0:D.toLocaleString())||0}`,icon:"solar:round-transfer-horizontal-bold",color:"warning.main"})]})]}),e.jsxs(r,{children:[e.jsx(E,{title:"Items",icon:"solar:cart-large-minimalistic-bold"}),e.jsxs(r,{sx:{bgcolor:"background.neutral",borderRadius:2,overflow:"hidden",border:a=>`1px solid ${a.palette.divider}`},children:[e.jsxs(r,{sx:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",p:1.5,bgcolor:a=>a.palette.grey[200],borderBottom:a=>`1px solid ${a.palette.divider}`},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:800,color:"text.secondary"},children:"ITEM"}),e.jsx(n,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"QTY"}),e.jsx(n,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"PRICE"}),e.jsx(n,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"TOTAL"})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column"},children:[(S=o.table_qecz)==null?void 0:S.map((a,y)=>{var R,W;return e.jsxs(r,{sx:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",p:1.5,borderBottom:L=>y!==o.table_qecz.length-1?`1px solid ${L.palette.divider}`:"none"},children:[e.jsxs(r,{children:[e.jsx(n,{variant:"subtitle2",children:a.service}),e.jsx(n,{variant:"caption",sx:{color:"text.disabled"},children:a.description||a.service})]}),e.jsx(n,{variant:"body2",sx:{textAlign:"right"},children:a.quantity}),e.jsxs(n,{variant:"body2",sx:{textAlign:"right"},children:["₹",((R=a.price)==null?void 0:R.toLocaleString())||0]}),e.jsxs(n,{variant:"body2",sx:{textAlign:"right",fontWeight:600},children:["₹",((W=a.sub_total)==null?void 0:W.toLocaleString())||0]})]},y)}),(!o.table_qecz||o.table_qecz.length===0)&&e.jsx(r,{sx:{p:3,textAlign:"center"},children:e.jsx(n,{variant:"body2",sx:{color:"text.secondary"},children:"No items found"})})]})]})]}),e.jsxs(r,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(E,{title:"Financial Summary",icon:"solar:bill-list-bold",noMargin:!0}),e.jsxs(r,{sx:{mt:3,display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(p,{label:"Total Qty",value:o.total_qty,icon:"solar:box-bold"}),e.jsx(p,{label:"Total Amount",value:`₹${((_=o.total_amount)==null?void 0:_.toLocaleString())||0}`,icon:"solar:wad-of-money-bold"}),e.jsx(p,{label:"Grand Total",value:`₹${((C=o.grand_total)==null?void 0:C.toLocaleString())||0}`,icon:"solar:tag-bold",color:"primary.main"})]})]}),e.jsxs(r,{children:[e.jsx(E,{title:"System Information",icon:"solar:clock-circle-bold"}),e.jsxs(r,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(p,{label:"Created On",value:new Date(o.creation).toLocaleString(),icon:"solar:calendar-date-bold"}),e.jsx(p,{label:"Owner",value:o.owner,icon:"solar:user-rounded-bold"})]})]})]}):e.jsxs(r,{sx:{py:10,textAlign:"center"},children:[e.jsx(u,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(n,{variant:"h6",sx:{color:"text.secondary"},children:"Invoice Not Found"})]})})]})}function E({title:c,icon:l,noMargin:i=!1}){return e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:i?0:2.5},children:[e.jsx(u,{icon:l,width:20,sx:{color:"primary.main"}}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:c})]})}function p({label:c,value:l,icon:i,color:o="text.primary"}){return e.jsxs(r,{children:[e.jsx(n,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:c}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(u,{icon:i,width:16,sx:{color:"text.disabled"}}),e.jsx(n,{variant:"body2",sx:{fontWeight:700,color:o},children:l||"-"})]})]})}function we(){K();const[c,l]=d.useState(!1),[i,o]=d.useState([]),[f,I]=d.useState([]),[b,g]=d.useState(""),[v,D]=d.useState(null),[S,_]=d.useState(null),[C,a]=d.useState(0),[y,R]=d.useState(10),[W,L]=d.useState(!1),[U,q]=d.useState(null),[j,F]=d.useState([]),[X,G]=d.useState(!1),Z=t=>{if(t.target.checked){const m=i.map(x=>x.name);F(m);return}F([])},ee=(t,m)=>{const x=j.indexOf(m);let h=[];x===-1?h=h.concat(j,m):x===0?h=h.concat(j.slice(1)):x===j.length-1?h=h.concat(j.slice(0,-1)):x>0&&(h=h.concat(j.slice(0,x),j.slice(x+1))),F(h)},te=async(t,m)=>{l(!0);try{const x=i.map(Y=>{const T={};return t.forEach(P=>{T[P]=Y[P]}),T}),h=z.json_to_sheet(x),w=z.book_new();z.book_append_sheet(w,h,"Invoices"),m==="excel"?Q(w,`Invoice_Report_${N().format("YYYYMMDD")}.xlsx`):Q(w,`Invoice_Report_${N().format("YYYYMMDD")}.csv`,{bookType:"csv"})}catch(x){console.error("Export failed:",x)}finally{l(!1)}},$=d.useCallback(async()=>{l(!0);try{const t={};b&&(t.client_name=b),v&&(t.from_date=v.format("YYYY-MM-DD")),S&&(t.to_date=S.format("YYYY-MM-DD"));const m=await ie("Invoice Report",t);o(m.result||[]),I(m.report_summary||[])}catch(t){console.error("Failed to fetch invoice report:",t)}finally{l(!1)}},[b,v,S]);d.useEffect(()=>{$()},[$]);const oe=()=>{g(""),D(null),_(null)},re=(t,m)=>{a(m)},se=t=>{R(parseInt(t.target.value,10)),a(0)};return e.jsxs(ce,{children:[e.jsxs(k,{spacing:3,children:[e.jsxs(k,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h4",children:"Invoice Report"}),e.jsxs(k,{direction:"row",spacing:1,children:[e.jsx(M,{variant:"outlined",startIcon:e.jsx(u,{icon:"solar:refresh-bold"}),onClick:$,disabled:c,children:"Refresh"}),e.jsx(M,{variant:"outlined",color:"error",startIcon:e.jsx(u,{icon:"solar:restart-bold"}),onClick:oe,children:"Reset"})]})]}),e.jsxs(O,{sx:{p:2.5,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"background.neutral",border:t=>`1px solid ${t.palette.divider}`},children:[e.jsx(ue,{label:"Customer Name",value:b,onChange:t=>g(t.target.value),placeholder:"Search customer...",size:"small",sx:{minWidth:200}}),e.jsxs(fe,{dateAdapter:je,children:[e.jsx(H,{label:"From Date",value:v,onChange:t=>D(t),slotProps:{textField:{size:"small"}}}),e.jsx(H,{label:"To Date",value:S,onChange:t=>_(t),slotProps:{textField:{size:"small"}}})]}),e.jsx(r,{sx:{flexGrow:1}}),e.jsx(M,{variant:"contained",startIcon:e.jsx(u,{icon:"solar:export-bold"}),onClick:()=>G(!0),children:"Export"})]}),e.jsx(r,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:f.map(t=>e.jsx(De,{item:t},t.label))}),e.jsxs(O,{children:[e.jsx(be,{sx:{position:"relative",overflow:"unset"},children:e.jsx(ae,{children:e.jsxs(ye,{size:"medium",stickyHeader:!0,children:[e.jsx(ve,{children:e.jsxs(B,{sx:{bgcolor:"#f4f6f8"},children:[e.jsx(s,{padding:"checkbox",children:e.jsx(V,{indeterminate:j.length>0&&j.length<i.length,checked:i.length>0&&j.length===i.length,onChange:Z})}),e.jsx(s,{sx:{fontWeight:700,color:"text.secondary"},children:"Ref No"}),e.jsx(s,{sx:{fontWeight:700,color:"text.secondary"},children:"Customer"}),e.jsx(s,{sx:{fontWeight:700,color:"text.secondary"},children:"Date"}),e.jsx(s,{sx:{fontWeight:700,color:"text.secondary"},children:"Item"}),e.jsx(s,{align:"center",sx:{fontWeight:700,color:"text.secondary"},children:"Qty"}),e.jsx(s,{align:"right",sx:{fontWeight:700,color:"text.secondary"},children:"Price"}),e.jsx(s,{align:"right",sx:{fontWeight:700,color:"text.secondary"},children:"Tax"}),e.jsx(s,{align:"right",sx:{fontWeight:700,color:"text.secondary"},children:"Subtotal"}),e.jsx(s,{align:"right",sx:{fontWeight:700,color:"text.secondary"},children:"Grand Total"}),e.jsx(s,{align:"right",sx:{fontWeight:700,color:"text.secondary",position:"sticky",right:0,bgcolor:"#f4f6f8",zIndex:11},children:"Actions"})]})}),e.jsxs(Se,{children:[i.slice(C*y,C*y+y).map((t,m)=>{var h,w,Y,T;const x=j.indexOf(t.name)!==-1;return e.jsxs(B,{hover:!0,role:"checkbox","aria-checked":x,selected:x,children:[e.jsx(s,{padding:"checkbox",children:e.jsx(V,{checked:x,onClick:P=>ee(P,t.name)})}),e.jsx(s,{children:t.name}),e.jsx(s,{children:t.customer_name}),e.jsx(s,{children:t.invoice_date?N(t.invoice_date).format("DD MMM YYYY"):"-"}),e.jsx(s,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.service}),e.jsx(s,{align:"center",children:t.quantity}),e.jsxs(s,{align:"right",children:["₹",((h=t.price)==null?void 0:h.toLocaleString())||0]}),e.jsxs(s,{align:"right",children:["₹",((w=t.tax_amount)==null?void 0:w.toLocaleString())||0]}),e.jsxs(s,{align:"right",children:["₹",((Y=t.sub_total)==null?void 0:Y.toLocaleString())||0]}),e.jsxs(s,{align:"right",sx:{fontWeight:700},children:["₹",((T=t.grand_total)==null?void 0:T.toLocaleString())||0]}),e.jsx(s,{align:"right",sx:{position:"sticky",right:0,bgcolor:"background.paper",boxShadow:"-2px 0 4px rgba(145, 158, 171, 0.08)"},children:e.jsx(J,{onClick:()=>{q(t.name),L(!0)},sx:{color:"info.main"},children:e.jsx(u,{icon:"solar:eye-bold"})})})]},m)}),i.length===0&&!c&&e.jsx(B,{children:e.jsx(s,{colSpan:11,align:"center",sx:{py:10},children:e.jsxs(k,{spacing:1,alignItems:"center",children:[e.jsx(u,{icon:"eva:slash-outline",width:48,sx:{color:"text.disabled"}}),e.jsx(n,{variant:"body2",sx:{color:"text.disabled"},children:"No data found"})]})})})]})]})})}),e.jsx(Ie,{component:"div",count:i.length,page:C,onPageChange:re,rowsPerPage:y,onRowsPerPageChange:se})]})]}),e.jsx(Ce,{open:W,invoiceId:U,onClose:()=>{L(!1),q(null)}}),e.jsx(de,{open:X,onClose:()=>G(!1),doctype:"Invoice",onExport:te})]})}function De({item:c}){var I,b;const l=K(),i=g=>{switch(g==null?void 0:g.toLowerCase()){case"blue":return l.palette.info.main;case"green":return l.palette.success.main;case"orange":return l.palette.warning.main;case"red":return l.palette.error.main;default:return l.palette.primary.main}},o=g=>g.includes("Amount")?"solar:wad-of-money-bold-duotone":g.includes("Quantity")?"solar:box-bold-duotone":g.includes("Records")?"solar:document-text-bold-duotone":"solar:chart-2-bold-duotone",f=i(c.indicator);return e.jsxs(O,{sx:{p:3,boxShadow:"none",position:"relative",overflow:"hidden",bgcolor:A(f,.04),border:`1px solid ${A(f,.1)}`,transition:l.transitions.create(["transform","box-shadow"]),"&:hover":{transform:"translateY(-4px)",boxShadow:`0 12px 24px -4px ${A(f,.12)}`}},children:[e.jsxs(k,{direction:"row",alignItems:"center",spacing:2.5,children:[e.jsx(r,{sx:{width:48,height:48,flexShrink:0,display:"flex",borderRadius:1.5,alignItems:"center",justifyContent:"center",color:f,bgcolor:A(f,.1)},children:e.jsx(u,{icon:o(c.label),width:28})}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:700,mb:.5},children:c.label}),e.jsx(n,{variant:"h4",sx:{color:"text.primary",fontWeight:800},children:c.datatype==="Currency"?`₹${(I=c.value)==null?void 0:I.toLocaleString()}`:(b=c.value)==null?void 0:b.toLocaleString()})]})]}),e.jsx(r,{sx:{top:-16,right:-16,width:80,height:80,opacity:.08,position:"absolute",borderRadius:"50%",bgcolor:f}})]})}function st(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Invoice Report - ${le.appName}`}),e.jsx(we,{})]})}export{st as default};
