import{f as n,H as c}from"./index-Co7v2xsC.js";import{h as f}from"./api-error-handler-CV6pRVHb.js";async function g(t){const e=[],i=[];t.search&&(i.push(["Estimation","ref_no","like",`%${t.search}%`]),i.push(["Estimation","customer_name","like",`%${t.search}%`]),i.push(["Estimation","phone_number","like",`%${t.search}%`])),t.filters&&(t.filters.client_name&&t.filters.client_name!=="all"&&e.push(["Estimation","client_name","=",t.filters.client_name]),t.filters.ref_no&&e.push(["Estimation","ref_no","like",`%${t.filters.ref_no}%`]),t.filters.estimate_date&&e.push(["Estimation","estimate_date","=",t.filters.estimate_date]));let o="creation desc";if(t.sort_by){const[_,p]=t.sort_by.split("_").reduce((s,a)=>(a==="asc"||a==="desc"?s[1]=a:s[0]=s[0]?`${s[0]}_${a}`:a,s),["","desc"]);o=`${_} ${p}`}const r=new URLSearchParams({doctype:"Estimation",fields:JSON.stringify(["name","ref_no","client_name","customer_name","estimate_date","grand_total","creation"]),filters:JSON.stringify(e),or_filters:JSON.stringify(i),limit_start:String((t.page-1)*t.page_size),limit_page_length:String(t.page_size),order_by:o}),[d,m]=await Promise.all([n(`/api/method/frappe.client.get_list?${r.toString()}`),n(`/api/method/frappe.client.get_count?doctype=Estimation&filters=${encodeURIComponent(JSON.stringify(e))}&or_filters=${encodeURIComponent(JSON.stringify(i))}`)]);if(!d.ok)throw new Error("Failed to fetch estimations");const l=await d.json(),h=await m.json();return{data:l.message||[],total:h.message||0}}async function w(t){const e=await c(),i=await n("/api/method/frappe.client.insert",{method:"POST",headers:e,body:JSON.stringify({doc:{doctype:"Estimation",...t}})}),o=await i.json();if(!i.ok)throw new Error(f(o,"Failed to create estimation"));return o.message}async function E(t,e){const i=await c(),o=await n("/api/method/frappe.client.set_value",{method:"POST",headers:i,body:JSON.stringify({doctype:"Estimation",name:t,fieldname:e})}),r=await o.json();if(!o.ok)throw new Error(f(r,"Failed to update estimation"));return r.message}async function S(t){const e=await c(),i=await n("/api/method/frappe.client.delete",{method:"POST",headers:e,body:JSON.stringify({doctype:"Estimation",name:t})}),o=await i.json();if(!i.ok)throw new Error(f(o,"Failed to delete estimation"));return o.message}async function O(t){const e=await n(`/api/method/frappe.client.get?doctype=Estimation&name=${encodeURIComponent(t)}`);if(!e.ok)throw new Error("Failed to fetch estimation details");return(await e.json()).message}function $(t){return`/api/method/frappe.utils.print_format.download_pdf?doctype=Estimation&name=${encodeURIComponent(t)}`}async function j(t){const e=await c(),i=await n("/api/method/company.company.frontend_api.convert_estimation_to_invoice",{method:"POST",headers:e,body:JSON.stringify({estimation:t})}),o=await i.json();if(!i.ok)throw new Error(f(o,"Failed to convert estimation"));return o.message}export{$ as a,w as b,j as c,S as d,g as f,O as g,E as u};
