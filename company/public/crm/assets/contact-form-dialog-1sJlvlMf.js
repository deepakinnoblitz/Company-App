import{r as s,j as t,v as ee,I as U,B as z,p as te}from"./index-Co7v2xsC.js";import{y as se}from"./mui-tel-input.es-qb3PikOv.js";import{getDoctypeList as ae}from"./leads-d5FzXGcx.js";import{l as E}from"./location_data-s7SeKs4x.js";import{a as re,u as ne,c as le}from"./contacts-Y516V3QZ.js";import{D as ie,a as oe}from"./DialogContent-DtP-sWqR.js";import{D as ue}from"./DialogTitle-C3eBZids.js";import{T as r}from"./TextField-BmVWmDzd.js";import{D as ce}from"./DialogActions-h_2rRG3x.js";function Ce({open:d,onClose:f,contactId:i,onSuccess:L}){const[G,_]=s.useState(!1),[w,k]=s.useState(!1),[h,p]=s.useState(""),[T,g]=s.useState(""),[y,x]=s.useState(""),[m,v]=s.useState(""),[A,S]=s.useState(""),[B,C]=s.useState(""),[F,j]=s.useState(""),[n,b]=s.useState(""),[o,D]=s.useState(""),[q,N]=s.useState(""),[I,W]=s.useState("Sales"),[H,$]=s.useState(""),[J,K]=s.useState([]),[M,O]=s.useState([]),[Q,u]=s.useState([]),[de,V]=s.useState([]),[P,c]=s.useState({});s.useEffect(()=>{const e=Array.from(new Set(E.map(a=>a.country)));K(["",...e]),ae("Lead",["name","lead_name"]).then(V).catch(console.error)},[]),s.useEffect(()=>{d&&i?(_(!0),re(i).then(e=>{p(e.first_name||""),g(e.company_name||""),x(e.email||""),v(Y(e.phone||"")),S(e.designation||""),C(e.address||""),j(e.notes||""),b(e.country||""),D(e.state||""),N(e.city||""),W(e.customer_type||"Sales"),$(e.source_lead||"")}).catch(console.error).finally(()=>_(!1))):d&&X()},[d,i]),s.useEffect(()=>{if(n){const e=E.find(a=>a.country===n);if(e){const a=e.states.map(l=>l.name);O(["",...a,"Others"])}else O([])}else O([]),u([])},[n]),s.useEffect(()=>{if(o&&n)if(o==="Others")u(["Others"]);else{const e=E.find(a=>a.country===n);if(e){const a=e.states.find(l=>l.name===o);u(a?["",...a.cities,"Others"]:["Others"])}}else u([])},[o,n]);const X=()=>{p(""),g(""),x(""),v(""),S(""),C(""),j(""),b(""),D(""),N(""),W("Sales"),$(""),c({})},Y=e=>e?e.startsWith("+")&&e.includes("-")?e.replace("-"," "):e:"",Z=async()=>{const e={};if(h||(e.firstName=!0),y||(e.email=!0),m||(e.phone=!0),Object.keys(e).length>0){c(e);return}try{k(!0);let a=m.replace(/\s/g,"");const l=m.trim().split(/\s+/);l.length>1&&l[0].startsWith("+")&&(a=`${l[0]}-${l.slice(1).join("")}`);const R={first_name:h,company_name:T,email:y,phone:a,designation:A,address:B,notes:F,country:n,state:o,city:q,customer_type:I,source_lead:H};i?await ne(i,R):await le(R),L&&L(),f()}catch(a){console.error(a)}finally{k(!1)}};return t.jsxs(ie,{open:d,onClose:f,fullWidth:!0,maxWidth:"md",children:[t.jsxs(ue,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i?"Edit Contact":"New Contact",t.jsx(ee,{onClick:f,sx:{color:e=>e.palette.grey[500]},children:t.jsx(U,{icon:"mingcute:close-line"})})]}),t.jsx(oe,{dividers:!0,children:G?t.jsx(z,{sx:{py:10,textAlign:"center"},children:t.jsx(U,{icon:"solar:restart-bold",width:40,sx:{color:"primary.main"}})}):t.jsxs(z,{display:"grid",margin:2,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:3,children:[t.jsx(r,{fullWidth:!0,label:"Name",value:h,onChange:e=>{p(e.target.value),e.target.value&&c(a=>({...a,firstName:!1}))},required:!0,error:!!P.firstName}),t.jsx(r,{fullWidth:!0,label:"Email",value:y,onChange:e=>{x(e.target.value),e.target.value&&c(a=>({...a,email:!1}))},required:!0,error:!!P.email}),t.jsx(se,{fullWidth:!0,defaultCountry:"IN",label:"Phone Number",name:"phone_number",value:m,onChange:e=>{v(e),e&&c(a=>({...a,phone:!1}))},required:!0,error:!!P.phone}),t.jsx(r,{fullWidth:!0,label:"Company Name",value:T,onChange:e=>g(e.target.value)}),t.jsxs(r,{select:!0,fullWidth:!0,label:"Contact Type",value:I,onChange:e=>W(e.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[t.jsx("option",{value:"Sales",children:"Sales"}),t.jsx("option",{value:"Purchase",children:"Purchase"})]}),t.jsx(r,{fullWidth:!0,label:"Designation",value:A,onChange:e=>S(e.target.value)}),t.jsxs(r,{select:!0,fullWidth:!0,label:"Country",name:"country",value:n,onChange:e=>b(e.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[t.jsx("option",{value:"",disabled:!0,children:"Select"}),J.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs(r,{select:!0,fullWidth:!0,label:"State",name:"state",value:o,onChange:e=>D(e.target.value),disabled:!n,SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[t.jsx("option",{value:"",disabled:!0,children:"Select"}),M.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs(r,{select:!0,fullWidth:!0,label:"City",name:"city",value:q,onChange:e=>N(e.target.value),disabled:!o,SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[t.jsx("option",{value:"",disabled:!0,children:"Select"}),Q.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx(r,{fullWidth:!0,label:"Address",multiline:!0,rows:2,value:B,onChange:e=>C(e.target.value),sx:{gridColumn:"span 2"}}),t.jsx(r,{fullWidth:!0,label:"Notes",multiline:!0,rows:3,value:F,onChange:e=>j(e.target.value),sx:{gridColumn:"span 2"}})]})}),t.jsx(ce,{children:t.jsx(te,{variant:"contained",onClick:Z,disabled:w,children:w?"Saving...":i?"Update Contact":"Create Contact"})})]})}export{Ce as C};
