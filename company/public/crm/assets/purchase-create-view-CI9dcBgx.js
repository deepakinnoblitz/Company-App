import{Z as ht,W as Ee,r as d,j as e,$ as be,T as u,p as j,I as y,B as T,q as Ne,D as q,d as h,v as Qe,w as Ze}from"./index-Co7v2xsC.js";import{d as Ae}from"./dayjs.min-C2542nnJ.js";import{c as A}from"./format-number-DSNgsWBE.js";import{c as Je}from"./invoice-CmnDHtbD.js";import{getDoctypeList as k}from"./leads-d5FzXGcx.js";import{u as Ke}from"./data-import-KyR0bLZ-.js";import{D as Ye,C as Xe}from"./Card-CDV3jV6O.js";import{g as mt,b as xt,u as gt,c as yt}from"./purchase-CQE7gI0T.js";import{T as Re,a as B,b as Ve}from"./tax-type-form-dialog-Ctl86VPY.js";import{S as p}from"./Stack-GQIY7Xk9.js";import{L as et,A as tt}from"./AdapterDayjs-BPhbSeWE.js";import{A as ae,c as at}from"./Autocomplete-BIV6h0T7.js";import{T as x}from"./TextField-BmVWmDzd.js";import{D as Fe}from"./DatePicker-BMZY9CMK.js";import{T as st,a as rt,b as nt,c as Oe,d as g,e as it}from"./TableRow-DqeBPnxy.js";import{S as ot}from"./Snackbar-BVA3LOhi.js";import{A as lt}from"./AlertTitle-BbqQne_Q.js";import{D as ct,a as dt}from"./DialogContent-DtP-sWqR.js";import{D as pt}from"./DialogTitle-C3eBZids.js";import{D as ut}from"./DialogActions-h_2rRG3x.js";const Ge=at();function qt(){const{id:P}=ht(),se=Ee(),[re,ne]=d.useState([]),[H,E]=d.useState([]),[Q,fe]=d.useState([]),[ze,Z]=d.useState([]),[J,K]=d.useState(""),[ie,oe]=d.useState(""),[je,le]=d.useState(new Date().toISOString().split("T")[0]),[ve,ce]=d.useState(""),[_e,X]=d.useState(""),[de,pe]=d.useState(""),[Ie,w]=d.useState(""),[D,V]=d.useState([]),[ue,C]=d.useState(!1),[v,R]=d.useState([{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,sub_total:0}]),[he,z]=d.useState("Flat"),[M,me]=d.useState(0),[xe,U]=d.useState(!1),[S,$e]=d.useState(!0),[F,f]=d.useState({open:!1,message:"",severity:"success"}),[L,W]=d.useState(!1),[$,N]=d.useState({item_name:"",item_code:"",rate:0}),[O,Ce]=d.useState(null),[Y,Te]=d.useState(!1),[qe,Se]=d.useState(!1),[ke,I]=d.useState("");d.useEffect(()=>{(async()=>{try{const[n,s,i,c,m]=await Promise.all([k("Contacts",["name","first_name","company_name","customer_type"]),k("Item",["name","item_name","rate","item_code"]),k("Tax Types",["name","tax_name","tax_percentage","tax_type"]),k("Payment Type",["name","payment_type"]),P?mt(P):null]),te=n.filter(b=>b.customer_type==="Purchase");ne(te),E(s),fe(i),Z(c),m&&(K(m.vendor_name||""),oe(m.bill_no||""),le(m.bill_date||new Date().toISOString().split("T")[0]),ce(m.payment_type||""),X(m.payment_terms||""),pe(m.due_date||""),w(m.description||""),z(m.overall_discount_type||"Flat"),me(m.overall_discount||0),m.attach&&V([{name:"Attachment",url:m.attach}]),m.table_qecz&&m.table_qecz.length>0&&R(m.table_qecz.map(b=>({name:b.name,service:b.service||"",hsn_code:b.hsn_code||"",description:b.description||"",quantity:b.quantity||1,price:b.price||0,discount_type:b.discount_type||"Percentage",discount:b.discount||0,tax_type:b.tax_type||"",tax_percent:b.tax_percent||0,tax_amount:b.tax_amount||0,sub_total:b.sub_total||0}))))}catch(n){console.error("Failed to load data:",n),f({open:!0,message:"Failed to load purchase data",severity:"error"})}finally{$e(!1)}})()},[P]);const Be=()=>{R([...v,{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,sub_total:0}])},ge=t=>{const n=v.filter((s,i)=>i!==t);R(n)},_=async(t,n,s)=>{const i=[...v],c={...i[t],[n]:s};if(n==="service"){const G=H.find(Le=>Le.name===s);G?(c.price=G.rate||0,c.description=G.item_name||"",c.hsn_code=G.item_code||""):(c.price=0,c.description="",c.hsn_code="",c.quantity=1,c.discount=0,c.tax_type="",c.tax_percent=0)}if(n==="tax_type"){const G=Q.find(Le=>Le.name===s);G?c.tax_percent=G.tax_percentage||0:c.tax_percent=0}const m=c.quantity*c.price,te=c.discount_type==="Flat"?c.discount:m*c.discount/100,b=Math.max(0,m-te);c.tax_amount=b*c.tax_percent/100,c.sub_total=b+c.tax_amount,i[t]=c,R(i)},We=async()=>{if(!$.item_name){f({open:!0,message:"Please enter Item Name",severity:"error"});return}try{Te(!0);const t=await Je($),n={name:t.name,item_name:t.item_name,item_code:t.item_code||"",rate:t.rate||0};if(E(s=>[...s,n]),O!==null){const s=[...v];s[O]={...s[O],service:t.name,description:t.item_name||"",hsn_code:t.item_code||"",price:t.rate||0};const i=s[O],c=i.quantity*i.price,m=i.discount_type==="Flat"?i.discount:c*i.discount/100,te=Math.max(0,c-m);i.tax_amount=te*i.tax_percent/100,i.sub_total=te+i.tax_amount,R(s)}W(!1),N({item_name:"",item_code:"",rate:0}),f({open:!0,message:"Item created successfully",severity:"success"})}catch(t){f({open:!0,message:t.message||"Failed to create item",severity:"error"})}finally{Te(!1)}},ee=v.reduce((t,n)=>{const s=n.quantity*n.price,i=n.discount_type==="Flat"?n.discount:s*n.discount/100;return t+(s-i)},0),Pe=v.reduce((t,n)=>t+n.tax_amount,0),ye=ee+Pe,we=v.reduce((t,n)=>t+n.quantity,0),Me=he==="Flat"?M:ye*M/100,De=Math.max(0,ye-Me),Ue=t=>{var s;const n=(s=t.target.files)==null?void 0:s[0];n&&V([n])},a=t=>{V(n=>n.filter((s,i)=>i!==t))},l=async()=>{if(!J){f({open:!0,message:"Please select a vendor",severity:"error"});return}if(!ie){f({open:!0,message:"Please enter bill number",severity:"error"});return}const t=v.filter(n=>n.service!=="");if(t.length===0){f({open:!0,message:"Please add at least one item",severity:"error"});return}try{U(!0);let n="";if(D.length>0&&D[0]instanceof File){C(!0);try{n=(await Ke(D[0],"Purchase",P,"attachments")).file_url}catch(i){throw new Error(`File upload failed: ${i.message}`)}finally{C(!1)}}else D.length>0&&(n=D[0].url||"");const s={vendor_name:J,vendor_id:J,bill_no:ie,bill_date:je,payment_type:ve,payment_terms:_e,due_date:de,description:Ie,attach:n,overall_discount_type:he,overall_discount:M,total_qty:we,total_amount:ee,grand_total:De,table_qecz:t.map(i=>({name:i.name,service:i.service,hsn_code:i.hsn_code,description:i.description,quantity:i.quantity,price:i.price,discount_type:i.discount_type,discount:i.discount,tax_type:i.tax_type,tax_amount:i.tax_amount,sub_total:i.sub_total}))};await gt(P,s),f({open:!0,message:"Purchase updated successfully",severity:"success"}),setTimeout(()=>se.push("/purchase"),1500)}catch(n){console.error(n),f({open:!0,message:n.message||"Failed to update purchase",severity:"error"})}finally{U(!1)}},r=()=>{P&&window.open(xt(P),"_blank")},o=()=>{se.push("/purchase")};return S?e.jsx(Ye,{children:e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{height:"50vh"},children:e.jsx(be,{})})}):e.jsx(et,{dateAdapter:tt,children:e.jsxs(Ye,{maxWidth:"xl",children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(u,{variant:"h4",children:"Edit Purchase"}),e.jsxs(p,{direction:"row",spacing:2,children:[e.jsx(j,{variant:"outlined",color:"inherit",onClick:o,children:"Cancel"}),e.jsx(j,{variant:"outlined",color:"primary",startIcon:e.jsx(y,{icon:"solar:printer-bold"}),onClick:r,children:"Print"}),e.jsx(j,{variant:"contained",color:"primary",onClick:l,disabled:xe,children:xe?e.jsx(be,{size:24}):"Update Purchase"})]})]}),e.jsxs(Xe,{sx:{p:4},children:[e.jsxs(T,{sx:{display:"grid",columnGap:3,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(ae,{fullWidth:!0,options:re,getOptionLabel:t=>t.first_name?`${t.name} - ${t.first_name}`:t.name||"",value:re.find(t=>t.name===J)||null,onChange:(t,n)=>K((n==null?void 0:n.name)||""),renderInput:t=>e.jsx(x,{...t,label:"Vendor",required:!0})}),e.jsx(x,{fullWidth:!0,label:"Bill No",value:ie,onChange:t=>oe(t.target.value),required:!0}),e.jsx(Fe,{label:"Bill Date",value:Ae(je),onChange:t=>le((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(x,{fullWidth:!0,select:!0,label:"Payment Type",value:ve,onChange:t=>ce(t.target.value),children:ze.map(t=>e.jsx(Ne,{value:t.name,children:t.payment_type||t.name},t.name))}),e.jsx(x,{fullWidth:!0,select:!0,label:"Payment Terms",value:_e,onChange:t=>X(t.target.value),children:["Next day Payment","Due On Receipt","15 days","30 days","60 days","1 Year"].map(t=>e.jsx(Ne,{value:t,children:t},t))}),e.jsx(Fe,{label:"Due Date",value:de?Ae(de):null,onChange:t=>pe((t==null?void 0:t.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}})]}),e.jsx(q,{sx:{my:4}}),e.jsx(u,{variant:"h6",sx:{mb:2},children:"Items"}),e.jsx(st,{sx:{overflow:"unset",border:t=>`1px solid ${t.palette.divider}`,borderRadius:1.5,bgcolor:"background.paper",boxShadow:t=>t.customShadows.z8},children:e.jsxs(rt,{sx:{minWidth:960},children:[e.jsx(nt,{sx:{bgcolor:t=>h(t.palette.grey[500],.08)},children:e.jsxs(Oe,{children:[e.jsx(g,{width:180,sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Service"}),e.jsx(g,{width:80,sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"HSN"}),e.jsx(g,{sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Description"}),e.jsx(g,{width:80,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Qty"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Price"}),e.jsx(g,{width:140,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Discount"}),e.jsx(g,{width:150,sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Type"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Amt"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:t=>`1px solid ${t.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Total"}),e.jsx(g,{width:40})]})}),e.jsx(it,{children:v.map((t,n)=>e.jsxs(Oe,{sx:{verticalAlign:"top",transition:s=>s.transitions.create("background-color"),"&:hover":{bgcolor:s=>h(s.palette.primary.main,.02)},"&:nth-of-type(even)":{bgcolor:s=>h(s.palette.grey[500],.02)}},children:[[{field:"service",component:e.jsx(ae,{fullWidth:!0,size:"small",options:H,getOptionLabel:s=>typeof s=="string"?s:s.inputValue?s.inputValue:s.item_name||s.name||"",filterOptions:(s,i)=>{const c=Ge(s,i),{inputValue:m}=i;return c.push({inputValue:m||"",item_name:m?`+ Create "${m}"`:"+ Create Item",isNew:!0}),c},value:H.find(s=>s.name===t.service)||null,onChange:(s,i)=>{typeof i=="string"?_(n,"service",i):i&&i.isNew?(Ce(n),N(c=>({...c,item_name:i.inputValue})),W(!0)):_(n,"service",(i==null?void 0:i.name)||"")},ListboxProps:{sx:{width:"350px","& .MuiAutocomplete-option":{py:1.5,px:2,borderRadius:.75,mx:.5,my:.25}}},slotProps:{paper:{sx:{mt:.5,boxShadow:s=>s.customShadows.z20,borderRadius:1.5}}},renderInput:s=>e.jsx(x,{...s,placeholder:"Select Service",variant:"standard",InputProps:{...s.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(s,i)=>e.jsx(T,{component:"li",...s,sx:{typography:"body2",...i.isNew&&{color:"primary.main",fontWeight:600,bgcolor:c=>h(c.palette.primary.main,.08),borderTop:c=>`1px solid ${c.palette.divider}`,mt:.5,"&:hover":{bgcolor:c=>h(c.palette.primary.main,.16)}}},children:i.isNew?e.jsxs(p,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(p,{spacing:0,children:[e.jsx(u,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(u,{variant:"caption",sx:{opacity:.8},children:"Item"})]})]}):i.item_name||i.name})})},{field:"hsn_code",component:e.jsx(x,{fullWidth:!0,size:"small",variant:"standard",value:t.hsn_code,onChange:s=>_(n,"hsn_code",s.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"description",component:e.jsx(x,{fullWidth:!0,multiline:!0,size:"small",variant:"standard",value:t.description,onChange:s=>_(n,"description",s.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"quantity",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:t.quantity===0?"":t.quantity,onChange:s=>_(n,"quantity",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"price",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:t.price===0?"":t.price,onChange:s=>_(n,"price",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"discount",component:e.jsxs(p,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsxs(Re,{size:"small",value:t.discount_type,exclusive:!0,onChange:(s,i)=>{i!==null&&_(n,"discount_type",i)},sx:{height:28,"& .MuiToggleButton-root":{px:1,py:0,border:"none",typography:"body2","&.Mui-selected":{bgcolor:s=>h(s.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:s=>h(s.palette.primary.main,.2)}}}},children:[e.jsx(B,{value:"Flat",children:"₹"}),e.jsx(B,{value:"Percentage",children:"%"})]}),e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:t.discount===0?"":t.discount,onChange:s=>_(n,"discount",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})]})},{field:"tax_type",component:e.jsx(ae,{fullWidth:!0,size:"small",options:Q,getOptionLabel:s=>typeof s=="string"?s:s.inputValue?s.inputValue:s.tax_name||s.name||"",filterOptions:(s,i)=>{const c=Ge(s,i),{inputValue:m}=i;return c.push({inputValue:m||"",tax_name:m?`+ Create "${m}"`:"Create Tax Type",isNew:!0}),c},value:Q.find(s=>s.name===t.tax_type)||null,onChange:(s,i)=>{typeof i=="string"?_(n,"tax_type",i):i&&i.isNew?(Ce(n),I(i.inputValue),Se(!0)):_(n,"tax_type",(i==null?void 0:i.name)||"")},renderInput:s=>e.jsx(x,{...s,placeholder:"Select Tax",variant:"standard",InputProps:{...s.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(s,i)=>e.jsx(T,{component:"li",...s,sx:{typography:"body2",...i.isNew&&{color:"primary.main",fontWeight:600,bgcolor:c=>h(c.palette.primary.main,.08),borderTop:c=>`1px solid ${c.palette.divider}`,mt:.5,"&:hover":{bgcolor:c=>h(c.palette.primary.main,.16)}}},children:i.isNew?e.jsxs(p,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(p,{spacing:0,children:[e.jsx(u,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(u,{variant:"caption",sx:{opacity:.8},children:"Tax Type"})]})]}):i.tax_name||i.name})})}].map((s,i)=>e.jsx(g,{sx:{px:1,py:1,borderRight:c=>`1px solid ${c.palette.divider}`,transition:c=>c.transitions.create(["background-color","box-shadow"]),"&:focus-within":{bgcolor:c=>h(c.palette.primary.main,.05)}},children:s.component},i)),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:e.jsx(u,{variant:"body2",sx:{fontWeight:"fontWeightMedium"},children:A(t.tax_amount)})}),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:e.jsx(u,{variant:"subtitle2",color:"primary.main",children:A(t.sub_total)})}),e.jsx(g,{sx:{px:1,py:1},children:e.jsx(Qe,{color:"error",onClick:()=>ge(n),size:"small",sx:{opacity:.6,"&:hover":{opacity:1}},children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})})]},n))})]})}),e.jsx(j,{startIcon:e.jsx(y,{icon:"mingcute:add-line"}),onClick:Be,sx:{mt:2},children:"Add Item"}),e.jsx(q,{sx:{my:4}}),e.jsx(T,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(p,{spacing:2,sx:{width:400,mt:3},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:box-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Total Quantity"})]}),e.jsx(u,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:we})]}),e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:bill-list-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Taxable Amount"})]}),e.jsx(u,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:A(ee)})]}),e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:calculator-minimalistic-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Total Tax"})]}),e.jsx(u,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:A(Pe)})]}),e.jsxs(p,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,sx:{flexGrow:1},children:[e.jsx(y,{icon:"solar:tag-horizontal-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Overall Discount"})]}),e.jsxs(Re,{size:"small",value:he,exclusive:!0,onChange:(t,n)=>{n!==null&&z(n)},sx:{height:32,"& .MuiToggleButton-root":{px:1,py:0,typography:"body2","&.Mui-selected":{bgcolor:t=>h(t.palette.primary.main,.1),color:"primary.main"}}},children:[e.jsx(B,{value:"Flat",children:"₹"}),e.jsx(B,{value:"Percentage",children:"%"})]}),e.jsx(x,{size:"small",type:"number",variant:"standard",value:M===0?"":M,onChange:t=>me(Number(t.target.value)),onFocus:t=>t.target.select(),sx:{width:100,"& .MuiInputBase-root":{bgcolor:t=>h(t.palette.grey[500],.08),borderRadius:.75,px:1,"&:hover":{bgcolor:t=>h(t.palette.grey[500],.12)},"&.Mui-focused":{bgcolor:t=>h(t.palette.primary.main,.08)}}},inputProps:{sx:{textAlign:"right",typography:"body2"}}})]}),e.jsx(q,{}),e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:wad-of-money-bold-duotone",sx:{color:"primary.main",width:24,height:24}}),e.jsx(u,{variant:"subtitle1",sx:{color:"primary.main"},children:"Grand Total"})]}),e.jsx(u,{variant:"h6",color:"primary",sx:{width:120,textAlign:"right"},children:A(De)})]})]})}),e.jsx(q,{sx:{my:4,borderStyle:"dashed"}}),e.jsxs(T,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[e.jsx(x,{fullWidth:!0,label:"Description",multiline:!0,rows:4,value:Ie,onChange:t=>w(t.target.value)}),e.jsxs(T,{sx:{p:3,borderRadius:2,bgcolor:t=>h(t.palette.grey[500],.04),border:t=>`1px dashed ${h(t.palette.grey[500],.2)}`},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2.5},children:[e.jsx(u,{variant:"h6",children:"Attachments"}),e.jsxs(j,{variant:"contained",component:"label",color:"primary",size:"small",startIcon:e.jsx(y,{icon:"solar:upload-bold"}),disabled:ue,children:[ue?"Uploading...":"Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:Ue})]})]}),e.jsx(p,{spacing:1,children:D.length===0?e.jsxs(p,{alignItems:"center",justifyContent:"center",sx:{py:3,color:"text.disabled"},children:[e.jsx(y,{icon:"solar:file-bold",width:40,height:40,sx:{mb:1,opacity:.48}}),e.jsx(u,{variant:"body2",children:"No attachments yet"})]}):D.map((t,n)=>e.jsxs(p,{direction:"row",alignItems:"center",sx:{px:1.5,py:.75,borderRadius:1.5,bgcolor:s=>h(s.palette.grey[500],.08)},children:[e.jsx(y,{icon:"solar:link-bold",width:20,sx:{mr:1,color:"text.secondary",flexShrink:0}}),e.jsx(u,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:typeof t=="string"?t:t.url||t.name}),e.jsx(j,{size:"small",color:"inherit",onClick:()=>a(n),sx:{px:1.5,py:0,height:26,borderRadius:1.5,minWidth:"auto",typography:"caption",bgcolor:"background.paper",border:s=>`1px solid ${h(s.palette.grey[500],.24)}`,"&:hover":{bgcolor:s=>h(s.palette.grey[500],.08)}},children:"Clear"})]},n))})]})]})]}),e.jsx(ot,{open:F.open,autoHideDuration:6e3,onClose:()=>f(t=>({...t,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(Ze,{severity:F.severity,sx:{width:"100%",boxShadow:t=>t.customShadows.z20},children:[e.jsx(lt,{children:F.severity==="success"?"Success":"Error"}),F.message]})}),e.jsxs(ct,{open:L,onClose:()=>!Y&&W(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(pt,{children:"Create Item"}),e.jsx(dt,{children:e.jsxs(p,{spacing:3,sx:{pt:1},children:[e.jsx(x,{fullWidth:!0,label:"Item Name",value:$.item_name,onChange:t=>N(n=>({...n,item_name:t.target.value})),required:!0}),e.jsx(x,{fullWidth:!0,label:"HSN Code",value:$.item_code,onChange:t=>N(n=>({...n,item_code:t.target.value}))}),e.jsx(x,{fullWidth:!0,label:"Rate",type:"number",value:$.rate,onChange:t=>N(n=>({...n,rate:Number(t.target.value)}))})]})}),e.jsxs(ut,{children:[e.jsx(j,{color:"inherit",onClick:()=>W(!1),disabled:Y,children:"Cancel"}),e.jsx(j,{variant:"contained",onClick:We,disabled:Y,children:Y?e.jsx(be,{size:24}):"Create"})]})]}),e.jsx(Ve,{open:qe,initialName:ke,onClose:()=>Se(!1),onSuccess:t=>{fe(n=>[...n,t]),O!==null&&_(O,"tax_type",t.name)}})]})})}const He=at();function kt(){const P=Ee(),[se,re]=d.useState([]),[ne,H]=d.useState([]),[E,Q]=d.useState([]),[fe,ze]=d.useState([]),[Z,J]=d.useState(""),[K,ie]=d.useState(""),[oe,je]=d.useState(new Date().toISOString().split("T")[0]),[le,ve]=d.useState(""),[ce,_e]=d.useState(""),[X,de]=d.useState(""),[pe,Ie]=d.useState(""),[w,D]=d.useState([]),[V,ue]=d.useState(!1),[C,v]=d.useState([{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,sub_total:0}]),[R,he]=d.useState("Flat"),[z,M]=d.useState(0),[me,xe]=d.useState(!1),[U,S]=d.useState({open:!1,message:"",severity:"success"}),[$e,F]=d.useState(!1),[f,L]=d.useState({item_name:"",item_code:"",rate:0}),[W,$]=d.useState(null),[N,O]=d.useState(!1),[Ce,Y]=d.useState(!1),[Te,qe]=d.useState("");d.useEffect(()=>{k("Contacts",["name","first_name","company_name","customer_type"]).then(a=>{console.log("Vendor data loaded:",a);const l=a.filter(r=>r.customer_type==="Purchase");re(l)}).catch(a=>{console.error("Failed to load Vendor data:",a),re([])}),k("Item",["name","item_name","rate","item_code"]).then(H).catch(a=>console.error("Failed to load Item data:",a)),k("Tax Types",["name","tax_name","tax_percentage","tax_type"]).then(Q).catch(a=>console.error("Failed to load Tax Types data:",a)),k("Payment Type",["name","payment_type"]).then(ze).catch(a=>console.error("Failed to load Payment Type data:",a))},[]);const Se=()=>{v([...C,{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,sub_total:0}])},ke=a=>{const l=C.filter((r,o)=>o!==a);v(l)},I=async(a,l,r)=>{const o=[...C],t={...o[a],[l]:r};if(l==="service"){const c=ne.find(m=>m.name===r);c?(t.price=c.rate||0,t.description=c.item_name||"",t.hsn_code=c.item_code||""):(t.price=0,t.description="",t.hsn_code="",t.quantity=1,t.discount=0,t.tax_type="",t.tax_percent=0)}if(l==="tax_type"){const c=E.find(m=>m.name===r);c?t.tax_percent=c.tax_percentage||0:t.tax_percent=0}const n=t.quantity*t.price,s=t.discount_type==="Flat"?t.discount:n*t.discount/100,i=Math.max(0,n-s);t.tax_amount=i*t.tax_percent/100,t.sub_total=i+t.tax_amount,o[a]=t,v(o)},Be=async()=>{if(!f.item_name){S({open:!0,message:"Please enter Item Name",severity:"error"});return}try{O(!0);const a=await Je(f),l={name:a.name,item_name:a.item_name,item_code:a.item_code||"",rate:a.rate||0};if(H(r=>[...r,l]),W!==null){const r=[...C];r[W]={...r[W],service:a.name,description:a.item_name||"",hsn_code:a.item_code||"",price:a.rate||0};const o=r[W],t=o.quantity*o.price,n=o.discount_type==="Flat"?o.discount:t*o.discount/100,s=Math.max(0,t-n);o.tax_amount=s*o.tax_percent/100,o.sub_total=s+o.tax_amount,v(r)}F(!1),L({item_name:"",item_code:"",rate:0}),S({open:!0,message:"Item created successfully",severity:"success"})}catch(a){S({open:!0,message:a.message||"Failed to create item",severity:"error"})}finally{O(!1)}},ge=C.reduce((a,l)=>{const r=l.quantity*l.price,o=l.discount_type==="Flat"?l.discount:r*l.discount/100;return a+(r-o)},0),_=C.reduce((a,l)=>a+l.tax_amount,0),We=ge+_,ee=C.reduce((a,l)=>a+l.quantity,0),Pe=R==="Flat"?z:We*z/100,ye=Math.max(0,We-Pe),we=a=>{var r;const l=(r=a.target.files)==null?void 0:r[0];l&&D([l])},Me=a=>{D(l=>l.filter((r,o)=>o!==a))},De=async()=>{if(!Z){S({open:!0,message:"Please select a vendor",severity:"error"});return}if(!K){S({open:!0,message:"Please enter bill number",severity:"error"});return}const a=C.filter(l=>l.service!=="");if(a.length===0){S({open:!0,message:"Please add at least one item",severity:"error"});return}try{xe(!0);let l="";if(w.length>0&&w[0]instanceof File){ue(!0);try{l=(await Ke(w[0])).file_url}catch(o){throw new Error(`File upload failed: ${o.message}`)}finally{ue(!1)}}else w.length>0&&(l=w[0].url||"");const r={vendor_name:Z,vendor_id:Z,bill_no:K,bill_date:oe,payment_type:le,payment_terms:ce,due_date:X,description:pe,attach:l,overall_discount_type:R,overall_discount:z,total_qty:ee,total_amount:ge,grand_total:ye,table_qecz:a.map(o=>({service:o.service,hsn_code:o.hsn_code,description:o.description,quantity:o.quantity,price:o.price,discount_type:o.discount_type,discount:o.discount,tax_type:o.tax_type,tax_amount:o.tax_amount,sub_total:o.sub_total}))};await yt(r),S({open:!0,message:"Purchase created successfully",severity:"success"}),setTimeout(()=>P.push("/purchase"),1500)}catch(l){console.error(l),S({open:!0,message:l.message||"Failed to create purchase",severity:"error"})}finally{xe(!1)}},Ue=()=>{P.push("/purchase")};return e.jsx(et,{dateAdapter:tt,children:e.jsxs(Ye,{maxWidth:"xl",children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(u,{variant:"h4",children:"New Purchase"}),e.jsxs(p,{direction:"row",spacing:2,children:[e.jsx(j,{variant:"outlined",color:"inherit",onClick:Ue,children:"Cancel"}),e.jsx(j,{variant:"contained",color:"primary",onClick:De,disabled:me,children:me?e.jsx(be,{size:24}):"Save Purchase"})]})]}),e.jsxs(Xe,{sx:{p:4},children:[e.jsxs(T,{sx:{display:"grid",columnGap:3,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(ae,{fullWidth:!0,options:se,getOptionLabel:a=>a.first_name?`${a.name} - ${a.first_name}`:a.name||"",value:se.find(a=>a.name===Z)||null,onChange:(a,l)=>J((l==null?void 0:l.name)||""),renderInput:a=>e.jsx(x,{...a,label:"Vendor",required:!0})}),e.jsx(x,{fullWidth:!0,label:"Bill No",value:K,onChange:a=>ie(a.target.value),required:!0}),e.jsx(Fe,{label:"Bill Date",value:Ae(oe),onChange:a=>je((a==null?void 0:a.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(x,{fullWidth:!0,select:!0,label:"Payment Type",value:le,onChange:a=>ve(a.target.value),required:!0,children:fe.map(a=>e.jsx(Ne,{value:a.name,children:a.payment_type||a.name},a.name))}),e.jsx(x,{fullWidth:!0,select:!0,label:"Payment Terms",value:ce,onChange:a=>_e(a.target.value),required:!0,children:["Next day Payment","Due On Receipt","15 days","30 days","60 days","1 Year"].map(a=>e.jsx(Ne,{value:a,children:a},a))}),e.jsx(Fe,{label:"Due Date",value:X?Ae(X):null,onChange:a=>de((a==null?void 0:a.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}})]}),e.jsx(q,{sx:{my:4}}),e.jsx(u,{variant:"h6",sx:{mb:2},children:"Items"}),e.jsx(st,{sx:{overflow:"unset",border:a=>`1px solid ${a.palette.divider}`,borderRadius:1.5,bgcolor:"background.paper",boxShadow:a=>a.customShadows.z8},children:e.jsxs(rt,{sx:{minWidth:960},children:[e.jsx(nt,{sx:{bgcolor:a=>h(a.palette.grey[500],.08)},children:e.jsxs(Oe,{children:[e.jsx(g,{width:180,sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Service"}),e.jsx(g,{width:80,sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"HSN"}),e.jsx(g,{sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Description"}),e.jsx(g,{width:80,align:"right",sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Qty"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Price"}),e.jsx(g,{width:140,align:"right",sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Discount"}),e.jsx(g,{width:150,sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Type"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Amt"}),e.jsx(g,{width:120,align:"right",sx:{borderRight:a=>`1px solid ${a.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Total"}),e.jsx(g,{width:40})]})}),e.jsx(it,{children:C.map((a,l)=>e.jsxs(Oe,{sx:{verticalAlign:"top",transition:r=>r.transitions.create("background-color"),"&:hover":{bgcolor:r=>h(r.palette.primary.main,.02)},"&:nth-of-type(even)":{bgcolor:r=>h(r.palette.grey[500],.02)}},children:[[{field:"service",component:e.jsx(ae,{fullWidth:!0,size:"small",options:ne,getOptionLabel:r=>typeof r=="string"?r:r.inputValue?r.inputValue:r.item_name||r.name||"",filterOptions:(r,o)=>{const t=He(r,o),{inputValue:n}=o;return t.push({inputValue:n||"",item_name:n?`+ Create "${n}"`:"+ Create Item",isNew:!0}),t},value:ne.find(r=>r.name===a.service)||null,onChange:(r,o)=>{typeof o=="string"?I(l,"service",o):o&&o.isNew?($(l),L(t=>({...t,item_name:o.inputValue})),F(!0)):I(l,"service",(o==null?void 0:o.name)||"")},ListboxProps:{sx:{width:"350px","& .MuiAutocomplete-option":{py:1.5,px:2,borderRadius:.75,mx:.5,my:.25}}},slotProps:{paper:{sx:{mt:.5,boxShadow:r=>r.customShadows.z20,borderRadius:1.5}}},renderInput:r=>e.jsx(x,{...r,placeholder:"Select Service",variant:"standard",InputProps:{...r.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(r,o)=>e.jsx(T,{component:"li",...r,sx:{typography:"body2",...o.isNew&&{color:"primary.main",fontWeight:600,bgcolor:t=>h(t.palette.primary.main,.08),borderTop:t=>`1px solid ${t.palette.divider}`,mt:.5,"&:hover":{bgcolor:t=>h(t.palette.primary.main,.16)}}},children:o.isNew?e.jsxs(p,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(p,{spacing:0,children:[e.jsx(u,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(u,{variant:"caption",sx:{opacity:.8},children:"Item"})]})]}):o.item_name||o.name})})},{field:"hsn_code",component:e.jsx(x,{fullWidth:!0,size:"small",variant:"standard",value:a.hsn_code,onChange:r=>I(l,"hsn_code",r.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"description",component:e.jsx(x,{fullWidth:!0,multiline:!0,size:"small",variant:"standard",value:a.description,onChange:r=>I(l,"description",r.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"quantity",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:a.quantity===0?"":a.quantity,onChange:r=>I(l,"quantity",Number(r.target.value)),onFocus:r=>r.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"price",component:e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:a.price===0?"":a.price,onChange:r=>I(l,"price",Number(r.target.value)),onFocus:r=>r.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"discount",component:e.jsxs(p,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsxs(Re,{size:"small",value:a.discount_type,exclusive:!0,onChange:(r,o)=>{o!==null&&I(l,"discount_type",o)},sx:{height:28,"& .MuiToggleButton-root":{px:1,py:0,border:"none",typography:"body2","&.Mui-selected":{bgcolor:r=>h(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>h(r.palette.primary.main,.2)}}}},children:[e.jsx(B,{value:"Flat",children:"₹"}),e.jsx(B,{value:"Percentage",children:"%"})]}),e.jsx(x,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:a.discount===0?"":a.discount,onChange:r=>I(l,"discount",Number(r.target.value)),onFocus:r=>r.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})]})},{field:"tax_type",component:e.jsx(ae,{fullWidth:!0,size:"small",options:E,getOptionLabel:r=>typeof r=="string"?r:r.inputValue?r.inputValue:r.tax_name||r.name||"",filterOptions:(r,o)=>{const t=He(r,o),{inputValue:n}=o;return t.push({inputValue:n||"",tax_name:n?`+ Create "${n}"`:"Create Tax Type",isNew:!0}),t},value:E.find(r=>r.name===a.tax_type)||null,onChange:(r,o)=>{typeof o=="string"?I(l,"tax_type",o):o&&o.isNew?($(l),qe(o.inputValue),Y(!0)):I(l,"tax_type",(o==null?void 0:o.name)||"")},renderInput:r=>e.jsx(x,{...r,placeholder:"Select Tax",variant:"standard",InputProps:{...r.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(r,o)=>e.jsx(T,{component:"li",...r,sx:{typography:"body2",...o.isNew&&{color:"primary.main",fontWeight:600,bgcolor:t=>h(t.palette.primary.main,.08),borderTop:t=>`1px solid ${t.palette.divider}`,mt:.5,"&:hover":{bgcolor:t=>h(t.palette.primary.main,.16)}}},children:o.isNew?e.jsxs(p,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:add-circle-bold",width:24}),e.jsxs(p,{spacing:0,children:[e.jsx(u,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),e.jsx(u,{variant:"caption",sx:{opacity:.8},children:"Tax Type"})]})]}):o.tax_name||o.name})})}].map((r,o)=>e.jsx(g,{sx:{px:1,py:1,borderRight:t=>`1px solid ${t.palette.divider}`,transition:t=>t.transitions.create(["background-color","box-shadow"]),"&:focus-within":{bgcolor:t=>h(t.palette.primary.main,.05)}},children:r.component},o)),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:r=>`1px solid ${r.palette.divider}`},children:e.jsx(u,{variant:"body2",sx:{fontWeight:"fontWeightMedium"},children:A(a.tax_amount)})}),e.jsx(g,{align:"right",sx:{px:1,py:1,borderRight:r=>`1px solid ${r.palette.divider}`},children:e.jsx(u,{variant:"subtitle2",color:"primary.main",children:A(a.sub_total)})}),e.jsx(g,{sx:{px:1,py:1},children:e.jsx(Qe,{color:"error",onClick:()=>ke(l),size:"small",sx:{opacity:.6,"&:hover":{opacity:1}},children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})})]},l))})]})}),e.jsx(j,{startIcon:e.jsx(y,{icon:"mingcute:add-line"}),onClick:Se,sx:{mt:2},children:"Add Item"}),e.jsx(q,{sx:{my:4}}),e.jsx(T,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(p,{spacing:2,sx:{width:400,mt:3},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:box-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Total Quantity"})]}),e.jsx(u,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:ee})]}),e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:bill-list-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Taxable Amount"})]}),e.jsx(u,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:A(ge)})]}),e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{icon:"solar:calculator-minimalistic-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Total Tax"})]}),e.jsx(u,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:A(_)})]}),e.jsxs(p,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,sx:{flexGrow:1},children:[e.jsx(y,{icon:"solar:tag-horizontal-bold-duotone",sx:{color:"text.secondary"}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Overall Discount"})]}),e.jsxs(Re,{size:"small",value:R,exclusive:!0,onChange:(a,l)=>{l!==null&&he(l)},sx:{height:32,"& .MuiToggleButton-root":{px:1,py:0,typography:"body2","&.Mui-selected":{bgcolor:a=>h(a.palette.primary.main,.1),color:"primary.main"}}},children:[e.jsx(B,{value:"Flat",children:"₹"}),e.jsx(B,{value:"Percentage",children:"%"})]}),e.jsx(x,{size:"small",type:"number",variant:"standard",value:z===0?"":z,onChange:a=>M(Number(a.target.value)),onFocus:a=>a.target.select(),sx:{width:100,"& .MuiInputBase-root":{bgcolor:a=>h(a.palette.grey[500],.08),borderRadius:.75,px:1,"&:hover":{bgcolor:a=>h(a.palette.grey[500],.12)},"&.Mui-focused":{bgcolor:a=>h(a.palette.primary.main,.08)}}},inputProps:{sx:{textAlign:"right",typography:"body2"}}})]}),e.jsx(q,{}),e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:"solar:wad-of-money-bold-duotone",sx:{color:"primary.main",width:24,height:24}}),e.jsx(u,{variant:"subtitle1",sx:{color:"primary.main"},children:"Grand Total"})]}),e.jsx(u,{variant:"h6",color:"primary",sx:{width:120,textAlign:"right"},children:A(ye)})]})]})}),e.jsx(q,{sx:{my:4,borderStyle:"dashed"}}),e.jsxs(T,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[e.jsx(x,{fullWidth:!0,label:"Description",multiline:!0,rows:4,value:pe,onChange:a=>Ie(a.target.value)}),e.jsxs(T,{sx:{p:3,borderRadius:2,bgcolor:a=>h(a.palette.grey[500],.04),border:a=>`1px dashed ${h(a.palette.grey[500],.2)}`},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2.5},children:[e.jsx(u,{variant:"h6",children:"Attachments"}),e.jsxs(j,{variant:"contained",component:"label",color:"primary",size:"small",startIcon:e.jsx(y,{icon:"solar:upload-bold"}),disabled:V,children:[V?"Uploading...":"Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:we})]})]}),e.jsx(p,{spacing:1,children:w.length===0?e.jsxs(p,{alignItems:"center",justifyContent:"center",sx:{py:3,color:"text.disabled"},children:[e.jsx(y,{icon:"solar:file-bold",width:40,height:40,sx:{mb:1,opacity:.48}}),e.jsx(u,{variant:"body2",children:"No attachments yet"})]}):w.map((a,l)=>e.jsxs(p,{direction:"row",alignItems:"center",sx:{px:1.5,py:.75,borderRadius:1.5,bgcolor:r=>h(r.palette.grey[500],.08)},children:[e.jsx(y,{icon:"solar:link-bold",width:20,sx:{mr:1,color:"text.secondary",flexShrink:0}}),e.jsx(u,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:typeof a=="string"?a:a.url||a.name}),e.jsx(j,{size:"small",color:"inherit",onClick:()=>Me(l),sx:{px:1.5,py:0,height:26,borderRadius:1.5,minWidth:"auto",typography:"caption",bgcolor:"background.paper",border:r=>`1px solid ${h(r.palette.grey[500],.24)}`,"&:hover":{bgcolor:r=>h(r.palette.grey[500],.08)}},children:"Clear"})]},l))})]})]})]}),e.jsx(ot,{open:U.open,autoHideDuration:6e3,onClose:()=>S(a=>({...a,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(Ze,{severity:U.severity,sx:{width:"100%",boxShadow:a=>a.customShadows.z20},children:[e.jsx(lt,{children:U.severity==="success"?"Success":"Error"}),U.message]})}),e.jsxs(ct,{open:$e,onClose:()=>!N&&F(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(pt,{children:"Create Item"}),e.jsx(dt,{children:e.jsxs(p,{spacing:3,sx:{pt:1},children:[e.jsx(x,{fullWidth:!0,label:"Item Name",value:f.item_name,onChange:a=>L(l=>({...l,item_name:a.target.value})),required:!0}),e.jsx(x,{fullWidth:!0,label:"HSN Code",value:f.item_code,onChange:a=>L(l=>({...l,item_code:a.target.value}))}),e.jsx(x,{fullWidth:!0,label:"Rate",type:"number",value:f.rate,onChange:a=>L(l=>({...l,rate:Number(a.target.value)}))})]})}),e.jsxs(ut,{children:[e.jsx(j,{color:"inherit",onClick:()=>F(!1),disabled:N,children:"Cancel"}),e.jsx(j,{variant:"contained",onClick:Be,disabled:N,children:N?e.jsx(be,{size:24}):"Create"})]})]}),e.jsx(Ve,{open:Ce,initialName:Te,onClose:()=>Y(!1),onSuccess:a=>{Q(l=>[...l,a]),W!==null&&I(W,"tax_type",a.name)}})]})})}export{kt as P,qt as a};
