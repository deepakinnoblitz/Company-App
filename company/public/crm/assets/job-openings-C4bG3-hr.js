import{f as O,H as L,r as i,j as e,B as m,d as U,T as y,v as E,I as C,D as M,S as z,p as B,q as P,w as je}from"./index-Co7v2xsC.js";import{d as ye}from"./dayjs.min-C2542nnJ.js";import{h as q}from"./api-error-handler-CV6pRVHb.js";import{D as we,C as ve}from"./Card-CDV3jV6O.js";import{E as Se}from"./empty-content-BBDmaj4d.js";import{U as Ce,a as De,b as Oe,T as _e}from"./user-table-toolbar-BXgkag6p.js";import{L as Q}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as V,d as v,T as ke,a as Je,e as Pe}from"./TableRow-DqeBPnxy.js";import{C as Te}from"./Checkbox-CoJXcvzD.js";import{S as D}from"./Stack-GQIY7Xk9.js";import{D as K,a as X}from"./DialogContent-DtP-sWqR.js";import{D as Z}from"./DialogTitle-C3eBZids.js";import{T as Re}from"./TablePagination-CEaYVDlQ.js";import{L as Ee,A as We}from"./AdapterDayjs-BPhbSeWE.js";import{T as w}from"./TextField-BmVWmDzd.js";import{D as Ie}from"./DatePicker-BMZY9CMK.js";import{D as Fe}from"./DialogActions-h_2rRG3x.js";import{S as Ne}from"./Snackbar-BVA3LOhi.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";async function Be(s){const o=[];s.search&&o.push(["Job Opening","job_title","like",`%${s.search}%`]);const n=s.orderBy&&s.order?`${s.orderBy} ${s.order}`:"posted_on desc",l=new URLSearchParams({doctype:"Job Opening",fields:JSON.stringify(["*"]),filters:JSON.stringify(o),limit_start:String((s.page-1)*s.page_size),limit_page_length:String(s.page_size),order_by:n}),[c,x]=await Promise.all([O(`/api/method/frappe.client.get_list?${l.toString()}`),O(`/api/method/frappe.client.get_count?doctype=Job Opening&filters=${encodeURIComponent(JSON.stringify(o))}`)]);if(!c.ok)throw new Error("Failed to fetch job openings");const u=await c.json(),h=await x.json();return{data:u.message||[],total:h.message||0}}const Le=s=>Be(s);async function qe(s){const o=await L(),n=await O("/api/method/frappe.client.insert",{method:"POST",headers:o,body:JSON.stringify({doc:{doctype:"Job Opening",...s}})});if(!n.ok){const l=await n.json();throw new Error(q(l,"Failed to create job opening"))}return(await n.json()).message}async function Ae(s,o){const n=await L(),l=await O("/api/method/frappe.client.set_value",{method:"POST",headers:n,body:JSON.stringify({doctype:"Job Opening",name:s,fieldname:o})});if(!l.ok){const c=await l.json();throw new Error(q(c,"Failed to update job opening"))}return(await l.json()).message}async function Y(s){const o=await L(),n=await O("/api/method/frappe.client.delete",{method:"POST",headers:o,body:JSON.stringify({doctype:"Job Opening",name:s})});if(!n.ok){const l=await n.json();throw new Error(q(l,"Failed to delete job opening"))}return!0}async function G(s){const o=await O(`/api/method/frappe.client.get?doctype=Job Opening&name=${encodeURIComponent(s)}`);if(!o.ok)throw new Error("Failed to fetch job opening details");return(await o.json()).message}async function $e(){const s=await O("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Job Opening");return s.ok?(await s.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}function He(s,o,n,l,c){const[x,u]=i.useState([]),[h,S]=i.useState(0),[_,f]=i.useState(!0),[d,b]=i.useState(null),J=i.useCallback(async()=>{f(!0);try{const j=await Le({page:s,page_size:o,search:n,order_by:l,order:c});u(j.data),S(j.total),b(null)}catch(j){b(j)}finally{f(!1)}},[s,o,n,l,c]);return i.useEffect(()=>{J()},[J]),{data:x,total:h,loading:_,error:d,refetch:J}}function Ue({row:s,selected:o,onSelectRow:n,onView:l,onEdit:c,onDelete:x,canEdit:u,canDelete:h,hideCheckbox:S=!1,index:_}){const f=d=>d?new Date(d).toLocaleDateString():"-";return e.jsxs(V,{hover:!0,selected:o,children:[!S&&e.jsx(v,{padding:"checkbox",children:e.jsx(Te,{checked:o,onClick:n})}),typeof _=="number"&&e.jsx(v,{align:"center",children:e.jsx(m,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:d=>U(d.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:d=>`1px solid ${U(d.palette.primary.main,.16)}`,mx:"auto",transition:d=>d.transitions.create(["all"],{duration:d.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:_+1})}),e.jsxs(v,{children:[e.jsx(m,{onClick:l,sx:{color:"primary.main",fontWeight:600,cursor:"pointer","&:hover":{textDecoration:"underline"}},children:s.job_title}),e.jsx(y,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:s.designation})]}),e.jsx(v,{children:s.location}),e.jsx(v,{children:f(s.posted_on)}),e.jsx(v,{children:e.jsx(Q,{variant:"soft",color:s.status==="Open"&&"success"||s.status==="Closed"&&"error"||"default",children:s.status})}),e.jsx(v,{align:"right",children:e.jsxs(D,{direction:"row",spacing:.5,justifyContent:"flex-end",children:[e.jsx(E,{onClick:l,sx:{color:"info.main"},children:e.jsx(C,{icon:"solar:eye-bold"})}),u&&e.jsx(E,{onClick:c,sx:{color:"primary.main"},children:e.jsx(C,{icon:"solar:pen-bold"})}),h&&e.jsx(E,{onClick:x,sx:{color:"error.main"},children:e.jsx(C,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function Me({open:s,onClose:o,job:n}){if(!n)return null;const l=h=>h?new Date(h).toLocaleDateString():"-",c=e.jsx(m,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2,mb:3},children:e.jsxs(D,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(m,{children:[e.jsx(y,{variant:"h4",sx:{mb:1,fontWeight:700},children:n.job_title}),e.jsxs(D,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(y,{variant:"subtitle2",color:"text.secondary",children:n.designation}),e.jsx(M,{orientation:"vertical",flexItem:!0,sx:{height:12,my:"auto"}}),e.jsx(y,{variant:"subtitle2",color:"text.secondary",children:n.location})]})]}),e.jsx(Q,{variant:"filled",color:n.status==="Open"&&"success"||n.status==="Closed"&&"error"||"default",sx:{height:32,px:2,borderRadius:1},children:n.status})]})}),x=e.jsxs(m,{sx:{display:"grid",gap:2.5,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},mb:4},children:[e.jsx(k,{icon:"solar:calendar-date-bold",label:"Posted On",value:l(n.posted_on)}),e.jsx(k,{icon:"solar:calendar-add-bold",label:"Closes On",value:l(n.closes_on)}),e.jsx(k,{icon:"solar:clock-circle-bold",label:"Shift",value:n.shift}),e.jsx(k,{icon:"solar:ranking-bold",label:"Experience",value:n.experience}),e.jsx(k,{icon:"solar:wad-of-money-bold",label:"Salary Range",value:n.lower_range?`₹${n.lower_range} - ₹${n.upper_range} per ${n.salary_per}`:"Not Disclosed"}),e.jsx(k,{icon:"solar:settings-bold",label:"Skills Required",value:n.skills_required||"-"})]}),u=e.jsxs(m,{sx:{mt:2},children:[e.jsx(Ye,{title:"Job Description",icon:"solar:notes-bold"}),e.jsx(m,{sx:{mt:2,color:"text.secondary",whiteSpace:"pre-wrap"},children:e.jsx(y,{variant:"body2",children:n.description||n.small_description||"No description provided."})})]});return e.jsxs(K,{open:s,onClose:o,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Z,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Job Opening Details",e.jsx(E,{onClick:o,children:e.jsx(C,{icon:"mingcute:close-line"})})]}),e.jsx(z,{sx:{maxHeight:"85vh"},children:e.jsxs(X,{sx:{p:4},children:[c,x,e.jsx(M,{sx:{my:4,borderStyle:"dashed"}}),u]})})]})}function Ye({title:s,icon:o}){return e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(C,{icon:o,width:24,sx:{mr:1.5,color:"primary.main"}}),e.jsx(y,{variant:"subtitle1",sx:{fontWeight:700},children:s})]})}function k({icon:s,label:o,value:n}){return e.jsxs(D,{direction:"row",spacing:1.5,alignItems:"flex-start",children:[e.jsx(C,{icon:s,width:20,sx:{color:"text.disabled",mt:.2}}),e.jsxs(m,{children:[e.jsx(y,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:o}),e.jsx(y,{variant:"body2",sx:{fontWeight:600},children:n})]})]})}function Ge(){const[s,o]=i.useState(0),[n,l]=i.useState(10),[c,x]=i.useState(""),[u,h]=i.useState("desc"),[S,_]=i.useState("posted_on"),[f,d]=i.useState([]),{data:b,total:J,refetch:j}=He(s+1,n,c,S,u),A=!b.length&&!c,[W,ee]=i.useState({read:!1,write:!1,delete:!1}),[te,I]=i.useState(!1),[se,$]=i.useState(!1),[ne,ae]=i.useState(null),[T,F]=i.useState(null),[r,p]=i.useState({job_title:"",designation:"",shift:"General Shift",location:"",experience:"",status:"Open",closes_on:"",description:"",skills_required:""}),[R,g]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{(async()=>{const a=await $e();ee(a)})()},[]);const oe=t=>{h(S===t&&u==="asc"?"desc":"asc"),_(t)},ie=t=>{d(t?b.map(a=>a.name):[])},re=t=>{d(a=>a.includes(t)?a.filter(be=>be!==t):[...a,t])},le=()=>{F(null),p({job_title:"",designation:"",shift:"General Shift",location:"",experience:"",status:"Open",closes_on:"",description:"",skills_required:""}),I(!0)},N=()=>{I(!1),F(null)},ce=i.useCallback(async t=>{try{const a=await G(t.name);F(a),p({job_title:a.job_title,designation:a.designation,shift:a.shift,location:a.location,experience:a.experience,status:a.status,closes_on:a.closes_on,description:a.description,skills_required:a.skills_required}),I(!0)}catch(a){g({open:!0,message:a.message||"Failed to load record",severity:"error"})}},[]),de=i.useCallback(async t=>{try{const a=await G(t.name);ae(a),$(!0)}catch(a){g({open:!0,message:a.message||"Failed to load record",severity:"error"})}},[]),ue=i.useCallback(async t=>{try{await Y(t),g({open:!0,message:"Deleted successfully",severity:"success"}),j()}catch(a){g({open:!0,message:a.message||"Delete failed",severity:"error"})}},[j]),pe=async()=>{try{await Promise.all(f.map(t=>Y(t))),g({open:!0,message:"Deleted successfully",severity:"success"}),d([]),j()}catch(t){g({open:!0,message:t.message||"Bulk delete failed",severity:"error"})}},he=async()=>{try{T?(await Ae(T.name,r),g({open:!0,message:"Updated successfully",severity:"success"})):(await qe(r),g({open:!0,message:"Created successfully",severity:"success"})),N(),j()}catch(t){g({open:!0,message:t.message||"Action failed",severity:"error"})}},ge=(t,a)=>{o(a)},me=t=>{l(parseInt(t.target.value,10)),o(0)},xe=t=>{x(t.target.value),o(0)},H=()=>{g({...R,open:!1})},fe=!b.length&&!!c;return e.jsxs(we,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:5},children:[e.jsx(y,{variant:"h4",children:"Job Openings"}),W.write&&e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(C,{icon:"mingcute:add-line"}),onClick:le,children:"New Job Opening"})]}),e.jsxs(ve,{children:[e.jsx(Ce,{numSelected:f.length,filterName:c,onFilterName:xe,onDelete:pe}),e.jsx(z,{children:e.jsx(ke,{sx:{overflow:"unset"},children:e.jsxs(Je,{sx:{minWidth:800},children:[e.jsx(De,{order:u,orderBy:S,rowCount:b.length,numSelected:f.length,onSort:oe,onSelectAllRows:t=>ie(t),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"job_title",label:"Job Title"},{id:"location",label:"Location"},{id:"posted_on",label:"Posted Date"},{id:"status",label:"Status"},{id:"",label:""}]}),e.jsxs(Pe,{children:[b.map((t,a)=>e.jsx(Ue,{index:s*n+a,hideCheckbox:!0,row:{id:t.name,job_title:t.job_title,designation:t.designation,posted_on:t.posted_on,status:t.status,location:t.location},selected:f.includes(t.name),onSelectRow:()=>re(t.name),onView:()=>de(t),onEdit:()=>ce(t),onDelete:()=>ue(t.name),canEdit:W.write,canDelete:W.delete},t.name)),fe&&e.jsx(Oe,{searchQuery:c}),A&&e.jsx(V,{children:e.jsx(v,{colSpan:6,children:e.jsx(Se,{title:"No job openings",description:"Create your first job opening to start hiring.",icon:"solar:case-round-minimalistic-bold-duotone"})})}),!A&&e.jsx(_e,{height:68,emptyRows:Math.max(0,n-b.length)})]})]})})}),e.jsx(Re,{component:"div",page:s,count:J,rowsPerPage:n,onPageChange:ge,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:me})]}),e.jsxs(K,{open:te,onClose:N,fullWidth:!0,maxWidth:"sm",children:[e.jsx(Z,{children:T?"Edit Job Opening":"New Job Opening"}),e.jsx(X,{children:e.jsx(Ee,{dateAdapter:We,children:e.jsxs(D,{spacing:3,sx:{mt:2},children:[e.jsx(w,{fullWidth:!0,label:"Job Title",value:r.job_title,onChange:t=>p({...r,job_title:t.target.value})}),e.jsx(w,{fullWidth:!0,label:"Designation",value:r.designation,onChange:t=>p({...r,designation:t.target.value}),placeholder:"Manager, Developer, etc."}),e.jsxs(D,{direction:"row",spacing:2,children:[e.jsxs(w,{select:!0,fullWidth:!0,label:"Shift",value:r.shift,onChange:t=>p({...r,shift:t.target.value}),children:[e.jsx(P,{value:"General Shift",children:"General Shift"}),e.jsx(P,{value:"Night Shift",children:"Night Shift"}),e.jsx(P,{value:"WFH",children:"WFH"})]}),e.jsxs(w,{select:!0,fullWidth:!0,label:"Status",value:r.status,onChange:t=>p({...r,status:t.target.value}),children:[e.jsx(P,{value:"Open",children:"Open"}),e.jsx(P,{value:"Closed",children:"Closed"})]})]}),e.jsxs(D,{direction:"row",spacing:2,children:[e.jsx(w,{fullWidth:!0,label:"Location",value:r.location,onChange:t=>p({...r,location:t.target.value})}),e.jsx(w,{fullWidth:!0,label:"Experience",value:r.experience,onChange:t=>p({...r,experience:t.target.value}),placeholder:"2-4 Years"})]}),e.jsx(Ie,{label:"Closes On",value:r.closes_on?ye(r.closes_on):null,onChange:t=>p({...r,closes_on:(t==null?void 0:t.format("YYYY-MM-DD"))||""}),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(w,{fullWidth:!0,multiline:!0,rows:3,label:"Skills Required",value:r.skills_required,onChange:t=>p({...r,skills_required:t.target.value})}),e.jsx(w,{fullWidth:!0,multiline:!0,rows:4,label:"Description",value:r.description,onChange:t=>p({...r,description:t.target.value})})]})})}),e.jsxs(Fe,{children:[e.jsx(B,{variant:"outlined",onClick:N,children:"Cancel"}),e.jsx(B,{variant:"contained",onClick:he,children:T?"Update":"Create"})]})]}),e.jsx(Me,{open:se,onClose:()=>$(!1),job:ne}),e.jsx(Ne,{open:R.open,autoHideDuration:6e3,onClose:H,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(je,{onClose:H,severity:R.severity,sx:{width:"100%"},children:R.message})})]})}function Ct(){return e.jsx(Ge,{})}export{Ct as default};
