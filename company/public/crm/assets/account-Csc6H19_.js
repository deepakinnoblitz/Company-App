import{r as s,j as e,T as _,p as B,I as j,q as x,B as w,S as Ae,v as We,h as Ie,d as T}from"./index-Co7v2xsC.js";import{C as Oe}from"./config-global-BX9xwJzv.js";import{r as Te,u as D,w as De}from"./reports-0l1D3gVE.js";import{D as Pe,C as M}from"./Card-CDV3jV6O.js";import{getDoctypeList as se,getStates as Re,getCities as _e}from"./leads-d5FzXGcx.js";import{E as Ee}from"./export-fields-dialog-DKDJ10Kv.js";import{A as Fe}from"./account-details-dialog-Bj-gJsO-.js";import{S as v}from"./Stack-GQIY7Xk9.js";import{L as Ne,A as ze}from"./AdapterDayjs-BPhbSeWE.js";import{D as ne}from"./DatePicker-BMZY9CMK.js";import{T as Le}from"./TextField-BmVWmDzd.js";import{F as P,S as R}from"./Select-B1EkSlUY.js";import{T as Ye,a as Be,b as Ge,c as G,d as o,e as Me}from"./TableRow-DqeBPnxy.js";import{C as oe}from"./Checkbox-CoJXcvzD.js";import{T as $e}from"./TablePagination-CEaYVDlQ.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./RadioGroup-B7r1ll7C.js";import"./useFormControl-Cqn8lfES.js";import"./FormControlLabel-CEvUm0a3.js";import"./DialogActions-h_2rRG3x.js";import"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";import"./dayjs.min-C2542nnJ.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function Ue(){const[r,p]=s.useState([]),[S,E]=s.useState([]),[u,m]=s.useState(!1),[d,$]=s.useState(""),[l,U]=s.useState("all"),[h,C]=s.useState("all"),[b,k]=s.useState("all"),[A,V]=s.useState("all"),[W,q]=s.useState(null),[I,H]=s.useState(null),[ae,re]=s.useState([]),[le,J]=s.useState([]),[ie,K]=s.useState([]),[ce,de]=s.useState([]),[F,N]=s.useState(0),[O,he]=s.useState(10),[ue,Q]=s.useState(!1),[xe,X]=s.useState(null),[i,z]=s.useState([]),pe=t=>{if(t.target.checked){const a=r.map(n=>n.name);z(a);return}z([])},me=(t,a)=>{const n=i.indexOf(a);let c=[];n===-1?c=c.concat(i,a):n===0?c=c.concat(i.slice(1)):n===i.length-1?c=c.concat(i.slice(0,-1)):n>0&&(c=c.concat(i.slice(0,n),i.slice(n+1))),z(c)},[fe,Z]=s.useState(!1),ge=async(t,a)=>{m(!0);try{const n=i.length>0?i:r.map(f=>f.name);if(n.length===0){m(!1);return}const c=[["name","in",n]],Y=t.length>0?t:["name","account_name","phone_number","website","gstin"];Y.includes("name")||Y.push("name");const we=new URLSearchParams({doctype:"Accounts",fields:JSON.stringify(Y),filters:JSON.stringify(c),limit_page_length:"99999"}),ee=await fetch(`/api/method/frappe.client.get_list?${we.toString()}`,{credentials:"include"});if(!ee.ok)throw new Error("Failed to fetch data for export");const Se=(await ee.json()).message||[],te=D.json_to_sheet(Se);if(a==="excel"){const f=D.book_new();D.book_append_sheet(f,te,"Accounts"),De(f,"Account_Report.xlsx")}else{const f=D.sheet_to_csv(te),Ce=new Blob([f],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a"),ke=URL.createObjectURL(Ce);g.setAttribute("href",ke),g.setAttribute("download","Account_Report.csv"),g.style.visibility="hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)}}catch(n){console.error(n)}finally{m(!1)}},je=s.useCallback(t=>{X(t),Q(!0)},[]),be=s.useCallback((t,a)=>{N(a)},[]),ye=s.useCallback(t=>{he(parseInt(t.target.value,10)),N(0)},[]),L=s.useCallback(async()=>{m(!0);try{const t={};d&&(t.account_name=d),l!=="all"&&(t.country=l),h!=="all"&&(t.state=h),b!=="all"&&(t.city=b),A!=="all"&&(t.owner=A),W&&(t.from_date=W.format("YYYY-MM-DD")),I&&(t.to_date=I.format("YYYY-MM-DD"));const a=await Te("Account Report",t);p(a.result||[]),E(a.report_summary||[]),N(0)}catch(t){console.error("Failed to fetch account report:",t)}finally{m(!1)}},[d,l,h,b,A,W,I]);s.useEffect(()=>{L()},[L]);const ve=()=>{q(null),H(null),$(""),U("all"),C("all"),k("all"),V("all")};return s.useEffect(()=>{se("Country").then(re),se("User").then(de)},[]),s.useEffect(()=>{l&&l!=="all"?Re(l).then(t=>{J(t),t.includes(h)||C("all")}):(J([]),C("all"))},[l]),s.useEffect(()=>{l&&l!=="all"&&h&&h!=="all"?_e(l,h).then(t=>{K(t),t.includes(b)||k("all")}):(K([]),k("all"))},[l,h]),e.jsxs(Pe,{children:[e.jsxs(v,{spacing:3,children:[e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(_,{variant:"h4",children:"Account Report"}),e.jsxs(v,{direction:"row",spacing:1,children:[e.jsx(B,{variant:"outlined",startIcon:e.jsx(j,{icon:"solar:refresh-bold"}),onClick:L,disabled:u,children:"Refresh"}),e.jsx(B,{variant:"outlined",color:"error",startIcon:e.jsx(j,{icon:"solar:restart-bold"}),onClick:ve,children:"Reset"})]})]}),e.jsxs(M,{sx:{p:2.5,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"background.neutral",border:t=>`1px solid ${t.palette.divider}`},children:[e.jsxs(Ne,{dateAdapter:ze,children:[e.jsx(ne,{label:"From Date",value:W,onChange:t=>q(t),slotProps:{textField:{size:"small"}}}),e.jsx(ne,{label:"To Date",value:I,onChange:t=>H(t),slotProps:{textField:{size:"small"}}})]}),e.jsx(Le,{label:"Account Name",size:"small",sx:{minWidth:160},value:d,onChange:t=>$(t.target.value)}),e.jsx(P,{size:"small",sx:{minWidth:160},children:e.jsxs(R,{value:l,onChange:t=>U(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"Country"}),ae.map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(P,{size:"small",sx:{minWidth:160},disabled:l==="all",children:e.jsxs(R,{value:h,onChange:t=>C(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"State"}),le.map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(P,{size:"small",sx:{minWidth:160},disabled:h==="all",children:e.jsxs(R,{value:b,onChange:t=>k(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"City"}),ie.map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(P,{size:"small",sx:{minWidth:160},children:e.jsxs(R,{value:A,onChange:t=>V(t.target.value),displayEmpty:!0,children:[e.jsx(x,{value:"all",children:"Owner"}),e.jsx(x,{value:"Administrator",children:"Administrator"}),ce.filter(t=>t!=="Administrator").map(t=>e.jsx(x,{value:t,children:t},t))]})}),e.jsx(w,{sx:{flexGrow:1}}),e.jsx(B,{variant:"contained",startIcon:e.jsx(j,{icon:"solar:export-bold"}),onClick:()=>Z(!0),children:"Export"})]}),e.jsxs(w,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"}},children:[S.map((t,a)=>e.jsx(y,{item:t},a)),S.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{item:{label:"Total Accounts",value:0,indicator:"blue"}}),e.jsx(y,{item:{label:"With GSTIN",value:0,indicator:"green"}}),e.jsx(y,{item:{label:"With Website",value:0,indicator:"orange"}}),e.jsx(y,{item:{label:"With Phone",value:0,indicator:"red"}})]})]}),e.jsxs(M,{children:[e.jsx(Ye,{sx:{position:"relative",overflow:"unset"},children:e.jsx(Ae,{children:e.jsxs(Be,{size:"medium",stickyHeader:!0,children:[e.jsx(Ge,{children:e.jsxs(G,{sx:{bgcolor:"#f4f6f8"},children:[e.jsx(o,{padding:"checkbox",children:e.jsx(oe,{indeterminate:i.length>0&&i.length<r.length,checked:r.length>0&&i.length===r.length,onChange:pe})}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Account Name"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Phone"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Website"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"GSTIN"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Location"}),e.jsx(o,{sx:{fontWeight:700,color:"text.secondary"},children:"Owner"}),e.jsx(o,{align:"right",sx:{fontWeight:700,color:"text.secondary",position:"sticky",right:0,bgcolor:"#f4f6f8",zIndex:11},children:"Actions"})]})}),e.jsxs(Me,{children:[r.slice(F*O,F*O+O).map((t,a)=>{const n=i.indexOf(t.name)!==-1;return e.jsxs(G,{hover:!0,role:"checkbox","aria-checked":n,selected:n,children:[e.jsx(o,{padding:"checkbox",children:e.jsx(oe,{checked:n,onClick:c=>me(c,t.name)})}),e.jsx(o,{sx:{fontWeight:600},children:t.account_name}),e.jsx(o,{children:t.phone_number}),e.jsx(o,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.website}),e.jsx(o,{children:t.gstin}),e.jsx(o,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.city,t.state,t.country].filter(Boolean).join(", ")}),e.jsx(o,{children:t.owner_name}),e.jsx(o,{align:"right",sx:{position:"sticky",right:0,bgcolor:"background.paper",boxShadow:"-2px 0 4px rgba(145, 158, 171, 0.08)"},children:e.jsx(We,{onClick:()=>je(t.name),sx:{color:"info.main"},children:e.jsx(j,{icon:"solar:eye-bold"})})})]},a)}),r.length===0&&!u&&e.jsx(G,{children:e.jsx(o,{colSpan:8,align:"center",sx:{py:10},children:e.jsxs(v,{spacing:1,alignItems:"center",children:[e.jsx(j,{icon:"eva:slash-outline",width:48,sx:{color:"text.disabled"}}),e.jsx(_,{variant:"body2",sx:{color:"text.disabled"},children:"No data found"})]})})})]})]})})}),e.jsx($e,{component:"div",count:r.length,page:F,onPageChange:be,rowsPerPage:O,onRowsPerPageChange:ye,rowsPerPageOptions:[5,10,25]})]})]}),e.jsx(Fe,{open:ue,accountId:xe,onClose:()=>{Q(!1),X(null)}}),e.jsx(Ee,{open:fe,onClose:()=>Z(!1),doctype:"Accounts",onExport:ge})]})}function y({item:r}){var m;const p=Ie(),S=d=>{switch(d==null?void 0:d.toLowerCase()){case"blue":return p.palette.info.main;case"green":return p.palette.success.main;case"orange":return p.palette.warning.main;case"red":return p.palette.error.main;default:return p.palette.primary.main}},E=d=>{switch(d){case"Total Accounts":return"solar:buildings-2-bold-duotone";case"With GSTIN":return"solar:document-text-bold-duotone";case"With Website":return"solar:global-bold-duotone";case"With Phone":return"solar:phone-bold-duotone";default:return"solar:chart-2-bold-duotone"}},u=S(r.indicator);return e.jsxs(M,{sx:{p:3,boxShadow:"none",position:"relative",overflow:"hidden",bgcolor:T(u,.04),border:`1px solid ${T(u,.1)}`,transition:p.transitions.create(["transform","box-shadow"]),"&:hover":{transform:"translateY(-4px)",boxShadow:`0 12px 24px -4px ${T(u,.12)}`}},children:[e.jsxs(v,{direction:"row",alignItems:"center",spacing:2.5,children:[e.jsx(w,{sx:{width:48,height:48,flexShrink:0,display:"flex",borderRadius:1.5,alignItems:"center",justifyContent:"center",color:u,bgcolor:T(u,.1)},children:e.jsx(j,{icon:E(r.label),width:28})}),e.jsxs(w,{sx:{flexGrow:1},children:[e.jsx(_,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:700,mb:.5},children:r.label}),e.jsx(_,{variant:"h4",sx:{color:"text.primary",fontWeight:800},children:(m=r.value)==null?void 0:m.toLocaleString()})]})]}),e.jsx(w,{sx:{top:-16,right:-16,width:80,height:80,opacity:.08,position:"absolute",borderRadius:"50%",bgcolor:u}})]})}function Ct(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Account Report - ${Oe.appName}`}),e.jsx(Ue,{})]})}export{Ct as default};
