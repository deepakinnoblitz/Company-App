import{r as n,j as e,T as i,v as G,I as f,B as o,D as ce,p as L,S as de,h as xe,d as k}from"./index-Co7v2xsC.js";import{C as he}from"./config-global-BX9xwJzv.js";import{d as pe}from"./dayjs.min-C2542nnJ.js";import{r as ue,u as T,w as me}from"./reports-0l1D3gVE.js";import{g as ge,a as fe}from"./purchase-CQE7gI0T.js";import{D as be,C as E}from"./Card-CDV3jV6O.js";import{E as je}from"./export-fields-dialog-DKDJ10Kv.js";import{L as ye}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{D as ve,a as we}from"./DialogContent-DtP-sWqR.js";import{D as Pe}from"./DialogTitle-C3eBZids.js";import{S as C}from"./Stack-GQIY7Xk9.js";import{L as Ce,A as Se}from"./AdapterDayjs-BPhbSeWE.js";import{D as V}from"./DatePicker-BMZY9CMK.js";import{A as De}from"./Autocomplete-BIV6h0T7.js";import{T as _e}from"./TextField-BmVWmDzd.js";import{T as ke,a as Te,b as Ie,c as O,d,e as Re}from"./TableRow-DqeBPnxy.js";import{C as q}from"./Checkbox-CoJXcvzD.js";import{T as We}from"./TablePagination-CEaYVDlQ.js";import"./api-error-handler-CV6pRVHb.js";import"./RadioGroup-B7r1ll7C.js";import"./useFormControl-Cqn8lfES.js";import"./FormControlLabel-CEvUm0a3.js";import"./DialogActions-h_2rRG3x.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./Select-B1EkSlUY.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function Ae({open:a,onClose:x,purchaseId:u}){var b;const[s,m]=n.useState(null),[w,g]=n.useState(!1);return n.useEffect(()=>{a&&u?(g(!0),ge(u).then(m).catch(r=>console.error("Failed to fetch purchase details:",r)).finally(()=>g(!1))):m(null)},[a,u]),e.jsxs(ve,{open:a,onClose:x,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Pe,{sx:{m:0,p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:"background.neutral"},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:800},children:"Purchase Profile"}),e.jsx(G,{onClick:x,sx:{color:r=>r.palette.grey[500],bgcolor:"background.paper",boxShadow:r=>{var y;return(y=r.customShadows)==null?void 0:y.z1}},children:e.jsx(f,{icon:"mingcute:close-line"})})]}),e.jsx(we,{sx:{p:4,m:2,mt:4},children:w?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:e.jsx(f,{icon:"svg-spinners:12-dots-scale-rotate",width:40,sx:{color:"primary.main"}})}):s?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",gap:2.5},children:[e.jsx(o,{sx:{width:64,height:64,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.lighter",color:"primary.main"},children:e.jsx(f,{icon:"solar:cart-large-minimalistic-bold",width:32})}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(i,{variant:"h5",sx:{fontWeight:800},children:s.vendor_name}),e.jsxs(i,{variant:"body2",sx:{color:"text.secondary",fontWeight:600},children:["Bill No: ",s.bill_no||"-"]})]}),e.jsxs(o,{sx:{textAlign:"right"},children:[e.jsx(ye,{variant:"soft",color:"secondary",children:"Purchase"}),e.jsxs(i,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled",fontWeight:700},children:["ID: ",s.name]})]})]}),e.jsx(ce,{sx:{borderStyle:"dashed"}}),e.jsxs(o,{children:[e.jsx(I,{title:"Purchase Details",icon:"solar:info-circle-bold"}),e.jsxs(o,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(j,{label:"Vendor Name",value:s.vendor_name,icon:"solar:user-bold"}),e.jsx(j,{label:"Bill No",value:s.bill_no,icon:"solar:tag-bold"}),e.jsx(j,{label:"Bill Date",value:s.bill_date,icon:"solar:calendar-date-bold"}),e.jsx(j,{label:"Payment Type",value:s.payment_type,icon:"solar:bank-note-bold",color:"primary.main"}),e.jsx(j,{label:"Payment Terms",value:s.payment_terms,icon:"solar:document-text-bold"}),e.jsx(j,{label:"Due Date",value:s.due_date,icon:"solar:calendar-minimalistic-bold",color:"error.main"})]})]}),e.jsxs(o,{children:[e.jsx(I,{title:"Items",icon:"solar:cart-large-minimalistic-bold"}),e.jsxs(o,{sx:{bgcolor:"background.neutral",borderRadius:2,overflow:"hidden",border:r=>`1px solid ${r.palette.divider}`},children:[e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",p:1.5,bgcolor:r=>r.palette.grey[200],borderBottom:r=>`1px solid ${r.palette.divider}`},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:800,color:"text.secondary"},children:"ITEM"}),e.jsx(i,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"QTY"}),e.jsx(i,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"PRICE"}),e.jsx(i,{variant:"caption",sx:{fontWeight:800,color:"text.secondary",textAlign:"right"},children:"TOTAL"})]}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column"},children:[(b=s.table_qecz)==null?void 0:b.map((r,y)=>e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",p:1.5,borderBottom:v=>y!==s.table_qecz.length-1?`1px solid ${v.palette.divider}`:"none"},children:[e.jsxs(o,{children:[e.jsx(i,{variant:"subtitle2",children:r.service}),e.jsx(i,{variant:"caption",sx:{color:"text.disabled"},children:r.description||r.service})]}),e.jsx(i,{variant:"body2",sx:{textAlign:"right"},children:r.quantity}),e.jsx(i,{variant:"body2",sx:{textAlign:"right"},children:r.price}),e.jsx(i,{variant:"body2",sx:{textAlign:"right",fontWeight:600},children:r.sub_total})]},y)),(!s.table_qecz||s.table_qecz.length===0)&&e.jsx(o,{sx:{p:3,textAlign:"center"},children:e.jsx(i,{variant:"body2",sx:{color:"text.secondary"},children:"No items found"})})]})]})]}),e.jsxs(o,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2},children:[e.jsx(I,{title:"Financial Summary",icon:"solar:bill-list-bold",noMargin:!0}),e.jsxs(o,{sx:{mt:3,display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(j,{label:"Total Qty",value:s.total_qty,icon:"solar:box-bold"}),e.jsx(j,{label:"Total Amount",value:s.total_amount,icon:"solar:wad-of-money-bold"}),e.jsx(j,{label:"Grand Total",value:s.grand_total,icon:"solar:tag-bold",color:"primary.main"})]})]}),e.jsxs(o,{children:[e.jsx(I,{title:"System Information",icon:"solar:clock-circle-bold"}),e.jsxs(o,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(j,{label:"Created On",value:new Date(s.creation).toLocaleString(),icon:"solar:calendar-date-bold"}),e.jsx(j,{label:"Owner",value:s.owner,icon:"solar:user-rounded-bold"})]})]})]}):e.jsxs(o,{sx:{py:10,textAlign:"center"},children:[e.jsx(f,{icon:"solar:ghost-bold",width:64,sx:{color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",sx:{color:"text.secondary"},children:"Purchase Not Found"})]})})]})}function I({title:a,icon:x,noMargin:u=!1}){return e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:u?0:2.5},children:[e.jsx(f,{icon:x,width:20,sx:{color:"primary.main"}}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:800,textTransform:"uppercase",letterSpacing:.5},children:a})]})}function j({label:a,value:x,icon:u,color:s="text.primary"}){return e.jsxs(o,{children:[e.jsx(i,{variant:"caption",sx:{color:"text.disabled",fontWeight:700,textTransform:"uppercase",mb:.5,display:"block"},children:a}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{icon:u,width:16,sx:{color:"text.disabled"}}),e.jsx(i,{variant:"body2",sx:{fontWeight:700,color:s},children:x||"-"})]})]})}function Ye(){const[a,x]=n.useState([]),[u,s]=n.useState(!1),[m,w]=n.useState([]),[g,b]=n.useState(null),[r,y]=n.useState(null),[v,B]=n.useState(null),[Q,H]=n.useState([]),[W,A]=n.useState(0),[S,U]=n.useState(10),[J,M]=n.useState(!1),[K,$]=n.useState(null),[p,Y]=n.useState([]),X=t=>{if(t.target.checked){const l=a.map(c=>c.name);Y(l);return}Y([])},Z=(t,l)=>{const c=p.indexOf(l);let h=[];c===-1?h=h.concat(p,l):c===0?h=h.concat(p.slice(1)):c===p.length-1?h=h.concat(p.slice(0,-1)):c>0&&(h=h.concat(p.slice(0,c),p.slice(c+1))),Y(h)},[ee,z]=n.useState(!1),te=async(t,l)=>{s(!0);try{const c=[];p.length>0?c.push(["Purchase","name","in",p]):(g&&c.push(["Purchase","bill_date",">=",g.format("YYYY-MM-DD")]),r&&c.push(["Purchase","bill_date","<=",r.format("YYYY-MM-DD")]),v&&c.push(["Purchase","vendor_name","=",v.name]));const h=new URLSearchParams({doctype:"Purchase",fields:JSON.stringify(t),filters:JSON.stringify(c),limit_page_length:"99999"}),D=await fetch(`/api/method/frappe.client.get_list?${h.toString()}`,{credentials:"include"});if(!D.ok)throw new Error("Failed to fetch data for export");const le=(await D.json()).message||[],N=T.json_to_sheet(le);if(l==="excel"){const _=T.book_new();T.book_append_sheet(_,N,"Purchases"),me(_,"Purchase_Report.xlsx")}else{const _=T.sheet_to_csv(N),ne=new Blob([_],{type:"text/csv;charset=utf-8;"}),P=document.createElement("a"),ie=URL.createObjectURL(ne);P.setAttribute("href",ie),P.setAttribute("download","Purchase_Report.csv"),P.style.visibility="hidden",document.body.appendChild(P),P.click(),document.body.removeChild(P)}}catch(c){console.error(c)}finally{s(!1)}},re=n.useCallback(t=>{$(t),M(!0)},[]),se=n.useCallback((t,l)=>{A(l)},[]),oe=n.useCallback(t=>{U(parseInt(t.target.value,10)),A(0)},[]),F=n.useCallback(async()=>{s(!0);try{const t={};g&&(t.from_date=g.format("YYYY-MM-DD")),r&&(t.to_date=r.format("YYYY-MM-DD")),v&&(t.vendor=v.name),console.log("Fetching Purchase Report with filters:",t);const l=await ue("Purchase Report",t);console.log("Purchase Report Result Received:",l),l&&l.result?(x(l.result||[]),w(l.report_summary||[])):Array.isArray(l)?x(l):(x([]),w([])),A(0)}catch(t){console.error("Failed to fetch purchase report:",t)}finally{s(!1)}},[g,r,v]);n.useEffect(()=>{F()},[F]);const ae=()=>{b(null),y(null),B(null)};return n.useEffect(()=>{fe("Contacts",["name","first_name"],{customer_type:"Purchase"}).then(t=>{H(t)})},[]),e.jsxs(be,{children:[e.jsxs(C,{spacing:3,children:[e.jsxs(C,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(i,{variant:"h4",children:"Purchase Report"}),e.jsxs(C,{direction:"row",spacing:1,children:[e.jsx(L,{variant:"outlined",startIcon:e.jsx(f,{icon:"solar:refresh-bold"}),onClick:F,disabled:u,children:"Refresh"}),e.jsx(L,{variant:"outlined",color:"error",startIcon:e.jsx(f,{icon:"solar:restart-bold"}),onClick:ae,children:"Reset"})]})]}),e.jsxs(E,{sx:{p:2.5,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"background.neutral",border:t=>`1px solid ${t.palette.divider}`},children:[e.jsxs(Ce,{dateAdapter:Se,children:[e.jsx(V,{label:"From Date",value:g,onChange:t=>b(t),slotProps:{textField:{size:"small"}}}),e.jsx(V,{label:"To Date",value:r,onChange:t=>y(t),slotProps:{textField:{size:"small"}}})]}),e.jsx(De,{size:"small",sx:{minWidth:240},options:Q,getOptionLabel:t=>t?`${t.name} - ${t.first_name}`:"",value:v,onChange:(t,l)=>B(l),renderInput:t=>e.jsx(_e,{...t,label:"Vendor",placeholder:"All Vendors"})}),e.jsx(o,{sx:{flexGrow:1}}),e.jsx(L,{variant:"contained",startIcon:e.jsx(f,{icon:"solar:export-bold"}),onClick:()=>z(!0),children:"Export"})]}),e.jsxs(o,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[m.map((t,l)=>e.jsx(R,{item:t},l)),m.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{item:{label:"Total Purchase Amount",value:0,indicator:"blue",datatype:"Currency"}}),e.jsx(R,{item:{label:"Total Quantity Purchased",value:0,indicator:"green",datatype:"Float"}}),e.jsx(R,{item:{label:"Purchase Records",value:0,indicator:"orange"}})]})]}),e.jsxs(E,{children:[e.jsx(ke,{sx:{position:"relative",overflow:"unset"},children:e.jsx(de,{children:e.jsxs(Te,{size:"medium",stickyHeader:!0,children:[e.jsx(Ie,{children:e.jsxs(O,{sx:{bgcolor:"#f4f6f8"},children:[e.jsx(d,{padding:"checkbox",children:e.jsx(q,{indeterminate:p.length>0&&p.length<a.length,checked:a.length>0&&p.length===a.length,onChange:X})}),e.jsx(d,{sx:{fontWeight:700,color:"text.secondary"},children:"Purchase ID"}),e.jsx(d,{sx:{fontWeight:700,color:"text.secondary"},children:"Vendor"}),e.jsx(d,{sx:{fontWeight:700,color:"text.secondary"},children:"Bill No"}),e.jsx(d,{sx:{fontWeight:700,color:"text.secondary"},children:"Bill Date"}),e.jsx(d,{sx:{fontWeight:700,color:"text.secondary"},children:"Item"}),e.jsx(d,{sx:{fontWeight:700,color:"text.secondary"},children:"Qty"}),e.jsx(d,{sx:{fontWeight:700,color:"text.secondary"},children:"Grand Total"}),e.jsx(d,{align:"right",sx:{fontWeight:700,color:"text.secondary",position:"sticky",right:0,bgcolor:"#f4f6f8",zIndex:11},children:"Actions"})]})}),e.jsxs(Re,{children:[a.slice(W*S,W*S+S).map((t,l)=>{var h;const c=p.indexOf(t.name)!==-1;return e.jsxs(O,{hover:!0,role:"checkbox","aria-checked":c,selected:c,children:[e.jsx(d,{padding:"checkbox",children:e.jsx(q,{checked:c,onClick:D=>Z(D,t.name)})}),e.jsx(d,{children:t.name}),e.jsxs(d,{children:[t.vendor_name,t.vendor_real_name?` - ${t.vendor_real_name}`:""]}),e.jsx(d,{children:t.bill_no}),e.jsx(d,{children:t.bill_date?pe(t.bill_date).format("DD MMM YYYY"):"-"}),e.jsx(d,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.service}),e.jsx(d,{children:t.quantity}),e.jsxs(d,{sx:{fontWeight:700},children:["₹",((h=t.grand_total)==null?void 0:h.toLocaleString())||0]}),e.jsx(d,{align:"right",sx:{position:"sticky",right:0,bgcolor:"background.paper",boxShadow:"-2px 0 4px rgba(145, 158, 171, 0.08)"},children:e.jsx(G,{onClick:()=>re(t.name),sx:{color:"info.main"},children:e.jsx(f,{icon:"solar:eye-bold"})})})]},l)}),a.length===0&&!u&&e.jsx(O,{children:e.jsx(d,{colSpan:9,align:"center",sx:{py:10},children:e.jsxs(C,{spacing:1,alignItems:"center",children:[e.jsx(f,{icon:"eva:slash-outline",width:48,sx:{color:"text.disabled"}}),e.jsx(i,{variant:"body2",sx:{color:"text.disabled"},children:"No data found"})]})})})]})]})})}),e.jsx(We,{component:"div",count:a.length,page:W,onPageChange:se,rowsPerPage:S,onRowsPerPageChange:oe,rowsPerPageOptions:[5,10,25]})]})]}),e.jsx(Ae,{open:J,purchaseId:K,onClose:()=>{M(!1),$(null)}}),e.jsx(je,{open:ee,onClose:()=>z(!1),doctype:"Purchase",onExport:te})]})}function R({item:a}){var w,g;const x=xe(),u=b=>{switch(b==null?void 0:b.toLowerCase()){case"blue":return x.palette.info.main;case"green":return x.palette.success.main;case"orange":return x.palette.warning.main;case"red":return x.palette.error.main;default:return x.palette.primary.main}},s=b=>{const r=b.toLowerCase();return r.includes("amount")?"solar:wad-of-money-bold-duotone":r.includes("quantity")?"solar:box-bold-duotone":r.includes("records")?"solar:document-text-bold-duotone":"solar:chart-2-bold-duotone"},m=u(a.indicator);return e.jsxs(E,{sx:{p:3,boxShadow:"none",position:"relative",overflow:"hidden",bgcolor:k(m,.04),border:`1px solid ${k(m,.1)}`,transition:x.transitions.create(["transform","box-shadow"]),"&:hover":{transform:"translateY(-4px)",boxShadow:`0 12px 24px -4px ${k(m,.12)}`}},children:[e.jsxs(C,{direction:"row",alignItems:"center",spacing:2.5,children:[e.jsx(o,{sx:{width:48,height:48,flexShrink:0,display:"flex",borderRadius:1.5,alignItems:"center",justifyContent:"center",color:m,bgcolor:k(m,.1)},children:e.jsx(f,{icon:s(a.label),width:28})}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(i,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:700,mb:.5},children:a.label}),e.jsx(i,{variant:"h4",sx:{color:"text.primary",fontWeight:800},children:a.datatype==="Currency"||typeof a.value=="number"&&a.label.toLowerCase().includes("amount")?`₹${(w=a.value)==null?void 0:w.toLocaleString()}`:(g=a.value)==null?void 0:g.toLocaleString()})]})]}),e.jsx(o,{sx:{top:-16,right:-16,width:80,height:80,opacity:.08,position:"absolute",borderRadius:"50%",bgcolor:m}})]})}function ut(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Purchase Report - ${he.appName}`}),e.jsx(Ye,{})]})}export{ut as default};
