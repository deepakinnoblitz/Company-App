import{f as T,H as M,r as l,j as e,B as p,d as V,A as Ee,T as g,v as F,I,D as J,S as te,p as E,q as j,w as Ye}from"./index-Co7v2xsC.js";import{C as Le}from"./config-global-BX9xwJzv.js";import{d as Y}from"./dayjs.min-C2542nnJ.js";import{h as z}from"./api-error-handler-CV6pRVHb.js";import{getDoctypeList as B}from"./leads-d5FzXGcx.js";import{D as $e,C as He}from"./Card-CDV3jV6O.js";import{E as Ue}from"./empty-content-BBDmaj4d.js";import{U as Be,a as Je,b as Me,T as ze}from"./user-table-toolbar-BXgkag6p.js";import{L as se}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as O,d as x,T as ae,a as re,b as qe,e as ne}from"./TableRow-DqeBPnxy.js";import{C as Ge}from"./Checkbox-CoJXcvzD.js";import{S as P}from"./Stack-GQIY7Xk9.js";import{R as le}from"./Rating-9hFTuiPC.js";import{D as ie,a as oe}from"./DialogContent-DtP-sWqR.js";import{D as ce}from"./DialogTitle-C3eBZids.js";import{T as Qe}from"./TablePagination-CEaYVDlQ.js";import{T as D}from"./TextField-BmVWmDzd.js";import{L as Ve,A as Ke}from"./AdapterDayjs-BPhbSeWE.js";import{D as Xe}from"./DatePicker-BMZY9CMK.js";import{D as Ze}from"./DialogActions-h_2rRG3x.js";import{S as et}from"./Snackbar-BVA3LOhi.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./visuallyHidden-Dan1xhjv.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Chip-Rg4Dn3a5.js";async function tt(r=1,n=10,a="",d="creation",u="desc"){const b=[];a&&b.push(["Interview","job_applicant","like",`%${a}%`]);const v=`${d} ${u}`,S=new URLSearchParams({doctype:"Interview",fields:JSON.stringify(["*"]),filters:JSON.stringify(b),limit_start:String((r-1)*n),limit_page_length:String(n),order_by:v}),[h,m]=await Promise.all([T(`/api/method/frappe.client.get_list?${S.toString()}`),T(`/api/method/frappe.client.get_count?doctype=Interview&filters=${encodeURIComponent(JSON.stringify(b))}`)]);if(!h.ok)throw new Error("Failed to fetch interviews");const y=await h.json(),_=await m.json();return{data:y.message||[],total:_.message||0}}async function K(r){const n=await T(`/api/method/frappe.client.get?doctype=Interview&name=${encodeURIComponent(r)}`);if(!n.ok)throw new Error("Failed to fetch interview details");return(await n.json()).message}async function st(r){const n=await M(),a=await T("/api/method/frappe.client.insert",{method:"POST",headers:n,body:JSON.stringify({doc:{doctype:"Interview",...r}})}),d=await a.json();if(!a.ok)throw new Error(z(d,"Failed to create interview"));return d.message}async function at(r,n){const a=await M(),d=await T("/api/method/frappe.client.set_value",{method:"POST",headers:a,body:JSON.stringify({doctype:"Interview",name:r,fieldname:n})}),u=await d.json();if(!d.ok)throw new Error(z(u,"Failed to update interview"));return u.message}async function X(r){const n=await M(),a=await T("/api/method/frappe.client.delete",{method:"POST",headers:n,body:JSON.stringify({doctype:"Interview",name:r})}),d=await a.json();if(!a.ok)throw new Error(z(d,"Failed to delete interview"));return d.message}async function rt(){const r=await T("/api/method/company.company.frontend_api.get_doc_permissions?doctype=Interview");return r.ok?(await r.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}function nt(r=1,n=10,a="",d="creation",u="desc"){const[b,v]=l.useState([]),[S,h]=l.useState(0),[m,y]=l.useState(!0),[_,c]=l.useState(null),f=l.useCallback(async()=>{try{y(!0);const C=await tt(r,n,a,d,u);v(C.data),h(C.total),c(null)}catch(C){c(C),console.error("Failed to fetch interviews:",C)}finally{y(!1)}},[r,n,a,d,u]);return l.useEffect(()=>{f()},[f]),{data:b,total:S,loading:m,error:_,refetch:f}}function lt({row:r,selected:n,onSelectRow:a,onView:d,onEdit:u,onDelete:b,canEdit:v,canDelete:S,hideCheckbox:h=!1,index:m}){const y=c=>{let f="default";switch(c){case"Selected":case"Completed":f="success";break;case"Rejected":case"Cancelled":case"No-Show":f="error";break;case"On Hold":case"Rescheduled":f="warning";break;case"Scheduled":case"In Progress":f="info";break;case"Applied":case"Screening":case"Shortlisted":f="primary";break;default:f="default"}return e.jsx(se,{variant:"soft",color:f,children:c})},_=(c,f)=>c?`${new Date(c).toLocaleDateString()} ${f||""}`:"-";return e.jsxs(O,{hover:!0,selected:n,children:[!h&&e.jsx(x,{padding:"checkbox",children:e.jsx(Ge,{checked:n,onClick:a})}),typeof m=="number"&&e.jsx(x,{align:"center",children:e.jsx(p,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:c=>V(c.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:c=>`1px solid ${V(c.palette.primary.main,.16)}`,mx:"auto",transition:c=>c.transitions.create(["all"],{duration:c.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:m+1})}),e.jsx(x,{children:e.jsxs(P,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(Ee,{alt:r.job_applicant,sx:{bgcolor:"info.main",color:"common.white"},children:r.job_applicant.charAt(0).toUpperCase()}),e.jsxs(p,{children:[e.jsx(g,{variant:"subtitle2",noWrap:!0,sx:{color:"primary.main",cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:d,children:r.job_applicant}),e.jsx(g,{variant:"caption",sx:{color:"text.secondary"},noWrap:!0,children:r.job_applied||"No Job Assigned"})]})]})}),e.jsx(x,{children:_(r.scheduled_on,r.from_time)}),e.jsx(x,{children:y(r.overall_status)}),e.jsx(x,{align:"right",children:e.jsxs(p,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(F,{size:"small",color:"primary",onClick:d,children:e.jsx(I,{icon:"solar:eye-bold"})}),v&&e.jsx(F,{size:"small",color:"info",onClick:u,children:e.jsx(I,{icon:"solar:pen-bold"})}),S&&e.jsx(F,{size:"small",color:"error",onClick:b,children:e.jsx(I,{icon:"solar:trash-bin-trash-bold"})})]})})]})}function it({open:r,onClose:n,interview:a}){var S;if(!a)return null;const d=h=>{let m="default";switch(h){case"Selected":case"Completed":m="success";break;case"Rejected":case"Cancelled":case"No-Show":m="error";break;case"On Hold":case"Rescheduled":m="warning";break;case"Scheduled":case"In Progress":m="info";break;default:m="primary"}return e.jsx(se,{variant:"filled",color:m,sx:{height:32,px:2,borderRadius:1},children:h})},u=e.jsx(p,{sx:{p:3,bgcolor:"background.neutral",borderRadius:2,mb:3},children:e.jsxs(P,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,children:[e.jsxs(p,{children:[e.jsx(g,{variant:"h4",sx:{mb:1,fontWeight:700},children:a.job_applicant}),e.jsxs(P,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:a.job_applied||"No Job Assigned"}),a.designation&&e.jsxs(e.Fragment,{children:[e.jsx(J,{orientation:"vertical",flexItem:!0,sx:{height:12,my:"auto"}}),e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:a.designation})]})]})]}),d(a.overall_status)]})}),b=e.jsxs(p,{sx:{mb:4},children:[e.jsx(Z,{title:"Interview Schedule",icon:"solar:calendar-date-bold"}),e.jsxs(p,{sx:{display:"grid",gap:2.5,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(ee,{icon:"solar:calendar-bold",label:"Date",value:a.scheduled_on?new Date(a.scheduled_on).toLocaleDateString():"-"}),e.jsx(ee,{icon:"solar:clock-circle-bold",label:"Time",value:`${a.from_time||""} - ${a.to_time||""}`})]})]}),v=e.jsxs(p,{sx:{mt:2},children:[e.jsx(Z,{title:"Interviewer Feedback",icon:"solar:ranking-bold"}),e.jsx(ae,{sx:{mt:2,borderRadius:1,border:h=>`solid 1px ${h.vars.palette.divider}`},children:e.jsxs(re,{size:"small",children:[e.jsx(qe,{children:e.jsxs(O,{children:[e.jsx(x,{children:"Interviewer"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Rating"}),e.jsx(x,{children:"Notes"})]})}),e.jsx(ne,{children:(S=a.feedbacks)!=null&&S.length?a.feedbacks.map((h,m)=>e.jsxs(O,{children:[e.jsx(x,{children:h.interviewer}),e.jsx(x,{children:h.interview_type}),e.jsx(x,{children:e.jsx(le,{value:h.rating,readOnly:!0,size:"small"})}),e.jsx(x,{children:h.notes})]},m)):e.jsx(O,{children:e.jsx(x,{colSpan:4,align:"center",sx:{py:3,color:"text.secondary"},children:"No feedback recorded yet."})})})]})}),a.overall_performance&&e.jsxs(p,{sx:{mt:3},children:[e.jsx(g,{variant:"subtitle2",sx:{mb:1},children:"Overall Performance Summary"}),e.jsx(p,{sx:{p:2,bgcolor:"background.neutral",borderRadius:1},children:e.jsx(g,{variant:"body2",sx:{color:"text.secondary",whiteSpace:"pre-wrap"},children:a.overall_performance})})]})]});return e.jsxs(ie,{open:r,onClose:n,fullWidth:!0,maxWidth:"md",children:[e.jsxs(ce,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Interview Details",e.jsx(F,{onClick:n,children:e.jsx(I,{icon:"mingcute:close-line"})})]}),e.jsx(te,{sx:{maxHeight:"85vh"},children:e.jsxs(oe,{sx:{p:4},children:[u,b,e.jsx(J,{sx:{my:4,borderStyle:"dashed"}}),v]})})]})}function Z({title:r,icon:n}){return e.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(I,{icon:n,width:24,sx:{mr:1.5,color:"primary.main"}}),e.jsx(g,{variant:"subtitle1",sx:{fontWeight:700},children:r})]})}function ee({icon:r,label:n,value:a}){return e.jsxs(P,{direction:"row",spacing:1.5,alignItems:"flex-start",children:[e.jsx(I,{icon:r,width:20,sx:{color:"text.disabled",mt:.2}}),e.jsxs(p,{children:[e.jsx(g,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:n}),e.jsx(g,{variant:"body2",sx:{fontWeight:600},children:a})]})]})}function ot(){const[r,n]=l.useState(0),[a,d]=l.useState(10),[u,b]=l.useState(""),[v,S]=l.useState("desc"),[h,m]=l.useState("creation"),[y,_]=l.useState([]),{data:c,total:f,refetch:C}=nt(r+1,a,u,h,v),[L,de]=l.useState({read:!1,write:!1,delete:!1}),[he,ue]=l.useState([]),[me,pe]=l.useState([]),[xe,fe]=l.useState([]),[je,$]=l.useState(!1),[ge,q]=l.useState(!1),[be,ve]=l.useState(null),[A,H]=l.useState(null),[i,w]=l.useState({job_applicant:"",scheduled_on:Y().format("YYYY-MM-DD"),from_time:"",to_time:"",overall_status:"Scheduled",overall_performance:"",feedbacks:[]}),[N,k]=l.useState({open:!1,message:"",severity:"success"});l.useEffect(()=>{(async()=>{const s=await rt();de(s);const[o,R,We]=await Promise.all([B("Job Applicant",["name","applicant_name"]),B("Interview Type",["name"]),B("User",["name","full_name"])]);ue(o),pe(R),fe(We)})()},[]);const ye=t=>{S(h===t&&v==="asc"?"desc":"asc"),m(t)},we=t=>{_(t?c.map(s=>s.name):[])},Se=t=>{_(s=>s.includes(t)?s.filter(o=>o!==t):[...s,t])},_e=()=>{H(null),w({job_applicant:"",scheduled_on:Y().format("YYYY-MM-DD"),from_time:"",to_time:"",overall_status:"Scheduled",overall_performance:"",feedbacks:[]}),$(!0)},U=()=>{$(!1),H(null)},Ce=l.useCallback(async t=>{try{const s=await K(t.name);H(s),w({job_applicant:s.job_applicant,scheduled_on:s.scheduled_on,from_time:s.from_time,to_time:s.to_time,overall_status:s.overall_status,overall_performance:s.overall_performance,feedbacks:s.feedbacks||[]}),$(!0)}catch(s){k({open:!0,message:s.message||"Failed to load record",severity:"error"})}},[]),ke=l.useCallback(async t=>{try{const s=await K(t.name);ve(s),q(!0)}catch(s){k({open:!0,message:s.message||"Failed to load record",severity:"error"})}},[]),Ie=l.useCallback(async t=>{try{await X(t),k({open:!0,message:"Deleted successfully",severity:"success"}),C()}catch(s){k({open:!0,message:s.message||"Delete failed",severity:"error"})}},[C]),De=async()=>{try{await Promise.all(y.map(t=>X(t))),k({open:!0,message:"Deleted successfully",severity:"success"}),_([]),C()}catch(t){k({open:!0,message:t.message||"Bulk delete failed",severity:"error"})}},Re=async()=>{try{const t={...i,scheduled_on:i.scheduled_on?Y(i.scheduled_on).format("YYYY-MM-DD"):null};A?(await at(A.name,t),k({open:!0,message:"Updated successfully",severity:"success"})):(await st(t),k({open:!0,message:"Created successfully",severity:"success"})),U(),C()}catch(t){k({open:!0,message:t.message||"Action failed",severity:"error"})}},Te=()=>{w({...i,feedbacks:[...i.feedbacks,{interview_type:"",rating:0,interviewer:"",notes:""}]})},Pe=t=>{const s=[...i.feedbacks];s.splice(t,1),w({...i,feedbacks:s})},W=(t,s,o)=>{const R=[...i.feedbacks];R[t]={...R[t],[s]:o},w({...i,feedbacks:R})},Fe=(t,s)=>{n(s)},Oe=t=>{d(parseInt(t.target.value,10)),n(0)},Ae=t=>{b(t.target.value),n(0)},G=()=>{k({...N,open:!1})},Ne=!c.length&&!!u,Q=!c.length&&!u;return e.jsxs($e,{children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:5},children:[e.jsx(g,{variant:"h4",children:"Interviews"}),L.write&&e.jsx(E,{variant:"contained",color:"primary",startIcon:e.jsx(I,{icon:"mingcute:add-line"}),onClick:_e,children:"Schedule Interview"})]}),e.jsxs(He,{children:[e.jsx(Be,{numSelected:y.length,filterName:u,onFilterName:Ae,onDelete:De,searchPlaceholder:"Search by applicant..."}),e.jsx(te,{children:e.jsx(ae,{sx:{overflow:"unset"},children:e.jsxs(re,{sx:{minWidth:800},children:[e.jsx(Je,{order:v,orderBy:h,rowCount:c.length,numSelected:y.length,onSort:ye,onSelectAllRows:t=>we(t),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"job_applicant",label:"Applicant"},{id:"scheduled_on",label:"Schedule"},{id:"overall_status",label:"Status"},{id:"",label:""}]}),e.jsxs(ne,{children:[c.map((t,s)=>e.jsx(lt,{index:r*a+s,hideCheckbox:!0,row:{id:t.name,job_applicant:t.job_applicant,job_applied:t.job_applied,scheduled_on:t.scheduled_on,from_time:t.from_time,overall_status:t.overall_status},selected:y.includes(t.name),onSelectRow:()=>Se(t.name),onView:()=>ke(t),onEdit:()=>Ce(t),onDelete:()=>Ie(t.name),canEdit:L.write,canDelete:L.delete},t.name)),Ne&&e.jsx(Me,{searchQuery:u}),Q&&e.jsx(O,{children:e.jsx(x,{colSpan:6,children:e.jsx(Ue,{title:"No interviews scheduled",description:"Start scheduling interviews for your shortlisted candidates.",icon:"solar:video-library-bold-duotone"})})}),!Q&&e.jsx(ze,{height:68,emptyRows:Math.max(0,a-c.length)})]})]})})}),e.jsx(Qe,{component:"div",page:r,count:f,rowsPerPage:a,onPageChange:Fe,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:Oe})]}),e.jsxs(ie,{open:je,onClose:U,fullWidth:!0,maxWidth:"md",children:[e.jsx(ce,{children:A?"Edit Interview":"Schedule Interview"}),e.jsx(oe,{children:e.jsxs(P,{spacing:3,sx:{mt:2},children:[e.jsxs(p,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"}},children:[e.jsx(D,{select:!0,fullWidth:!0,label:"Job Applicant",value:i.job_applicant,onChange:t=>w({...i,job_applicant:t.target.value}),required:!0,children:he.map(t=>e.jsx(j,{value:t.name,children:t.applicant_name||t.name},t.name))}),e.jsx(Ve,{dateAdapter:Ke,children:e.jsx(Xe,{label:"Scheduled On",value:i.scheduled_on?Y(i.scheduled_on):null,onChange:t=>{w({...i,scheduled_on:t!=null&&t.isValid()?t.format("YYYY-MM-DD"):""})},slotProps:{textField:{fullWidth:!0}}})}),e.jsx(D,{fullWidth:!0,label:"From Time",type:"time",value:i.from_time,onChange:t=>w({...i,from_time:t.target.value}),InputLabelProps:{shrink:!0}}),e.jsx(D,{fullWidth:!0,label:"To Time",type:"time",value:i.to_time,onChange:t=>w({...i,to_time:t.target.value}),InputLabelProps:{shrink:!0}}),e.jsxs(D,{select:!0,fullWidth:!0,label:"Overall Status",value:i.overall_status,onChange:t=>w({...i,overall_status:t.target.value}),children:[e.jsx(j,{value:"Applied",children:"Applied"}),e.jsx(j,{value:"Screening",children:"Screening"}),e.jsx(j,{value:"Shortlisted",children:"Shortlisted"}),e.jsx(j,{value:"Scheduled",children:"Scheduled"}),e.jsx(j,{value:"In Progress",children:"In Progress"}),e.jsx(j,{value:"Completed",children:"Completed"}),e.jsx(j,{value:"No-Show",children:"No-Show"}),e.jsx(j,{value:"Cancelled",children:"Cancelled"}),e.jsx(j,{value:"Rescheduled",children:"Rescheduled"}),e.jsx(j,{value:"Selected",children:"Selected"}),e.jsx(j,{value:"Rejected",children:"Rejected"}),e.jsx(j,{value:"On Hold",children:"On Hold"})]}),e.jsx(D,{fullWidth:!0,multiline:!0,rows:3,label:"Overall Performance",value:i.overall_performance,onChange:t=>w({...i,overall_performance:t.target.value}),sx:{gridColumn:"span 2"}})]}),e.jsx(J,{sx:{my:2},children:"Feedbacks"}),e.jsxs(P,{spacing:2,children:[i.feedbacks.map((t,s)=>e.jsxs(p,{sx:{p:2,border:o=>`dashed 1px ${o.vars.palette.divider}`,borderRadius:1,position:"relative"},children:[e.jsx(F,{size:"small",color:"error",onClick:()=>Pe(s),sx:{position:"absolute",top:8,right:8},children:e.jsx(I,{icon:"solar:trash-bin-trash-bold"})}),e.jsxs(p,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},mt:2},children:[e.jsx(D,{select:!0,fullWidth:!0,label:"Interview Type",value:t.interview_type,onChange:o=>W(s,"interview_type",o.target.value),children:me.map(o=>e.jsx(j,{value:o.name,children:o.name},o.name))}),e.jsx(D,{select:!0,fullWidth:!0,label:"Interviewer",value:t.interviewer,onChange:o=>W(s,"interviewer",o.target.value),children:xe.map(o=>e.jsx(j,{value:o.name,children:o.full_name||o.name},o.name))}),e.jsxs(p,{sx:{gridColumn:"span 2"},children:[e.jsx(g,{component:"legend",children:"Rating"}),e.jsx(le,{name:`rating-${s}`,value:t.rating,onChange:(o,R)=>W(s,"rating",R)})]}),e.jsx(D,{fullWidth:!0,multiline:!0,rows:2,label:"Notes",value:t.notes,onChange:o=>W(s,"notes",o.target.value),sx:{gridColumn:"span 2"}})]})]},s)),e.jsx(E,{variant:"outlined",startIcon:e.jsx(I,{icon:"mingcute:add-line"}),onClick:Te,sx:{alignSelf:"flex-start"},children:"Add Feedback"})]})]})}),e.jsxs(Ze,{children:[e.jsx(E,{variant:"outlined",onClick:U,children:"Cancel"}),e.jsx(E,{variant:"contained",onClick:Re,children:A?"Update":"Schedule"})]})]}),e.jsx(it,{open:ge,onClose:()=>q(!1),interview:be}),e.jsx(et,{open:N.open,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ye,{onClose:G,severity:N.severity,sx:{width:"100%"},children:N.message})})]})}function Ut(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Interviews - ${Le.appName}`}),e.jsx(ot,{})]})}export{Ut as default};
