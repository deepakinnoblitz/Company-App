import{f as w,r as c,j as e,D as j,B as d,$ as k,T as u,S as T,p as D}from"./index-Co7v2xsC.js";import{h as R}from"./api-error-handler-CV6pRVHb.js";import{D as M,a as A}from"./DialogContent-DtP-sWqR.js";import{D as B}from"./DialogTitle-C3eBZids.js";import{R as _,a as y}from"./RadioGroup-B7r1ll7C.js";import{F as h}from"./FormControlLabel-CEvUm0a3.js";import{C as b}from"./Checkbox-CoJXcvzD.js";import{D as $}from"./DialogActions-h_2rRG3x.js";async function z(r){const l=await w(`/api/method/company.company.frontend_api.get_doctype_fields?doctype=${r}`);if(!l.ok){const a=await l.json();throw new Error(R(a,`Failed to fetch doctype meta for ${r}`))}const o=await l.json();console.log("getDoctypeMeta raw response:",o);const i=o.message;return console.log("getDoctypeMeta raw doc:",i),{name:i.name,fields:i.fields}}function H({open:r,onClose:l,doctype:o,onExport:i}){const[a,E]=c.useState([]),[t,x]=c.useState([]),[f,F]=c.useState("excel"),[g,m]=c.useState(!1);c.useEffect(()=>{r&&o&&(m(!0),z(o).then(s=>{console.log("ExportFieldsDialog meta:",s),E(s.fields),x(s.fields.map(n=>n.fieldname)),m(!1)}).catch(s=>{console.error(s),m(!1)}))},[r,o]);const C=s=>{const n=t.indexOf(s),p=[...t];n===-1?p.push(s):p.splice(n,1),x(p)},S=s=>{s.target.checked?x(a.map(n=>n.fieldname)):x([])},v=()=>{i(t,f),l()};return e.jsxs(M,{open:r,onClose:l,fullWidth:!0,maxWidth:"md",children:[e.jsxs(B,{children:["Export Data: ",o]}),e.jsx(j,{}),e.jsx(A,{sx:{py:3,height:400},children:g?e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(k,{})}):e.jsxs(d,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(u,{variant:"subtitle2",sx:{mb:1},children:"Export Format"}),e.jsxs(_,{row:!0,value:f,onChange:s=>F(s.target.value),children:[e.jsx(h,{value:"excel",control:e.jsx(y,{}),label:"Excel (.xlsx)"}),e.jsx(h,{value:"csv",control:e.jsx(y,{}),label:"CSV (.csv)"})]})]}),e.jsx(j,{sx:{mb:2}}),e.jsxs(d,{sx:{mb:2},children:[e.jsx(h,{control:e.jsx(b,{checked:t.length===a.length&&a.length>0,indeterminate:t.length>0&&t.length<a.length,onChange:S}),label:"Select All Fields"}),e.jsxs(u,{variant:"caption",sx:{ml:1,color:"text.secondary"},children:["(",t.length," selected)"]})]}),e.jsx(T,{children:e.jsx(d,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:1},children:a.map(s=>e.jsx(h,{control:e.jsx(b,{checked:t.indexOf(s.fieldname)!==-1,onChange:()=>C(s.fieldname),size:"small"}),label:s.label||s.fieldname,sx:{"& .MuiTypography-root":{fontSize:"0.875rem"}}},s.fieldname))})})]})}),e.jsxs($,{children:[e.jsx(D,{onClick:l,color:"inherit",children:"Cancel"}),e.jsx(D,{onClick:v,variant:"contained",disabled:t.length===0||g,children:"Export"})]})]})}export{H as E};
