import{r as o,j as e,T as F,p as P,I as b,q as h,B as y,S as fe,d as w,v as je,h as be}from"./index-Co7v2xsC.js";import{C as ye}from"./config-global-BX9xwJzv.js";import{r as ve,u as _,w as we}from"./reports-0l1D3gVE.js";import{getDoctypeList as q}from"./leads-d5FzXGcx.js";import{D as Le,C as A}from"./Card-CDV3jV6O.js";import{b as Ce}from"./lead-details-dialog-CNR7iG0O.js";import{E as Se}from"./export-fields-dialog-DKDJ10Kv.js";import{S as L}from"./Stack-GQIY7Xk9.js";import{L as ke,A as _e}from"./AdapterDayjs-BPhbSeWE.js";import{D as H}from"./DatePicker-BMZY9CMK.js";import{F as T,S as E}from"./Select-B1EkSlUY.js";import{T as Fe,a as Ie,b as De,c as W,d as a,e as Oe}from"./TableRow-DqeBPnxy.js";import{C as J}from"./Checkbox-CoJXcvzD.js";import{T as Re}from"./TablePagination-CEaYVDlQ.js";import"./api-error-handler-CV6pRVHb.js";import"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import"./string-DcbcEmw6.js";import"./format-time-9uMX-KY9.js";import"./dayjs.min-C2542nnJ.js";import"./CardHeader-CmhzWAj1.js";import"./useThemeProps-BDg4jra0.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./Tabs-oMX5aKw-.js";import"./useFormControl-Cqn8lfES.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./RadioGroup-B7r1ll7C.js";import"./FormControlLabel-CEvUm0a3.js";import"./DialogActions-h_2rRG3x.js";import"./index-Chjiymov.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./TextField-BmVWmDzd.js";import"./Chip-Rg4Dn3a5.js";import"./LastPage-CUGiC0iB.js";function Pe(){const[n,x]=o.useState([]),[C,m]=o.useState(!1),[r,v]=o.useState(null),[c,u]=o.useState(null),[g,M]=o.useState("all"),[f,z]=o.useState("all"),[p,B]=o.useState("all"),[K,Q]=o.useState([]),[X,Z]=o.useState([]),[I,D]=o.useState(0),[S,ee]=o.useState(10),[te,N]=o.useState(!1),[se,$]=o.useState(null),[l,O]=o.useState([]),oe=t=>{if(t.target.checked){const d=n.map(s=>s.name);O(d);return}O([])},ae=(t,d)=>{const s=l.indexOf(d);let i=[];s===-1?i=i.concat(l,d):s===0?i=i.concat(l.slice(1)):s===l.length-1?i=i.concat(l.slice(0,-1)):s>0&&(i=i.concat(l.slice(0,s),l.slice(s+1))),O(i)},[ne,U]=o.useState(!1),re=async(t,d)=>{m(!0);try{const s=[];l.length>0?s.push(["Lead","name","in",l]):(r&&s.push(["Lead","creation",">=",r.format("YYYY-MM-DD")]),c&&s.push(["Lead","creation","<=",c.format("YYYY-MM-DD")]),g!=="all"&&s.push(["Lead","leads_type","=",g]),f!=="all"&&s.push(["Lead","leads_from","=",f]),p!=="all"&&(p==="empty"?s.push(["Lead","owner","=",""]):s.push(["Lead","owner","=",p])));const i=new URLSearchParams({doctype:"Lead",fields:JSON.stringify(t),filters:JSON.stringify(s),limit_page_length:"99999"}),V=await fetch(`/api/method/frappe.client.get_list?${i.toString()}`,{credentials:"include"});if(!V.ok)throw new Error("Failed to fetch data for export");const me=(await V.json()).message||[],G=_.json_to_sheet(me);if(d==="excel"){const k=_.book_new();_.book_append_sheet(k,G,"Leads"),we(k,"Lead_Report.xlsx")}else{const k=_.sheet_to_csv(G),ue=new Blob([k],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a"),ge=URL.createObjectURL(ue);j.setAttribute("href",ge),j.setAttribute("download","Lead_Report.csv"),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j)}}catch(s){console.error(s)}finally{m(!1)}},le=o.useCallback(t=>{$(t),N(!0)},[]),ie=o.useCallback((t,d)=>{D(d)},[]),ce=o.useCallback(t=>{ee(parseInt(t.target.value,10)),D(0)},[]),R=o.useCallback(async()=>{m(!0);try{const t={};r&&(t.from_date=r.format("YYYY-MM-DD")),c&&(t.to_date=c.format("YYYY-MM-DD")),g!=="all"&&(t.leads_type=g),f!=="all"&&(t.leads_from=f),p!=="all"&&(t.owner=p);const d=await ve("Lead",t);x(d.result||[]),D(0)}catch(t){console.error("Failed to fetch lead report:",t)}finally{m(!1)}},[r,c,g,f,p]);o.useEffect(()=>{R()},[R]);const de=()=>{v(null),u(null),M("all"),z("all"),B("all")};o.useEffect(()=>{q("Lead From").then(Q),q("User").then(Z)},[]);const he=n.length,xe=n.filter(t=>t.leads_type==="Incoming").length,pe=n.filter(t=>t.leads_type==="Outgoing").length;return e.jsxs(Le,{children:[e.jsxs(L,{spacing:3,children:[e.jsxs(L,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(F,{variant:"h4",children:"Lead Report"}),e.jsxs(L,{direction:"row",spacing:1,children:[e.jsx(P,{variant:"outlined",startIcon:e.jsx(b,{icon:"solar:refresh-bold"}),onClick:R,disabled:C,children:"Refresh"}),e.jsx(P,{variant:"outlined",color:"error",startIcon:e.jsx(b,{icon:"solar:restart-bold"}),onClick:de,children:"Reset"})]})]}),e.jsxs(A,{sx:{p:2.5,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",bgcolor:"background.neutral",border:t=>`1px solid ${t.palette.divider}`},children:[e.jsxs(ke,{dateAdapter:_e,children:[e.jsx(H,{label:"From Date",value:r,onChange:t=>v(t),slotProps:{textField:{size:"small"}}}),e.jsx(H,{label:"To Date",value:c,onChange:t=>u(t),slotProps:{textField:{size:"small"}}})]}),e.jsx(T,{size:"small",sx:{minWidth:160},children:e.jsxs(E,{value:g,onChange:t=>M(t.target.value),displayEmpty:!0,children:[e.jsx(h,{value:"all",children:"Leads Type"}),e.jsx(h,{value:"Incoming",children:"Incoming"}),e.jsx(h,{value:"Outgoing",children:"Outgoing"})]})}),e.jsx(T,{size:"small",sx:{minWidth:160},children:e.jsxs(E,{value:f,onChange:t=>z(t.target.value),displayEmpty:!0,children:[e.jsx(h,{value:"all",children:"Leads From"}),K.map(t=>e.jsx(h,{value:t,children:t},t))]})}),e.jsx(T,{size:"small",sx:{minWidth:160},children:e.jsxs(E,{value:p,onChange:t=>B(t.target.value),displayEmpty:!0,children:[e.jsx(h,{value:"all",children:"Owner"}),e.jsx(h,{value:"Administrator",children:"Administrator"}),e.jsx(h,{value:"empty",children:"Empty"}),X.filter(t=>t!=="Administrator").map(t=>e.jsx(h,{value:t,children:t},t))]})}),e.jsx(y,{sx:{flexGrow:1}}),e.jsx(P,{variant:"contained",startIcon:e.jsx(b,{icon:"solar:export-bold"}),onClick:()=>U(!0),children:"Export"})]}),e.jsxs(y,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsx(Y,{item:{label:"Total Leads",value:he,indicator:"blue"}}),e.jsx(Y,{item:{label:"Incoming Leads",value:xe,indicator:"green"}}),e.jsx(Y,{item:{label:"Outgoing Leads",value:pe,indicator:"orange"}})]}),e.jsxs(A,{children:[e.jsx(Fe,{sx:{position:"relative",overflow:"unset"},children:e.jsx(fe,{children:e.jsxs(Ie,{size:"medium",stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(W,{sx:{bgcolor:"#f4f6f8"},children:[e.jsx(a,{padding:"checkbox",children:e.jsx(J,{indeterminate:l.length>0&&l.length<n.length,checked:n.length>0&&l.length===n.length,onChange:oe})}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Lead Name"}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Company"}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Phone"}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Email"}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Service"}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Leads Type"}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Leads From"}),e.jsx(a,{sx:{fontWeight:700,color:"text.secondary"},children:"Owner"}),e.jsx(a,{align:"right",sx:{fontWeight:700,color:"text.secondary",position:"sticky",right:0,bgcolor:"#f4f6f8",zIndex:11},children:"Actions"})]})}),e.jsxs(Oe,{children:[n.slice(I*S,I*S+S).map((t,d)=>{const s=l.indexOf(t.name)!==-1;return e.jsxs(W,{hover:!0,role:"checkbox","aria-checked":s,selected:s,children:[e.jsx(a,{padding:"checkbox",children:e.jsx(J,{checked:s,onClick:i=>ae(i,t.name)})}),e.jsx(a,{sx:{fontWeight:600},children:t.lead_name}),e.jsx(a,{children:t.company_name}),e.jsx(a,{children:t.phone_number}),e.jsx(a,{children:t.email}),e.jsx(a,{sx:{maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.service}),e.jsx(a,{children:e.jsx(y,{sx:{px:1,py:.5,borderRadius:1,display:"inline-flex",typography:"caption",fontWeight:"bold",bgcolor:w(t.leads_type==="Incoming"?"#4CAF50":"#FF9800",.1),color:t.leads_type==="Incoming"?"#4CAF50":"#FF9800"},children:t.leads_type})}),e.jsx(a,{children:t.leads_from}),e.jsx(a,{children:t.owner_name}),e.jsx(a,{align:"right",sx:{position:"sticky",right:0,bgcolor:"background.paper",boxShadow:"-2px 0 4px rgba(145, 158, 171, 0.08)"},children:e.jsx(je,{onClick:()=>le(t.name),sx:{color:"info.main"},children:e.jsx(b,{icon:"solar:eye-bold"})})})]},d)}),n.length===0&&!C&&e.jsx(W,{children:e.jsx(a,{colSpan:10,align:"center",sx:{py:10},children:e.jsxs(L,{spacing:1,alignItems:"center",children:[e.jsx(b,{icon:"eva:slash-outline",width:48,sx:{color:"text.disabled"}}),e.jsx(F,{variant:"body2",sx:{color:"text.disabled"},children:"No data found"})]})})})]})]})})}),e.jsx(Re,{component:"div",count:n.length,page:I,onPageChange:ie,rowsPerPage:S,onRowsPerPageChange:ce,rowsPerPageOptions:[5,10,25]})]})]}),e.jsx(Ce,{open:te,leadId:se,onClose:()=>{N(!1),$(null)}}),e.jsx(Se,{open:ne,onClose:()=>U(!1),doctype:"Lead",onExport:re})]})}function Y({item:n}){var v;const x=be(),C=c=>{switch(c==null?void 0:c.toLowerCase()){case"blue":return x.palette.info.main;case"green":return x.palette.success.main;case"orange":return x.palette.warning.main;case"red":return x.palette.error.main;default:return x.palette.primary.main}},m=c=>{const u=c.toLowerCase();return u.includes("total")?"solar:target-bold-duotone":u.includes("incoming")?"solar:inbox-in-bold-duotone":u.includes("outgoing")?"solar:inbox-out-bold-duotone":"solar:chart-2-bold-duotone"},r=C(n.indicator);return e.jsxs(A,{sx:{p:3,boxShadow:"none",position:"relative",overflow:"hidden",bgcolor:w(r,.04),border:`1px solid ${w(r,.1)}`,transition:x.transitions.create(["transform","box-shadow"]),"&:hover":{transform:"translateY(-4px)",boxShadow:`0 12px 24px -4px ${w(r,.12)}`}},children:[e.jsxs(L,{direction:"row",alignItems:"center",spacing:2.5,children:[e.jsx(y,{sx:{width:48,height:48,flexShrink:0,display:"flex",borderRadius:1.5,alignItems:"center",justifyContent:"center",color:r,bgcolor:w(r,.1)},children:e.jsx(b,{icon:m(n.label),width:28})}),e.jsxs(y,{sx:{flexGrow:1},children:[e.jsx(F,{variant:"subtitle2",sx:{color:"text.secondary",fontWeight:700,mb:.5},children:n.label}),e.jsx(F,{variant:"h4",sx:{color:"text.primary",fontWeight:800},children:(v=n.value)==null?void 0:v.toLocaleString()})]})]}),e.jsx(y,{sx:{top:-16,right:-16,width:80,height:80,opacity:.08,position:"absolute",borderRadius:"50%",bgcolor:r}})]})}function gt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Lead Report - ${ye.appName}`}),e.jsx(Pe,{})]})}export{gt as default};
