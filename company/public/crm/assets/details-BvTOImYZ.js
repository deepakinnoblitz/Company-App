import{Z as $,W as Y,r as x,j as e,$ as Z,T as i,p,I as a,B as y,d as n,D as K}from"./index-Co7v2xsC.js";import{C as X}from"./config-global-BX9xwJzv.js";import"./estimation-create-view-Dwo-yjK4.js";import"./format-time-9uMX-KY9.js";import"./dayjs.min-C2542nnJ.js";import{c}from"./format-number-DSNgsWBE.js";import{h as ee}from"./print-q83xVReF.js";import{D as C,C as te}from"./Card-CDV3jV6O.js";import{g as ie,c as re,d as ne,a as se}from"./estimation-B3H7gbs5.js";import{C as R}from"./confirm-dialog--19ddTk_.js";import{S as r}from"./Stack-GQIY7Xk9.js";import{T as oe,a as ae,b as le,c as k,d as s,e as ce}from"./TableRow-DqeBPnxy.js";import"./invoice-CmnDHtbD.js";import"./api-error-handler-CV6pRVHb.js";import"./data-import-KyR0bLZ-.js";import"./leads-d5FzXGcx.js";import"./contact-form-dialog-1sJlvlMf.js";import"./mui-tel-input.es-qb3PikOv.js";import"./TextField-BmVWmDzd.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./location_data-s7SeKs4x.js";import"./contacts-Y516V3QZ.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./tax-type-form-dialog-Ctl86VPY.js";import"./AdapterDayjs-BPhbSeWE.js";import"./index-Chjiymov.js";import"./useThemeProps-BDg4jra0.js";import"./Popper-DDlcgFVJ.js";import"./visuallyHidden-Dan1xhjv.js";import"./Chip-Rg4Dn3a5.js";import"./Autocomplete-BIV6h0T7.js";import"./usePreviousProps-CVIlMhUg.js";import"./DatePicker-BMZY9CMK.js";import"./Snackbar-BVA3LOhi.js";import"./AlertTitle-BbqQne_Q.js";function de(){const{id:o}=$(),m=Y(),[T,E]=x.useState(null),[A,F]=x.useState(!0),[g,W]=x.useState(!1),[G,f]=x.useState(!1),[N,b]=x.useState(!1),[v,I]=x.useState(!1);if(x.useEffect(()=>{o&&ie(o).then(E).finally(()=>F(!1))},[o]),A)return e.jsx(C,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(Z,{})});if(!T)return e.jsxs(C,{children:[e.jsx(i,{variant:"h4",children:"Estimation not found"}),e.jsx(p,{onClick:()=>m.push("/estimations"),sx:{mt:3},children:"Go back to list"})]});const{client_name:P,estimate_date:O,billing_address:H,description:S,terms_and_conditions:q,attachments:h,overall_discount_type:D,overall_discount:w,total_qty:U,total_amount:z,grand_total:_,table_qecz:u=[]}=T;let j=[];if(h)try{const t=JSON.parse(h);Array.isArray(t)?j=t:j=[{name:h.split("/").pop()||"Attachment",url:h}]}catch{j=[{name:h.split("/").pop()||"Attachment",url:h}]}const B=u.reduce((t,d)=>t+(d.tax_amount||0),0),L=z+B,Q=D==="Flat"?w:L*w/100,J=()=>{o&&ee(se(o))},M=async()=>{if(o)try{W(!0);const t=await re(o);m.push(`/invoices/${encodeURIComponent(t)}/view`,{converted:!0})}catch(t){console.error("Failed to convert estimation:",t)}finally{W(!1),f(!1)}},V=async()=>{if(o)try{I(!0),await ne(o),m.push("/estimations")}catch(t){console.error("Failed to delete estimation:",t)}finally{I(!1),b(!1)}};return e.jsxs(C,{children:[e.jsxs(r,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,className:"no-print",children:[e.jsxs(i,{variant:"h4",children:["Estimation: ",o]}),e.jsxs(r,{direction:"row",spacing:2,children:[e.jsx(p,{variant:"outlined",color:"inherit",onClick:()=>m.push("/estimations"),startIcon:e.jsx(a,{icon:"solar:arrow-left-bold"}),children:"Back"}),e.jsx(p,{variant:"outlined",color:"primary",onClick:J,startIcon:e.jsx(a,{icon:"solar:printer-bold"}),children:"Print"}),e.jsx(p,{variant:"contained",color:"warning",onClick:()=>f(!0),startIcon:e.jsx(a,{icon:"solar:transfer-horizontal-bold"}),disabled:g,children:g?"Converting...":"Convert to Invoice"}),e.jsx(p,{variant:"contained",color:"error",onClick:()=>b(!0),startIcon:e.jsx(a,{icon:"solar:trash-bin-trash-bold"}),children:"Delete"}),e.jsx(p,{variant:"contained",color:"primary",onClick:()=>m.push(`/estimations/${encodeURIComponent(o||"")}/edit`),startIcon:e.jsx(a,{icon:"solar:pen-bold"}),children:"Edit"})]})]}),e.jsx(te,{sx:{p:4,borderRadius:2},children:e.jsxs(r,{spacing:4,children:[e.jsxs(y,{sx:{display:"grid",columnGap:4,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsxs(r,{spacing:1.5,children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(a,{icon:"solar:user-rounded-bold-duotone",width:20}),e.jsx(i,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Customer Details"})]}),e.jsxs(y,{sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsx(i,{variant:"subtitle1",color:"primary.main",children:P}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:1,whiteSpace:"pre-wrap"},children:H||"No address provided"})]})]}),e.jsxs(r,{spacing:1.5,children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(a,{icon:"solar:calendar-bold-duotone",width:20}),e.jsx(i,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Doc Logistics"})]}),e.jsxs(r,{spacing:2,sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"caption",color:"text.disabled",children:"Date"}),e.jsx(i,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:O})]}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"caption",color:"text.disabled",children:"Reference"}),e.jsxs(i,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:["#",o]})]})]})]}),e.jsxs(r,{spacing:1.5,children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(a,{icon:"solar:wad-of-money-bold-duotone",width:20}),e.jsx(i,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Financial Summary"})]}),e.jsxs(r,{spacing:2,sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.primary.main,.04),border:t=>`1px solid ${n(t.palette.primary.main,.12)}`},children:[e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Grand Total"}),e.jsx(i,{variant:"h6",color:"primary.main",children:c(_)})]}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"caption",color:"text.secondary",children:"Items / Qty"}),e.jsxs(i,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:[u.length," / ",U||0]})]})]})]})]}),e.jsxs(y,{children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2,color:"text.secondary"},children:[e.jsx(a,{icon:"solar:list-bold-duotone",width:20}),e.jsx(i,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Line Items"})]}),e.jsx(oe,{sx:{overflow:"unset",border:t=>`1px solid ${n(t.palette.grey[500],.12)}`,borderRadius:1.5},children:e.jsxs(ae,{sx:{minWidth:800},children:[e.jsx(le,{children:e.jsxs(k,{sx:{bgcolor:t=>n(t.palette.grey[500],.04)},children:[e.jsx(s,{sx:{fontWeight:"fontWeightBold",py:2},children:"Service"}),e.jsx(s,{sx:{fontWeight:"fontWeightBold",py:2},children:"HSN"}),e.jsx(s,{sx:{fontWeight:"fontWeightBold",py:2},children:"Description"}),e.jsx(s,{width:60,align:"center",sx:{fontWeight:"fontWeightBold",py:2},children:"Qty"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Price"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Discount"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Tax Type"}),e.jsx(s,{width:100,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Tax Amt"}),e.jsx(s,{width:120,align:"right",sx:{fontWeight:"fontWeightBold",py:2},children:"Total"})]})}),e.jsx(ce,{children:u.map((t,d)=>e.jsxs(k,{sx:{"&:hover":{bgcolor:l=>n(l.palette.primary.main,.02)}},children:[e.jsx(s,{sx:{py:2},children:e.jsx(i,{variant:"subtitle2",children:t.service})}),e.jsx(s,{sx:{py:2},children:e.jsx(i,{variant:"body2",children:t.hsn_code||"-"})}),e.jsx(s,{sx:{py:2},children:e.jsx(i,{variant:"caption",sx:{color:"text.secondary",display:"block",maxWidth:200},children:t.description})}),e.jsx(s,{align:"center",sx:{py:2},children:t.quantity}),e.jsx(s,{align:"right",sx:{py:2},children:c(t.price)}),e.jsx(s,{align:"right",sx:{py:2},children:t.discount>0?e.jsxs(i,{variant:"caption",color:"success.main",children:["-",t.discount_type==="Flat"?c(t.discount):`${t.discount}%`]}):"-"}),e.jsx(s,{align:"right",sx:{py:2},children:e.jsx(i,{variant:"caption",color:"text.secondary",children:t.tax_type||"-"})}),e.jsx(s,{align:"right",sx:{py:2},children:c(t.tax_amount)}),e.jsx(s,{align:"right",sx:{py:2},children:e.jsx(i,{variant:"subtitle2",color:"primary",children:c(t.sub_total)})})]},d))})]})})]}),e.jsxs(y,{sx:{display:"grid",columnGap:4,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},alignItems:"start"},children:[e.jsxs(r,{spacing:3,children:[S&&e.jsxs(r,{spacing:1,children:[e.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Scope & Description"}),e.jsx(i,{variant:"body2",sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.primary.main,.04),border:t=>`1px solid ${n(t.palette.primary.main,.12)}`,whiteSpace:"pre-wrap",minHeight:80,color:"text.secondary"},children:S})]}),e.jsxs(r,{spacing:1,children:[e.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Terms & Conditions"}),e.jsx(i,{variant:"body2",sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.primary.main,.04),border:t=>`1px solid ${n(t.palette.primary.main,.12)}`,whiteSpace:"pre-wrap",minHeight:80},children:q||"No specific terms provided."})]}),j.length>0&&e.jsxs(r,{spacing:1,children:[e.jsx(i,{variant:"subtitle2",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Attachments"}),e.jsx(r,{spacing:1,children:j.map((t,d)=>e.jsxs(r,{direction:"row",alignItems:"center",component:"a",href:t.url,target:"_blank",sx:{px:2,py:1,borderRadius:1.5,textDecoration:"none",color:"inherit",bgcolor:l=>n(l.palette.primary.main,.04),border:l=>`1px solid ${n(l.palette.primary.main,.12)}`,transition:l=>l.transitions.create(["background-color","transform"]),"&:hover":{bgcolor:l=>n(l.palette.primary.main,.08),transform:"translateY(-1px)"}},children:[e.jsx(a,{icon:"solar:link-bold",width:18,sx:{mr:1,color:"primary.main",flexShrink:0}}),e.jsx(i,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:t.name||t.url.split("/").pop()}),e.jsx(a,{icon:"solar:download-bold",width:16,sx:{ml:1,color:"text.disabled"}})]},d))})]})]}),e.jsxs(r,{spacing:2,sx:{p:3,borderRadius:2,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Taxable Amount"}),e.jsx(i,{variant:"subtitle2",children:c(u.reduce((t,d)=>t+(d.sub_total-d.tax_amount),0))})]}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Total Tax"}),e.jsxs(i,{variant:"subtitle2",color:"error.main",children:["+",c(B)]})]}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Discount (",D==="Flat"?"Flat":`${w}%`,")"]}),e.jsxs(i,{variant:"subtitle2",color:"success.main",children:["-",c(Q)]})]}),e.jsx(K,{sx:{borderStyle:"dashed"}}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"subtitle1",children:"Grand Total"}),e.jsx(i,{variant:"h5",color:"primary.main",children:c(_)})]})]})]})]})}),e.jsx(R,{open:G,onClose:()=>!g&&f(!1),title:"Confirm Conversion",content:"Are you sure you want to convert this estimation into an invoice? This will create a new invoice document.",action:e.jsx(p,{onClick:M,color:"warning",variant:"contained",disabled:g,sx:{borderRadius:1.5,minWidth:100},children:g?"Converting...":"Confirm"})}),e.jsx(R,{open:N,onClose:()=>!v&&b(!1),title:"Confirm Delete",content:"Are you sure you want to delete this estimation?",action:e.jsx(p,{variant:"contained",color:"error",onClick:V,disabled:v,sx:{borderRadius:1.5,minWidth:100},children:v?"Deleting...":"Delete"})})]})}function Ve(){const{id:o}=$();return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Estimation details: ${o} - ${X.appName}`}),e.jsx(de,{})]})}export{Ve as default};
