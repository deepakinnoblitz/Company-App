import{r as s,j as e,B as x,d as Me,v as A,I,T as p,p as F,w as De,q as de,x as dt,y as ut,S as Ve}from"./index-Co7v2xsC.js";import{C as pt}from"./config-global-BX9xwJzv.js";import{f as ht,g as mt,d as Be}from"./contacts-Y516V3QZ.js";import{g as K}from"./string-DcbcEmw6.js";import{getDoctypeList as xt}from"./leads-d5FzXGcx.js";import{D as gt,C as ft}from"./Card-CDV3jV6O.js";import{l as X}from"./location_data-s7SeKs4x.js";import{E as bt}from"./empty-content-BBDmaj4d.js";import{C as jt}from"./confirm-dialog--19ddTk_.js";import{U as yt,a as Ct,T as He,b as St}from"./user-table-toolbar-BXgkag6p.js";import{c as R,d as b,T as ue,a as pe,b as ke,e as he}from"./TableRow-DqeBPnxy.js";import{C as vt}from"./Checkbox-CoJXcvzD.js";import{C as wt}from"./contact-form-dialog-1sJlvlMf.js";import{g as It,a as _t,u as kt,c as Dt,b as $e,d as Ue,e as Ot,s as Pt,f as Ft,h as Tt}from"./data-import-KyR0bLZ-.js";import{F as Ge,S as Je}from"./Select-B1EkSlUY.js";import{S as E}from"./Stack-GQIY7Xk9.js";import{T as $}from"./TextField-BmVWmDzd.js";import{D as Nt,a as Rt}from"./DialogContent-DtP-sWqR.js";import{D as Et}from"./DialogTitle-C3eBZids.js";import{S as Wt,a as zt,b as Lt}from"./Stepper-GJqW6VSQ.js";import{D as At}from"./DialogActions-h_2rRG3x.js";import{A as Mt}from"./Autocomplete-BIV6h0T7.js";import{B as Bt}from"./Badge-DIppMJwA.js";import{C as Ht}from"./contact-details-dialog-Bn0oXz4c.js";import{T as $t}from"./TablePagination-CEaYVDlQ.js";import{S as Ut}from"./Snackbar-BVA3LOhi.js";import"./api-error-handler-CV6pRVHb.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./mui-tel-input.es-qb3PikOv.js";import"./usePreviousProps-CVIlMhUg.js";import"./Chip-Rg4Dn3a5.js";import"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function Gt(S,D,_,i,j){const[w,d]=s.useState([]),[g,m]=s.useState(0),[k,u]=s.useState(!0),h=s.useCallback(async()=>{try{u(!0);const v=await ht({page:S,page_size:D,search:_,filterValues:i,sort_by:j});if(v&&typeof v=="object"&&"data"in v)d(v.data),m(v.total||v.data.length);else if(Array.isArray(v)){const P=v;d(P),m(P.length)}}catch(v){console.error("Error fetching contacts:",v),d([]),m(0)}finally{u(!1)}},[S,D,_,i,j]);return s.useEffect(()=>{h()},[h]),{data:w,total:g,loading:k,refetch:h}}function Jt({row:S,selected:D,onSelectRow:_,onView:i,onEdit:j,onDelete:w,canEdit:d=!0,canDelete:g=!0,hideCheckbox:m=!1,index:k}){return e.jsxs(R,{hover:!0,tabIndex:-1,role:"checkbox",selected:D,children:[!m&&e.jsx(b,{padding:"checkbox",children:e.jsx(vt,{disableRipple:!0,checked:D,onChange:_})}),typeof k=="number"&&e.jsx(b,{align:"center",children:e.jsx(x,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:u=>Me(u.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:u=>`1px solid ${Me(u.palette.primary.main,.16)}`,mx:"auto",transition:u=>u.transitions.create(["all"],{duration:u.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:k+1})}),e.jsx(b,{component:"th",scope:"row",children:e.jsx(x,{sx:{gap:2,display:"flex",alignItems:"center"},children:S.firstName})}),e.jsx(b,{children:S.companyName}),e.jsx(b,{children:S.sourceLead||"-"}),e.jsx(b,{children:S.phone}),e.jsx(b,{children:S.email}),e.jsx(b,{align:"right",children:e.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end"},children:[d&&e.jsx(A,{onClick:j,sx:{color:"primary.main"},children:e.jsx(I,{icon:"solar:pen-bold"})}),g&&e.jsx(A,{onClick:w,sx:{color:"error.main"},children:e.jsx(I,{icon:"solar:trash-bin-trash-bold"})}),e.jsx(A,{onClick:i,sx:{color:"info.main"},children:e.jsx(I,{icon:"solar:eye-bold"})})]})})]})}const Vt=["Upload","Map Columns","Preview","Import"];function Zt({open:S,onClose:D,onRefresh:_}){const[i,j]=s.useState(0),[w,d]=s.useState(null),[g,m]=s.useState(!1),[k,u]=s.useState(""),[h,v]=s.useState(null),[P,U]=s.useState([]),[r,C]=s.useState({}),[T,Y]=s.useState(null),[G,ee]=s.useState([]),[J,te]=s.useState(0),[se,M]=s.useState(""),[W,me]=s.useState([]);s.useEffect(()=>{S&&It("Contacts").then(U).catch(console.error)},[S]);const z=t=>{var n;(n=t.target.files)!=null&&n[0]&&(d(t.target.files[0]),M(""))},ae=async()=>{if(w){m(!0);try{const t=await kt(w),n=await Dt({reference_doctype:"Contacts",import_file:t.file_url,import_type:"Insert New Records"});u(n.name);const l=await $e(n.name);v(l);const c={};l.columns.forEach((f,O)=>{var je,ye;if(f.header_title==="Sr. No")return;if((je=f.df)!=null&&je.fieldname){c[O]=f.df.fieldname;return}const L=(ye=f.header_title)==null?void 0:ye.trim().toLowerCase(),be=P.find(oe=>{var Ce,Se,ve;return((Ce=oe.label)==null?void 0:Ce.trim().toLowerCase())===L||((Se=oe.fieldname)==null?void 0:Se.trim().toLowerCase())===L||((ve=oe.fieldname)==null?void 0:ve.replace(/_/g," ").toLowerCase())===L});c[O]=be?be.fieldname:"Don't Import"}),C(c),j(1)}catch(t){M(t.message||"Upload failed")}finally{m(!1)}}},xe=async()=>{m(!0);try{const t={};Object.entries(r).forEach(([c,f])=>{const O=parseInt(c,10);O>0&&(t[O-1]=f==="Don't Import"?"__skip__":f)}),await Ue(k,{template_options:JSON.stringify({column_to_field_map:t})});const l=await $e(k);v(l),me(l.data||[]),j(2)}catch(t){M(t.message||"Failed to save mapping")}finally{m(!1)}},N=async()=>{m(!0);try{const t={};Object.entries(r).forEach(([f,O])=>{const L=parseInt(f,10);L>0&&(t[L-1]=O==="Don't Import"?"__skip__":O)}),await Ue(k,{template_options:JSON.stringify({column_to_field_map:t})});const c=[h.columns.map(f=>f.header_title),...W];await Ot(k,c),await Pt(k),j(3),Oe(k)}catch(t){M(t.message||"Failed to start import"),m(!1)}},Oe=async t=>{const n=setInterval(async()=>{try{const l=await Ft(t);if(Y(l),l.total_records>0){const c=(l.success||0)+(l.failed||0);te(c/l.total_records*100)}if(["Success","Partial Success","Error","Timed Out"].includes(l.status)){clearInterval(n),m(!1);const c=await Tt(t);ee(c),_()}}catch(l){console.error("Polling error:",l)}},2e3)},B=()=>{j(0),d(null),u(""),v(null),C({}),ne([]),Y(null),ee([]),te(0),M(""),m(!1)},re=()=>{g||(B(),D())},[V,ne]=s.useState([]),ge=t=>{C({...r,[t]:"Don't Import"}),ne([...V,t])},Z=()=>{ne([])},fe=(t,n,l)=>{const c=[...W];c[t][n]=l,me(c)},H=(t,n)=>{C({...r,[t]:n})},Pe=e.jsxs(x,{sx:{py:4,display:"flex",flexFlow:"column",alignItems:"center"},children:[e.jsxs(x,{sx:{p:5,width:"100%",maxWidth:400,border:"2px dashed",borderColor:"divider",borderRadius:1.5,cursor:"pointer",bgcolor:"background.neutral",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:t=>t.transitions.create("opacity"),"&:hover":{opacity:.72},position:"relative",overflow:"hidden"},component:"label",children:[e.jsx("input",{type:"file",hidden:!0,accept:".csv, .xlsx",onChange:z}),e.jsx(I,{icon:"solar:cloud-upload-bold-duotone",width:64,sx:{mb:2,color:"primary.main",position:"relative",zIndex:1}}),e.jsx(p,{variant:"h6",sx:{position:"relative",zIndex:1},children:w?w.name:"Select data file"}),e.jsx(p,{variant:"body2",sx:{color:"text.secondary",position:"relative",zIndex:1},children:"Drop file here or click to browse"})]}),e.jsx(F,{size:"small",color:"primary",startIcon:e.jsx(I,{icon:"solar:download-bold-duotone"}),onClick:()=>window.open(_t("Contacts"),"_blank"),sx:{mt:2},children:"Download Sample Template"}),se&&e.jsx(De,{severity:"error",sx:{mt:2,width:"100%",maxWidth:400},children:se})]}),Fe=e.jsxs(x,{children:[V.length>0&&e.jsx(x,{sx:{mb:1,display:"flex",justifyContent:"flex-end"},children:e.jsxs(F,{size:"small",variant:"text",onClick:Z,startIcon:e.jsx(I,{icon:"solar:eye-bold"}),children:["Show ",V.length," skipped columns"]})}),e.jsx(ue,{sx:{mt:1,maxHeight:400},children:e.jsxs(pe,{stickyHeader:!0,size:"small",children:[e.jsx(ke,{children:e.jsxs(R,{children:[e.jsx(b,{children:"File Column"}),e.jsx(b,{children:"Contact Field"})]})}),e.jsx(he,{children:h==null?void 0:h.columns.filter(t=>t.header_title!=="Sr. No").filter(t=>!V.includes(h.columns.indexOf(t))).map(t=>{var l,c;const n=h.columns.indexOf(t);return e.jsxs(R,{children:[e.jsxs(b,{children:[e.jsx(p,{variant:"subtitle2",children:t.header_title||`Column ${n+1}`}),e.jsxs(p,{variant:"caption",sx:{color:"text.secondary"},children:["Sample: ",((c=(l=h.data)==null?void 0:l[0])==null?void 0:c[n])||"N/A"]})]}),e.jsx(b,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{fullWidth:!0,size:"small",children:e.jsxs(Je,{value:r[n]||"Don't Import",onChange:f=>C({...r,[n]:f.target.value}),children:[e.jsx(de,{value:"Don't Import",children:"Don't Import"}),P.map(f=>e.jsxs(de,{value:f.fieldname,children:[f.label," (",f.fieldname,")"]},f.fieldname))]})}),e.jsx(A,{size:"small",color:"error",onClick:()=>ge(n),children:e.jsx(I,{icon:"solar:trash-bin-trash-bold"})})]})})]},n)})})]})})]}),Te=e.jsxs(x,{sx:{mt:2},children:[(()=>{const t=((h==null?void 0:h.warnings)||[]).filter(n=>{var c;const l=((c=n.message)==null?void 0:c.toLowerCase())||"";return!(l.includes("__skip__")||n.type==="info"&&(l.includes("mapping column")||l.includes("cannot match column")||l.includes("with any field")))});return t.length===0?null:e.jsxs(E,{spacing:1,sx:{mb:3},children:[e.jsxs(p,{variant:"subtitle1",color:"warning.main",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(I,{icon:"solar:danger-bold"})," Warnings (",t.length,")"]}),t.slice(0,5).map((n,l)=>e.jsxs(De,{severity:n.type==="info"?"info":"warning",sx:{py:0},children:[n.row?`Row ${n.row}: `:"",n.message.replace(/<[^>]*>?/gm,"")]},l)),t.length>5&&e.jsxs(p,{variant:"caption",children:["...and ",t.length-5," more warnings"]})]})})(),e.jsxs(p,{variant:"subtitle2",sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(I,{icon:"solar:table-split-bold-duotone",width:20}),"Data Preview & Mapping (Editable)"]}),e.jsx(ue,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:450,bgcolor:"background.paper",boxShadow:t=>t.customShadows.dropdown},children:e.jsxs(pe,{size:"small",stickyHeader:!0,sx:{borderCollapse:"separate",borderSpacing:0},children:[e.jsx(ke,{children:e.jsx(R,{children:h==null?void 0:h.columns.map((t,n)=>{if(t.header_title==="Sr. No")return null;const l=r[n]==="Don't Import";return e.jsxs(b,{sx:{whiteSpace:"nowrap",bgcolor:"background.neutral",borderRight:1,borderBottom:2,borderColor:"divider",p:1.5,opacity:l?.6:1,transition:c=>c.transitions.create("opacity"),minWidth:160},children:[e.jsx(p,{variant:"caption",sx:{fontWeight:"bold",display:"block",mb:1,color:l?"text.disabled":"text.primary",textTransform:"uppercase",letterSpacing:.5},children:t.header_title}),e.jsx(Ge,{fullWidth:!0,size:"small",children:e.jsxs(Je,{value:r[n]||"Don't Import",onChange:c=>H(n,c.target.value),sx:{height:32,fontSize:"0.75rem",bgcolor:l?"transparent":"background.paper","& .MuiOutlinedInput-notchedOutline":{borderColor:l?"transparent":"primary.light"}},children:[e.jsx(de,{value:"Don't Import",sx:{color:"text.disabled",fontStyle:"italic"},children:"Don't Import"}),P.map(c=>e.jsx(de,{value:c.fieldname,sx:{fontSize:"0.75rem"},children:c.label},c.fieldname))]})})]},n)})})}),e.jsx(he,{children:W.map((t,n)=>e.jsx(R,{sx:{"&:hover":{bgcolor:"action.hover"}},children:t.map((l,c)=>{if(c===0)return null;const f=r[c]==="Don't Import";return e.jsx(b,{sx:{p:0,borderRight:1,borderColor:"divider",bgcolor:f?"action.hover":"inherit",opacity:f?.5:1},children:e.jsx($,{fullWidth:!0,size:"small",value:l||"",onChange:O=>fe(n,c,O.target.value),variant:"standard",slotProps:{input:{disableUnderline:!0,sx:{fontSize:"0.875rem",px:1.5,py:1,height:"100%","&:focus-within":{bgcolor:"background.paper",boxShadow:O=>`inset 0 0 0 2px ${O.palette.primary.main}`}}}}})},c)})},n))})]})})]}),Ne=e.jsx(x,{sx:{py:4},children:e.jsxs(E,{spacing:3,children:[e.jsxs(x,{children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(p,{variant:"subtitle1",children:"Importing..."}),e.jsxs(p,{variant:"body2",children:[Math.round(J),"%"]})]}),e.jsx(dt,{variant:"determinate",value:J,sx:{height:10,borderRadius:5}})]}),T&&e.jsxs(x,{sx:{p:2,bgcolor:"background.neutral",borderRadius:1,display:"flex",gap:4},children:[e.jsxs(x,{children:[e.jsx(p,{variant:"caption",display:"block",color:"text.secondary",children:"Total"}),e.jsx(p,{variant:"h6",children:T.total_records})]}),e.jsxs(x,{children:[e.jsx(p,{variant:"caption",display:"block",color:"success.main",children:"Success"}),e.jsx(p,{variant:"h6",color:"success.main",children:T.success||0})]}),e.jsxs(x,{children:[e.jsx(p,{variant:"caption",display:"block",color:"error.main",children:"Failed"}),e.jsx(p,{variant:"h6",color:"error.main",children:T.failed||0})]})]}),G.length>0&&e.jsxs(x,{children:[e.jsx(p,{variant:"subtitle2",sx:{mb:1},children:"Detailed Error Logs"}),e.jsx(ue,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:300},children:e.jsxs(pe,{size:"small",stickyHeader:!0,children:[e.jsx(ke,{children:e.jsxs(R,{children:[e.jsx(b,{children:"Row(s)"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Message / Exception"})]})}),e.jsx(he,{children:G.map((t,n)=>e.jsxs(R,{children:[e.jsx(b,{children:JSON.parse(t.row_indexes).join(", ")}),e.jsx(b,{children:e.jsx(I,{icon:t.success?"solar:check-circle-bold":"solar:close-circle-bold",color:t.success?"success.main":"error.main"})}),e.jsx(b,{sx:{fontSize:"0.75rem",maxWidth:400},children:t.success?`Created: ${t.docname}`:e.jsx(x,{children:e.jsx(p,{variant:"caption",color:"error",component:"pre",sx:{whiteSpace:"pre-wrap",fontFamily:"monospace"},children:t.messages!=="[]"?JSON.parse(t.messages).join(`
`):t.exception})})})]},n))})]})})]})]})});return e.jsxs(Nt,{open:S,onClose:re,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Et,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Import Contacts",e.jsx(A,{onClick:re,disabled:g,children:e.jsx(I,{icon:"mingcute:close-line"})})]}),e.jsxs(Rt,{dividers:!0,sx:{pb:4},children:[e.jsx(Wt,{activeStep:i,sx:{py:2},children:Vt.map(t=>e.jsx(zt,{children:e.jsx(Lt,{children:t})},t))}),i===0&&Pe,i===1&&Fe,i===2&&Te,i===3&&Ne]}),e.jsxs(At,{sx:{p:2},children:[i>0&&i<3&&e.jsx(F,{variant:"outlined",onClick:()=>j(i-1),disabled:g,children:"Back"}),e.jsx(x,{sx:{flexGrow:1}}),i===0&&e.jsx(F,{variant:"contained",onClick:ae,disabled:!w||g,children:g?"Processing...":"Next: Mapping"}),i===1&&e.jsx(F,{variant:"contained",onClick:xe,disabled:g,children:g?"Saving...":"Next: Preview"}),i===2&&e.jsx(F,{variant:"contained",onClick:N,disabled:g,children:"Start Import"}),i===3&&!g&&e.jsx(F,{variant:"contained",onClick:re,children:"Finish"})]})]})}function qt({open:S,onOpen:D,onClose:_,filters:i,onFilters:j,canReset:w,onResetFilters:d,options:g}){const m=(r,C)=>{j(r==="country"?{[r]:C,state:"all",city:"all"}:r==="state"?{[r]:C,city:"all"}:{[r]:C})},k=e.jsxs(x,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(p,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(A,{onClick:d,disabled:!w,sx:{mr:.5,color:w?"primary.main":"text.disabled","&:hover":{bgcolor:w?"primary.lighter":"transparent"}},children:e.jsx(Bt,{color:"error",variant:"dot",invisible:!w,children:e.jsx(I,{icon:"solar:restart-bold",width:20})})}),e.jsx(A,{onClick:_,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(I,{icon:"mingcute:close-line",width:20})})]}),u=e.jsxs(E,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Contact Type"}),e.jsxs($,{select:!0,fullWidth:!0,value:i.customer_type,onChange:r=>m("customer_type",r.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"Sales",children:"Sales"}),e.jsx("option",{value:"Purchase",children:"Purchase"})]})]}),h=e.jsxs(E,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Source Lead"}),e.jsx(Mt,{fullWidth:!0,size:"small",value:i.source_lead==="all"?null:g.source_leads.find(r=>r.name===i.source_lead)||null,onChange:(r,C)=>{m("source_lead",C?C.name:"all")},options:g.source_leads,getOptionLabel:r=>`${r.lead_name} (${r.name})`,renderInput:r=>e.jsx($,{...r,placeholder:"Search leads...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(r,C)=>s.createElement("li",{...r,key:C.name},e.jsxs(p,{variant:"body2",sx:{fontSize:"13px"},children:[C.lead_name," (",C.name,")"]}))})]}),v=e.jsxs(E,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Country"}),e.jsxs($,{select:!0,fullWidth:!0,value:i.country,onChange:r=>m("country",r.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Countries"}),g.countries.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),P=e.jsxs(E,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"State"}),e.jsxs($,{select:!0,fullWidth:!0,value:i.state,onChange:r=>m("state",r.target.value),SelectProps:{native:!0},size:"small",disabled:!i.country||i.country==="all",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:!i.country||i.country==="all"?"Select Country First":"All States"}),g.states.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),U=e.jsxs(E,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"City"}),e.jsxs($,{select:!0,fullWidth:!0,value:i.city,onChange:r=>m("city",r.target.value),SelectProps:{native:!0},size:"small",disabled:!i.state||i.state==="all",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:!i.state||i.state==="all"?"Select State First":"All Cities"}),g.cities.map(r=>e.jsx("option",{value:r,children:r},r))]})]});return e.jsxs(ut,{anchor:"right",open:S,onClose:_,slotProps:{paper:{sx:{width:340,boxShadow:r=>r.customShadows.z24}}},sx:{zIndex:r=>r.zIndex.drawer+100},children:[k,e.jsx(Ve,{children:e.jsxs(E,{spacing:3,sx:{p:3},children:[u,h,v,P,U]})}),e.jsx(x,{sx:{p:2.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.neutral"},children:e.jsx(F,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(I,{icon:"solar:trash-bin-trash-bold"}),onClick:d,disabled:!w,sx:{borderRadius:1.5,borderColor:"divider",fontWeight:600,"&:hover":{borderColor:"error.main",color:"error.main",bgcolor:"error.lighter"},"&.Mui-disabled":{borderColor:"divider"}},children:"Clear All Filters"})})]})}const Qt=[{value:"modified_desc",label:"Newest First"},{value:"modified_asc",label:"Oldest First"},{value:"first_name_asc",label:"Name: A to Z"},{value:"first_name_desc",label:"Name: Z to A"},{value:"company_name_asc",label:"Company: A to Z"},{value:"company_name_desc",label:"Company: Z to A"}];function Kt(){const[S,D]=s.useState(0),[_,i]=s.useState(5),[j,w]=s.useState(""),[d,g]=s.useState({customer_type:"all",source_lead:"all",country:"all",state:"all",city:"all"}),[m,k]=s.useState("modified_desc"),[u,h]=s.useState([]),[v,P]=s.useState(!1),[U,r]=s.useState(!1),[C,T]=s.useState(null),[Y,G]=s.useState(!1),[ee,J]=s.useState(!1),[te,se]=s.useState([]),[M,W]=s.useState([]),[me,z]=s.useState([]),[ae,xe]=s.useState([]),[N,Oe]=s.useState(""),[B,re]=s.useState(""),[V,ne]=s.useState(""),[ge,Z]=s.useState([]),[fe,H]=s.useState([]),[Pe,Fe]=s.useState(!1),[Te,Ne]=s.useState(""),[t,n]=s.useState(""),[l,c]=s.useState(""),[f,O]=s.useState(""),[L,be]=s.useState(""),[je,ye]=s.useState(""),[oe,Ce]=s.useState(""),[Se,ve]=s.useState("Sales"),[Xt,Yt]=s.useState(""),[Ze,we]=s.useState(!1),[Re,Ee]=s.useState(null),[Ie,q]=s.useState({open:!1,message:"",severity:"success"}),[_e,qe]=s.useState({read:!0,write:!0,delete:!0}),{data:Q,total:We,loading:le,refetch:ie}=Gt(S+1,_,j,d,m),Qe=a=>{g(o=>({...o,...a})),D(0)},Ke=()=>{g({customer_type:"all",source_lead:"all",country:"all",state:"all",city:"all"}),D(0)},ce=d.customer_type!=="all"||d.source_lead!=="all"||d.country!=="all"||d.state!=="all"||d.city!=="all";s.useEffect(()=>{mt().then(qe);const a=Array.from(new Set(X.map(o=>o.country)));se(["",...a]),xt("Lead",["name","lead_name"]).then(xe).catch(console.error)},[]),s.useEffect(()=>{if(N){const a=X.find(o=>o.country===N);if(a){const o=a.states.map(y=>y.name);W(["",...o,"Others"])}else W([])}else W([]),z([])},[N]),s.useEffect(()=>{if(B&&N)if(B==="Others")z(["Others"]);else{const a=X.find(o=>o.country===N);if(a){const o=a.states.find(y=>y.name===B);z(o?["",...o.cities,"Others"]:["Others"])}}else z([])},[B,N]),s.useEffect(()=>{if(d.country&&d.country!=="all"){const a=X.find(o=>o.country===d.country);if(a){const o=a.states.map(y=>y.name);Z([...o,"Others"])}else Z([])}else Z([])},[d.country]),s.useEffect(()=>{if(d.state&&d.state!=="all"&&d.country&&d.country!=="all")if(d.state==="Others")H(["Others"]);else{const a=X.find(o=>o.country===d.country);if(a){const o=a.states.find(y=>y.name===d.state);H(o?[...o.cities,"Others"]:["Others"])}}else H([])},[d.state,d.country]);const[es,ts]=s.useState({}),Xe=()=>{T(null),r(!0)},Ye=()=>{r(!1),T(null)},ze=()=>{q(a=>({...a,open:!1}))},et=a=>{Ee(a),we(!0)},tt=async()=>{if(Re)try{await Be(Re),q({open:!0,message:"Contact deleted successfully",severity:"success"}),await ie()}catch(a){console.error(a),q({open:!0,message:"Failed to delete contact",severity:"error"})}finally{we(!1),Ee(null)}},st=async()=>{try{await Promise.all(u.map(a=>Be(a))),q({open:!0,message:`${u.length} contacts deleted successfully`,severity:"success"}),h([]),await ie()}catch(a){q({open:!0,message:a.message||"Error during bulk delete",severity:"error"})}},at=(a,o)=>{if(a){h(o);return}h([])},rt=a=>{const o=u.indexOf(a);let y=[];o===-1?y=y.concat(u,a):o===0?y=y.concat(u.slice(1)):o===u.length-1?y=y.concat(u.slice(0,-1)):o>0&&(y=y.concat(u.slice(0,o),u.slice(o+1))),h(y)},Le=a=>{T(a),r(!0)},nt=a=>{T(a),G(!0)},ot=(a,o)=>{D(o)},lt=a=>{i(parseInt(a.target.value,10)),D(0)},it=!le&&!Q.length&&(!!j||ce),Ae=!le&&!Q.length&&!j&&!ce;return e.jsxs(gt,{children:[e.jsxs(x,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(p,{variant:"h4",sx:{flexGrow:1},children:"Contacts"}),_e.write&&e.jsxs(x,{sx:{display:"flex",gap:2},children:[e.jsx(F,{variant:"outlined",startIcon:e.jsx(I,{icon:"solar:import-bold-duotone"}),onClick:()=>J(!0),sx:{color:"#08a3cd",borderColor:"#08a3cd","&:hover":{borderColor:"#068fb3",bgcolor:"rgba(8, 163, 205, 0.04)"}},children:"Import"}),e.jsx(F,{variant:"contained",startIcon:e.jsx(I,{icon:"mingcute:add-line"}),onClick:Xe,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Contact"})]})]}),e.jsxs(ft,{children:[e.jsx(yt,{numSelected:u.length,filterName:j,onFilterName:a=>{w(a.target.value),D(0)},searchPlaceholder:"Search contacts...",onOpenFilter:()=>P(!0),canReset:ce,sortBy:m,onSortChange:k,onDelete:st,sortOptions:Qt}),e.jsx(Ve,{children:e.jsx(ue,{sx:{overflow:"unset"},children:e.jsxs(pe,{sx:{minWidth:800},children:[e.jsx(Ct,{rowCount:We,numSelected:u.length,onSelectAllRows:a=>at(a,Q.map(o=>o.name)),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"name",label:"Name"},{id:"company",label:"Company"},{id:"sourceLead",label:"Source Lead"},{id:"phone",label:"Phone"},{id:"email",label:"Email"},{id:""}]}),e.jsxs(he,{children:[le&&e.jsx(He,{height:68,emptyRows:_}),!le&&Q.map((a,o)=>{var y;return e.jsx(Jt,{index:S*_+o,hideCheckbox:!0,row:{id:a.name,firstName:a.first_name,companyName:K(a.company_name)||"",email:K(a.email)||"",phone:K(a.phone)||"",avatarUrl:"/assets/images/avatar/avatar-25.webp",sourceLead:a.source_lead?`${K(a.source_lead)} - ${((y=ae.find(ct=>ct.name===K(a.source_lead)))==null?void 0:y.lead_name)||""}`:""},selected:u.includes(a.name),onSelectRow:()=>rt(a.name),onView:()=>nt(a.name),onEdit:()=>Le(a.name),onDelete:()=>et(a.name),canEdit:_e.write,canDelete:_e.delete},a.name)}),it&&e.jsx(St,{searchQuery:j}),Ae&&e.jsx(R,{children:e.jsx(b,{colSpan:10,children:e.jsx(bt,{title:"No contacts found",description:"Create a new contact to track your professional network.",icon:"solar:users-group-rounded-bold-duotone"})})}),!Ae&&e.jsx(He,{height:68,emptyRows:_-Q.length})]})]})})}),e.jsx($t,{component:"div",count:We,page:S,rowsPerPage:_,onPageChange:ot,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:lt})]}),e.jsx(qt,{open:v,onOpen:()=>P(!0),onClose:()=>P(!1),filters:d,onFilters:Qe,canReset:ce,onResetFilters:Ke,options:{countries:te.filter(a=>a!==""),states:ge,cities:fe,source_leads:ae}}),e.jsx(wt,{open:U,onClose:Ye,contactId:C,onSuccess:ie}),e.jsx(jt,{open:Ze,onClose:()=>we(!1),title:"Confirm Delete",content:"Are you sure you want to delete this contact?",action:e.jsx(F,{onClick:tt,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),e.jsx(Ut,{open:Ie.open,autoHideDuration:6e3,onClose:ze,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(De,{onClose:ze,severity:Ie.severity,sx:{width:"100%"},children:Ie.message})}),e.jsx(Zt,{open:ee,onClose:()=>J(!1),onRefresh:ie}),e.jsx(Ht,{open:Y,onClose:()=>{G(!1)},contactId:C,onEdit:Le})]})}function Ls(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Contacts - ${pt.appName}`}),e.jsx(Kt,{})]})}export{Ls as default};
