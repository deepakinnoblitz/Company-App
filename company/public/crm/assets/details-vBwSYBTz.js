import{Z as E,W as G,r as c,j as e,$ as N,T as s,p as d,I as o,B as u,d as n,D as b,w as O}from"./index-Co7v2xsC.js";import{C as L}from"./config-global-BX9xwJzv.js";import{c as m}from"./format-number-DSNgsWBE.js";import{D as f,C as V}from"./Card-CDV3jV6O.js";import{g as z,d as H}from"./purchase-collection-D_NfVWmK.js";import{C as M}from"./confirm-dialog--19ddTk_.js";import{S as r}from"./Stack-GQIY7Xk9.js";import{S as U}from"./Snackbar-BVA3LOhi.js";import{A as Z}from"./AlertTitle-BbqQne_Q.js";import"./api-error-handler-CV6pRVHb.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";function q(){const{id:i}=E(),x=G(),[y,I]=c.useState(null),[D,P]=c.useState(!0),[j,C]=c.useState(!1),[v,k]=c.useState(!1),[_,g]=c.useState(!1),[l,h]=c.useState({open:!1,message:"",severity:"success"});if(c.useEffect(()=>{i&&z(i).then(t=>{I(t),fetch(`/api/method/frappe.client.get_list?doctype=Purchase Collection&fields=["name"]&filters=[["Purchase Collection","purchase","=","${t.purchase}"]]&order_by=collection_date desc&limit_page_length=1`,{credentials:"include"}).then(a=>a.json()).then(a=>{a.message&&a.message.length>0&&k(a.message[0].name===t.name)}).catch(a=>console.error("Failed to check if latest",a))}).catch(t=>{console.error("Failed to fetch collection:",t),h({open:!0,message:"Failed to load collection details",severity:"error"})}).finally(()=>P(!1))},[i]),D)return e.jsx(f,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(N,{})});if(!y)return e.jsxs(f,{children:[e.jsx(s,{variant:"h4",children:"Purchase Collection not found"}),e.jsx(d,{onClick:()=>x.push("/purchase-collections"),sx:{mt:3},children:"Go back to list"})]});const{purchase:R,vendor:T,vendor_name:$,collection_date:A,amount_to_pay:w,amount_collected:F,amount_pending:p,mode_of_payment:B,remarks:S}=y,W=async()=>{if(i)try{C(!0),await H(i),h({open:!0,message:"Collection deleted successfully",severity:"success"}),setTimeout(()=>x.push("/purchase-collections"),1500)}catch(t){console.error("Failed to delete collection:",t),h({open:!0,message:"Failed to delete collection",severity:"error"})}finally{C(!1),g(!1)}};return e.jsxs(f,{children:[e.jsxs(r,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(s,{variant:"h4",children:["Purchase Collection: ",i]}),e.jsxs(r,{direction:"row",spacing:2,children:[e.jsx(d,{variant:"outlined",color:"inherit",onClick:()=>x.push("/purchase-collections"),startIcon:e.jsx(o,{icon:"solar:arrow-left-bold"}),children:"Back to List"}),v&&e.jsx(d,{variant:"contained",color:"error",onClick:()=>g(!0),startIcon:e.jsx(o,{icon:"solar:trash-bin-trash-bold"}),children:"Delete"}),v&&e.jsx(d,{variant:"contained",color:"primary",onClick:()=>x.push(`/purchase-collections/${encodeURIComponent(i||"")}/edit`),startIcon:e.jsx(o,{icon:"solar:pen-bold"}),children:"Edit Collection"})]})]}),e.jsx(V,{sx:{p:4,borderRadius:2},children:e.jsxs(r,{spacing:4,children:[e.jsxs(u,{sx:{display:"grid",columnGap:4,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:[e.jsxs(r,{spacing:1.5,children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(o,{icon:"solar:document-text-bold-duotone",width:20}),e.jsx(s,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Purchase Details"})]}),e.jsxs(u,{sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsx(s,{variant:"caption",color:"text.disabled",children:"Purchase Number"}),e.jsx(s,{variant:"subtitle1",color:"primary.main",sx:{mt:.5},children:R}),e.jsx(b,{sx:{my:1.5,borderStyle:"dashed"}}),e.jsx(s,{variant:"caption",color:"text.disabled",children:"Amount to Pay"}),e.jsx(s,{variant:"h6",sx:{mt:.5},children:m(w)})]})]}),e.jsxs(r,{spacing:1.5,children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(o,{icon:"solar:user-rounded-bold-duotone",width:20}),e.jsx(s,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Vendor Details"})]}),e.jsxs(u,{sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsx(s,{variant:"caption",color:"text.disabled",children:"Vendor ID"}),e.jsx(s,{variant:"subtitle2",sx:{mt:.5},children:T}),e.jsx(b,{sx:{my:1.5,borderStyle:"dashed"}}),e.jsx(s,{variant:"caption",color:"text.disabled",children:"Name"}),e.jsx(s,{variant:"body2",sx:{mt:.5},children:$||"-"})]})]}),e.jsxs(r,{spacing:1.5,children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(o,{icon:"solar:calendar-bold-duotone",width:20}),e.jsx(s,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Collection Info"})]}),e.jsxs(r,{spacing:2,sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(s,{variant:"caption",color:"text.disabled",children:"Collection Date"}),e.jsx(s,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:A})]}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(s,{variant:"caption",color:"text.disabled",children:"Payment Mode"}),e.jsx(s,{variant:"body2",sx:{fontWeight:"fontWeightSemiBold"},children:B})]})]})]})]}),e.jsxs(u,{children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2,color:"text.secondary"},children:[e.jsx(o,{icon:"solar:wad-of-money-bold-duotone",width:20}),e.jsx(s,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Payment Summary"})]}),e.jsxs(r,{spacing:2,sx:{p:3,borderRadius:2,bgcolor:t=>n(t.palette.grey[500],.04),border:t=>`1px solid ${n(t.palette.grey[500],.08)}`},children:[e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Amount to Pay"}),e.jsx(s,{variant:"subtitle2",children:m(w)})]}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(r,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(o,{icon:"solar:hand-money-bold-duotone",width:16,sx:{color:"success.main"}}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Amount Collected"})]}),e.jsx(s,{variant:"subtitle2",color:"success.main",children:m(F)})]}),e.jsx(b,{sx:{borderStyle:"dashed"}}),e.jsxs(r,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(r,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(o,{icon:"solar:wallet-2-bold-duotone",width:20,sx:{color:(p||0)>0?"error.main":"success.main"}}),e.jsx(s,{variant:"subtitle1",sx:{color:(p||0)>0?"error.main":"success.main"},children:"Amount Pending"})]}),e.jsx(s,{variant:"h5",color:(p||0)>0?"error.main":"success.main",children:m(p)})]})]})]}),S&&e.jsxs(r,{spacing:1,children:[e.jsxs(r,{direction:"row",alignItems:"center",spacing:1,sx:{color:"text.secondary"},children:[e.jsx(o,{icon:"solar:notes-bold-duotone",width:20}),e.jsx(s,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.5},children:"Remarks"})]}),e.jsx(s,{variant:"body2",sx:{p:2,borderRadius:1.5,bgcolor:t=>n(t.palette.primary.main,.04),border:t=>`1px solid ${n(t.palette.primary.main,.12)}`,whiteSpace:"pre-wrap",minHeight:80,color:"text.secondary"},children:S})]})]})}),e.jsx(U,{open:l.open,autoHideDuration:6e3,onClose:()=>h({...l,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(O,{severity:l.severity,sx:{width:"100%",boxShadow:t=>t.customShadows.z20},children:[e.jsx(Z,{children:l.severity==="success"?"Success":"Error"}),l.message]})}),e.jsx(M,{open:_,onClose:()=>!j&&g(!1),title:"Confirm Delete",content:"Are you sure you want to delete this purchase collection?",action:e.jsx(d,{variant:"contained",color:"error",onClick:W,disabled:j,sx:{borderRadius:1.5,minWidth:100},children:j?"Deleting...":"Delete"})})]})}function ce(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Purchase Collection Details - ${L.appName}`}),e.jsx(q,{})]})}export{ce as default};
