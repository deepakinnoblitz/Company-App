const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leads-d5FzXGcx.js","assets/index-Co7v2xsC.js","assets/index-CLEJBD1W.css","assets/api-error-handler-CV6pRVHb.js"])))=>i.map(i=>d[i]);
import{r as s,j as e,B as m,d as ht,v as ee,I as W,T as g,p as N,w as Y,q as Oe,x as Kt,y as Xt,S as Ct,n as Yt}from"./index-Co7v2xsC.js";import{C as Zt}from"./config-global-BX9xwJzv.js";import{y as es}from"./mui-tel-input.es-qb3PikOv.js";import{fetchLeads as ts,getDoctypeList as mt,getWorkflowStates as ss,convertLead as rs,updateLead as xt,getLead as gt,getWorkflowActions as bt,createLead as as,deleteLead as ft}from"./leads-d5FzXGcx.js";import{g as d}from"./string-DcbcEmw6.js";import{g as ls}from"./error-handler-Bmy_4JQL.js";import{D as os,C as ns}from"./Card-CDV3jV6O.js";import{l as Le}from"./location_data-s7SeKs4x.js";import{E as is}from"./empty-content-BBDmaj4d.js";import{C as yt}from"./confirm-dialog--19ddTk_.js";import{U as cs,a as ds,T as vt,b as us}from"./user-table-toolbar-BXgkag6p.js";import{L as ps}from"./label-BpZ9ieER.js";import"./styles-wAmuuHpw.js";import{c as Z,d as C,T as Me,a as ze,b as Qe,e as Be}from"./TableRow-DqeBPnxy.js";import{C as hs}from"./Checkbox-CoJXcvzD.js";import{S as ms,L as xs,a as gs,b as bs}from"./lead-details-dialog-CNR7iG0O.js";import{g as fs,a as ys,u as vs,c as js,b as jt,d as St,e as Ss,s as Cs,f as ws,h as Is}from"./data-import-KyR0bLZ-.js";import{F as Ke,S as Xe}from"./Select-B1EkSlUY.js";import{S as B}from"./Stack-GQIY7Xk9.js";import{T as x}from"./TextField-BmVWmDzd.js";import{D as wt,a as It}from"./DialogContent-DtP-sWqR.js";import{D as kt}from"./DialogTitle-C3eBZids.js";import{S as ks,a as _s,b as Ps}from"./Stepper-GJqW6VSQ.js";import{D as _t}from"./DialogActions-h_2rRG3x.js";import{B as Ls}from"./Badge-DIppMJwA.js";import{T as Os,a as Ee}from"./Tabs-oMX5aKw-.js";import{T as Ws}from"./TablePagination-CEaYVDlQ.js";import{S as Fs}from"./Snackbar-BVA3LOhi.js";import"./api-error-handler-CV6pRVHb.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./format-time-9uMX-KY9.js";import"./dayjs.min-C2542nnJ.js";import"./CardHeader-CmhzWAj1.js";import"./useThemeProps-BDg4jra0.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";function Ds(i,k,D,o,I){const[w,T]=s.useState([]),[v,b]=s.useState(0),[P,_]=s.useState(!0),[S,E]=s.useState(0),A=()=>E(f=>f+1);return s.useEffect(()=>{_(!0),ts({page:i+1,page_size:k,search:D,filterValues:o,sort_by:I}).then(f=>{T(f.data),b(f.total)}).catch(f=>{console.error("Failed to fetch leads",f),T([]),b(0)}).finally(()=>_(!1))},[i,k,D,o,I,S]),{data:w,total:v,loading:P,refetch:A}}const Ns=i=>({"New Lead":{bgcolor:"rgba(234, 179, 8, 0.22)",border:"1px solid rgba(234, 179, 8, 0.45)",color:"#92400e"},Contacted:{bgcolor:"rgba(251, 146, 60, 0.24)",border:"1px solid rgba(251, 146, 60, 0.45)",color:"#9a3412"},Qualified:{bgcolor:"rgba(34, 197, 94, 0.25)",border:"1px solid rgba(34, 197, 94, 0.45)",color:"#15803d"},"Proposal Sent":{bgcolor:"rgba(99, 102, 241, 0.25)",border:"1px solid rgba(99, 102, 241, 0.45)",color:"#4338ca"},"In Negotiation":{bgcolor:"rgba(249, 115, 22, 0.25)",border:"1px solid rgba(249, 115, 22, 0.45)",color:"#c2410c"},"Follow-up Scheduled":{bgcolor:"rgba(245, 158, 11, 0.25)",border:"1px solid rgba(245, 158, 11, 0.45)",color:"#92400e"},"On Hold":{bgcolor:"rgba(156, 163, 175, 0.25)",border:"1px solid rgba(156, 163, 175, 0.45)",color:"#374151"},"Not Interested":{bgcolor:"rgba(239, 68, 68, 0.25)",border:"1px solid rgba(239, 68, 68, 0.45)",color:"#991b1b"},"In Active":{bgcolor:"rgba(139, 92, 246, 0.22)",border:"1px solid rgba(139, 92, 246, 0.45)",color:"#4c1d95"},Closed:{bgcolor:"rgba(220, 38, 38, 0.25)",border:"1px solid rgba(220, 38, 38, 0.45)",color:"#7f1d1d"},Pending:{bgcolor:"rgba(249, 115, 22, 0.25)",border:"1px solid rgba(249, 115, 22, 0.45)",color:"#c2410c"}})[i]||{bgcolor:"rgba(156, 163, 175, 0.25)",border:"1px solid rgba(156, 163, 175, 0.45)",color:"#374151"};function Ts({row:i,selected:k,onSelectRow:D,onView:o,onEdit:I,onDelete:w,canEdit:T=!0,canDelete:v=!0,hideCheckbox:b=!1,index:P}){return e.jsxs(Z,{hover:!0,tabIndex:-1,role:"checkbox",selected:k,children:[!b&&e.jsx(C,{padding:"checkbox",children:e.jsx(hs,{disableRipple:!0,checked:k,onChange:D})}),typeof P=="number"&&e.jsx(C,{align:"center",children:e.jsx(m,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:_=>ht(_.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:_=>`1px solid ${ht(_.palette.primary.main,.16)}`,mx:"auto",transition:_=>_.transitions.create(["all"],{duration:_.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:P+1})}),e.jsx(C,{component:"th",scope:"row",children:e.jsx(m,{sx:{gap:2,display:"flex",alignItems:"center"},children:i.name})}),e.jsx(C,{children:i.company}),e.jsx(C,{children:i.country||"-"}),e.jsx(C,{children:i.phone}),e.jsx(C,{children:i.email}),e.jsx(C,{children:e.jsx(ps,{sx:{...Ns(i.workflow_state||i.status),fontWeight:500,borderRadius:"6px",padding:"4px 12px"},children:i.workflow_state||i.status})}),e.jsx(C,{align:"right",children:e.jsxs(m,{sx:{display:"flex",justifyContent:"flex-end"},children:[T&&e.jsx(ee,{onClick:I,sx:{color:"primary.main"},children:e.jsx(W,{icon:"solar:pen-bold"})}),v&&e.jsx(ee,{onClick:w,sx:{color:"error.main"},children:e.jsx(W,{icon:"solar:trash-bin-trash-bold"})}),e.jsx(ee,{onClick:o,sx:{color:"info.main"},children:e.jsx(W,{icon:"solar:eye-bold"})})]})})]})}const Rs=["Upload","Map Columns","Preview","Import"];function As({open:i,onClose:k,onRefresh:D}){const[o,I]=s.useState(0),[w,T]=s.useState(null),[v,b]=s.useState(!1),[P,_]=s.useState(""),[S,E]=s.useState(null),[A,f]=s.useState([]),[L,u]=s.useState({}),[a,H]=s.useState(null),[ae,We]=s.useState([]),[ye,V]=s.useState(0),[te,R]=s.useState(""),[q,le]=s.useState([]),[J,z]=s.useState([]);s.useEffect(()=>{i&&fs("Lead").then(f).catch(console.error)},[i]);const oe=l=>{var c;(c=l.target.files)!=null&&c[0]&&(T(l.target.files[0]),R(""))},Q=async()=>{if(w){b(!0);try{const l=await vs(w),c=await js({reference_doctype:"Lead",import_file:l.file_url,import_type:"Insert New Records"});_(c.name);const p=await jt(c.name);E(p);const h={};p.columns.forEach((j,O)=>{var re,Ce;if(j.header_title==="Sr. No")return;if((re=j.df)!=null&&re.fieldname){h[O]=j.df.fieldname;return}const $=(Ce=j.header_title)==null?void 0:Ce.trim().toLowerCase(),se=A.find(X=>{var we,De,Ie;return((we=X.label)==null?void 0:we.trim().toLowerCase())===$||((De=X.fieldname)==null?void 0:De.trim().toLowerCase())===$||((Ie=X.fieldname)==null?void 0:Ie.replace(/_/g," ").toLowerCase())===$});h[O]=se?se.fieldname:"Don't Import"}),u(h),I(1)}catch(l){R(l.message||"Upload failed")}finally{b(!1)}}},ne=async()=>{b(!0);try{const l={};Object.entries(L).forEach(([h,j])=>{const O=parseInt(h,10);O>0&&(l[O-1]=j==="Don't Import"?"__skip__":j)}),await St(P,{template_options:JSON.stringify({column_to_field_map:l})});const p=await jt(P);E(p),z(p.data||[]),I(2)}catch(l){R(l.message||"Failed to save mapping")}finally{b(!1)}},ve=async()=>{b(!0);try{const l={};Object.entries(L).forEach(([j,O])=>{const $=parseInt(j,10);$>0&&(l[$-1]=O==="Don't Import"?"__skip__":O)}),await St(P,{template_options:JSON.stringify({column_to_field_map:l})});const h=[S.columns.map(j=>j.header_title),...J];await Ss(P,h),await Cs(P),I(3),ie(P)}catch(l){R(l.message||"Failed to start import"),b(!1)}},ie=async l=>{const c=setInterval(async()=>{try{const p=await ws(l);if(H(p),p.total_records>0){const h=(p.success||0)+(p.failed||0);V(h/p.total_records*100)}if(["Success","Partial Success","Error","Timed Out"].includes(p.status)){clearInterval(c),b(!1);const h=await Is(l);We(h),D()}}catch(p){console.error("Polling error:",p)}},2e3)},je=()=>{I(0),T(null),_(""),E(null),u({}),le([]),H(null),We([]),V(0),R(""),b(!1)},K=()=>{v||(je(),k())},Se=l=>{u({...L,[l]:"Don't Import"}),le([...q,l])},ce=()=>{le([])},M=(l,c,p)=>{const h=[...J];h[l][c]=p,z(h)},de=(l,c)=>{u({...L,[l]:c})},U=e.jsxs(m,{sx:{py:4,display:"flex",flexFlow:"column",alignItems:"center"},children:[e.jsxs(m,{sx:{p:5,width:"100%",maxWidth:400,border:"2px dashed",borderColor:"divider",borderRadius:1.5,cursor:"pointer",bgcolor:"background.neutral",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:l=>l.transitions.create("opacity"),"&:hover":{opacity:.72},position:"relative",overflow:"hidden"},component:"label",children:[e.jsx("input",{type:"file",hidden:!0,accept:".csv, .xlsx",onChange:oe}),e.jsx(W,{icon:"solar:cloud-upload-bold-duotone",width:64,sx:{mb:2,color:"primary.main",position:"relative",zIndex:1}}),e.jsx(g,{variant:"h6",sx:{position:"relative",zIndex:1},children:w?w.name:"Select data file"}),e.jsx(g,{variant:"body2",sx:{color:"text.secondary",position:"relative",zIndex:1},children:"Drop file here or click to browse"})]}),e.jsx(N,{size:"small",color:"primary",startIcon:e.jsx(W,{icon:"solar:download-bold-duotone"}),onClick:()=>window.open(ys("Lead"),"_blank"),sx:{mt:2},children:"Download Sample Template"}),te&&e.jsx(Y,{severity:"error",sx:{mt:2,width:"100%",maxWidth:400},children:te})]}),ue=e.jsxs(m,{children:[q.length>0&&e.jsx(m,{sx:{mb:1,display:"flex",justifyContent:"flex-end"},children:e.jsxs(N,{size:"small",variant:"text",onClick:ce,startIcon:e.jsx(W,{icon:"solar:eye-bold"}),children:["Show ",q.length," skipped columns"]})}),e.jsx(Me,{sx:{mt:1,maxHeight:400},children:e.jsxs(ze,{stickyHeader:!0,size:"small",children:[e.jsx(Qe,{children:e.jsxs(Z,{children:[e.jsx(C,{children:"File Column"}),e.jsx(C,{children:"Lead Field"})]})}),e.jsx(Be,{children:S==null?void 0:S.columns.filter(l=>l.header_title!=="Sr. No").filter(l=>!q.includes(S.columns.indexOf(l))).map(l=>{var p,h;const c=S.columns.indexOf(l);return e.jsxs(Z,{children:[e.jsxs(C,{children:[e.jsx(g,{variant:"subtitle2",children:l.header_title||`Column ${c+1}`}),e.jsxs(g,{variant:"caption",sx:{color:"text.secondary"},children:["Sample: ",((h=(p=S.data)==null?void 0:p[0])==null?void 0:h[c])||"N/A"]})]}),e.jsx(C,{children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{fullWidth:!0,size:"small",children:e.jsxs(Xe,{value:L[c]||"Don't Import",onChange:j=>u({...L,[c]:j.target.value}),children:[e.jsx(Oe,{value:"Don't Import",children:"Don't Import"}),A.map(j=>e.jsxs(Oe,{value:j.fieldname,children:[j.label," (",j.fieldname,")"]},j.fieldname))]})}),e.jsx(ee,{size:"small",color:"error",onClick:()=>Se(c),children:e.jsx(W,{icon:"solar:trash-bin-trash-bold"})})]})})]},c)})})]})})]}),Fe=e.jsxs(m,{sx:{mt:2},children:[(()=>{const l=((S==null?void 0:S.warnings)||[]).filter(c=>{var h;const p=((h=c.message)==null?void 0:h.toLowerCase())||"";return!(p.includes("__skip__")||c.type==="info"&&(p.includes("mapping column")||p.includes("cannot match column")||p.includes("with any field")))});return l.length===0?null:e.jsxs(B,{spacing:1,sx:{mb:3},children:[e.jsxs(g,{variant:"subtitle1",color:"warning.main",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{icon:"solar:danger-bold"})," Warnings (",l.length,")"]}),l.slice(0,5).map((c,p)=>e.jsxs(Y,{severity:c.type==="info"?"info":"warning",sx:{py:0},children:[c.row?`Row ${c.row}: `:"",c.message.replace(/<[^>]*>?/gm,"")]},p)),l.length>5&&e.jsxs(g,{variant:"caption",children:["...and ",l.length-5," more warnings"]})]})})(),e.jsxs(g,{variant:"subtitle2",sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{icon:"solar:table-split-bold-duotone",width:20}),"Data Preview & Mapping (Editable)"]}),e.jsx(Me,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:450,bgcolor:"background.paper",boxShadow:l=>l.customShadows.dropdown},children:e.jsxs(ze,{size:"small",stickyHeader:!0,sx:{borderCollapse:"separate",borderSpacing:0},children:[e.jsx(Qe,{children:e.jsx(Z,{children:S==null?void 0:S.columns.map((l,c)=>{if(l.header_title==="Sr. No")return null;const p=L[c]==="Don't Import";return e.jsxs(C,{sx:{whiteSpace:"nowrap",bgcolor:"background.neutral",borderRight:1,borderBottom:2,borderColor:"divider",p:1.5,opacity:p?.6:1,transition:h=>h.transitions.create("opacity"),minWidth:160},children:[e.jsx(g,{variant:"caption",sx:{fontWeight:"bold",display:"block",mb:1,color:p?"text.disabled":"text.primary",textTransform:"uppercase",letterSpacing:.5},children:l.header_title}),e.jsx(Ke,{fullWidth:!0,size:"small",children:e.jsxs(Xe,{value:L[c]||"Don't Import",onChange:h=>de(c,h.target.value),sx:{height:32,fontSize:"0.75rem",bgcolor:p?"transparent":"background.paper","& .MuiOutlinedInput-notchedOutline":{borderColor:p?"transparent":"primary.light"}},children:[e.jsx(Oe,{value:"Don't Import",sx:{color:"text.disabled",fontStyle:"italic"},children:"Don't Import"}),A.map(h=>e.jsx(Oe,{value:h.fieldname,sx:{fontSize:"0.75rem"},children:h.label},h.fieldname))]})})]},c)})})}),e.jsx(Be,{children:J.map((l,c)=>e.jsx(Z,{sx:{"&:hover":{bgcolor:"action.hover"}},children:l.map((p,h)=>{if(h===0)return null;const j=L[h]==="Don't Import";return e.jsx(C,{sx:{p:0,borderRight:1,borderColor:"divider",bgcolor:j?"action.hover":"inherit",opacity:j?.5:1},children:e.jsx(x,{fullWidth:!0,size:"small",value:p||"",onChange:O=>M(c,h,O.target.value),variant:"standard",slotProps:{input:{disableUnderline:!0,sx:{fontSize:"0.875rem",px:1.5,py:1,height:"100%","&:focus-within":{bgcolor:"background.paper",boxShadow:O=>`inset 0 0 0 2px ${O.palette.primary.main}`}}}}})},h)})},c))})]})})]}),pe=e.jsx(m,{sx:{py:4},children:e.jsxs(B,{spacing:3,children:[e.jsxs(m,{children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(g,{variant:"subtitle1",children:"Importing..."}),e.jsxs(g,{variant:"body2",children:[Math.round(ye),"%"]})]}),e.jsx(Kt,{variant:"determinate",value:ye,sx:{height:10,borderRadius:5}})]}),a&&e.jsxs(m,{sx:{p:2,bgcolor:"background.neutral",borderRadius:1,display:"flex",gap:4},children:[e.jsxs(m,{children:[e.jsx(g,{variant:"caption",display:"block",color:"text.secondary",children:"Total"}),e.jsx(g,{variant:"h6",children:a.total_records})]}),e.jsxs(m,{children:[e.jsx(g,{variant:"caption",display:"block",color:"success.main",children:"Success"}),e.jsx(g,{variant:"h6",color:"success.main",children:a.success||0})]}),e.jsxs(m,{children:[e.jsx(g,{variant:"caption",display:"block",color:"error.main",children:"Failed"}),e.jsx(g,{variant:"h6",color:"error.main",children:a.failed||0})]})]}),ae.length>0&&e.jsxs(m,{children:[e.jsx(g,{variant:"subtitle2",sx:{mb:1},children:"Detailed Error Logs"}),e.jsx(Me,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:300},children:e.jsxs(ze,{size:"small",stickyHeader:!0,children:[e.jsx(Qe,{children:e.jsxs(Z,{children:[e.jsx(C,{children:"Row(s)"}),e.jsx(C,{children:"Status"}),e.jsx(C,{children:"Message / Exception"})]})}),e.jsx(Be,{children:ae.map((l,c)=>e.jsxs(Z,{children:[e.jsx(C,{children:JSON.parse(l.row_indexes).join(", ")}),e.jsx(C,{children:e.jsx(W,{icon:l.success?"solar:check-circle-bold":"solar:close-circle-bold",color:l.success?"success.main":"error.main"})}),e.jsx(C,{sx:{fontSize:"0.75rem",maxWidth:400},children:l.success?`Created: ${l.docname}`:e.jsx(m,{children:e.jsx(g,{variant:"caption",color:"error",component:"pre",sx:{whiteSpace:"pre-wrap",fontFamily:"monospace"},children:l.messages!=="[]"?JSON.parse(l.messages).join(`
`):l.exception})})})]},c))})]})})]})]})});return e.jsxs(wt,{open:i,onClose:K,fullWidth:!0,maxWidth:"md",children:[e.jsxs(kt,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Import Leads",e.jsx(ee,{onClick:K,disabled:v,children:e.jsx(W,{icon:"mingcute:close-line"})})]}),e.jsxs(It,{dividers:!0,sx:{pb:4},children:[e.jsx(ks,{activeStep:o,sx:{py:2},children:Rs.map(l=>e.jsx(_s,{children:e.jsx(Ps,{children:l})},l))}),o===0&&U,o===1&&ue,o===2&&Fe,o===3&&pe]}),e.jsxs(_t,{sx:{p:2},children:[o>0&&o<3&&e.jsx(N,{variant:"outlined",onClick:()=>I(o-1),disabled:v,children:"Back"}),e.jsx(m,{sx:{flexGrow:1}}),o===0&&e.jsx(N,{variant:"contained",onClick:Q,disabled:!w||v,children:v?"Processing...":"Next: Mapping"}),o===1&&e.jsx(N,{variant:"contained",onClick:ne,disabled:v,children:v?"Saving...":"Next: Preview"}),o===2&&e.jsx(N,{variant:"contained",onClick:ve,disabled:v,children:"Start Import"}),o===3&&!v&&e.jsx(N,{variant:"contained",onClick:K,children:"Finish"})]})]})}function Es({open:i,onOpen:k,onClose:D,filters:o,onFilters:I,canReset:w,onResetFilters:T,options:v}){const b=(a,H)=>{I(a==="country"?{[a]:H,state:"all",city:"all"}:a==="state"?{[a]:H,city:"all"}:{[a]:H})},P=e.jsxs(m,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(g,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(ee,{onClick:T,disabled:!w,sx:{mr:.5,color:w?"primary.main":"text.disabled","&:hover":{bgcolor:w?"primary.lighter":"transparent"}},children:e.jsx(Ls,{color:"error",variant:"dot",invisible:!w,children:e.jsx(W,{icon:"solar:restart-bold",width:20})})}),e.jsx(ee,{onClick:D,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(W,{icon:"mingcute:close-line",width:20})})]}),_=e.jsxs(B,{spacing:1.5,children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Status"}),e.jsxs(x,{select:!0,fullWidth:!0,value:o.workflow_state,onChange:a=>b("workflow_state",a.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All States"}),v.workflow_states.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),S=e.jsxs(B,{spacing:1.5,children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Lead Source"}),e.jsxs(x,{select:!0,fullWidth:!0,value:o.leads_from,onChange:a=>b("leads_from",a.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Sources"}),v.leads_from.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),E=e.jsxs(B,{spacing:1.5,children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Lead Type"}),e.jsxs(x,{select:!0,fullWidth:!0,value:o.leads_type,onChange:a=>b("leads_type",a.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"Incoming",children:"Incoming"}),e.jsx("option",{value:"Outgoing",children:"Outgoing"})]})]}),A=e.jsxs(B,{spacing:1.5,children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Service"}),e.jsxs(x,{select:!0,fullWidth:!0,value:o.service,onChange:a=>b("service",a.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Services"}),v.services.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),f=e.jsxs(B,{spacing:1.5,children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Country"}),e.jsxs(x,{select:!0,fullWidth:!0,value:o.country,onChange:a=>b("country",a.target.value),SelectProps:{native:!0},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:"All Countries"}),v.countries.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),L=e.jsxs(B,{spacing:1.5,children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"State"}),e.jsxs(x,{select:!0,fullWidth:!0,value:o.state,onChange:a=>b("state",a.target.value),SelectProps:{native:!0},size:"small",disabled:!o.country||o.country==="all",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:!o.country||o.country==="all"?"Select Country First":"All States"}),v.states.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),u=e.jsxs(B,{spacing:1.5,children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"City"}),e.jsxs(x,{select:!0,fullWidth:!0,value:o.city,onChange:a=>b("city",a.target.value),SelectProps:{native:!0},size:"small",disabled:!o.state||o.state==="all",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}},children:[e.jsx("option",{value:"all",children:!o.state||o.state==="all"?"Select State First":"All Cities"}),v.cities.map(a=>e.jsx("option",{value:a,children:a},a))]})]});return e.jsxs(Xt,{anchor:"right",open:i,onClose:D,slotProps:{paper:{sx:{width:340,boxShadow:a=>a.customShadows.z24}}},sx:{zIndex:a=>a.zIndex.drawer+100},children:[P,e.jsx(Ct,{children:e.jsxs(B,{spacing:3,sx:{p:3},children:[_,S,E,A,f,L,u]})}),e.jsx(m,{sx:{p:2.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.neutral"},children:e.jsx(N,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(W,{icon:"solar:trash-bin-trash-bold"}),onClick:T,disabled:!w,sx:{borderRadius:1.5,borderColor:"divider",fontWeight:600,"&:hover":{borderColor:"error.main",color:"error.main",bgcolor:"error.lighter"},"&.Mui-disabled":{borderColor:"divider"}},children:"Clear All Filters"})})]})}function Ms(){const i=zs(),[k,D]=s.useState(""),[o,I]=s.useState({status:"all",workflow_state:"all",leads_from:"all",leads_type:"all",service:"all",country:"all",state:"all",city:"all"}),[w,T]=s.useState("modified_desc"),[v,b]=s.useState(!1),P=[{value:"New Lead",label:"New Lead"},{value:"Contacted",label:"Contacted"},{value:"Qualified",label:"Qualified"},{value:"Proposal Sent",label:"Proposal Sent"},{value:"In Negotiation",label:"In Negotiation"},{value:"Follow-up Scheduled",label:"Follow-up Scheduled"},{value:"On Hold",label:"On Hold"},{value:"Not Interested",label:"Not Interested"},{value:"In Active",label:"In Active"},{value:"Closed",label:"Closed"}],[_,S]=s.useState(!1),[E,A]=s.useState(!1),[f,L]=s.useState(null),[u,a]=s.useState(!1),[H,ae]=s.useState(!1),[We,ye]=s.useState(!1),[V,te]=s.useState(""),[R,q]=s.useState(""),[le,J]=s.useState(""),[z,oe]=s.useState(""),[Q,ne]=s.useState(""),[ve,ie]=s.useState("Incoming"),[je,K]=s.useState(""),[Se,ce]=s.useState(""),[M,de]=s.useState(""),[U,ue]=s.useState(""),[Fe,pe]=s.useState(""),[l,c]=s.useState(""),[p,h]=s.useState("New Lead"),[j,O]=s.useState(""),[$,se]=s.useState(""),[re,Ce]=s.useState(""),[X,we]=s.useState(""),[De,Ie]=s.useState([]),[Pt,He]=s.useState([]),[he,Ue]=s.useState("general"),[Ye,Lt]=s.useState([]),[Ze,Ot]=s.useState([]),[et,Wt]=s.useState([]),[Ft,qe]=s.useState([]),[Dt,ke]=s.useState([]),[Nt,$e]=s.useState([]),[Tt,Ne]=s.useState([]),[Rt,tt]=s.useState([]),[st,At]=s.useState([]),[me,Te]=s.useState(null),[rt,at]=s.useState(!1),[xe,lt]=s.useState(null),[Et,Ge]=s.useState(!1),[ot,nt]=s.useState(null),[Ve,F]=s.useState({open:!1,message:"",severity:"success"}),[Je,Mt]=s.useState({read:!0,write:!0,delete:!0}),{data:ge,total:it,loading:_e,refetch:be}=Ds(i.page,i.rowsPerPage,k,o,w),zt=t=>{I(r=>({...r,...t})),i.onResetPage()},Bt=()=>{I({status:"all",workflow_state:"all",leads_from:"all",leads_type:"all",service:"all",country:"all",state:"all",city:"all"}),i.onResetPage()},Re=o.status!=="all"||o.workflow_state!=="all"||o.leads_from!=="all"||o.leads_type!=="all"||o.service!=="all"||o.country!=="all"||o.state!=="all"||o.city!=="all";s.useEffect(()=>{mt("Lead From").then(r=>Lt(r.map(n=>n.name||n.label||String(n)))),mt("Service").then(r=>Ot(r.map(n=>n.name||n.label||String(n)))),Yt(()=>import("./leads-d5FzXGcx.js"),__vite__mapDeps([0,1,2,3])).then(r=>{r.getLeadPermissions().then(Mt)});const t=Array.from(new Set(Le.map(r=>r.country)));Wt(["",...t]),ss("Lead").then(r=>{At(r.states)})},[]),s.useEffect(()=>{if(M){const t=Le.find(r=>r.country===M);if(t){const r=t.states.map(n=>n.name);qe(["",...r,"Others"])}else qe([])}else qe([]),ke([])},[M]),s.useEffect(()=>{if(U&&M)if(U==="Others")ke(["Others"]);else{const t=Le.find(r=>r.country===M);if(t){const r=t.states.find(n=>n.name===U);ke(r?["",...r.cities,"Others"]:["Others"])}}else ke([])},[U,M]),s.useEffect(()=>{if(o.country&&o.country!=="all"){const t=Le.find(r=>r.country===o.country);if(t){const r=t.states.map(n=>n.name);$e([...r,"Others"])}else $e([])}else $e([])},[o.country]),s.useEffect(()=>{if(o.state&&o.state!=="all"&&o.country&&o.country!=="all")if(o.state==="Others")Ne(["Others"]);else{const t=Le.find(r=>r.country===o.country);if(t){const r=t.states.find(n=>n.name===o.state);Ne(r?[...r.cities,"Others"]:["Others"])}}else Ne([])},[o.state,o.country]);const Ht=()=>{a(!1),S(!0)},Ae=()=>{S(!1),G({}),L(null),a(!1),Ue("general"),te(""),q(""),J(""),oe(""),ne(""),ie("Incoming"),K(""),ce(""),de(""),ue(""),pe(""),c(""),h("New Lead"),O(""),se(""),Ce(""),we(""),Ie([]),He([])},ct=()=>{F(t=>({...t,open:!1}))},Ut=t=>{nt(t),Ge(!0)},qt=async()=>{if(ot)try{await ft(ot),F({open:!0,message:"Lead deleted successfully",severity:"success"}),await be()}catch(t){console.error(t),F({open:!0,message:"Failed to delete lead",severity:"error"})}finally{Ge(!1),nt(null)}},$t=async()=>{try{await Promise.all(i.selected.map(t=>ft(t))),F({open:!0,message:`${i.selected.length} leads deleted successfully`,severity:"success"}),i.onSelectAllRows(!1,[]),await be()}catch(t){F({open:!0,message:t.message||"Error during bulk delete",severity:"error"})}},[Pe,G]=s.useState({}),Gt=async()=>{const t={},r=[];if(V||(t.leadName=!0,r.push("Lead Name")),R||(t.companyName=!0,r.push("Company Name")),ve||(t.leadsType=!0,r.push("Leads Type")),je||(t.leadsFrom=!0,r.push("Leads From")),z||(t.phoneNumber=!0,r.push("Phone Number")),Object.keys(t).length>0){G(t),F({open:!0,message:`Please fill in mandatory fields: ${r.join(", ")}`,severity:"error"});return}G({});try{A(!0);let n=z.replace(/\s/g,"");const y=z.trim().split(/\s+/);y.length>1&&y[0].startsWith("+")&&(n=`${y[0]}-${y.slice(1).join("")}`);const fe={lead_name:V,company_name:R,gstin:le,phone_number:n,email:Q,leads_type:ve,leads_from:je,service:Se,country:M,state:U,city:Fe,status:p,workflow_state:l,billing_address:j,remarks:$};f?(await xt(f,fe),F({open:!0,message:"Lead updated successfully",severity:"success"})):(await as(fe),F({open:!0,message:"Lead created successfully",severity:"success"})),await be(),Ae()}catch(n){if(console.error(n),f)F({open:!0,message:"Failed to update lead",severity:"error"});else{const y=ls(n);F({open:!0,message:y,severity:"error"})}}finally{A(!1)}},dt=t=>t?t.startsWith("+")&&t.includes("-")?t.replace("-"," "):t:"",ut=async t=>{a(!1),G({});const r=t.id;L(r);try{const n=await gt(r);te(d(n.lead_name)||""),q(d(n.company_name)||""),J(d(n.gstin)||""),oe(dt(d(n.phone_number)||"")),ne(d(n.email)||""),ie(d(n.leads_type)||"Incoming"),K(d(n.leads_from)||""),ce(d(n.service)||""),de(d(n.country)||""),ue(d(n.state)||""),pe(d(n.city)||""),c(d(n.workflow_state)||""),h(d(n.status)||"New Lead"),O(d(n.billing_address)||""),se(d(n.remarks)||""),Ce(d(n.converted_account)||""),we(d(n.converted_contact)||""),Ie(n.followup_details||[]),He(n.converted_pipeline_timeline||[]);const y=d(n.workflow_state);if(y){const fe=await bt("Lead",y);tt(fe)}}catch(n){console.error("Failed to fetch full lead",n);const y=ge.find(fe=>fe.name===r);y&&(te(d(y.lead_name)||""),q(d(y.company_name)||""),J(d(y.gstin)||""),oe(dt(d(y.phone_number)||"")),ne(d(y.email)||""),ie(d(y.leads_type)||"Incoming"),K(d(y.leads_from)||""),ce(d(y.service)||""),de(d(y.country)||""),ue(d(y.state)||""),pe(d(y.city)||""),c(d(y.workflow_state)||""),h(d(y.status)||"New Lead"),O(d(y.billing_address)||""),se(d(y.remarks)||""))}S(!0)},Vt=async t=>{const r=t.id;L(r),ae(!0)},Jt=t=>{Ut(t)},Qt=!_e&&ge.length===0&&(!!k||Re),pt=!_e&&ge.length===0&&!k&&!Re;return e.jsxs(e.Fragment,{children:[e.jsxs(wt,{open:_,onClose:Ae,fullWidth:!0,maxWidth:"md",children:[e.jsxs(kt,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u?"Lead Details":f?"Edit Lead":"New Lead",e.jsx(ee,{"aria-label":"close",onClick:Ae,sx:{color:t=>t.palette.grey[500]},children:e.jsx(W,{icon:"mingcute:close-line"})})]}),e.jsx(m,{sx:{px:2,borderBottom:1,borderColor:"divider"},children:e.jsxs(Os,{value:he,onChange:(t,r)=>Ue(r),children:[e.jsx(Ee,{label:"General",value:"general"}),f&&e.jsx(Ee,{label:"Pipeline",value:"pipeline"}),f&&e.jsx(Ee,{label:"Followups",value:"followups"}),f&&e.jsx(Ee,{label:"Convert Lead",value:"convert",disabled:u})]})}),e.jsxs(It,{dividers:!0,children:[he==="general"&&e.jsxs(m,{sx:{display:"grid",margin:"1rem",columnGap:2,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(x,{fullWidth:!0,label:"Lead Name",value:V,onChange:t=>{te(t.target.value),t.target.value&&G(r=>({...r,leadName:!1}))},required:!0,error:!!Pe.leadName,slotProps:{input:{readOnly:u}}}),e.jsx(x,{fullWidth:!0,label:"Company Name",value:R,onChange:t=>{q(t.target.value),t.target.value&&G(r=>({...r,companyName:!1}))},required:!0,error:!!Pe.companyName,slotProps:{input:{readOnly:u}}}),e.jsx(x,{fullWidth:!0,label:"GSTIN",value:le,onChange:t=>J(t.target.value),slotProps:{input:{readOnly:u}}}),e.jsx(es,{fullWidth:!0,defaultCountry:"IN",label:"Phone Number",name:"phone_number",value:z,onChange:t=>{oe(t),t&&G(r=>({...r,phoneNumber:!1}))},required:!0,disabled:u,error:!!Pe.phoneNumber,sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"rgba(0, 0, 0, 0.87)"},"& .MuiInputLabel-root.Mui-disabled":{color:"rgba(0, 0, 0, 0.6)"}}}),e.jsx(x,{fullWidth:!0,label:"Email",type:"email",value:Q,onChange:t=>ne(t.target.value),slotProps:{input:{readOnly:u}}}),e.jsxs(x,{select:!0,fullWidth:!0,label:"Leads Type",value:ve,onChange:t=>{ie(t.target.value),t.target.value&&G(r=>({...r,leadsType:!1}))},required:!0,disabled:u,error:!!Pe.leadsType,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"rgba(0, 0, 0, 0.87)"}},children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),e.jsx("option",{value:"Incoming",children:"Incoming"}),e.jsx("option",{value:"Outgoing",children:"Outgoing"})]}),e.jsxs(x,{select:!0,fullWidth:!0,label:"Leads From",value:je,onChange:t=>{K(t.target.value),t.target.value&&G(r=>({...r,leadsFrom:!1}))},required:!0,disabled:u,error:!!Pe.leadsFrom,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"rgba(0, 0, 0, 0.87)"}},children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),Ye.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(x,{select:!0,fullWidth:!0,label:"Service",value:Se,onChange:t=>ce(t.target.value),disabled:u,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"rgba(0, 0, 0, 0.87)"}},children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),Ze.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(x,{select:!0,fullWidth:!0,label:"Country",value:M,onChange:t=>de(t.target.value),disabled:u,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"rgba(0, 0, 0, 0.87)"}},children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),et.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(x,{select:!0,fullWidth:!0,label:"State",value:U,onChange:t=>ue(t.target.value),disabled:u||!M,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"rgba(0, 0, 0, 0.87)"}},children:[e.jsx("option",{value:"",disabled:!0,children:M?"Select":"Select Country First"}),Ft.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(x,{select:!0,fullWidth:!0,label:"City",value:Fe,onChange:t=>pe(t.target.value),disabled:u||!U,SelectProps:{native:!0},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"rgba(0, 0, 0, 0.87)"}},children:[e.jsx("option",{value:"",disabled:!0,children:U?"Select":"Select State First"}),Dt.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(x,{fullWidth:!0,label:"Billing Address",multiline:!0,rows:3,value:j,onChange:t=>O(t.target.value),sx:{gridColumn:{sm:"span 2"}},slotProps:{input:{readOnly:u}}}),e.jsx(x,{fullWidth:!0,label:"Remarks",multiline:!0,rows:3,value:$,onChange:t=>se(t.target.value),sx:{gridColumn:{sm:"span 2"}},slotProps:{input:{readOnly:u}}}),(re||X)&&e.jsxs(e.Fragment,{children:[e.jsx(x,{fullWidth:!0,label:"Converted Account",value:re,InputProps:{readOnly:!0}}),e.jsx(x,{fullWidth:!0,label:"Converted Contact",value:X,InputProps:{readOnly:!0}})]})]}),he==="pipeline"&&e.jsxs(e.Fragment,{children:[l!=="Closed"&&e.jsxs(B,{direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,sx:{mb:2},children:[e.jsx(g,{variant:"subtitle2",sx:{color:"text.primary"},children:"Change Workflow"}),e.jsx(Ke,{size:"small",sx:{minWidth:250},children:e.jsx(Xe,{value:"",disabled:u,displayEmpty:!0,renderValue:()=>"Select Action",sx:{bgcolor:"common.white","& .MuiSelect-select":{color:"text.secondary"}},children:Rt.map(t=>{const r=d(t.action);return e.jsx(Oe,{value:r,onClick:()=>{Te(t)},children:r},r)})})})]}),e.jsx(ms,{currentStage:l||p,stages:st,leadName:V,service:Se,disabled:u}),e.jsx(xs,{title:"State History",list:Pt})]}),he==="followups"&&e.jsx(gs,{title:"Followup History",list:De}),he==="convert"&&e.jsxs(m,{sx:{p:3},children:[e.jsx(g,{variant:"h6",sx:{mb:3},children:"Convert Lead to Account and Contact"}),re&&X?e.jsxs(m,{children:[e.jsx(Y,{severity:"info",sx:{mb:2},children:"This lead has already been converted."}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(x,{fullWidth:!0,label:"Converted Account",value:re,InputProps:{readOnly:!0}}),e.jsx(x,{fullWidth:!0,label:"Converted Contact",value:X,InputProps:{readOnly:!0}})]})]}):xe?e.jsxs(m,{children:[e.jsx(Y,{severity:"success",sx:{mb:2},children:"Lead converted successfully!"}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(x,{fullWidth:!0,label:"Account Created",value:xe.account,InputProps:{readOnly:!0}}),e.jsx(x,{fullWidth:!0,label:"Contact Created",value:xe.contact,InputProps:{readOnly:!0}}),xe.messages&&xe.messages.length>0&&e.jsxs(m,{sx:{mt:2},children:[e.jsx(g,{variant:"subtitle2",sx:{mb:1},children:"Conversion Details:"}),xe.messages.map((t,r)=>e.jsx(Y,{severity:t.type,sx:{mb:1},children:t.text},r))]}),e.jsx(N,{variant:"outlined",onClick:()=>{lt(null),Ue("general"),Ae(),be()},sx:{mt:2},children:"Close"})]})]}):e.jsxs(m,{children:[e.jsx(Y,{severity:"info",sx:{mb:3},children:"This will create an Account and Contact from this lead's information."}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[e.jsx(x,{fullWidth:!0,label:"Lead Name",value:V,InputProps:{readOnly:!0}}),e.jsx(x,{fullWidth:!0,label:"Company Name",value:R,InputProps:{readOnly:!0},error:!R,helperText:R?"":"Company Name is required"}),e.jsx(x,{fullWidth:!0,label:"Email",value:Q,InputProps:{readOnly:!0}}),e.jsx(x,{fullWidth:!0,label:"Phone Number",value:z,InputProps:{readOnly:!0}}),!Q&&!z&&e.jsx(Y,{severity:"warning",children:"Email or Phone Number is required to create a Contact"})]}),e.jsx(N,{variant:"contained",onClick:async()=>{if(!R){F({open:!0,message:"Company Name is required to convert lead",severity:"error"});return}if(!Q&&!z){F({open:!0,message:"Email or Phone Number is required to convert lead",severity:"error"});return}try{at(!0);const t=await rs(f);lt(t),F({open:!0,message:"Lead converted successfully!",severity:"success"})}catch(t){console.error("Conversion error:",t),F({open:!0,message:t.message||"Failed to convert lead",severity:"error"})}finally{at(!1)}},disabled:rt||!R||!Q&&!z,fullWidth:!0,children:rt?"Converting...":"Convert Lead"})]})]})]}),e.jsx(_t,{children:!u&&he==="general"&&e.jsx(N,{variant:"contained",onClick:Gt,disabled:E,children:E?f?"Updating...":"Creating...":f?"Update Lead":"Create Lead"})})]}),e.jsxs(os,{children:[e.jsxs(m,{sx:{mb:5,display:"flex",alignItems:"center"},children:[e.jsx(g,{variant:"h4",sx:{flexGrow:1},children:"Leads"}),Je.write&&e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsx(N,{variant:"outlined",startIcon:e.jsx(W,{icon:"solar:import-bold-duotone"}),onClick:()=>ye(!0),sx:{color:"#08a3cd",borderColor:"#08a3cd","&:hover":{borderColor:"#068fb3",bgcolor:"rgba(8, 163, 205, 0.04)"}},children:"Import"}),e.jsx(N,{variant:"contained",startIcon:e.jsx(W,{icon:"mingcute:add-line"}),onClick:Ht,sx:{bgcolor:"#08a3cd",color:"common.white","&:hover":{bgcolor:"#068fb3"}},children:"New Lead"})]})]}),e.jsxs(ns,{children:[e.jsx(cs,{numSelected:i.selected.length,filterName:k,onFilterName:t=>{D(t.target.value),i.onResetPage()},onOpenFilter:()=>b(!0),canReset:Re,sortBy:w,onSortChange:T,onDelete:$t}),e.jsx(Ct,{children:e.jsx(Me,{sx:{overflow:"unset"},children:e.jsxs(ze,{sx:{minWidth:800},children:[e.jsx(ds,{rowCount:it,numSelected:i.selected.length,onSelectAllRows:t=>i.onSelectAllRows(t,ge.map(r=>r.name)),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"lead_name",label:"Name"},{id:"company_name",label:"Company"},{id:"country",label:"Country"},{id:"phone_number",label:"Phone"},{id:"email",label:"Email"},{id:"workflow_state",label:"Status"},{id:""}]}),e.jsxs(Be,{children:[_e&&e.jsx(vt,{height:68,emptyRows:i.rowsPerPage}),!_e&&ge.map((t,r)=>e.jsx(Ts,{index:i.page*i.rowsPerPage+r,hideCheckbox:!0,row:{id:t.name,name:d(t.lead_name)??"-",company:d(t.company_name)??"-",phone:d(t.phone_number)??"-",email:d(t.email)??"-",status:d(t.status)??"-",workflow_state:d(t.workflow_state)??"-",avatarUrl:"/assets/images/avatar/avatar-25.webp",isVerified:!0,country:d(t.country)??"-"},selected:i.selected.includes(t.name),onSelectRow:()=>i.onSelectRow(t.name),onEdit:()=>ut({id:t.name}),onDelete:()=>Jt(t.name),onView:()=>Vt({id:t.name}),canEdit:Je.write,canDelete:Je.delete},t.name)),Qt&&e.jsx(us,{searchQuery:k}),pt&&e.jsx(Z,{children:e.jsx(C,{colSpan:8,align:"center",sx:{py:10},children:e.jsx(is,{title:"No leads found",description:"Start capturing leads to boost your sales.",icon:"solar:flag-checkered-bold-duotone"})})}),!pt&&!_e&&e.jsx(vt,{height:68,emptyRows:i.rowsPerPage-ge.length})]})]})})}),e.jsx(Ws,{component:"div",page:i.page,count:it,rowsPerPage:i.rowsPerPage,onPageChange:i.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:i.onChangeRowsPerPage})]})]}),e.jsx(Es,{open:v,onOpen:()=>b(!0),onClose:()=>b(!1),filters:o,onFilters:zt,canReset:Re,onResetFilters:Bt,options:{status:P,workflow_states:st,leads_from:Ye,services:Ze,countries:et.filter(t=>t!==""),states:Nt,cities:Tt}}),e.jsx(yt,{open:Et,onClose:()=>Ge(!1),title:"Confirm Delete",content:"Are you sure you want to delete this lead?",action:e.jsx(N,{onClick:qt,color:"error",variant:"contained",sx:{borderRadius:1.5,minWidth:100},children:"Delete"})}),e.jsx(yt,{open:!!me,onClose:()=>Te(null),title:"Confirm Workflow Change",icon:"solar:question-square-bold",iconColor:"primary.main",content:`Are you sure you want to change the workflow status to "${me==null?void 0:me.action}"?`,action:e.jsx(N,{variant:"contained",color:"primary",sx:{borderRadius:1.5,minWidth:100},onClick:async()=>{if(me)try{const t=me.next_state;if(c(t),f){await xt(f,{workflow_state:t});const r=await gt(f);He(r.converted_pipeline_timeline||[]);const n=await bt("Lead",t);tt(n),await be(),F({open:!0,message:"Workflow status updated successfully",severity:"success"})}Te(null)}catch(t){console.error("Failed to update workflow status:",t),F({open:!0,message:t.message||"Failed to update workflow status",severity:"error"}),Te(null)}},children:"Confirm"})}),e.jsx(As,{open:We,onClose:()=>ye(!1),onRefresh:be}),e.jsx(bs,{open:H,onClose:()=>{ae(!1),L(null)},leadId:f,onEdit:()=>{f&&(ae(!1),ut({id:f}))}}),e.jsx(Fs,{open:Ve.open,autoHideDuration:6e3,onClose:ct,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Y,{onClose:ct,severity:Ve.severity,sx:{width:"100%"},children:Ve.message})})]})}function zs(){const[i,k]=s.useState(0),[D,o]=s.useState("name"),[I,w]=s.useState(5),[T,v]=s.useState([]),[b,P]=s.useState("asc"),_=s.useCallback(u=>{P(D===u&&b==="asc"?"desc":"asc"),o(u)},[b,D]),S=s.useCallback((u,a)=>{v(u?a:[])},[]),E=s.useCallback(u=>{v(a=>a.includes(u)?a.filter(H=>H!==u):[...a,u])},[]),A=()=>k(0);return{page:i,order:b,orderBy:D,rowsPerPage:I,selected:T,onSort:_,onSelectRow:E,onSelectAllRows:S,onResetPage:A,onChangePage:(u,a)=>k(a),onChangeRowsPerPage:u=>{w(parseInt(u.target.value,10)),A()}}}function Ir(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Users - ${Zt.appName}`}),e.jsx(Ms,{})]})}export{Ir as default};
