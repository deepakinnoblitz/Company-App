import{f as R,r as i,j as e,B as o,d as A,T as d,v as N,I as C,D,p as M,S as B,w as Q}from"./index-Co7v2xsC.js";import{D as K,C as X}from"./Card-CDV3jV6O.js";import{E as Z}from"./empty-content-BBDmaj4d.js";import{U as ee,a as ae,b as te,T as ne}from"./user-table-toolbar-BXgkag6p.js";import{c as W,d as f,T as se,a as re,e as oe}from"./TableRow-DqeBPnxy.js";import{C as le}from"./Checkbox-CoJXcvzD.js";import{S as L}from"./Stack-GQIY7Xk9.js";import{D as ie,a as ce}from"./DialogContent-DtP-sWqR.js";import{D as de}from"./DialogTitle-C3eBZids.js";import{T as xe}from"./TablePagination-CEaYVDlQ.js";import{S as pe}from"./Snackbar-BVA3LOhi.js";import"./Select-B1EkSlUY.js";import"./useFormControl-Cqn8lfES.js";import"./Popper-DDlcgFVJ.js";import"./Badge-DIppMJwA.js";import"./usePreviousProps-CVIlMhUg.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";async function he(t){const s=[];t.search&&s.push(["Salary Slip","employee_name","like",`%${t.search}%`]);const a=t.orderBy&&t.order?`${t.orderBy} ${t.order}`:"pay_period_start desc",h=new URLSearchParams({doctype:"Salary Slip",fields:JSON.stringify(["*"]),filters:JSON.stringify(s),limit_start:String((t.page-1)*t.page_size),limit_page_length:String(t.page_size),order_by:a}),[l,m]=await Promise.all([R(`/api/method/frappe.client.get_list?${h.toString()}`),R(`/api/method/frappe.client.get_count?doctype=Salary Slip&filters=${encodeURIComponent(JSON.stringify(s))}`)]);if(!l.ok)throw new Error("Failed to fetch salary slips");const x=await l.json(),u=await m.json();return{data:x.message||[],total:u.message||0}}const me=t=>he(t);async function ye(t){const s=await R(`/api/method/frappe.client.get?doctype=Salary Slip&name=${encodeURIComponent(t)}`);if(!s.ok)throw new Error("Failed to fetch salary slip details");return(await s.json()).message}function ue(t){return`/api/method/frappe.utils.print_format.download_pdf?doctype=Salary%20Slip&name=${encodeURIComponent(t)}`}function ge(t,s,a,h,l){const[m,x]=i.useState([]),[u,y]=i.useState(0),[g,r]=i.useState(!0),[_,j]=i.useState(null),w=i.useCallback(async()=>{r(!0);try{const b=await me({page:t,page_size:s,search:a,order_by:h,order:l});x(b.data),y(b.total),j(null)}catch(b){j(b)}finally{r(!1)}},[t,s,a,h,l]);return i.useEffect(()=>{w()},[w]),{data:m,total:u,loading:g,error:_,refetch:w}}function je({row:t,selected:s,onSelectRow:a,onView:h,hideCheckbox:l=!1,index:m}){var y,g;const x=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"-",u=`${x(t.pay_period_start)} - ${x(t.pay_period_end)}`;return e.jsxs(W,{hover:!0,selected:s,children:[!l&&e.jsx(f,{padding:"checkbox",children:e.jsx(le,{checked:s,onChange:a})}),typeof m=="number"&&e.jsx(f,{align:"center",children:e.jsx(o,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:r=>A(r.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:r=>`1px solid ${A(r.palette.primary.main,.16)}`,mx:"auto",transition:r=>r.transitions.create(["all"],{duration:r.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:m+1})}),e.jsx(f,{children:e.jsx(o,{onClick:h,sx:{color:"primary.main",fontWeight:600,cursor:"pointer","&:hover":{textDecoration:"underline"}},children:t.employee_name})}),e.jsx(f,{children:u}),e.jsxs(f,{align:"right",children:["₹",((y=t.gross_pay)==null?void 0:y.toLocaleString())||0]}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"subtitle2",sx:{color:"success.main",fontWeight:700},children:["₹",((g=t.net_pay)==null?void 0:g.toLocaleString())||0]})}),e.jsx(f,{align:"right",children:e.jsx(N,{onClick:h,sx:{color:"info.main"},children:e.jsx(C,{icon:"solar:eye-bold"})})})]})}function fe({open:t,onClose:s,slip:a}){var g;if(!a)return null;const h=()=>{const r=ue(a.name);window.open(r,"_blank")},l=r=>r?new Date(r).toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"}):"-",m=e.jsxs(o,{sx:{p:3,textAlign:"center",bgcolor:"background.neutral",borderRadius:2,mb:3},children:[e.jsx(d,{variant:"h5",sx:{mb:1,fontWeight:700,color:"primary.main"},children:"SALARY SLIP"}),e.jsxs(d,{variant:"subtitle2",sx:{color:"text.secondary",textTransform:"uppercase"},children:["For the period: ",l(a.pay_period_start)," to ",l(a.pay_period_end)]})]}),x=e.jsxs(o,{sx:{mb:4},children:[e.jsx(P,{title:"Employee Details",icon:"solar:user-id-bold"}),e.jsxs(o,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(S,{label:"Employee ID",value:a.employee}),e.jsx(S,{label:"Employee Name",value:a.employee_name}),e.jsx(S,{label:"Department",value:a.department||"-"}),e.jsx(S,{label:"Designation",value:a.designation||"-"}),e.jsx(S,{label:"Bank Name",value:a.bank_name||"-"}),e.jsx(S,{label:"Account No",value:a.account_no||"-"})]})]}),u=e.jsx(o,{sx:{mb:4},children:e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:4},children:[e.jsxs(o,{children:[e.jsx(P,{title:"Earnings",icon:"solar:wad-of-money-bold",color:"success.main"}),e.jsxs(L,{spacing:1.5,children:[e.jsx(p,{label:"Basic Pay",amount:a.basic_pay}),e.jsx(p,{label:"HRA",amount:a.hra}),e.jsx(p,{label:"Conveyance",amount:a.conveyance_allowances}),e.jsx(p,{label:"Medical",amount:a.medical_allowances}),e.jsx(p,{label:"Other Allowances",amount:a.other_allowances}),e.jsx(D,{sx:{my:1}}),e.jsx(p,{label:"Gross Earnings",amount:a.gross_pay,isTotal:!0})]})]}),e.jsxs(o,{children:[e.jsx(P,{title:"Deductions",icon:"solar:hand-money-bold",color:"error.main"}),e.jsxs(L,{spacing:1.5,children:[e.jsx(p,{label:"EPF",amount:a.pf}),e.jsx(p,{label:"ESI/Health Insurance",amount:a.health_insurance}),e.jsx(p,{label:"Professional Tax",amount:a.professional_tax}),e.jsx(p,{label:"Loan Recovery",amount:a.loan_recovery}),e.jsx(p,{label:"LOP",amount:a.lop}),e.jsx(D,{sx:{my:1}}),e.jsx(p,{label:"Total Deductions",amount:a.total_deduction,isTotal:!0})]})]})]})}),y=e.jsxs(o,{sx:{p:3,borderRadius:2,bgcolor:"primary.main",color:"primary.contrastText",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(d,{variant:"subtitle1",sx:{opacity:.8,fontWeight:600},children:"NET SALARY PAYABLE"}),e.jsx(d,{variant:"body2",sx:{opacity:.6},children:"(Gross Earnings - Total Deductions)"})]}),e.jsxs(d,{variant:"h3",sx:{fontWeight:800},children:["₹",((g=a.net_pay)==null?void 0:g.toLocaleString())||0]})]});return e.jsxs(ie,{open:t,onClose:s,fullWidth:!0,maxWidth:"md",children:[e.jsxs(de,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Salary Slip Details",e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(M,{size:"small",variant:"contained",color:"primary",startIcon:e.jsx(C,{icon:"solar:download-bold"}),onClick:h,children:"Download PDF"}),e.jsx(N,{onClick:s,children:e.jsx(C,{icon:"mingcute:close-line"})})]})]}),e.jsx(B,{sx:{maxHeight:"85vh"},children:e.jsxs(ce,{sx:{p:4},children:[m,x,e.jsx(D,{sx:{my:4,borderStyle:"dashed"}}),u,y,e.jsx(o,{sx:{mt:4,textAlign:"center"},children:e.jsx(d,{variant:"caption",sx:{color:"text.secondary"},children:"This is a computer generated salary slip and does not require a signature."})})]})})]})}function P({title:t,icon:s,color:a="text.secondary"}){return e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(C,{icon:s,width:22,sx:{mr:1.5,color:a}}),e.jsx(d,{variant:"subtitle1",sx:{fontWeight:700,textTransform:"uppercase",letterSpacing:.5},children:t})]})}function S({label:t,value:s}){return e.jsxs(o,{children:[e.jsx(d,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:.5},children:t}),e.jsx(d,{variant:"body2",sx:{fontWeight:600},children:s})]})}function p({label:t,amount:s,isTotal:a=!1}){return e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(d,{variant:a?"subtitle2":"body2",sx:{color:a?"text.primary":"text.secondary",fontWeight:a?700:500},children:t}),e.jsxs(d,{variant:a?"subtitle1":"body2",sx:{fontWeight:a?700:600},children:["₹",(s==null?void 0:s.toLocaleString())||0]})]})}function be(){const[t,s]=i.useState(0),[a,h]=i.useState(10),[l,m]=i.useState(""),[x,u]=i.useState("desc"),[y,g]=i.useState("pay_period_start"),[r,_]=i.useState([]),{data:j,total:w}=ge(t+1,a,l,y,x),[b,T]=i.useState(!1),[F,O]=i.useState(null),[v,k]=i.useState({open:!1,message:"",severity:"success"}),U=n=>{u(y===n&&x==="asc"?"desc":"asc"),g(n)},$=n=>{_(n?j.map(c=>c.name):[])},H=n=>{_(c=>c.includes(n)?c.filter(J=>J!==n):[...c,n])},V=i.useCallback(async n=>{try{const c=await ye(n.name);O(c),T(!0)}catch(c){k({open:!0,message:c.message||"Failed to load record",severity:"error"})}},[]),Y=(n,c)=>{s(c)},q=n=>{h(parseInt(n.target.value,10)),s(0)},z=n=>{m(n.target.value),s(0)},E=()=>{k({...v,open:!1})},G=!j.length&&!!l,I=!j.length&&!l;return e.jsxs(K,{children:[e.jsxs(o,{sx:{mb:5},children:[e.jsx(d,{variant:"h4",children:"Salary Slips"}),e.jsx(d,{variant:"body2",sx:{color:"text.secondary"},children:"View and download your monthly salary statements."})]}),e.jsxs(X,{children:[e.jsx(ee,{numSelected:r.length,filterName:l,onFilterName:z,searchPlaceholder:"Search employee name..."}),e.jsx(B,{children:e.jsx(se,{sx:{overflow:"unset"},children:e.jsxs(re,{sx:{minWidth:800},children:[e.jsx(ae,{order:x,orderBy:y,rowCount:j.length,numSelected:r.length,onSort:U,onSelectAllRows:n=>$(n),hideCheckbox:!0,showIndex:!0,headLabel:[{id:"employee_name",label:"Employee Name"},{id:"pay_period_start",label:"Pay Period"},{id:"gross_pay",label:"Gross Pay",align:"right"},{id:"net_pay",label:"Net Pay",align:"right"},{id:"",label:"",align:"right"}]}),e.jsxs(oe,{children:[j.map((n,c)=>e.jsx(je,{index:t*a+c,hideCheckbox:!0,row:{id:n.name,employee_name:n.employee_name,pay_period_start:n.pay_period_start,pay_period_end:n.pay_period_end,gross_pay:n.gross_pay,net_pay:n.net_pay},selected:r.includes(n.name),onSelectRow:()=>H(n.name),onView:()=>V(n)},n.name)),G&&e.jsx(te,{searchQuery:l}),I&&e.jsx(W,{children:e.jsx(f,{colSpan:5,children:e.jsx(Z,{title:"No salary slips",description:"You haven't received any salary slips yet.",icon:"solar:wallet-bold-duotone"})})}),!I&&e.jsx(ne,{height:68,emptyRows:Math.max(0,a-j.length)})]})]})})}),e.jsx(xe,{component:"div",page:t,count:w,rowsPerPage:a,onPageChange:Y,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:q})]}),e.jsx(fe,{open:b,onClose:()=>T(!1),slip:F}),e.jsx(pe,{open:v.open,autoHideDuration:6e3,onClose:E,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Q,{onClose:E,severity:v.severity,sx:{width:"100%"},children:v.message})})]})}function Oe(){return e.jsx(be,{})}export{Oe as default};
