import{Z as It,W as et,r as a,j as t,$ as Ze,T as c,p as g,B as C,d as l,D as A,q as tt,I as h,v as st,w as nt,a0 as Ct}from"./index-Co7v2xsC.js";import{d as se}from"./dayjs.min-C2542nnJ.js";import{c as R}from"./format-number-DSNgsWBE.js";import{u as it}from"./data-import-KyR0bLZ-.js";import{getDoctypeList as ne,getDoc as rt}from"./leads-d5FzXGcx.js";import{D as Ke,C as at}from"./Card-CDV3jV6O.js";import{g as St,u as Wt,c as ot,a as Tt}from"./invoice-CmnDHtbD.js";import{T as Be,a as z,b as lt}from"./tax-type-form-dialog-Ctl86VPY.js";import{C as ct}from"./contact-form-dialog-1sJlvlMf.js";import{S as o}from"./Stack-GQIY7Xk9.js";import{L as dt,A as pt}from"./AdapterDayjs-BPhbSeWE.js";import{A as ie,c as ut}from"./Autocomplete-BIV6h0T7.js";import{T as p}from"./TextField-BmVWmDzd.js";import{D as re}from"./DatePicker-BMZY9CMK.js";import{T as mt,a as xt,b as ht,c as ze,d as m,e as gt}from"./TableRow-DqeBPnxy.js";import{S as yt}from"./Snackbar-BVA3LOhi.js";import{A as ft}from"./AlertTitle-BbqQne_Q.js";import{D as bt,a as jt}from"./DialogContent-DtP-sWqR.js";import{D as vt}from"./DialogTitle-C3eBZids.js";import{D as _t}from"./DialogActions-h_2rRG3x.js";const Xe=ut();function Qt(){const{id:w}=It(),Me=et(),[d,Ie]=a.useState([]),[ae,E]=a.useState([]),[M,q]=a.useState([]),[P,D]=a.useState(""),[Ce,H]=a.useState(""),[oe,Q]=a.useState(""),[J,le]=a.useState(""),[ce,Z]=a.useState(""),[Se,de]=a.useState(""),[We,pe]=a.useState(""),[ue,K]=a.useState(""),[Te,X]=a.useState(""),[me,xe]=a.useState(""),[we,he]=a.useState(""),[O,f]=a.useState([]),[ge,ye]=a.useState(!1),[_,y]=a.useState([]),[$,V]=a.useState("Flat"),[Y,B]=a.useState(0),[qe,Ye]=a.useState(!0),[Pe,U]=a.useState(!1),[b,F]=a.useState({open:!1,message:"",severity:"success"}),[ee,N]=a.useState(!1),[S,I]=a.useState({item_name:"",item_code:"",rate:0}),[k,L]=a.useState(null),[G,De]=a.useState(!1),[Ne,Ae]=a.useState(!1),[Re,Ue]=a.useState(""),[Le,fe]=a.useState(!1);a.useEffect(()=>{ne("Contacts",["name","first_name","company_name","address"]).then(Ie),ne("Item",["name","item_name","rate","item_code"]).then(E),ne("Tax Types",["name","tax_name","tax_percentage","tax_type"]).then(q),w&&St(w).then(e=>{var i;if(D(e.customer_id||e.client_name||""),H(e.customer_name||""),Q(e.billing_name||""),le(e.invoice_date||""),Z(e.due_date||""),de(e.payment_terms||""),pe(e.po_no||""),K(e.po_date||""),X(e.billing_address||""),xe(e.description||""),he(e.terms_and_conditions||""),e.attachments)try{const s=JSON.parse(e.attachments);Array.isArray(s)?f(s):f([{name:e.attachments.split("/").pop()||"Attachment",url:e.attachments}])}catch{f([{name:e.attachments.split("/").pop()||"Attachment",url:e.attachments}])}else f([]);V(e.overall_discount_type||"Flat"),B(e.overall_discount||0),y(((i=e.table_qecz)==null?void 0:i.map(s=>({...s,tax_percent:s.tax_percent||0})))||[])}).finally(()=>Ye(!1))},[w]);const Oe=async e=>{if(D(e),e)try{const i=await rt("Contacts",e);H(i.first_name||""),Q(i.company_name||""),X(i.address||"")}catch(i){console.error("Failed to fetch contact details:",i)}else H(""),Q(""),X("")},Ge=()=>{y([..._,{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,cgst:0,sgst:0,igst:0,sub_total:0}])},j=e=>{const i=_.filter((s,n)=>n!==e);y(i)},v=async(e,i,s)=>{const n=[..._],r={...n[e],[i]:s};if(i==="service"){const x=ae.find(T=>T.name===s);x?(r.price=x.rate||0,r.description=x.item_name||"",r.hsn_code=x.item_code||""):(r.price=0,r.description="",r.hsn_code="",r.quantity=1,r.discount=0,r.tax_type="",r.tax_percent=0)}let u="";if(i==="tax_type"){const x=M.find(T=>T.name===s);x?(r.tax_percent=x.tax_percentage||0,u=x.tax_type||""):(r.tax_percent=0,u="")}else if(r.tax_type){const x=M.find(T=>T.name===r.tax_type);u=(x==null?void 0:x.tax_type)||""}const W=r.quantity*r.price,Je=r.discount_type==="Flat"?r.discount:W*r.discount/100,_e=Math.max(0,W-Je);r.tax_amount=_e*r.tax_percent/100,r.sub_total=_e+r.tax_amount,u==="GST"?(r.cgst=r.tax_amount/2,r.sgst=r.tax_amount/2,r.igst=0):u==="IGST"?(r.cgst=0,r.sgst=0,r.igst=r.tax_amount):(r.cgst=0,r.sgst=0,r.igst=0),n[e]=r,y(n)},be=async()=>{if(!S.item_name){F({open:!0,message:"Please enter Item Name",severity:"error"});return}try{De(!0);const e=await ot(S),i={name:e.name,item_name:e.item_name,item_code:e.item_code||"",rate:e.rate||0};if(E(s=>[...s,i]),k!==null){const s=[..._];s[k]={...s[k],service:e.name,description:e.item_name||"",hsn_code:e.item_code||"",price:e.rate||0};const n=s[k],r=n.quantity*n.price,u=n.discount_type==="Flat"?n.discount:r*n.discount/100,W=Math.max(0,r-u);n.tax_amount=W*n.tax_percent/100,n.sub_total=W+n.tax_amount,y(s)}N(!1),I({item_name:"",item_code:"",rate:0}),F({open:!0,message:"Item created successfully",severity:"success"})}catch(e){F({open:!0,message:e.message||"Failed to create item",severity:"error"})}finally{De(!1)}},te=_.reduce((e,i)=>{const s=i.quantity*i.price,n=i.discount_type==="Flat"?i.discount:s*i.discount/100;return e+(s-n)},0),je=_.reduce((e,i)=>e+i.tax_amount,0),ve=te+je,Fe=_.reduce((e,i)=>e+i.quantity,0),ke=$==="Flat"?Y:ve*Y/100,$e=Math.max(0,ve-ke),Ee=e=>{var s;const i=(s=e.target.files)==null?void 0:s[0];i&&f([i])},He=e=>{f(i=>i.filter((s,n)=>n!==e))},Qe=async()=>{if(!w||!P)return;const e=_.filter(i=>i.service!=="");if(e.length===0){F({open:!0,message:"Please add at least one item",severity:"error"});return}try{U(!0);let i="";if(O.length>0&&O[0]instanceof File){ye(!0);try{i=(await it(O[0],"Invoice",w,"attachments")).file_url}catch(n){throw new Error(`File upload failed: ${n.message}`)}finally{ye(!1)}}else O.length>0&&(i=O[0].url||"");const s={client_name:P,customer_name:Ce,billing_name:oe,invoice_date:J,due_date:ce,payment_terms:Se,po_no:We,po_date:ue,billing_address:Te,description:me,terms_and_conditions:we,attachments:i,overall_discount_type:$,overall_discount:Y,total_qty:Fe,total_amount:te,grand_total:$e,table_qecz:e.map(n=>({name:n.name,service:n.service,hsn_code:n.hsn_code,description:n.description,quantity:n.quantity,price:n.price,discount_type:n.discount_type,discount:n.discount,tax_type:n.tax_type,tax_amount:n.tax_amount,cgst:n.cgst,sgst:n.sgst,igst:n.igst,sub_total:n.sub_total}))};await Wt(w,s),F({open:!0,message:"Invoice updated successfully",severity:"success"}),setTimeout(()=>Me.push("/invoices"),1500)}catch(i){console.error(i),F({open:!0,message:i.message||"Failed to update invoice",severity:"error"})}finally{U(!1)}};return qe?t.jsx(Ke,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:t.jsx(Ze,{})}):t.jsxs(Ke,{maxWidth:"xl",children:[t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[t.jsxs(c,{variant:"h4",children:["Edit Invoice: ",w]}),t.jsxs(o,{direction:"row",spacing:2,children:[t.jsx(g,{variant:"outlined",color:"inherit",onClick:()=>Me.push("/invoices"),children:"Cancel"}),t.jsx(g,{variant:"contained",color:"primary",onClick:Qe,loading:Pe,children:"Update Invoice"})]})]}),t.jsx(dt,{dateAdapter:pt,children:t.jsxs(at,{sx:{p:4},children:[t.jsxs(C,{sx:{display:"grid",columnGap:3,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[t.jsxs(o,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(ie,{fullWidth:!0,options:d,getOptionLabel:e=>e.first_name?`${e.name} - ${e.first_name}`:e.name||"",value:d.find(e=>e.name===P)||null,onChange:(e,i)=>Oe((i==null?void 0:i.name)||""),renderInput:e=>t.jsx(p,{...e,label:"Customer ID",required:!0})}),P&&t.jsx(g,{variant:"contained",color:"primary",onClick:()=>fe(!0),sx:{height:35,px:2},children:"Edit"})]}),t.jsx(p,{fullWidth:!0,label:"Customer Name",value:Ce,InputProps:{readOnly:!0},sx:{"& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08)}}}),t.jsx(p,{fullWidth:!0,label:"Billing Name",value:oe,InputProps:{readOnly:!0},sx:{"& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08)}}}),t.jsx(p,{fullWidth:!0,label:"Billing Address",multiline:!0,rows:2,value:Te,InputProps:{readOnly:!0},sx:{gridColumn:"span 2","& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08)}}}),t.jsx(A,{sx:{my:2,gridColumn:"span 2"}}),t.jsx(p,{select:!0,fullWidth:!0,label:"Payment Terms",value:Se,onChange:e=>de(e.target.value),children:["Next day Payment","Due On Receipt","15 days","30 days","60 days","1 Year"].map(e=>t.jsx(tt,{value:e,children:e},e))}),t.jsx(re,{label:"Due Date",value:ce?se(ce):null,onChange:e=>Z((e==null?void 0:e.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(p,{fullWidth:!0,label:"PO No",value:We,onChange:e=>pe(e.target.value)}),t.jsx(re,{label:"PO Date",value:ue?se(ue):null,onChange:e=>K((e==null?void 0:e.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(re,{label:"Invoice Date",value:J?se(J):null,onChange:e=>le((e==null?void 0:e.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}})]}),t.jsx(A,{sx:{my:4}}),t.jsx(c,{variant:"h6",sx:{mb:2},children:"Items"}),t.jsx(mt,{sx:{overflow:"unset",border:e=>`1px solid ${e.palette.divider}`,borderRadius:1.5,bgcolor:"background.paper",boxShadow:e=>e.customShadows.z8},children:t.jsxs(xt,{sx:{minWidth:960},children:[t.jsx(ht,{sx:{bgcolor:e=>l(e.palette.grey[500],.08)},children:t.jsxs(ze,{children:[t.jsx(m,{width:180,sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Service"}),t.jsx(m,{width:80,sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"HSN"}),t.jsx(m,{sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Description"}),t.jsx(m,{width:80,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Qty"}),t.jsx(m,{width:120,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Price"}),t.jsx(m,{width:140,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Discount"}),t.jsx(m,{width:150,sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Type"}),t.jsx(m,{width:120,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Amt"}),t.jsx(m,{width:120,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Total"}),t.jsx(m,{width:40})]})}),t.jsx(gt,{children:_.map((e,i)=>t.jsxs(ze,{sx:{verticalAlign:"top",transition:s=>s.transitions.create("background-color"),"&:hover":{bgcolor:s=>l(s.palette.primary.main,.02)},"&:nth-of-type(even)":{bgcolor:s=>l(s.palette.grey[500],.02)}},children:[[{field:"service",component:t.jsx(ie,{fullWidth:!0,size:"small",options:ae,getOptionLabel:s=>typeof s=="string"?s:s.inputValue?s.inputValue:s.item_name||s.name||"",filterOptions:(s,n)=>{const r=Xe(s,n),{inputValue:u}=n;return r.push({inputValue:u||"",item_name:u?`+ Create "${u}"`:"+ Create item",isNew:!0}),r},value:ae.find(s=>s.name===e.service)||null,onChange:(s,n)=>{typeof n=="string"?v(i,"service",n):n&&n.isNew?(L(i),I(r=>({...r,item_name:n.inputValue})),N(!0)):v(i,"service",(n==null?void 0:n.name)||"")},ListboxProps:{sx:{width:"350px","& .MuiAutocomplete-option":{py:1.5,px:2,borderRadius:.75,mx:.5,my:.25}}},slotProps:{paper:{sx:{mt:.5,boxShadow:s=>s.customShadows.z20,borderRadius:1.5}}},renderInput:s=>t.jsx(p,{...s,placeholder:"Select Service",variant:"standard",InputProps:{...s.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(s,n)=>t.jsx(C,{component:"li",...s,sx:{typography:"body2",...n.isNew&&{color:"primary.main",fontWeight:600,bgcolor:r=>l(r.palette.primary.main,.08),borderTop:r=>`1px solid ${r.palette.divider}`,mt:.5,"&:hover":{bgcolor:r=>l(r.palette.primary.main,.16)}}},children:n.isNew?t.jsxs(o,{direction:"row",alignItems:"center",spacing:1.5,children:[t.jsx(h,{icon:"solar:add-circle-bold",width:24}),t.jsxs(o,{spacing:0,children:[t.jsx(c,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),t.jsx(c,{variant:"caption",sx:{opacity:.8},children:"Item"})]})]}):n.item_name||n.name})})},{field:"hsn_code",component:t.jsx(p,{fullWidth:!0,size:"small",variant:"standard",value:e.hsn_code,onChange:s=>v(i,"hsn_code",s.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"description",component:t.jsx(p,{fullWidth:!0,multiline:!0,size:"small",variant:"standard",value:e.description,onChange:s=>v(i,"description",s.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"quantity",component:t.jsx(p,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.quantity===0?"":e.quantity,onChange:s=>v(i,"quantity",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"price",component:t.jsx(p,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.price===0?"":e.price,onChange:s=>v(i,"price",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"discount",component:t.jsxs(o,{direction:"row",spacing:.5,alignItems:"center",children:[t.jsxs(Be,{size:"small",value:e.discount_type,exclusive:!0,onChange:(s,n)=>{n!==null&&v(i,"discount_type",n)},sx:{height:28,"& .MuiToggleButton-root":{px:1,py:0,border:"none",typography:"body2","&.Mui-selected":{bgcolor:s=>l(s.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:s=>l(s.palette.primary.main,.2)}}}},children:[t.jsx(z,{value:"Flat",children:"₹"}),t.jsx(z,{value:"Percentage",children:"%"})]}),t.jsx(p,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.discount===0?"":e.discount,onChange:s=>v(i,"discount",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})]})},{field:"tax_type",component:t.jsx(ie,{fullWidth:!0,size:"small",options:M,getOptionLabel:s=>typeof s=="string"?s:s.inputValue?s.inputValue:s.tax_name||s.name||"",filterOptions:(s,n)=>{const r=Xe(s,n),{inputValue:u}=n;return r.push({inputValue:u||"",tax_name:u?`+ Create "${u}"`:"Create Tax Type",isNew:!0}),r},value:M.find(s=>s.name===e.tax_type)||null,onChange:(s,n)=>{typeof n=="string"?v(i,"tax_type",n):n&&n.isNew?(L(i),Ue(n.inputValue),Ae(!0)):v(i,"tax_type",(n==null?void 0:n.name)||"")},renderInput:s=>t.jsx(p,{...s,placeholder:"Select Tax",variant:"standard",InputProps:{...s.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(s,n)=>t.jsx(C,{component:"li",...s,sx:{typography:"body2",...n.isNew&&{color:"primary.main",fontWeight:600,bgcolor:r=>l(r.palette.primary.main,.08),borderTop:r=>`1px solid ${r.palette.divider}`,mt:.5,"&:hover":{bgcolor:r=>l(r.palette.primary.main,.16)}}},children:n.isNew?t.jsxs(o,{direction:"row",alignItems:"center",spacing:1.5,children:[t.jsx(h,{icon:"solar:add-circle-bold",width:24}),t.jsxs(o,{spacing:0,children:[t.jsx(c,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),t.jsx(c,{variant:"caption",sx:{opacity:.8},children:"Tax Type"})]})]}):n.tax_name||n.name})})}].map((s,n)=>t.jsx(m,{sx:{px:1,py:1,borderRight:r=>`1px solid ${r.palette.divider}`,transition:r=>r.transitions.create(["background-color","box-shadow"]),"&:focus-within":{bgcolor:r=>l(r.palette.primary.main,.05)}},children:s.component},n)),t.jsx(m,{align:"right",sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(c,{variant:"body2",sx:{fontWeight:"fontWeightMedium"},children:R(e.tax_amount)})}),t.jsx(m,{align:"right",sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(c,{variant:"subtitle2",color:"primary.main",children:R(e.sub_total)})}),t.jsx(m,{sx:{px:1,py:1},children:t.jsx(st,{color:"error",onClick:()=>j(i),size:"small",sx:{opacity:.6,"&:hover":{opacity:1}},children:t.jsx(h,{icon:"solar:trash-bin-trash-bold"})})})]},i))})]})}),t.jsx(g,{startIcon:t.jsx(h,{icon:"mingcute:add-line"}),onClick:Ge,sx:{mt:2},children:"Add Item"}),t.jsx(A,{sx:{my:4}}),t.jsx(C,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsxs(o,{spacing:2,sx:{width:400,mt:3},children:[t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{icon:"solar:box-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Total Quantity"})]}),t.jsx(c,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:Fe})]}),t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{icon:"solar:bill-list-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Taxable Amount"})]}),t.jsx(c,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:R(te)})]}),t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{icon:"solar:calculator-minimalistic-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Total Tax"})]}),t.jsx(c,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:R(je)})]}),t.jsxs(o,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,sx:{flexGrow:1},children:[t.jsx(h,{icon:"solar:tag-horizontal-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Overall Discount"})]}),t.jsxs(Be,{size:"small",value:$,exclusive:!0,onChange:(e,i)=>{i!==null&&V(i)},sx:{height:32,"& .MuiToggleButton-root":{px:1,py:0,typography:"body2","&.Mui-selected":{bgcolor:e=>l(e.palette.primary.main,.1),color:"primary.main"}}},children:[t.jsx(z,{value:"Flat",children:"₹"}),t.jsx(z,{value:"Percentage",children:"%"})]}),t.jsx(p,{size:"small",type:"number",variant:"standard",value:Y===0?"":Y,onChange:e=>B(Number(e.target.value)),onFocus:e=>e.target.select(),sx:{width:100,"& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08),borderRadius:.75,px:1,"&:hover":{bgcolor:e=>l(e.palette.grey[500],.12)},"&.Mui-focused":{bgcolor:e=>l(e.palette.primary.main,.08)}}},inputProps:{sx:{textAlign:"right",typography:"body2"}}})]}),t.jsx(A,{}),t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1.5,children:[t.jsx(h,{icon:"solar:wad-of-money-bold-duotone",sx:{color:"primary.main",width:24,height:24}}),t.jsx(c,{variant:"subtitle1",sx:{color:"primary.main"},children:"Grand Total"})]}),t.jsx(c,{variant:"h6",color:"primary",sx:{width:120,textAlign:"right"},children:R($e)})]})]})}),t.jsx(A,{sx:{my:4,borderStyle:"dashed"}}),t.jsxs(C,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[t.jsxs(o,{spacing:3,children:[t.jsx(p,{fullWidth:!0,label:"Description",multiline:!0,rows:4,value:me,onChange:e=>xe(e.target.value)}),t.jsx(p,{fullWidth:!0,label:"Terms & Conditions / Remarks",multiline:!0,rows:4,value:we,onChange:e=>he(e.target.value)})]}),t.jsxs(C,{sx:{p:3,borderRadius:2,bgcolor:e=>l(e.palette.grey[500],.04),border:e=>`1px dashed ${l(e.palette.grey[500],.2)}`},children:[t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2.5},children:[t.jsx(c,{variant:"h6",children:"Attachments"}),t.jsxs(g,{variant:"contained",component:"label",color:"primary",size:"small",startIcon:t.jsx(h,{icon:"solar:upload-bold"}),disabled:ge,children:[ge?"Uploading...":"Upload File",t.jsx("input",{type:"file",hidden:!0,onChange:Ee})]})]}),t.jsx(o,{spacing:1,children:O.length===0?t.jsxs(o,{alignItems:"center",justifyContent:"center",sx:{py:3,color:"text.disabled"},children:[t.jsx(h,{icon:"solar:file-bold",width:40,height:40,sx:{mb:1,opacity:.48}}),t.jsx(c,{variant:"body2",children:"No attachments yet"})]}):O.map((e,i)=>t.jsxs(o,{direction:"row",alignItems:"center",sx:{px:1.5,py:.75,borderRadius:1.5,bgcolor:s=>l(s.palette.grey[500],.08)},children:[t.jsx(h,{icon:"solar:link-bold",width:20,sx:{mr:1,color:"text.secondary",flexShrink:0}}),t.jsx(c,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:typeof e=="string"?e:e.url||e.name}),t.jsx(g,{size:"small",color:"inherit",onClick:()=>He(i),sx:{px:1.5,py:0,height:26,borderRadius:1.5,minWidth:"auto",typography:"caption",bgcolor:"background.paper",border:s=>`1px solid ${l(s.palette.grey[500],.24)}`,"&:hover":{bgcolor:s=>l(s.palette.grey[500],.08)}},children:"Clear"})]},i))})]})]})]})}),t.jsx(ct,{open:Le,onClose:()=>fe(!1),contactId:P,onSuccess:()=>{P&&Oe(P)}}),t.jsx(lt,{open:Ne,initialName:Re,onClose:()=>Ae(!1),onSuccess:e=>{q(i=>[...i,e]),k!==null&&v(k,"tax_type",e.name)}}),t.jsx(yt,{open:b.open,autoHideDuration:6e3,onClose:()=>F(e=>({...e,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(nt,{severity:b.severity,sx:{width:"100%",boxShadow:e=>e.customShadows.z20},children:[t.jsx(ft,{children:b.severity==="success"?"Success":"Error"}),b.message]})}),t.jsxs(bt,{open:ee,onClose:()=>!G&&N(!1),fullWidth:!0,maxWidth:"xs",children:[t.jsx(vt,{children:"Create item"}),t.jsx(jt,{children:t.jsxs(o,{spacing:3,sx:{pt:1},children:[t.jsx(p,{fullWidth:!0,label:"Item Name",value:S.item_name,onChange:e=>I(i=>({...i,item_name:e.target.value})),required:!0}),t.jsx(p,{fullWidth:!0,label:"HSN Code",value:S.item_code,onChange:e=>I(i=>({...i,item_code:e.target.value}))}),t.jsx(p,{fullWidth:!0,label:"Rate",type:"number",value:S.rate,onChange:e=>I(i=>({...i,rate:Number(e.target.value)}))})]})}),t.jsxs(_t,{children:[t.jsx(g,{color:"inherit",onClick:()=>N(!1),disabled:G,children:"Cancel"}),t.jsx(g,{variant:"contained",onClick:be,disabled:G,children:G?t.jsx(Ze,{size:24}):"Create"})]})]})]})}const Ve=ut();function Jt(){const w=et(),d=Ct().state,[Ie,ae]=a.useState([]),[E,M]=a.useState([]),[q,P]=a.useState([]),[D,Ce]=a.useState((d==null?void 0:d.client_name)||(d==null?void 0:d.customer_id)||""),[H,oe]=a.useState((d==null?void 0:d.customer_name)||""),[Q,J]=a.useState((d==null?void 0:d.billing_name)||""),[le,ce]=a.useState(new Date().toISOString().split("T")[0]),[Z,Se]=a.useState(""),[de,We]=a.useState("Due On Receipt"),[pe,ue]=a.useState(""),[K,Te]=a.useState(""),[X,me]=a.useState((d==null?void 0:d.billing_address)||""),[xe,we]=a.useState((d==null?void 0:d.description)||""),[he,O]=a.useState((d==null?void 0:d.terms_and_conditions)||""),[f,ge]=a.useState(()=>{try{return d!=null&&d.attachments?typeof d.attachments=="string"?JSON.parse(d.attachments):d.attachments:[]}catch{return[]}}),[ye,_]=a.useState(!1),[y,$]=a.useState((d==null?void 0:d.table_qecz)||[{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,cgst:0,sgst:0,igst:0,sub_total:0}]),[V,Y]=a.useState((d==null?void 0:d.overall_discount_type)||"Flat"),[B,qe]=a.useState((d==null?void 0:d.overall_discount)||0),[Ye,Pe]=a.useState(!1),[U,b]=a.useState({open:!1,message:"",severity:"success"}),[F,ee]=a.useState(!1),[N,S]=a.useState({item_name:"",item_code:"",rate:0}),[I,k]=a.useState(null),[L,G]=a.useState(!1),[De,Ne]=a.useState(!1),[Ae,Re]=a.useState(!1),[Ue,Le]=a.useState("");a.useEffect(()=>{ne("Contacts",["name","first_name","company_name","address"]).then(ae),ne("Item",["name","item_name","rate","item_code"]).then(M),ne("Tax Types",["name","tax_name","tax_percentage","tax_type"]).then(P)},[]);const fe=async e=>{if(Ce(e),e)try{const i=await rt("Contacts",e);oe(i.first_name||""),J(i.company_name||""),me(i.address||"")}catch(i){console.error("Failed to fetch contact details:",i)}else oe(""),J(""),me("")},Oe=()=>{$([...y,{service:"",hsn_code:"",description:"",quantity:1,price:0,discount_type:"Percentage",discount:0,tax_type:"",tax_percent:0,tax_amount:0,cgst:0,sgst:0,igst:0,sub_total:0}])},Ge=e=>{const i=y.filter((s,n)=>n!==e);$(i)},j=async(e,i,s)=>{const n=[...y],r={...n[e],[i]:s};if(i==="service"){const x=E.find(T=>T.name===s);x?(r.price=x.rate||0,r.description=x.item_name||"",r.hsn_code=x.item_code||""):(r.price=0,r.description="",r.hsn_code="",r.quantity=1,r.discount=0,r.tax_type="",r.tax_percent=0)}let u="";if(i==="tax_type"){const x=q.find(T=>T.name===s);x?(r.tax_percent=x.tax_percentage||0,u=x.tax_type||""):(r.tax_percent=0,u="")}else if(r.tax_type){const x=q.find(T=>T.name===r.tax_type);u=(x==null?void 0:x.tax_type)||""}const W=r.quantity*r.price,Je=r.discount_type==="Flat"?r.discount:W*r.discount/100,_e=Math.max(0,W-Je);r.tax_amount=_e*r.tax_percent/100,r.sub_total=_e+r.tax_amount,u==="GST"?(r.cgst=r.tax_amount/2,r.sgst=r.tax_amount/2,r.igst=0):u==="IGST"?(r.cgst=0,r.sgst=0,r.igst=r.tax_amount):(r.cgst=0,r.sgst=0,r.igst=0),n[e]=r,$(n)},v=async()=>{if(!N.item_name){b({open:!0,message:"Please enter Item Name",severity:"error"});return}try{G(!0);const e=await ot(N),i={name:e.name,item_name:e.item_name,item_code:e.item_code||"",rate:e.rate||0};if(M(s=>[...s,i]),I!==null){const s=[...y];s[I]={...s[I],service:e.name,description:e.item_name||"",hsn_code:e.item_code||"",price:e.rate||0};const n=s[I],r=n.quantity*n.price,u=n.discount_type==="Flat"?n.discount:r*n.discount/100,W=Math.max(0,r-u);n.tax_amount=W*n.tax_percent/100,n.sub_total=W+n.tax_amount,$(s)}ee(!1),S({item_name:"",item_code:"",rate:0}),b({open:!0,message:"Item created successfully",severity:"success"})}catch(e){b({open:!0,message:e.message||"Failed to create item",severity:"error"})}finally{G(!1)}},be=y.reduce((e,i)=>{const s=i.quantity*i.price,n=i.discount_type==="Flat"?i.discount:s*i.discount/100;return e+(s-n)},0),te=y.reduce((e,i)=>e+i.tax_amount,0),je=be+te,ve=y.reduce((e,i)=>e+i.quantity,0),Fe=V==="Flat"?B:je*B/100,ke=Math.max(0,je-Fe),$e=e=>{var s;const i=(s=e.target.files)==null?void 0:s[0];i&&ge([i])},Ee=e=>{ge(i=>i.filter((s,n)=>n!==e))},He=async()=>{if(!D){b({open:!0,message:"Please select a customer",severity:"error"});return}const e=y.filter(i=>i.service!=="");if(e.length===0){b({open:!0,message:"Please add at least one item",severity:"error"});return}try{Pe(!0);let i="";if(f.length>0&&f[0]instanceof File){_(!0);try{i=(await it(f[0])).file_url}catch(n){throw new Error(`File upload failed: ${n.message}`)}finally{_(!1)}}else f.length>0&&(i=f[0].url||"");const s={client_name:D,customer_name:H,billing_name:Q,invoice_date:le,due_date:Z,payment_terms:de,po_no:pe,po_date:K,billing_address:X,description:xe,terms_and_conditions:he,attachments:i,overall_discount_type:V,overall_discount:B,total_qty:ve,total_amount:be,grand_total:ke,table_qecz:e.map(n=>({service:n.service,hsn_code:n.hsn_code,description:n.description,quantity:n.quantity,price:n.price,discount_type:n.discount_type,discount:n.discount,tax_type:n.tax_type,tax_amount:n.tax_amount,cgst:n.cgst,sgst:n.sgst,igst:n.igst,sub_total:n.sub_total}))};await Tt(s),b({open:!0,message:"Invoice created successfully",severity:"success"}),setTimeout(()=>w.push("/invoices"),1500)}catch(i){console.error(i),b({open:!0,message:i.message||"Failed to create invoice",severity:"error"})}finally{Pe(!1)}},Qe=()=>{w.push("/invoices")};return t.jsxs(Ke,{maxWidth:"xl",children:[t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[t.jsx(c,{variant:"h4",children:"New Invoice"}),t.jsxs(o,{direction:"row",spacing:2,children:[t.jsx(g,{variant:"outlined",color:"inherit",onClick:Qe,children:"Cancel"}),t.jsx(g,{variant:"contained",color:"primary",onClick:He,loading:Ye,children:"Save Invoice"})]})]}),t.jsx(dt,{dateAdapter:pt,children:t.jsxs(at,{sx:{p:4},children:[t.jsxs(C,{sx:{display:"grid",columnGap:3,rowGap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[t.jsxs(o,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(ie,{fullWidth:!0,options:Ie,getOptionLabel:e=>e.first_name?`${e.name} - ${e.first_name}`:e.name||"",value:Ie.find(e=>e.name===D)||null,onChange:(e,i)=>fe((i==null?void 0:i.name)||""),renderInput:e=>t.jsx(p,{...e,label:"Customer ID",required:!0})}),D&&t.jsx(g,{variant:"contained",color:"primary",onClick:()=>Ne(!0),sx:{height:35,px:2},children:"Edit"})]}),t.jsx(p,{fullWidth:!0,label:"Customer Name",value:H,InputProps:{readOnly:!0},sx:{"& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08)}}}),t.jsx(p,{fullWidth:!0,label:"Billing Name",value:Q,InputProps:{readOnly:!0},sx:{"& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08)}}}),t.jsx(p,{fullWidth:!0,label:"Billing Address",multiline:!0,rows:2,value:X,InputProps:{readOnly:!0},sx:{gridColumn:"span 2","& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08)}}}),t.jsx(A,{sx:{my:2,gridColumn:"span 2"}}),t.jsx(p,{select:!0,fullWidth:!0,label:"Payment Terms",value:de,onChange:e=>We(e.target.value),children:["Next day Payment","Due On Receipt","15 days","30 days","60 days","1 Year"].map(e=>t.jsx(tt,{value:e,children:e},e))}),t.jsx(re,{label:"Due Date",value:Z?se(Z):null,onChange:e=>Se((e==null?void 0:e.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(p,{fullWidth:!0,label:"PO No",value:pe,onChange:e=>ue(e.target.value)}),t.jsx(re,{label:"PO Date",value:K?se(K):null,onChange:e=>Te((e==null?void 0:e.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(re,{label:"Invoice Date",value:se(le),onChange:e=>ce((e==null?void 0:e.format("YYYY-MM-DD"))||""),slotProps:{textField:{fullWidth:!0,InputLabelProps:{shrink:!0}}}})]}),t.jsx(A,{sx:{my:4}}),t.jsx(c,{variant:"h6",sx:{mb:2},children:"Items"}),t.jsx(mt,{sx:{overflow:"unset",border:e=>`1px solid ${e.palette.divider}`,borderRadius:1.5,bgcolor:"background.paper",boxShadow:e=>e.customShadows.z8},children:t.jsxs(xt,{sx:{minWidth:960},children:[t.jsx(ht,{sx:{bgcolor:e=>l(e.palette.grey[500],.08)},children:t.jsxs(ze,{children:[t.jsx(m,{width:180,sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Service"}),t.jsx(m,{width:80,sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"HSN"}),t.jsx(m,{sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Description"}),t.jsx(m,{width:80,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Qty"}),t.jsx(m,{width:120,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Price"}),t.jsx(m,{width:140,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Discount"}),t.jsx(m,{width:150,sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Type"}),t.jsx(m,{width:120,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Tax Amt"}),t.jsx(m,{width:120,align:"right",sx:{borderRight:e=>`1px solid ${e.palette.divider}`,py:1.5,fontWeight:"fontWeightSemiBold"},children:"Total"}),t.jsx(m,{width:40})]})}),t.jsx(gt,{children:y.map((e,i)=>t.jsxs(ze,{sx:{verticalAlign:"top",transition:s=>s.transitions.create("background-color"),"&:hover":{bgcolor:s=>l(s.palette.primary.main,.02)},"&:nth-of-type(even)":{bgcolor:s=>l(s.palette.grey[500],.02)}},children:[[{field:"service",component:t.jsx(ie,{fullWidth:!0,size:"small",options:E,getOptionLabel:s=>typeof s=="string"?s:s.inputValue?s.inputValue:s.item_name||s.name||"",filterOptions:(s,n)=>{const r=Ve(s,n),{inputValue:u}=n;return r.push({inputValue:u||"",item_name:u?`+ Create "${u}"`:"+ Create item",isNew:!0}),r},value:E.find(s=>s.name===e.service)||null,onChange:(s,n)=>{typeof n=="string"?j(i,"service",n):n&&n.isNew?(k(i),S(r=>({...r,item_name:n.inputValue})),ee(!0)):j(i,"service",(n==null?void 0:n.name)||"")},ListboxProps:{sx:{width:"350px",height:"300px","& .MuiAutocomplete-option":{py:1.5,px:2,borderRadius:.75,mx:.5,my:.25}}},slotProps:{paper:{sx:{mt:.5,boxShadow:s=>s.customShadows.z20,borderRadius:1.5}}},renderInput:s=>t.jsx(p,{...s,placeholder:"Select Service",variant:"standard",InputProps:{...s.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(s,n)=>t.jsx(C,{component:"li",...s,sx:{typography:"body2",...n.isNew&&{color:"primary.main",fontWeight:600,bgcolor:r=>l(r.palette.primary.main,.08),borderTop:r=>`1px solid ${r.palette.divider}`,mt:.5,"&:hover":{bgcolor:r=>l(r.palette.primary.main,.16)}}},children:n.isNew?t.jsxs(o,{direction:"row",alignItems:"center",spacing:1.5,children:[t.jsx(h,{icon:"solar:add-circle-bold",width:24}),t.jsxs(o,{spacing:0,children:[t.jsx(c,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),t.jsx(c,{variant:"caption",sx:{opacity:.8},children:"Item"})]})]}):n.item_name||n.name})})},{field:"hsn_code",component:t.jsx(p,{fullWidth:!0,size:"small",variant:"standard",value:e.hsn_code,onChange:s=>j(i,"hsn_code",s.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"description",component:t.jsx(p,{fullWidth:!0,multiline:!0,size:"small",variant:"standard",value:e.description,onChange:s=>j(i,"description",s.target.value),InputProps:{disableUnderline:!0,sx:{typography:"body2"}}})},{field:"quantity",component:t.jsx(p,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.quantity===0?"":e.quantity,onChange:s=>j(i,"quantity",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"price",component:t.jsx(p,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.price===0?"":e.price,onChange:s=>j(i,"price",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})},{field:"discount",component:t.jsxs(o,{direction:"row",spacing:.5,alignItems:"center",children:[t.jsxs(Be,{size:"small",value:e.discount_type,exclusive:!0,onChange:(s,n)=>{n!==null&&j(i,"discount_type",n)},sx:{height:28,"& .MuiToggleButton-root":{px:1,py:0,border:"none",typography:"body2","&.Mui-selected":{bgcolor:s=>l(s.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:s=>l(s.palette.primary.main,.2)}}}},children:[t.jsx(z,{value:"Flat",children:"₹"}),t.jsx(z,{value:"Percentage",children:"%"})]}),t.jsx(p,{fullWidth:!0,size:"small",type:"number",variant:"standard",value:e.discount===0?"":e.discount,onChange:s=>j(i,"discount",Number(s.target.value)),onFocus:s=>s.target.select(),inputProps:{sx:{textAlign:"right",typography:"body2",px:0}},InputProps:{disableUnderline:!0}})]})},{field:"tax_type",component:t.jsx(ie,{fullWidth:!0,size:"small",options:q,getOptionLabel:s=>typeof s=="string"?s:s.inputValue?s.inputValue:s.tax_name||s.name||"",filterOptions:(s,n)=>{const r=Ve(s,n),{inputValue:u}=n;return r.push({inputValue:u||"",tax_name:u?`+ Create "${u}"`:"Create Tax Type",isNew:!0}),r},value:q.find(s=>s.name===e.tax_type)||null,onChange:(s,n)=>{typeof n=="string"?j(i,"tax_type",n):n&&n.isNew?(k(i),Le(n.inputValue),Re(!0)):j(i,"tax_type",(n==null?void 0:n.name)||"")},renderInput:s=>t.jsx(p,{...s,placeholder:"Select Tax",variant:"standard",InputProps:{...s.InputProps,disableUnderline:!0,sx:{typography:"body2"}}}),renderOption:(s,n)=>t.jsx(C,{component:"li",...s,sx:{typography:"body2",...n.isNew&&{color:"primary.main",fontWeight:600,bgcolor:r=>l(r.palette.primary.main,.08),borderTop:r=>`1px solid ${r.palette.divider}`,mt:.5,"&:hover":{bgcolor:r=>l(r.palette.primary.main,.16)}}},children:n.isNew?t.jsxs(o,{direction:"row",alignItems:"center",spacing:1.5,children:[t.jsx(h,{icon:"solar:add-circle-bold",width:24}),t.jsxs(o,{spacing:0,children:[t.jsx(c,{variant:"subtitle2",sx:{lineHeight:1,fontWeight:700},children:"Create"}),t.jsx(c,{variant:"caption",sx:{opacity:.8},children:"Tax Type"})]})]}):n.tax_name||n.name})})}].map((s,n)=>t.jsx(m,{sx:{px:1,py:1,borderRight:r=>`1px solid ${r.palette.divider}`,transition:r=>r.transitions.create(["background-color","box-shadow"]),"&:focus-within":{bgcolor:r=>l(r.palette.primary.main,.05)}},children:s.component},n)),t.jsx(m,{align:"right",sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(c,{variant:"body2",sx:{fontWeight:"fontWeightMedium"},children:R(e.tax_amount)})}),t.jsx(m,{align:"right",sx:{px:1,py:1,borderRight:s=>`1px solid ${s.palette.divider}`},children:t.jsx(c,{variant:"subtitle2",color:"primary.main",children:R(e.sub_total)})}),t.jsx(m,{sx:{px:1,py:1},children:t.jsx(st,{color:"error",onClick:()=>Ge(i),size:"small",sx:{opacity:.6,"&:hover":{opacity:1}},children:t.jsx(h,{icon:"solar:trash-bin-trash-bold"})})})]},i))})]})}),t.jsx(g,{startIcon:t.jsx(h,{icon:"mingcute:add-line"}),onClick:Oe,sx:{mt:2},children:"Add Item"}),t.jsx(A,{sx:{my:4}}),t.jsx(C,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsxs(o,{spacing:2,sx:{width:400,mt:3},children:[t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{icon:"solar:box-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Total Quantity"})]}),t.jsx(c,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:ve})]}),t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{icon:"solar:bill-list-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Taxable Amount"})]}),t.jsx(c,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:R(be)})]}),t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{icon:"solar:calculator-minimalistic-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Total Tax"})]}),t.jsx(c,{variant:"subtitle2",sx:{width:120,textAlign:"right"},children:R(te)})]}),t.jsxs(o,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1,sx:{flexGrow:1},children:[t.jsx(h,{icon:"solar:tag-horizontal-bold-duotone",sx:{color:"text.secondary"}}),t.jsx(c,{variant:"body2",color:"text.secondary",children:"Overall Discount"})]}),t.jsxs(Be,{size:"small",value:V,exclusive:!0,onChange:(e,i)=>{i!==null&&Y(i)},sx:{height:32,"& .MuiToggleButton-root":{px:1,py:0,typography:"body2","&.Mui-selected":{bgcolor:e=>l(e.palette.primary.main,.1),color:"primary.main"}}},children:[t.jsx(z,{value:"Flat",children:"₹"}),t.jsx(z,{value:"Percentage",children:"%"})]}),t.jsx(p,{size:"small",type:"number",variant:"standard",value:B===0?"":B,onChange:e=>qe(Number(e.target.value)),onFocus:e=>e.target.select(),sx:{width:100,"& .MuiInputBase-root":{bgcolor:e=>l(e.palette.grey[500],.08),borderRadius:.75,px:1,"&:hover":{bgcolor:e=>l(e.palette.grey[500],.12)},"&.Mui-focused":{bgcolor:e=>l(e.palette.primary.main,.08)}}},inputProps:{sx:{textAlign:"right",typography:"body2"}}})]}),t.jsx(A,{}),t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(o,{direction:"row",alignItems:"center",spacing:1.5,children:[t.jsx(h,{icon:"solar:wad-of-money-bold-duotone",sx:{color:"primary.main",width:24,height:24}}),t.jsx(c,{variant:"subtitle1",sx:{color:"primary.main"},children:"Grand Total"})]}),t.jsx(c,{variant:"h6",color:"primary",sx:{width:120,textAlign:"right"},children:R(ke)})]})]})}),t.jsx(A,{sx:{my:4,borderStyle:"dashed"}}),t.jsxs(C,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[t.jsxs(o,{spacing:3,children:[t.jsx(p,{fullWidth:!0,label:"Description",multiline:!0,rows:4,value:xe,onChange:e=>we(e.target.value)}),t.jsx(p,{fullWidth:!0,label:"Terms & Conditions / Remarks",multiline:!0,rows:4,value:he,onChange:e=>O(e.target.value)})]}),t.jsxs(C,{sx:{p:3,borderRadius:2,bgcolor:e=>l(e.palette.grey[500],.04),border:e=>`1px dashed ${l(e.palette.grey[500],.2)}`},children:[t.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2.5},children:[t.jsx(c,{variant:"h6",children:"Attachments"}),t.jsxs(g,{variant:"contained",component:"label",color:"primary",size:"small",startIcon:t.jsx(h,{icon:"solar:upload-bold"}),disabled:ye,children:[ye?"Uploading...":"Upload File",t.jsx("input",{type:"file",hidden:!0,onChange:$e})]})]}),t.jsx(o,{spacing:1,children:f.length===0?t.jsxs(o,{alignItems:"center",justifyContent:"center",sx:{py:3,color:"text.disabled"},children:[t.jsx(h,{icon:"solar:file-bold",width:40,height:40,sx:{mb:1,opacity:.48}}),t.jsx(c,{variant:"body2",children:"No attachments yet"})]}):f.map((e,i)=>t.jsxs(o,{direction:"row",alignItems:"center",sx:{px:1.5,py:.75,borderRadius:1.5,bgcolor:s=>l(s.palette.grey[500],.08)},children:[t.jsx(h,{icon:"solar:link-bold",width:20,sx:{mr:1,color:"text.secondary",flexShrink:0}}),t.jsx(c,{variant:"body2",noWrap:!0,sx:{flexGrow:1,fontWeight:"fontWeightMedium"},children:typeof e=="string"?e:e.url||e.name}),t.jsx(g,{size:"small",color:"inherit",onClick:()=>Ee(i),sx:{px:1.5,py:0,height:26,borderRadius:1.5,minWidth:"auto",typography:"caption",bgcolor:"background.paper",border:s=>`1px solid ${l(s.palette.grey[500],.24)}`,"&:hover":{bgcolor:s=>l(s.palette.grey[500],.08)}},children:"Clear"})]},i))})]})]})]})}),t.jsx(ct,{open:De,onClose:()=>Ne(!1),contactId:D,onSuccess:()=>{D&&fe(D)}}),t.jsx(lt,{open:Ae,initialName:Ue,onClose:()=>Re(!1),onSuccess:e=>{P(i=>[...i,e]),I!==null&&j(I,"tax_type",e.name)}}),t.jsx(yt,{open:U.open,autoHideDuration:6e3,onClose:()=>b(e=>({...e,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(nt,{severity:U.severity,sx:{width:"100%",boxShadow:e=>e.customShadows.z20},children:[t.jsx(ft,{children:U.severity==="success"?"Success":"Error"}),U.message]})}),t.jsxs(bt,{open:F,onClose:()=>!L&&ee(!1),fullWidth:!0,maxWidth:"xs",children:[t.jsx(vt,{children:"Create item"}),t.jsx(jt,{children:t.jsxs(o,{spacing:3,sx:{pt:1},children:[t.jsx(p,{fullWidth:!0,label:"Item Name",value:N.item_name,onChange:e=>S(i=>({...i,item_name:e.target.value})),required:!0}),t.jsx(p,{fullWidth:!0,label:"HSN Code",value:N.item_code,onChange:e=>S(i=>({...i,item_code:e.target.value}))}),t.jsx(p,{fullWidth:!0,label:"Rate",type:"number",value:N.rate,onChange:e=>S(i=>({...i,rate:Number(e.target.value)}))})]})}),t.jsxs(_t,{children:[t.jsx(g,{color:"inherit",onClick:()=>ee(!1),disabled:L,children:"Cancel"}),t.jsx(g,{variant:"contained",onClick:v,disabled:L,children:L?t.jsx(Ze,{size:24}):"Create"})]})]})]})}export{Jt as I,Qt as a};
