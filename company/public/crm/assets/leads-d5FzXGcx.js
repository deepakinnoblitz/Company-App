import{f as o,H as d}from"./index-Co7v2xsC.js";import{h as f}from"./api-error-handler-CV6pRVHb.js";async function _(e){const a=[],t=[];e.search&&(t.push(["Lead","lead_name","like",`%${e.search}%`]),t.push(["Lead","email","like",`%${e.search}%`]),t.push(["Lead","company_name","like",`%${e.search}%`]),t.push(["Lead","phone_number","like",`%${e.search}%`])),e.filterValues&&Object.entries(e.filterValues).forEach(([p,i])=>{i&&i!=="all"&&a.push(["Lead",p,"=",i])});let n="creation desc";if(e.sort_by){const[p,i]=e.sort_by.split("_").reduce((r,c)=>(c==="asc"||c==="desc"?r[1]=c:r[0]=r[0]?`${r[0]}_${c}`:c,r),["","desc"]);n=`${p} ${i}`}const s=new URLSearchParams({doctype:"Lead",fields:JSON.stringify(["name","lead_name","company_name","gstin","phone_number","email","service","leads_type","leads_from","status","workflow_state","country","state","city","billing_address","remarks","interest_level","owner","creation"]),filters:JSON.stringify(a),or_filters:JSON.stringify(t),limit_start:String((e.page-1)*e.page_size),limit_page_length:String(e.page_size),order_by:n}),[l,m]=await Promise.all([o(`/api/method/frappe.client.get_list?${s.toString()}`),o(`/api/method/frappe.client.get_count?doctype=Lead&filters=${encodeURIComponent(JSON.stringify(a))}&or_filters=${encodeURIComponent(JSON.stringify(t))}`)]);if(!l.ok)throw new Error("Failed to fetch leads");const y=await l.json(),g=await m.json();return{data:y.message||[],total:g.message||0}}async function L(e){const a=await d(),t=await o("/api/method/frappe.client.insert",{method:"POST",headers:a,body:JSON.stringify({doc:{doctype:"Lead",...e}})}),n=await t.json();if(!t.ok)throw new Error(f(n,"Failed to create lead"));return n.message}async function S(e,a){const t=await d(),n=await o("/api/method/frappe.client.set_value",{method:"POST",headers:t,body:JSON.stringify({doctype:"Lead",name:e,fieldname:a})}),s=await n.json();if(!n.ok)throw new Error(f(s,"Failed to update lead"));return s.message}async function k(e){const a=await d(),t=await o("/api/method/frappe.client.delete",{method:"POST",headers:a,body:JSON.stringify({doctype:"Lead",name:e})}),n=await t.json();if(!t.ok)throw new Error(f(n,"Failed to delete lead"));return n.message}async function $(e,a){const t={doctype:e,limit_page_length:"1000"};a&&(t.fields=JSON.stringify(a));const n=new URLSearchParams(t),s=await o(`/api/method/company.company.frontend_api.get_doctype_list?${n.toString()}`);return s.ok?(await s.json()).message||[]:(console.error(`Failed to fetch list for ${e}`),[])}async function j(e){const a=await o(`/api/method/company.company.api.get_states?country=${encodeURIComponent(e)}`);return a.ok?(await a.json()).message||[]:[]}async function O(e,a){const t=await o(`/api/method/company.company.api.get_cities?country=${encodeURIComponent(e)}&state=${encodeURIComponent(a)}`);return t.ok?(await t.json()).message||[]:[]}async function u(e,a){const t=await o(`/api/method/frappe.client.get?doctype=${e}&name=${a}`);if(!t.ok)throw new Error(`Failed to fetch ${e} details`);return(await t.json()).message}async function b(e){return u("Lead",e)}async function N(){const e=await o("/api/method/company.company.frontend_api.get_lead_permissions");return e.ok?(await e.json()).message||{read:!1,write:!1,delete:!1}:{read:!1,write:!1,delete:!1}}async function J(e="Lead"){const a=await o(`/api/method/company.company.frontend_api.get_workflow_states?doctype=${e}`);return a.ok?(await a.json()).message||{states:[],transitions:[],actions:[]}:{states:[],transitions:[],actions:[]}}async function R(e="Lead",a){const t=await o(`/api/method/company.company.frontend_api.get_workflow_states?doctype=${e}&current_state=${encodeURIComponent(a)}`);return t.ok?((await t.json()).message||{actions:[]}).actions||[]:[]}function E(e,a){const t=a.filter(n=>n.state===e).map(n=>n.next_state);return[e,...t]}async function F(e){const a=await d(),t=await o("/api/method/company.company.crm_api.convert_lead",{method:"POST",headers:a,body:JSON.stringify({lead_name:e})}),n=await t.json();if(!t.ok||n.exc)throw new Error(f(n,"Failed to convert lead"));return n.message}export{F as convertLead,L as createLead,k as deleteLead,_ as fetchLeads,O as getCities,u as getDoc,$ as getDoctypeList,b as getLead,N as getLeadPermissions,E as getNextStates,j as getStates,R as getWorkflowActions,J as getWorkflowStates,S as updateLead};
