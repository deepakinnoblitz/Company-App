import{r,j as e,B as P,d as F,v as R,I as y,T as S,p as T,q as oe,y as ne,S as M,W as re,w as ae}from"./index-Co7v2xsC.js";import{C as se}from"./config-global-BX9xwJzv.js";import"./invoice-create-view-wr-rVZUR.js";import{f as H,d as ie}from"./invoice-CmnDHtbD.js";import{getDoctypeList as le}from"./leads-d5FzXGcx.js";import{D as ce,C as de}from"./Card-CDV3jV6O.js";import{E as me}from"./empty-content-BBDmaj4d.js";import{C as he}from"./confirm-dialog--19ddTk_.js";import{T as ue,e as pe,a as xe}from"./table-empty-rows-BA_Yxb7w.js";import{f as ge}from"./format-time-9uMX-KY9.js";import{c as A}from"./format-number-DSNgsWBE.js";import{c as W,d as b,b as fe,T as be,a as je,e as ve}from"./TableRow-DqeBPnxy.js";import{C as $}from"./Checkbox-CoJXcvzD.js";import{a as ye,T as _e}from"./TablePagination-CEaYVDlQ.js";import{O as Ce,I as Se,M as Ie}from"./Select-B1EkSlUY.js";import{B as Y}from"./Badge-DIppMJwA.js";import{d as ke}from"./dayjs.min-C2542nnJ.js";import{S as w}from"./Stack-GQIY7Xk9.js";import{A as E}from"./Autocomplete-BIV6h0T7.js";import{T as z}from"./TextField-BmVWmDzd.js";import{D as Pe}from"./DatePicker-BMZY9CMK.js";import{L as Re,A as we}from"./AdapterDayjs-BPhbSeWE.js";import{S as Te}from"./Snackbar-BVA3LOhi.js";import"./data-import-KyR0bLZ-.js";import"./api-error-handler-CV6pRVHb.js";import"./tax-type-form-dialog-Ctl86VPY.js";import"./DialogContent-DtP-sWqR.js";import"./DialogTitle-C3eBZids.js";import"./DialogActions-h_2rRG3x.js";import"./contact-form-dialog-1sJlvlMf.js";import"./mui-tel-input.es-qb3PikOv.js";import"./location_data-s7SeKs4x.js";import"./contacts-Y516V3QZ.js";import"./AlertTitle-BbqQne_Q.js";import"./useFormControl-Cqn8lfES.js";import"./KeyboardArrowRight-CBVMFcL2.js";import"./LastPage-CUGiC0iB.js";import"./usePreviousProps-CVIlMhUg.js";import"./Popper-DDlcgFVJ.js";import"./Chip-Rg4Dn3a5.js";import"./useThemeProps-BDg4jra0.js";import"./index-Chjiymov.js";import"./visuallyHidden-Dan1xhjv.js";function De(t,x,m,i,d){const[l,u]=r.useState([]),[g,c]=r.useState(0),[s,p]=r.useState(!0),[v,j]=r.useState(0),n=()=>j(a=>a+1);return r.useEffect(()=>{p(!0),H({page:t+1,page_size:x,search:m,filters:i,sort_by:d}).then(a=>{u(a.data),c(a.total)}).catch(a=>{console.error("Failed to fetch invoices",a),u([]),c(0)}).finally(()=>p(!1))},[t,x,m,i,d,v]),{data:l,total:g,loading:s,refetch:n}}function Oe({row:t,selected:x,onSelectRow:m,onView:i,onEdit:d,onDelete:l,canEdit:u=!0,canDelete:g=!0,hideCheckbox:c=!1,index:s}){return e.jsxs(W,{hover:!0,tabIndex:-1,role:"checkbox",selected:x,children:[!c&&e.jsx(b,{padding:"checkbox",children:e.jsx($,{disableRipple:!0,checked:x,onChange:m})}),typeof s=="number"&&e.jsx(b,{align:"center",children:e.jsx(P,{sx:{width:28,height:28,display:"flex",borderRadius:"50%",alignItems:"center",justifyContent:"center",bgcolor:p=>F(p.palette.primary.main,.08),color:"primary.main",typography:"subtitle2",fontWeight:800,border:p=>`1px solid ${F(p.palette.primary.main,.16)}`,mx:"auto",transition:p=>p.transitions.create(["all"],{duration:p.transitions.duration.shorter}),"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.1)"}},children:s+1})}),e.jsx(b,{component:"th",scope:"row",children:e.jsx(P,{sx:{gap:2,display:"flex",alignItems:"center"},children:t.ref_no})}),e.jsx(b,{children:t.client_name}),e.jsx(b,{children:t.customer_name}),e.jsx(b,{children:ge(t.invoice_date)}),e.jsx(b,{align:"right",children:A(t.grand_total)}),e.jsx(b,{align:"right",children:A(t.received_amount)}),e.jsx(b,{align:"right",children:A(t.balance_amount)}),e.jsx(b,{align:"right",children:e.jsxs(P,{sx:{display:"flex",justifyContent:"flex-end"},children:[u&&t.received_amount===0&&e.jsx(R,{onClick:d,sx:{color:"primary.main"},children:e.jsx(y,{icon:"solar:pen-bold"})}),g&&t.received_amount===0&&e.jsx(R,{onClick:l,sx:{color:"error.main"},children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})}),e.jsx(R,{onClick:i,sx:{color:"info.main"},children:e.jsx(y,{icon:"solar:eye-bold"})})]})})]})}function Ae({order:t,onSort:x,orderBy:m,rowCount:i,headLabel:d,numSelected:l,onSelectAllRows:u,hideCheckbox:g=!1,showIndex:c=!1}){return e.jsx(fe,{children:e.jsxs(W,{children:[!g&&e.jsx(b,{padding:"checkbox",children:e.jsx($,{indeterminate:l>0&&l<i,checked:i>0&&l===i,onChange:s=>u(s.target.checked)})}),c&&e.jsx(b,{align:"center",children:"Sno"}),d.map(s=>e.jsx(b,{align:s.align||"left",sx:{width:s.width,minWidth:s.minWidth},children:s.label},s.id))]})})}const L=[{value:"modified_desc",label:"Newest First"},{value:"creation_asc",label:"Oldest First"},{value:"grand_total_desc",label:"Amount: High to Low"},{value:"grand_total_asc",label:"Amount: Low to High"},{value:"customer_name_asc",label:"Customer: A to Z"},{value:"customer_name_desc",label:"Customer: Z to A"}];function Fe({numSelected:t,filterName:x,onFilterName:m,onDelete:i,sortBy:d="modified_desc",onSortChange:l,onOpenFilter:u,canReset:g}){var a;const[c,s]=r.useState(null),p=h=>{s(h.currentTarget)},v=()=>{s(null)},j=h=>{l&&l(h),v()},n=((a=L.find(h=>h.value===d))==null?void 0:a.label)||"Sort";return e.jsxs(ye,{sx:{height:96,display:"flex",justifyContent:"space-between",p:h=>h.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(S,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(Ce,{value:x,onChange:m,placeholder:"Search invoices...",startAdornment:e.jsx(Se,{position:"start",children:e.jsx(y,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:480,width:1}}),e.jsx(P,{sx:{display:"flex",gap:1,alignItems:"center"},children:t>0?e.jsx(R,{onClick:i,children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[u&&e.jsx(T,{disableRipple:!0,color:"inherit",startIcon:e.jsx(Y,{color:"error",variant:"dot",invisible:!g,children:e.jsx(y,{icon:"ic:round-filter-list"})}),onClick:u,sx:{height:40,px:2,bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500},children:"Filters"}),l&&e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"text",color:"inherit",startIcon:e.jsx(y,{icon:"solar:sort-bold"}),onClick:p,sx:{minWidth:160,height:40,px:2,color:"text.primary",bgcolor:"background.neutral",border:"1px solid",borderColor:"divider",borderRadius:1,fontWeight:500,"&:hover":{bgcolor:"action.hover"}},children:n}),e.jsx(Ie,{anchorEl:c,open:!!c,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1,minWidth:200,boxShadow:h=>h.customShadows.z20}}},children:L.map(h=>e.jsx(oe,{selected:h.value===d,onClick:()=>j(h.value),sx:{typography:"body2",...h.value===d&&{bgcolor:f=>F(f.palette.primary.main,.08),fontWeight:"fontWeightSemiBold"}},children:h.label},h.value))})]})]})})]})}function We({open:t,onOpen:x,onClose:m,filters:i,onFilters:d,canReset:l,onResetFilters:u,options:g}){const c=(n,a)=>{d({[n]:a})},s=e.jsxs(P,{sx:{py:2.5,pl:3,pr:2,display:"flex",alignItems:"center",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(S,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Filters"}),e.jsx(R,{onClick:u,disabled:!l,sx:{mr:.5,color:l?"primary.main":"text.disabled","&:hover":{bgcolor:l?"primary.lighter":"transparent"}},children:e.jsx(Y,{color:"error",variant:"dot",invisible:!l,children:e.jsx(y,{icon:"solar:restart-bold",width:20})})}),e.jsx(R,{onClick:m,sx:{color:"text.secondary","&:hover":{bgcolor:"action.hover"}},children:e.jsx(y,{icon:"mingcute:close-line",width:20})})]}),p=e.jsxs(w,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Customer"}),e.jsx(E,{fullWidth:!0,size:"small",value:i.client_name==="all"?null:g.customers.find(n=>n.name===i.client_name)||null,onChange:(n,a)=>{c("client_name",a?a.name:"all")},options:g.customers,getOptionLabel:n=>`${n.customer_name} (${n.name})`,renderInput:n=>e.jsx(z,{...n,placeholder:"Search customers...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(n,a)=>r.createElement("li",{...n,key:a.name},e.jsxs(S,{variant:"body2",sx:{fontSize:"13px"},children:[a.customer_name," (",a.name,")"]}))})]}),v=e.jsxs(w,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Reference No"}),e.jsx(E,{fullWidth:!0,size:"small",value:i.ref_no||null,onChange:(n,a)=>{c("ref_no",a||"")},options:g.refNos,renderInput:n=>e.jsx(z,{...n,placeholder:"Select reference no...",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}),renderOption:(n,a)=>r.createElement("li",{...n,key:a},e.jsx(S,{variant:"body2",sx:{fontSize:"13px"},children:a}))})]}),j=e.jsxs(w,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",fontWeight:600},children:"Invoice Date"}),e.jsx(Pe,{value:i.invoice_date?ke(i.invoice_date):null,onChange:n=>{c("invoice_date",n?n.format("YYYY-MM-DD"):null)},slotProps:{textField:{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5,bgcolor:"background.neutral","&:hover":{bgcolor:"action.hover"}}}}}})]});return e.jsx(ne,{anchor:"right",open:t,onClose:m,PaperProps:{sx:{width:320}},sx:{zIndex:n=>n.zIndex.drawer+2},children:e.jsxs(Re,{dateAdapter:we,children:[s,e.jsx(M,{children:e.jsxs(w,{spacing:3,sx:{p:3},children:[p,v,j]})}),e.jsx(P,{sx:{p:3},children:e.jsx(T,{fullWidth:!0,color:"inherit",size:"large",variant:"outlined",startIcon:e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),onClick:u,disabled:!l,children:"Clear All Filters"})})]})})}const Ne=[{id:"ref_no",label:"Ref No"},{id:"client_name",label:"Customer ID"},{id:"customer_name",label:"Customer"},{id:"invoice_date",label:"Date"},{id:"grand_total",label:"Amount",align:"right"},{id:"received_amount",label:"Received",align:"right"},{id:"balance_amount",label:"Balance",align:"right"},{id:""}];function Be(){const t=Ee(),x=re(),[m,i]=r.useState({open:!1,id:null}),[d,l]=r.useState(""),[u,g]=r.useState("modified_desc"),[c,s]=r.useState({open:!1,message:"",severity:"success"}),[p,v]=r.useState(!1),[j,n]=r.useState({client_name:"all",ref_no:"",invoice_date:null}),[a,h]=r.useState([]),[f,_]=r.useState([]);r.useEffect(()=>{le("Contacts",["name","first_name","company_name"]).then(o=>{const C=o.map(k=>({name:k.name,customer_name:k.first_name+(k.company_name?` - ${k.company_name}`:"")}));h(C)}),H({page:1,page_size:1e3}).then(o=>{const C=Array.from(new Set(o.data.map(k=>k.ref_no).filter(Boolean)));_(C)})},[]);const{data:I,total:D,loading:N,refetch:G}=De(t.page,t.rowsPerPage,d,j,u),U=o=>{n(C=>({...C,...o})),t.onResetPage()},Z=()=>{n({client_name:"all",ref_no:"",invoice_date:null}),t.onResetPage()},O=j.client_name!=="all"||!!j.ref_no||!!j.invoice_date,q=r.useCallback(o=>{l(o.target.value),t.onResetPage()},[t]),Q=()=>{x.push("/invoices/new")},V=o=>{x.push(`/invoices/${encodeURIComponent(o)}/edit`)},J=o=>{x.push(`/invoices/${encodeURIComponent(o)}/view`)},K=r.useCallback(o=>{i({open:!0,id:o})},[]),X=async()=>{if(m.id)try{await ie(m.id),s({open:!0,message:"Invoice deleted successfully",severity:"success"}),await G()}catch(o){console.error(o),s({open:!0,message:"Failed to delete invoice",severity:"error"})}finally{i({open:!1,id:null})}},B=()=>{s(o=>({...o,open:!1}))},ee=!N&&I.length===0&&!!d,te=!N&&I.length===0&&!d&&!O;return e.jsxs(ce,{children:[e.jsxs(w,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(S,{variant:"h4",children:"Invoices"}),e.jsx(T,{variant:"contained",color:"info",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),onClick:Q,children:"New Invoice"})]}),e.jsxs(de,{children:[e.jsx(Fe,{numSelected:t.selected.length,filterName:d,onFilterName:q,sortBy:u,onSortChange:g,onOpenFilter:()=>v(!0),canReset:O}),e.jsx(M,{children:e.jsx(be,{sx:{overflow:"unset"},children:e.jsxs(je,{sx:{minWidth:800},children:[e.jsx(Ae,{order:t.order,orderBy:t.orderBy,rowCount:D,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:o=>t.onSelectAllRows(o,I.map(C=>C.name)),hideCheckbox:!0,showIndex:!0,headLabel:Ne}),e.jsxs(ve,{children:[I.map((o,C)=>e.jsx(Oe,{index:t.page*t.rowsPerPage+C,hideCheckbox:!0,row:{id:o.name,ref_no:o.ref_no,client_name:o.client_name||"",customer_name:o.customer_name||"",invoice_date:o.invoice_date,grand_total:o.grand_total||0,received_amount:o.received_amount||0,balance_amount:o.balance_amount||0},selected:t.selected.includes(o.name),onSelectRow:()=>t.onSelectRow(o.name),onEdit:()=>V(o.name),onView:()=>J(o.name),onDelete:()=>K(o.name)},o.name)),e.jsx(ue,{height:77,emptyRows:pe(t.page,t.rowsPerPage,D)}),ee&&e.jsx(xe,{searchQuery:d}),te&&e.jsx(W,{children:e.jsx(b,{colSpan:8,children:e.jsx(me,{title:"No invoices found",description:"Create a new invoice to track your sales pipeline.",icon:"solar:bill-list-bold-duotone"})})})]})]})})}),e.jsx(_e,{page:t.page,component:"div",count:D,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:t.onChangeRowsPerPage})]}),e.jsx(We,{open:p,onOpen:()=>v(!0),onClose:()=>v(!1),filters:j,onFilters:U,canReset:O,onResetFilters:Z,options:{customers:a,refNos:f}}),e.jsx(Te,{open:c.open,autoHideDuration:6e3,onClose:B,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ae,{onClose:B,severity:c.severity,sx:{width:"100%"},children:c.message})}),e.jsx(he,{open:m.open,onClose:()=>i({open:!1,id:null}),title:"Confirm Delete",content:"Are you sure you want to delete this invoice?",action:e.jsx(T,{variant:"contained",color:"error",onClick:X,sx:{borderRadius:1.5,minWidth:100},children:"Delete"})})]})}function Ee(){const[t,x]=r.useState(0),[m,i]=r.useState("ref_no"),[d,l]=r.useState(5),[u,g]=r.useState([]),[c,s]=r.useState("asc"),p=r.useCallback(f=>{s(m===f&&c==="asc"?"desc":"asc"),i(f)},[c,m]),v=r.useCallback((f,_)=>{g(f?_:[])},[]),j=r.useCallback(f=>{g(_=>_.includes(f)?_.filter(I=>I!==f):[..._,f])},[]),n=()=>x(0);return{page:t,order:c,orderBy:m,rowsPerPage:d,selected:u,onSort:p,onSelectRow:j,onSelectAllRows:v,onResetPage:n,onChangePage:(f,_)=>x(_),onChangeRowsPerPage:f=>{l(parseInt(f.target.value,10)),n()}}}function Rt(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Invoices - ${se.appName}`}),e.jsx(Be,{})]})}export{Rt as default};
